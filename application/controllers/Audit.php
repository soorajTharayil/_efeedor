<?php
defined('BASEPATH') or exit('No direct script access allowed');

class Audit extends CI_Controller
{
    private $module;

    public function __construct()
    {
        parent::__construct();
        $this->load->library('session');

        if ($this->session->userdata('isLogIn') === false && $this->uri->segment(2) != 'track')
            redirect('login');

        $this->load->model(
            array(
                'dashboard_model',
                'efeedor_model',
                'tickets_model',
                'ipd_model',
                'audit_model',
                'setting_model',
                'departmenthead_model',
            )
        );


        $dates = get_from_to_date();
        if (isset($_SESSION['from_date']) && isset($_SESSION['to_date'])) {
            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
        } else {
            $fdate = date('Y-m-d', time());
            $tdate = date('Y-m-d', strtotime('-365 days'));
            $_SESSION['from_date'] = $fdate;
            $_SESSION['to_date'] = $tdate;
        }

        $this->module = 'inpatient_modules';

        $this->session->set_userdata([
            'active_menu' => array('ip_dashboard', 'ip_ticket', 'ip_reports', 'ip_patients', 'ip_settings', 'ip_dep', 'ip_analysis'),
        ]);

        if (ismodule_active('AUDIT') === false && $this->uri->segment(2) != 'track')
            redirect('dashboard/noaccess');
    }

    // RESERVED FOR DEVELOPER OR COMPANY ACCESS
    public function index()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');

        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'IP MODULE CONFIGURATION';
            $data['content'] = $this->load->view('auditmodules/developer', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function get_doctors_by_department()
    {
        $department = $this->input->post('department');
        $this->db->where('title', $department);
        $dept = $this->db->get('bf_audit_department')->row_array();

        $options = "<option value=''>Select Doctor</option>";
        if (!empty($dept['bed_no'])) {
            $doctors = explode(',', $dept['bed_no']);
            foreach ($doctors as $doc) {
                $doc = trim($doc);
                $options .= "<option value='{$doc}'>{$doc}</option>";
            }
        }

        // ✅ Return as JSON (so it won’t appear as raw text)
        echo json_encode([
            'html' => $options,
            'csrfName' => $this->security->get_csrf_token_name(),
            'csrfHash' => $this->security->get_csrf_hash()
        ]);
    }




    public function audit_welcome_page()
    {



        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();

            $data['title'] = 'QUALITY AUDIT MANAGER DASHBOARD';
            #------------------------------#
            $data['content'] = $this->load->view('audit_welcome_page', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function delete_audit($id)
    {
        $table = $this->input->get('table');

        if (empty($table)) {
            $this->session->set_flashdata('error', 'No table specified for deletion.');
            redirect($_SERVER['HTTP_REFERER']); // back to same page
            return;
        }

        $audit_array = [
            'bf_ma_active_cases_mrdip',
            'bf_ma_dischargedpatients_mrd_audit',
            'bf_ma_nursingip_closed_cases',
            'bf_ma_nursingip_open_cases',
            'bf_ma_nursingop_closed_cases',
            'bf_ma_clinical_active_mdc',
            'bf_ma_clinical_closedcases_mdc',
            'bf_ma_clinical_pharmacy_closed',
            'bf_ma_clinical_pharmacy_op',
            'bf_ma_clinical_pharmacy_open',
            'bf_ma_anesthesia_active_mdc',
            'bf_ma_anesthesia_closed_mdc',
            'bf_ma_ed_active_mdc',
            'bf_ma_ed_closed_mdc',
            'bf_ma_icu_active_mdc',
            'bf_ma_icu_closed_mdc',
            'bf_ma_primarycare_active_mdc',
            'bf_ma_primarycare_closed_mdc',
            'bf_ma_sedation_active_mdc',
            'bf_ma_sedation_closed_mdc',
            'bf_ma_surgeons_active_mdc',
            'bf_ma_surgeons_closed_mdc',
            'bf_ma_dietconsultation_op_mdc',
            'bf_ma_physiotherapy_closed_mdc',
            'bf_ma_physiotherapy_op_mdc',
            'bf_ma_physiotherapy_open_mdc',
            'bf_ma_mrd_ed_audit',
            'bf_ma_mrd_lama_audit',
            'bf_ma_mrd_op_audit',
            'bf_ma_accidental_delining_audit',
            'bf_ma_admission_area_audit',
            'bf_ma_cardio_pulmonary_audit',
            'bf_ma_extravasation_audit',
            'bf_ma_hapu_audit',
            'bf_ma_assessment_ae',
            'bf_ma_assessment_ipd',
            'bf_ma_assessment_opd',
            'bf_ma_ipsg1_audit',
            'bf_ma_ipsg2_er',
            'bf_ma_ipsg2_ae',
            'bf_ma_ipsg2_ipd',
            'bf_ma_ipsg4_timeout',
            'bf_ma_ipsg6_ip',
            'bf_ma_ipsg6_opd',
            'bf_ma_point_prevlance_audit',
            'bf_ma_clinicaloutcome_audit_acl',
            'bf_ma_clinicaloutcome_allogenic_bone_marrow',
            'bf_ma_clinicaloutcome_aortic_value_replacement',
            'bf_ma_clinicaloutcome_autologous_bone',
            'bf_ma_clinicaloutcome_brain_tumour',
            'bf_ma_clinicaloutcome_cabg',
            'bf_ma_clinicaloutcome_carotid_stenting',
            'bf_ma_clinicaloutcome_chemotherapy',
            'bf_ma_clinicaloutcome_colo_rectal',
            'bf_ma_clinicaloutcome_endoscopy',
            'bf_ma_clinicaloutcome_epilepsy',
            'bf_ma_clinicaloutcome_herniorrhaphy',
            'bf_ma_clinicaloutcome_holep',
            'bf_ma_clinicaloutcome_laparoscopic_appendicectomy',
            'bf_ma_clinicaloutcome_mechanical_thrombectomy',
            'bf_ma_clinicaloutcome_mvr',
            'bf_ma_clinicaloutcome_ptca',
            'bf_ma_clinicaloutcome_renal_transplantation',
            'bf_ma_clinicaloutcome_scoliosis_correction',
            'bf_ma_clinicaloutcome_spinal_dysraphism',
            'bf_ma_clinicaloutcome_spine_disc_surgery',
            'bf_ma_clinicaloutcome_thoracotomy',
            'bf_ma_clinicaloutcome_tkr',
            'bf_ma_clinicaloutcome_uro_oncology',
            'bf_ma_clinicaloutcome_whipples_surgery',
            'bf_ma_clinicaloutcome_laparoscopic_cholecystectomy',
            'bf_ma_clinicalkpi_bronchodilators_audit',
            'bf_ma_clinicalkpi_copd_protocol_audit',
            'bf_ma_infection_control_biomedical_waste',
            'bf_ma_infection_control_canteen_audit',
            'bf_ma_infection_control_cssd_audit',
            'bf_ma_infection_control_hand_hygiene',
            'bf_ma_infection_control_bundle_audit',
            'bf_ma_infection_control_ot_audit',
            'bf_ma_infection_control_linen_audit',
            'bf_ma_infection_control_ambulance_audit',
            'bf_ma_infection_control_coffee_audit',
            'bf_ma_infection_control_laboratory_audit',
            'bf_ma_infection_control_mortuary_audit',
            'bf_ma_infection_control_radiology_audit',
            'bf_ma_infection_control_ssi_survelliance_audit',
            'bf_ma_infection_control_peripheralivline_audit',
            'bf_ma_infection_control_personalprotective_audit',
            'bf_ma_infection_control_safe_injection_audit',
            'bf_ma_infection_control_surface_cleaning_audit',
            'bf_ma_clinical_pathway_arthroscopic_audit',
            'bf_ma_clinical_pathway_breast_lump_audit',
            'bf_ma_clinical_pathway_cardiac_arrest_audit',
            'bf_ma_clinical_pathway_donor_hepatectomy_audit',
            'bf_ma_clinical_pathway_febrile_seizure_audit',
            'bf_ma_clinical_pathway_heart_transplant_audit',
            'bf_ma_clinical_pathway_laproscopic_audit',
            'bf_ma_clinical_pathway_picc_line_audit',
            'bf_ma_clinical_pathway_stroke_audit',
            'bf_ma_clinical_pathway_urodynamics_audit',
            'bf_ma_clinical_pathway_stemi_audit',
            'bf_ma_bmw_audit',
            'bf_ma_pest_control_audit'
        ];

        if (!in_array($table, $audit_array)) {
            $this->session->set_flashdata('error', 'Invalid table specified for deletion.');
            redirect($_SERVER['HTTP_REFERER']); // back to same page
            return;
        }

        // Prepare action log text
        $fullname = $this->session->userdata('fullname');
        $designation = $this->session->userdata('designation');
        $action_text = 'Audit Deleted by ' . $fullname . ' (' . $designation . ')';

        // ✅ Soft delete instead of actual delete
        $this->db->where('id', $id);
        $updated = $this->db->update($table, [
            'status' => 'Deleted',
            'action' => $action_text
        ]);

        if ($updated) {
            $this->session->set_flashdata('message', 'Audit record marked as deleted successfully.');
        } else {
            $this->session->set_flashdata('error', 'Unable to mark the record as deleted.');
        }

        redirect($_SERVER['HTTP_REFERER']); // back to same audit page
    }




    public function audit_master()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'AUDIT MASTER';
            #------------------------------#
            $data['content'] = $this->load->view('audit_master', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }


    //main page of MRD & MDC Audit


    public function feedbacks_report_active_cases_mrd()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'Active Cases MRD Audit- IP';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_active_cases_mrd', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function feedbacks_report_discharged_patients_mrd()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'Discharged Patients MRD Audit';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_discharged_patients_mrd', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function feedbacks_report_nursing_ip_closed()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'Nursing (IP Closed Cases)';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_nursing_ip_closed', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function feedbacks_report_nursing_ip_open()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'Nursing (IP Open Cases)';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_nursing_ip_open', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function feedbacks_report_nursing_op_closed()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'Nursing (OP Closed Cases)';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_nursing_op_closed', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function feedbacks_report_clinical_active_mdc()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'Clinical Dietetics (Active)';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_clinical_active_mdc', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function feedbacks_report_clinical_closed_mdc()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'Clinical Dietetics (Closed Cases)';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_clinical_closed_mdc', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function feedbacks_report_clinical_pharmacy_closed()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'Clinical Pharmacy- (Closed)';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_clinical_pharmacy_closed', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function feedbacks_report_clinical_pharmacy_op()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'Clinical Pharmacy- (OP)';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_clinical_pharmacy_op', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function feedbacks_report_clinical_pharmacy_open()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'Clinical Pharmacy- (Open)';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_clinical_pharmacy_open', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function feedbacks_report_anesthesia_active()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'Clinicians-Anesthesia (Active)';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_anesthesia_active', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function feedbacks_report_anesthesia_closed()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'Clinicians-Anesthesia (Closed)';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_anesthesia_closed', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function feedbacks_report_ed_active()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'Clinicians- ED (Active)';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_ed_active', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function feedbacks_report_ed_closed()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'Clinicians- ED (Closed)';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_ed_closed', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function feedbacks_report_icu_active()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'Clinicians- ICU (Active)';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_icu_active', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function feedbacks_report_icu_closed()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'Clinicians- ICU (Closed)';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_icu_closed', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function feedbacks_report_primarycare_active()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'Clinicians- Primary Care Provider (Active)';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_primarycare_active', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function feedbacks_report_primarycare_closed()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'Clinicians- Primary Care Provider (Closed)';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_primarycare_closed', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function feedbacks_report_sedation_active()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'Clinicians- Sedation (Active)';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_sedation_active', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function feedbacks_report_sedation_closed()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'Clinicians- Sedation (Closed)';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_sedation_closed', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function feedbacks_report_surgeons_active()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'Clinicians- Surgeons (Active)';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_surgeons_active', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function feedbacks_report_surgeons_closed()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'Clinicians- Surgeons (Closed)';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_surgeons_closed', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function feedbacks_report_diet_consultation_op()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'Diet Consultation (OP)';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_diet_consultation_op', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function feedbacks_report_physiotherapy_closed()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'Physiotherapy- (Closed)';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_physiotherapy_closed', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function feedbacks_report_physiotherapy_op()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'Physiotherapy- (OP)';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_physiotherapy_op', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function feedbacks_report_physiotherapy_open()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'Physiotherapy- (Open)';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_physiotherapy_open', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function feedbacks_report_mrd_ed()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'MRD Audit- ED';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_mrd_ed', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function feedbacks_report_mrd_lama()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'MRD Audit- LAMA';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_mrd_lama', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function feedbacks_report_mrd_op()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'MRD Audit- OP';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_mrd_op', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }




    // individual page for MRD & MDC Audit


    public function active_cases_mrd_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/active_cases_mrd_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/active_cases_mrd_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function discharged_patients_mrd_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/discharged_patients_mrd_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/discharged_patients_mrd_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function nursing_ip_closed_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/nursing_ip_closed_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/nursing_ip_closed_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function nursing_ip_open_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/nursing_ip_open_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/nursing_ip_open_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function nursing_op_closed_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/nursing_op_closed_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/nursing_op_closed_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function clinical_active_mdc_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/clinical_active_mdc_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/clinical_active_mdc_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function clinical_closed_mdc_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/clinical_closed_mdc_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/clinical_closed_mdc_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function clinical_pharmacy_closed_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/clinical_pharmacy_closed_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/clinical_pharmacy_closed_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function clinical_pharmacy_op_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/clinical_pharmacy_op_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/clinical_pharmacy_op_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function clinical_pharmacy_open_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/clinical_pharmacy_open_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/clinical_pharmacy_open_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function anesthesia_active_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/anesthesia_active_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/anesthesia_active_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function anesthesia_closed_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/anesthesia_closed_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/anesthesia_closed_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function ed_active_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/ed_active_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/ed_active_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function ed_closed_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/ed_closed_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/ed_closed_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function icu_active_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/icu_active_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/icu_active_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function icu_closed_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/icu_closed_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/icu_closed_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function primarycare_active_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/primarycare_active_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/primarycare_active_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function primarycare_closed_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/primarycare_closed_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/primarycare_closed_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function sedation_active_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/sedation_active_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/sedation_active_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function sedation_closed_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/sedation_closed_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/sedation_closed_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function surgeons_active_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/surgeons_active_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/surgeons_active_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function surgeons_closed_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/surgeons_closed_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/surgeons_closed_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function diet_consultation_op_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/diet_consultation_op_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/diet_consultation_op_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function physiotherapy_closed_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/physiotherapy_closed_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/physiotherapy_closed_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function physiotherapy_op_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/physiotherapy_op_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/physiotherapy_op_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function physiotherapy_open_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/physiotherapy_open_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/physiotherapy_open_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function mrd_ed_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/mrd_ed_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/mrd_ed_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function mrd_lama_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/mrd_lama_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/mrd_lama_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function mrd_op_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/mrd_op_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/mrd_op_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }









    // Main page for Nursing and IPSG Audit

    public function feedbacks_report_accidental_delining()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'Accidental Delining Audit';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_accidental_delining', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function feedbacks_report_admission_holding_area()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'Admission Holding Area Audit';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_admission_holding_area', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function feedbacks_report_cardio_pulmonary()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'CPR Analysis Record';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_cardio_pulmonary', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function feedbacks_report_extravasation_audit()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'Extravasation Audit';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_extravasation_audit', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function feedbacks_report_hapu_audit()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'Hospital Acquired Pressure Ulcers (HAPU) Audit';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_hapu_audit', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function feedbacks_report_initial_assessment_ae()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'Initial Assessment Accident and Emergency (A&E)';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_initial_assessment_ae', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function feedbacks_report_initial_assessment_ipd()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'Initial Assessment IPD';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_initial_assessment_ipd', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function feedbacks_report_initial_assessment_opd()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'Initial Assessment OPD';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_initial_assessment_opd', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function feedbacks_report_ipsg1()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'IPSG-1';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_ipsg1', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function feedbacks_report_ipsg2_er()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'IPSG-2- ER';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_ipsg2_er', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function feedbacks_report_ipsg2_ae()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'IPSG-2- A&E';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_ipsg2_ae', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function feedbacks_report_ipsg2_ipd()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'IPSG-2- IPD';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_ipsg2_ipd', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function feedbacks_report_ipsg4_timeout()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'IPSG4-Timeout- Outside OT Audit';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_ipsg4_timeout', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function feedbacks_report_ipsg6_ip()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'IPSG6- IP';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_ipsg6_ip', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function feedbacks_report_ipsg6_opd()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'IPSG6- OPD';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_ipsg6_opd', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function feedbacks_report_point_prevelance()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'Point Prevalence Audit';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_point_prevelance', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }


    // individual page for Nursing & IPSG Audit

    public function accidental_delining_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/accidental_delining_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/accidental_delining_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function admission_holding_area_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/admission_holding_area_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/admission_holding_area_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function cardio_pulmonary_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/cardio_pulmonary_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/cardio_pulmonary_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function extravasation_audit_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/extravasation_audit_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/extravasation_audit_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function hapu_audit_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/hapu_audit_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/hapu_audit_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function initial_assessment_ae_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/initial_assessment_ae_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/initial_assessment_ae_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function initial_assessment_ipd_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/initial_assessment_ipd_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/initial_assessment_ipd_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function initial_assessment_opd_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/initial_assessment_opd_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/initial_assessment_opd_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function ipsg1_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/ipsg1_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/ipsg1_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function ipsg2_er_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/ipsg2_er_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/ipsg2_er_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function ipsg2_ae_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/ipsg2_ae_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/ipsg2_ae_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function ipsg2_ipd_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/ipsg2_ipd_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/ipsg2_ipd_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function ipsg4_timeout_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/ipsg4_timeout_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/ipsg4_timeout_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function ipsg6_ip_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/ipsg6_ip_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/ipsg6_ip_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function ipsg6_opd_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/ipsg6_opd_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/ipsg6_opd_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function point_prevelance_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/point_prevelance_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/point_prevelance_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }


    //main page of Clinical outcome

    public function feedbacks_report_clinical_audit_acl()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'ACL';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_clinical_audit_acl', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function feedbacks_report_clinical_allogenic_bone_marrow()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'Allogenic Bone Marrow Transplantation';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_clinical_allogenic_bone_marrow', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function feedbacks_report_clinical_aortic_value_replacement()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'Aortic Valve Replacement (AVR)';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_clinical_aortic_value_replacement', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function feedbacks_report_clinical_autologous_bone()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'Autologous Bone Marrow Transplantation';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_clinical_autologous_bone', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function feedbacks_report_clinical_brain_tumour()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'Brain Tumour Surgery';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_clinical_brain_tumour', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function feedbacks_report_clinical_cabg()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'CABG';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_clinical_cabg', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function feedbacks_report_clinical_carotid_stenting()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'Carotid Stenting';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_clinical_carotid_stenting', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function feedbacks_report_clinical_chemotherapy()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'Chemotherapy (Medical Oncology)';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_clinical_chemotherapy', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function feedbacks_report_clinical_colo_rectal()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'Colo-Rectal Surgeries';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_clinical_colo_rectal', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function feedbacks_report_clinical_endoscopy()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'Endoscopy';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_clinical_endoscopy', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function feedbacks_report_clinical_epilepsy()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'Epilepsy';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_clinical_epilepsy', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function feedbacks_report_clinical_herniorrhaphy()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'Herniorrhaphy';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_clinical_herniorrhaphy', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function feedbacks_report_clinical_holep()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'HoLEP';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_clinical_holep', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function feedbacks_report_clinical_laparoscopic()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'Laparoscopic Appendicectomy';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_clinical_laparoscopic', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function feedbacks_report_clinical_mechanical_thrombectomy()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'Mechanical Thrombectomy';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_clinical_mechanical_thrombectomy', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function feedbacks_report_clinical_mvr()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'MVR (Mitral Valve Replacement)';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_clinical_mvr', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function feedbacks_report_clinical_ptca()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'PTCA';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_clinical_ptca', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function feedbacks_report_clinical_renal_transplantation()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'Renal Transplantation';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_clinical_renal_transplantation', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function feedbacks_report_clinical_scoliosis_correction()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'Scoliosis Correction Surgery';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_clinical_scoliosis_correction', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function feedbacks_report_clinical_spinal_dysraphism()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'Spinal Dysraphism';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_clinical_spinal_dysraphism', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function feedbacks_report_clinical_spine_disc_surgery()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'Spine & Disc Surgery-Fusion Procedures';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_clinical_spine_disc_surgery', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function feedbacks_report_clinical_thoracotomy()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'Thoracotomy';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_clinical_thoracotomy', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function feedbacks_report_clinical_tkr()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'TKR';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_clinical_tkr', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function feedbacks_report_clinical_uro_oncology()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'Uro-oncology Procedures';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_clinical_uro_oncology', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function feedbacks_report_clinical_whipples_surgery()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'Whipples Surgery';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_clinical_whipples_surgery', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function feedbacks_report_clinical_laparoscopic_cholecystectomy()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'Laparoscopic Cholecystectomy';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_clinical_laparoscopic_cholecystectomy', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }


    //individual page of Clinical outcome
    public function clinical_audit_acl_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/clinical_audit_acl_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/clinical_audit_acl_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function clinical_allogenic_bone_marrow_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/clinical_allogenic_bone_marrow_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/clinical_allogenic_bone_marrow_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function clinical_aortic_value_replacement_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/clinical_aortic_value_replacement_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/clinical_aortic_value_replacement_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function clinical_autologous_bone_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/clinical_autologous_bone_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/clinical_autologous_bone_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function clinical_brain_tumour_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/clinical_brain_tumour_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/clinical_brain_tumour_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function clinical_cabg_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/clinical_cabg_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/clinical_cabg_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function clinical_carotid_stenting_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/clinical_carotid_stenting_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/clinical_carotid_stenting_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function clinical_chemotherapy_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/clinical_chemotherapy_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/clinical_chemotherapy_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function clinical_colo_rectal_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/clinical_colo_rectal_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/clinical_colo_rectal_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function clinical_endoscopy_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/clinical_endoscopy_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/clinical_endoscopy_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function clinical_epilepsy_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/clinical_epilepsy_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/clinical_epilepsy_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function clinical_herniorrhaphy_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/clinical_herniorrhaphy_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/clinical_herniorrhaphy_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function clinical_holep_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/clinical_holep_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/clinical_holep_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function clinical_laparoscopic_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/clinical_laparoscopic_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/clinical_laparoscopic_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function clinical_mechanical_thrombectomy_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/clinical_mechanical_thrombectomy_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/clinical_mechanical_thrombectomy_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function clinical_mvr_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/clinical_mvr_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/clinical_mvr_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function clinical_ptca_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/clinical_ptca_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/clinical_ptca_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function clinical_renal_transplantation_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/clinical_renal_transplantation_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/clinical_renal_transplantation_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function clinical_scoliosis_correction_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/clinical_scoliosis_correction_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/clinical_scoliosis_correction_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function clinical_spinal_dysraphism_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/clinical_spinal_dysraphism_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/clinical_spinal_dysraphism_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function clinical_spine_disc_surgery_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/clinical_spine_disc_surgery_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/clinical_spine_disc_surgery_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function clinical_thoracotomy_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/clinical_thoracotomy_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/clinical_thoracotomy_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function clinical_tkr_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/clinical_tkr_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/clinical_tkr_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function clinical_uro_oncology_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/clinical_uro_oncology_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/clinical_uro_oncology_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function clinical_whipples_surgery_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/clinical_whipples_surgery_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/clinical_whipples_surgery_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function clinical_laparoscopic_cholecystectomy_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/clinical_laparoscopic_cholecystectomy_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/clinical_laparoscopic_cholecystectomy_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }



    //Main page of Clinical KPI
    public function feedbacks_report_clinicalkpi_bronchodilators()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'Bronchodilators Audit';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_clinicalkpi_bronchodilators', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function feedbacks_report_clinicalkpi_copd_protocol()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'COPD Protocol Audit';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_clinicalkpi_copd_protocol', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }

    //Individual page of Clinical KPI
    public function clinicalkpi_bronchodilators_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/clinicalkpi_bronchodilators_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/clinicalkpi_bronchodilators_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function clinicalkpi_copd_protocol_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/clinicalkpi_copd_protocol_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/clinicalkpi_copd_protocol_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }

    //Main page of Infection Control
    public function feedbacks_report_infection_control_biomedical_waste()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'Biomedical Waste Management Audit';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_infection_control_biomedical_waste', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function feedbacks_report_infection_control_canteen_audit()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'Canteen Audit';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_infection_control_canteen_audit', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function feedbacks_report_infection_control_cssd_audit()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'CSSD Audit';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_infection_control_cssd_audit', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function feedbacks_report_infection_control_hand_hygiene()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'Hand Hygiene Audit';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_infection_control_hand_hygiene', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function feedbacks_report_infection_control_bundle_audit()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'Infection Control Bundle Audit';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_infection_control_bundle_audit', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function feedbacks_report_infection_control_ot_audit()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'Infection Control OT audit';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_infection_control_ot_audit', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function feedbacks_report_infection_control_ambulance_audit()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'Ambulance PCI Audit ';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_infection_control_ambulance_audit', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function feedbacks_report_infection_control_linen_audit()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'Linen Audit';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_infection_control_linen_audit', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function feedbacks_report_infection_control_coffee_audit()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'Coffee Shop PCI Audit';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_infection_control_coffee_audit', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function feedbacks_report_infection_control_laboratory_audit()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'Laboratory PCI Audit';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_infection_control_laboratory_audit', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function feedbacks_report_infection_control_mortuary_audit()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'Mortuary PCI Audit';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_infection_control_mortuary_audit', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function feedbacks_report_infection_control_radiology_audit()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'Radiology PCI Audit';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_infection_control_radiology_audit', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function feedbacks_report_infection_control_ssi_survelliance_audit()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'SSI Surveillance checklist';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_infection_control_ssi_survelliance_audit', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function feedbacks_report_infection_control_peripheralivline_audit()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'IV Cannula Audit';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_infection_control_peripheralivline_audit', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function feedbacks_report_infection_control_personalprotective_audit()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'Personal Protective Equipment Usage audit';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_infection_control_personalprotective_audit', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function feedbacks_report_infection_control_safe_injection_audit()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'Safe Injection and Infusion Audit';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_infection_control_safe_injection_audit', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function feedbacks_report_infection_control_surface_cleaning_audit()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'Surface cleaning & Disinfection effectiveness monitoring record';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_infection_control_surface_cleaning_audit', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }

    //Individual page of Infection control
    public function infection_control_biomedical_waste_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/infection_control_biomedical_waste_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/infection_control_biomedical_waste_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function infection_control_canteen_audit_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/infection_control_canteen_audit_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/infection_control_canteen_audit_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function infection_control_cssd_audit_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/infection_control_cssd_audit_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/infection_control_cssd_audit_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function infection_control_hand_hygiene_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/infection_control_hand_hygiene_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/infection_control_hand_hygiene_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function infection_control_bundle_audit_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/infection_control_bundle_audit_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/infection_control_bundle_audit_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function infection_control_ot_audit_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/infection_control_ot_audit_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/infection_control_ot_audit_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function infection_control_linen_audit_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/infection_control_linen_audit_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/infection_control_linen_audit_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function infection_control_ambulance_audit_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/infection_control_ambulance_audit_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/infection_control_ambulance_audit_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function infection_control_coffee_audit_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/infection_control_coffee_audit_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/infection_control_coffee_audit_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function infection_control_laboratory_audit_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/infection_control_laboratory_audit_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/infection_control_laboratory_audit_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function infection_control_mortuary_audit_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/infection_control_mortuary_audit_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/infection_control_mortuary_audit_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function infection_control_radiology_audit_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/infection_control_radiology_audit_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/infection_control_radiology_audit_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function infection_control_ssi_survelliance_audit_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/infection_control_ssi_survelliance_audit_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/infection_control_ssi_survelliance_audit_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function infection_control_peripheralivline_audit_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/infection_control_peripheralivline_audit_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/infection_control_peripheralivline_audit_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function infection_control_personalprotective_audit_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/infection_control_personalprotective_audit_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/infection_control_personalprotective_audit_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function infection_control_safe_injection_audit_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/infection_control_safe_injection_audit_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/infection_control_safe_injection_audit_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function infection_control_surface_cleaning_audit_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/infection_control_surface_cleaning_audit_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/infection_control_surface_cleaning_audit_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }



    //Main page of Clinical Pathways
    public function feedbacks_report_clinical_pathway_arthroscopic_audit()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'Arthroscopic Anterior Cruciate Ligament Reconstruction Surgery';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_clinical_pathway_arthroscopic_audit', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function feedbacks_report_clinical_pathway_breast_lump_audit()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'Breast Lump Consensus Guidelines';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_clinical_pathway_breast_lump_audit', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function feedbacks_report_clinical_pathway_cardiac_arrest_audit()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'Cardiac Arrest';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_clinical_pathway_cardiac_arrest_audit', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function feedbacks_report_clinical_pathway_donor_hepatectomy_audit()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'Donor Hepatectomy';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_clinical_pathway_donor_hepatectomy_audit', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function feedbacks_report_clinical_pathway_febrile_seizure_audit()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'Febrile Seizure';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_clinical_pathway_febrile_seizure_audit', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function feedbacks_report_clinical_pathway_heart_transplant_audit()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'Heart Transplant Recipient';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_clinical_pathway_heart_transplant_audit', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function feedbacks_report_clinical_pathway_laproscopic_audit()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'Laparoscopic Donor Nephrectomy';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_clinical_pathway_laproscopic_audit', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function feedbacks_report_clinical_pathway_picc_line_audit()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'PICC LINE Insertion';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_clinical_pathway_picc_line_audit', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function feedbacks_report_clinical_pathway_stroke_audit()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'Stroke';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_clinical_pathway_stroke_audit', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function feedbacks_report_clinical_pathway_urodynamics_audit()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'Urodynamics';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_clinical_pathway_urodynamics_audit', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function feedbacks_report_clinical_pathway_stemi_audit()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'STEMI-Primary PCI Clinical Pathway ';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_clinical_pathway_stemi_audit', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }


    //Individual page of Clinical Pathways
    public function clinical_pathway_arthroscopic_audit_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/clinical_pathway_arthroscopic_audit_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/clinical_pathway_arthroscopic_audit_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function clinical_pathway_breast_lump_audit_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/clinical_pathway_breast_lump_audit_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/clinical_pathway_breast_lump_audit_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function clinical_pathway_cardiac_arrest_audit_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/clinical_pathway_cardiac_arrest_audit_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/clinical_pathway_cardiac_arrest_audit_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function clinical_pathway_donor_hepatectomy_audit_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/clinical_pathway_donor_hepatectomy_audit_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/clinical_pathway_donor_hepatectomy_audit_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function clinical_pathway_febrile_seizure_audit_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/clinical_pathway_febrile_seizure_audit_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/clinical_pathway_febrile_seizure_audit_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function clinical_pathway_heart_transplant_audit_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/clinical_pathway_heart_transplant_audit_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/clinical_pathway_heart_transplant_audit_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function clinical_pathway_laproscopic_audit_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/clinical_pathway_laproscopic_audit_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/clinical_pathway_laproscopic_audit_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function clinical_pathway_picc_line_audit_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/clinical_pathway_picc_line_audit_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/clinical_pathway_picc_line_audit_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function clinical_pathway_stroke_audit_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/clinical_pathway_stroke_audit_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/clinical_pathway_stroke_audit_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function clinical_pathway_urodynamics_audit_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/clinical_pathway_urodynamics_audit_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/clinical_pathway_urodynamics_audit_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function clinical_pathway_stemi_audit_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/clinical_pathway_stemi_audit_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/clinical_pathway_stemi_audit_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }
    //main page for House Keeping
    public function feedbacks_report_bmw_audit()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'Biomedical Waste Collection Audit';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_bmw_audit', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function feedbacks_report_pest_control_audit()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'Pest Control Audit';
            $data['content'] = $this->load->view('auditmodules/feedbacks_report_pest_control_audit', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');
        } else {
            redirect('dashboard/noaccess');
        }
    }

    //Individual page for House Keeping
    public function bmw_audit_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/bmw_audit_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/bmw_audit_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function pest_control_audit_feedback()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'QUALITY AUDIT FORM';
            #------------------------------#
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/pest_control_audit_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/pest_control_audit_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }






    //edit page and to edit for MRD & MDC


    public function edit_active_cases_mrd_feedback()
    {

        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }


        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_active_cases_mrd_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_active_cases_mrd_feedback', $data, true);
            }
            //    $data['content'] = $this->load->view('qualitymodules/ticket_track', $data, true);

            $this->load->view('layout/main_wrapper', $data);
        }
    }


    public function edit_discharged_patients_mrd_feedback()
    {

        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }


        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_discharged_patients_mrd_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_discharged_patients_mrd_feedback', $data, true);
            }
            //    $data['content'] = $this->load->view('qualitymodules/ticket_track', $data, true);

            $this->load->view('layout/main_wrapper', $data);
        }
    }


    public function edit_nursing_ip_closed_feedback()
    {
        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }

        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_nursing_ip_closed_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_nursing_ip_closed_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
        }
    }

    public function edit_nursing_ip_open_feedback()
    {
        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }

        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_nursing_ip_open_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_nursing_ip_open_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
        }
    }

    public function edit_nursing_op_closed_feedback()
    {
        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }

        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_nursing_op_closed_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_nursing_op_closed_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
        }
    }

    public function edit_clinical_active_mdc_feedback()
    {
        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }

        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_clinical_active_mdc_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_clinical_active_mdc_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
        }
    }

    public function edit_clinical_closed_mdc_feedback()
    {
        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }

        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_clinical_closed_mdc_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_clinical_closed_mdc_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
        }
    }

    public function edit_clinical_pharmacy_closed_feedback()
    {
        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }

        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_clinical_pharmacy_closed_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_clinical_pharmacy_closed_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
        }
    }

    public function edit_clinical_pharmacy_op_feedback()
    {
        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }

        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_clinical_pharmacy_op_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_clinical_pharmacy_op_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
        }
    }

    public function edit_clinical_pharmacy_open_feedback()
    {
        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }

        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_clinical_pharmacy_open_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_clinical_pharmacy_open_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
        }
    }

    public function edit_anesthesia_active_feedback()
    {
        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }

        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_anesthesia_active_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_anesthesia_active_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
        }
    }

    public function edit_anesthesia_closed_feedback()
    {
        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }

        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_anesthesia_closed_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_anesthesia_closed_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
        }
    }

    public function edit_ed_active_feedback()
    {
        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }

        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_ed_active_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_ed_active_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
        }
    }

    public function edit_ed_closed_feedback()
    {
        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }

        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_ed_closed_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_ed_closed_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
        }
    }

    public function edit_icu_active_feedback()
    {
        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }

        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_icu_active_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_icu_active_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
        }
    }

    public function edit_icu_closed_feedback()
    {
        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }

        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_icu_closed_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_icu_closed_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
        }
    }

    public function edit_primarycare_active_feedback()
    {
        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }

        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_primarycare_active_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_primarycare_active_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
        }
    }

    public function edit_primarycare_closed_feedback()
    {
        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }

        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_primarycare_closed_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_primarycare_closed_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
        }
    }

    public function edit_sedation_active_feedback()
    {
        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }

        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_sedation_active_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_sedation_active_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
        }
    }

    public function edit_sedation_closed_feedback()
    {
        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }

        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_sedation_closed_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_sedation_closed_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
        }
    }

    public function edit_surgeons_active_feedback()
    {
        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }

        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_surgeons_active_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_surgeons_active_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
        }
    }

    public function edit_surgeons_closed_feedback()
    {
        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }

        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_surgeons_closed_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_surgeons_closed_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
        }
    }

    public function edit_diet_consultation_op_feedback()
    {
        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }

        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_diet_consultation_op_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_diet_consultation_op_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
        }
    }

    public function edit_physiotherapy_closed_feedback()
    {
        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }

        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_physiotherapy_closed_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_physiotherapy_closed_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
        }
    }

    public function edit_physiotherapy_op_feedback()
    {
        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }

        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_physiotherapy_op_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_physiotherapy_op_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
        }
    }

    public function edit_physiotherapy_open_feedback()
    {
        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }

        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_physiotherapy_open_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_physiotherapy_open_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
        }
    }

    public function edit_mrd_ed_feedback()
    {
        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }

        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_mrd_ed_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_mrd_ed_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
        }
    }

    public function edit_mrd_lama_feedback()
    {
        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }

        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_mrd_lama_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_mrd_lama_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
        }
    }

    public function edit_mrd_op_feedback()
    {
        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }

        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_mrd_op_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_mrd_op_feedback', $data, true);
            }

            $this->load->view('layout/main_wrapper', $data);
        }
    }

    //edit page for House Keeping
    public function edit_bmw_audit_feedback()
    {

        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }


        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_bmw_audit_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_bmw_audit_feedback', $data, true);
            }
            //    $data['content'] = $this->load->view('qualitymodules/ticket_track', $data, true);

            $this->load->view('layout/main_wrapper', $data);
        }
    }

    public function edit_pest_control_audit_feedback()
    {

        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }


        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_pest_control_audit_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_pest_control_audit_feedback', $data, true);
            }
            //    $data['content'] = $this->load->view('qualitymodules/ticket_track', $data, true);

            $this->load->view('layout/main_wrapper', $data);
        }
    }

    //To Edit audit by id for House Keeping
    public function edit_bmw_audit_feedback_byid($id)
    {
        // Check if form submitted
        if ($this->input->post()) {

            // 🧾 Get existing record
            $existing = $this->audit_model->get_biomedical_waste_collection_audit_feedback_byid($id);

            // Decode existing dataset JSON
            $dataset = json_decode($existing->dataset, true);
            if (!is_array($dataset)) {
                $dataset = [];
            }

            // Get existing files from dataset
            $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];

            // 🗑️ Handle removed files (from remove_files_json hidden field)
            $removeIndexesJson = $this->input->post('remove_files_json');
            $removeIndexes = !empty($removeIndexesJson) ? json_decode($removeIndexesJson, true) : [];

            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {

                        // Optionally delete physical file
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath)) {
                            @unlink($absolutePath);
                        }

                        unset($existingFiles[$index]);
                    }
                }

                // Reindex after removal
                $existingFiles = array_values($existingFiles);
            }

            // 📤 Handle multiple new file uploads
            if (!empty($_FILES['uploaded_files']['name'][0])) {

                $filesCount = count($_FILES['uploaded_files']['name']);

                $config['upload_path'] = './api/file_uploads/';
                $config['allowed_types'] = 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx';
                $config['max_size'] = 50000;
                $config['encrypt_name'] = FALSE;

                $this->load->library('upload');

                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file']['name'] = $_FILES['uploaded_files']['name'][$i];
                    $_FILES['file']['type'] = $_FILES['uploaded_files']['type'][$i];
                    $_FILES['file']['tmp_name'] = $_FILES['uploaded_files']['tmp_name'][$i];
                    $_FILES['file']['error'] = $_FILES['uploaded_files']['error'][$i];
                    $_FILES['file']['size'] = $_FILES['uploaded_files']['size'][$i];

                    $this->upload->initialize($config);

                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();

                        $newFile = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];

                        // Add new file to existing array
                        $existingFiles[] = $newFile;
                    }
                }
            }

            // 🧠 Merge updated file list back into dataset
            $dataset['files_name'] = array_values($existingFiles);

            // 🧩 Merge other post data (excluding upload fields)
            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            // 🕒 Save updated data
            $data = [
                'dataset' => json_encode($dataset),
            ];

            // Update in database
            $this->audit_model->update_biomedical_waste_collection_audit_feedback($id, $data);

            // Redirect back
            redirect('audit/bmw_audit_feedback?id=' . $id);
        } else {
            // 🧭 Load existing record for edit view
            $data['record'] = $this->audit_model->get_biomedical_waste_collection_audit_feedback_byid($id);
            $this->load->view('audit/edit_bmw_audit_feedback', $data);
        }
    }

    public function edit_pest_control_audit_feedback_byid($id)
    {
        // Check if form submitted
        if ($this->input->post()) {

            // 🧾 Get existing record
            $existing = $this->audit_model->get_pest_control_audit_feedback_byid($id);

            // Decode existing dataset JSON
            $dataset = json_decode($existing->dataset, true);
            if (!is_array($dataset)) {
                $dataset = [];
            }

            // Get existing files from dataset
            $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];

            // 🗑️ Handle removed files (from remove_files_json hidden field)
            $removeIndexesJson = $this->input->post('remove_files_json');
            $removeIndexes = !empty($removeIndexesJson) ? json_decode($removeIndexesJson, true) : [];

            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {

                        // Optionally delete physical file
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath)) {
                            @unlink($absolutePath);
                        }

                        unset($existingFiles[$index]);
                    }
                }

                // Reindex after removal
                $existingFiles = array_values($existingFiles);
            }

            // 📤 Handle multiple new file uploads
            if (!empty($_FILES['uploaded_files']['name'][0])) {

                $filesCount = count($_FILES['uploaded_files']['name']);

                $config['upload_path'] = './api/file_uploads/';
                $config['allowed_types'] = 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx';
                $config['max_size'] = 50000;
                $config['encrypt_name'] = FALSE;

                $this->load->library('upload');

                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file']['name'] = $_FILES['uploaded_files']['name'][$i];
                    $_FILES['file']['type'] = $_FILES['uploaded_files']['type'][$i];
                    $_FILES['file']['tmp_name'] = $_FILES['uploaded_files']['tmp_name'][$i];
                    $_FILES['file']['error'] = $_FILES['uploaded_files']['error'][$i];
                    $_FILES['file']['size'] = $_FILES['uploaded_files']['size'][$i];

                    $this->upload->initialize($config);

                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();

                        $newFile = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];

                        // Add new file to existing array
                        $existingFiles[] = $newFile;
                    }
                }
            }

            // 🧠 Merge updated file list back into dataset
            $dataset['files_name'] = array_values($existingFiles);

            // 🧩 Merge other post data (excluding upload fields)
            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            // 🕒 Save updated data
            $data = [
                'dataset' => json_encode($dataset),
            ];

            // Update in database
            $this->audit_model->update_pest_control_audit_feedback($id, $data);

            // Redirect back
            redirect('audit/pest_control_audit_feedback?id=' . $id);
        } else {
            // 🧭 Load existing record for edit view
            $data['record'] = $this->audit_model->get_pest_control_audit_feedback_byid($id);
            $this->load->view('audit/edit_pest_control_audit_feedback', $data);
        }
    }



    // To Edit audit by id
    public function edit_active_cases_mrd_feedback_byid($id)
    {
        // Check if form submitted
        if ($this->input->post()) {

            // 🧾 Get existing record
            $existing = $this->audit_model->get_active_cases_mrd_feedback_byid($id);

            // Decode existing dataset JSON
            $dataset = json_decode($existing->dataset, true);
            if (!is_array($dataset)) {
                $dataset = [];
            }

            // Get existing files from dataset
            $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];

            // 🗑️ Handle removed files (from remove_files_json hidden field)
            $removeIndexesJson = $this->input->post('remove_files_json');
            $removeIndexes = !empty($removeIndexesJson) ? json_decode($removeIndexesJson, true) : [];

            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {

                        // Optionally delete physical file
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath)) {
                            @unlink($absolutePath);
                        }

                        unset($existingFiles[$index]);
                    }
                }

                // Reindex after removal
                $existingFiles = array_values($existingFiles);
            }

            // 📤 Handle multiple new file uploads
            if (!empty($_FILES['uploaded_files']['name'][0])) {

                $filesCount = count($_FILES['uploaded_files']['name']);

                $config['upload_path'] = './api/file_uploads/';
                $config['allowed_types'] = 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx';
                $config['max_size'] = 50000;
                $config['encrypt_name'] = FALSE;

                $this->load->library('upload');

                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file']['name'] = $_FILES['uploaded_files']['name'][$i];
                    $_FILES['file']['type'] = $_FILES['uploaded_files']['type'][$i];
                    $_FILES['file']['tmp_name'] = $_FILES['uploaded_files']['tmp_name'][$i];
                    $_FILES['file']['error'] = $_FILES['uploaded_files']['error'][$i];
                    $_FILES['file']['size'] = $_FILES['uploaded_files']['size'][$i];

                    $this->upload->initialize($config);

                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();

                        $newFile = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];

                        // Add new file to existing array
                        $existingFiles[] = $newFile;
                    }
                }
            }

            // 🧠 Merge updated file list back into dataset
            $dataset['files_name'] = array_values($existingFiles);

            // 🧩 Merge other post data (excluding upload fields)
            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            // 🕒 Save updated data
            $data = [
                'dataset' => json_encode($dataset),

            ];

            // Update in database
            $this->audit_model->update_active_cases_mrd_feedback($id, $data);

            // Redirect back
            redirect('audit/active_cases_mrd_feedback?id=' . $id);
        } else {
            // 🧭 Load existing record for edit view
            $data['record'] = $this->audit_model->get_active_cases_mrd_feedback_byid($id);
            $this->load->view('audit/edit_active_cases_mrd_feedback', $data);
        }
    }

    public function edit_discharged_patients_mrd_feedback_byid($id)
    {
        // ✅ Check if form submitted
        if ($this->input->post()) {

            // 🧾 Get existing record
            $existing = $this->audit_model->get_discharged_patients_mrd_feedback_byid($id);

            // Decode existing dataset JSON
            $dataset = json_decode($existing->dataset, true);
            if (!is_array($dataset)) {
                $dataset = [];
            }

            // Get existing files from dataset
            $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];

            // 🗑️ Handle removed files (from remove_files_json hidden field)
            $removeIndexesJson = $this->input->post('remove_files_json');
            $removeIndexes = !empty($removeIndexesJson) ? json_decode($removeIndexesJson, true) : [];

            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {

                        // Optionally delete physical file
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath)) {
                            @unlink($absolutePath);
                        }

                        unset($existingFiles[$index]);
                    }
                }

                // Reindex files after removal
                $existingFiles = array_values($existingFiles);
            }

            // 📤 Handle new file uploads
            if (!empty($_FILES['uploaded_files']['name'][0])) {

                $filesCount = count($_FILES['uploaded_files']['name']);

                $config['upload_path'] = './api/file_uploads/';
                $config['allowed_types'] = 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx';
                $config['max_size'] = 50000;
                $config['encrypt_name'] = FALSE;

                $this->load->library('upload');

                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file']['name'] = $_FILES['uploaded_files']['name'][$i];
                    $_FILES['file']['type'] = $_FILES['uploaded_files']['type'][$i];
                    $_FILES['file']['tmp_name'] = $_FILES['uploaded_files']['tmp_name'][$i];
                    $_FILES['file']['error'] = $_FILES['uploaded_files']['error'][$i];
                    $_FILES['file']['size'] = $_FILES['uploaded_files']['size'][$i];

                    $this->upload->initialize($config);

                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();

                        $newFile = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];

                        // Add new file to existing array
                        $existingFiles[] = $newFile;
                    }
                }
            }

            // 🧠 Merge updated file list back into dataset
            $dataset['files_name'] = array_values($existingFiles);

            // 🧩 Merge other post data (excluding upload fields)
            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            // 🕒 Save updated data
            $data = [
                'dataset' => json_encode($dataset),

            ];

            // Update in database
            $this->audit_model->update_discharged_patients_mrd_feedback($id, $data);

            // Redirect back
            redirect('audit/discharged_patients_mrd_feedback?id=' . $id);
        } else {
            // 🧭 Load existing record for edit view
            $data['record'] = $this->audit_model->get_discharged_patients_mrd_feedback_byid($id);
            $this->load->view('audit/edit_discharged_patients_mrd_feedback', $data);
        }
    }



    public function edit_nursing_ip_closed_feedback_byid($id)
    {
        if ($this->input->post()) {

            // 🧾 Get existing record
            $existing = $this->audit_model->get_nursing_ip_closed_feedback_byid($id);

            // Decode existing dataset JSON
            $dataset = json_decode($existing->dataset, true);
            if (!is_array($dataset)) {
                $dataset = [];
            }

            // Existing files
            $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];

            // Handle removed files
            $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath))
                            @unlink($absolutePath);
                        unset($existingFiles[$index]);
                    }
                }
                $existingFiles = array_values($existingFiles);
            }

            // Handle new uploads
            if (!empty($_FILES['uploaded_files']['name'][0])) {
                $filesCount = count($_FILES['uploaded_files']['name']);
                $config = [
                    'upload_path' => './api/file_uploads/',
                    'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                    'max_size' => 50000,
                    'encrypt_name' => FALSE
                ];
                $this->load->library('upload');
                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file'] = [
                        'name' => $_FILES['uploaded_files']['name'][$i],
                        'type' => $_FILES['uploaded_files']['type'][$i],
                        'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                        'error' => $_FILES['uploaded_files']['error'][$i],
                        'size' => $_FILES['uploaded_files']['size'][$i]
                    ];
                    $this->upload->initialize($config);
                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();
                        $existingFiles[] = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];
                    }
                }
            }

            // Merge files and other post data
            $dataset['files_name'] = array_values($existingFiles);
            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            // Update database
            $this->audit_model->update_nursing_ip_closed_feedback($id, [
                'dataset' => json_encode($dataset),

            ]);

            redirect('audit/nursing_ip_closed_feedback?id=' . $id);
        } else {
            $data['record'] = $this->audit_model->get_nursing_ip_closed_feedback_byid($id);
            $this->load->view('audit/edit_nursing_ip_closed_feedback', $data);
        }
    }

    public function edit_nursing_ip_open_feedback_byid($id)
    {
        if ($this->input->post()) {

            $existing = $this->audit_model->get_nursing_ip_open_feedback_byid($id);
            $dataset = json_decode($existing->dataset, true) ?: [];
            $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];

            $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath))
                            @unlink($absolutePath);
                        unset($existingFiles[$index]);
                    }
                }
                $existingFiles = array_values($existingFiles);
            }

            if (!empty($_FILES['uploaded_files']['name'][0])) {
                $filesCount = count($_FILES['uploaded_files']['name']);
                $config = [
                    'upload_path' => './api/file_uploads/',
                    'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                    'max_size' => 50000,
                    'encrypt_name' => FALSE
                ];
                $this->load->library('upload');
                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file'] = [
                        'name' => $_FILES['uploaded_files']['name'][$i],
                        'type' => $_FILES['uploaded_files']['type'][$i],
                        'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                        'error' => $_FILES['uploaded_files']['error'][$i],
                        'size' => $_FILES['uploaded_files']['size'][$i]
                    ];
                    $this->upload->initialize($config);
                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();
                        $existingFiles[] = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];
                    }
                }
            }

            $dataset['files_name'] = array_values($existingFiles);
            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            $this->audit_model->update_nursing_ip_open_feedback($id, [
                'dataset' => json_encode($dataset),

            ]);

            redirect('audit/nursing_ip_open_feedback?id=' . $id);
        } else {
            $data['record'] = $this->audit_model->get_nursing_ip_open_feedback_byid($id);
            $this->load->view('audit/edit_nursing_ip_open_feedback', $data);
        }
    }

    public function edit_nursing_op_closed_feedback_byid($id)
    {
        if ($this->input->post()) {

            $existing = $this->audit_model->get_nursing_op_closed_feedback_byid($id);
            $dataset = json_decode($existing->dataset, true) ?: [];
            $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];

            $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath))
                            @unlink($absolutePath);
                        unset($existingFiles[$index]);
                    }
                }
                $existingFiles = array_values($existingFiles);
            }

            if (!empty($_FILES['uploaded_files']['name'][0])) {
                $filesCount = count($_FILES['uploaded_files']['name']);
                $config = [
                    'upload_path' => './api/file_uploads/',
                    'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                    'max_size' => 50000,
                    'encrypt_name' => FALSE
                ];
                $this->load->library('upload');
                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file'] = [
                        'name' => $_FILES['uploaded_files']['name'][$i],
                        'type' => $_FILES['uploaded_files']['type'][$i],
                        'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                        'error' => $_FILES['uploaded_files']['error'][$i],
                        'size' => $_FILES['uploaded_files']['size'][$i]
                    ];
                    $this->upload->initialize($config);
                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();
                        $existingFiles[] = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];
                    }
                }
            }

            $dataset['files_name'] = array_values($existingFiles);
            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            $this->audit_model->update_nursing_op_closed_feedback($id, [
                'dataset' => json_encode($dataset),

            ]);

            redirect('audit/nursing_op_closed_feedback?id=' . $id);
        } else {
            $data['record'] = $this->audit_model->get_nursing_op_closed_feedback_byid($id);
            $this->load->view('audit/edit_nursing_op_closed_feedback', $data);
        }
    }

    public function edit_clinical_active_mdc_feedback_byid($id)
    {
        if ($this->input->post()) {

            $existing = $this->audit_model->get_clinical_active_mdc_feedback_byid($id);
            $dataset = json_decode($existing->dataset, true) ?: [];
            $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];

            $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath))
                            @unlink($absolutePath);
                        unset($existingFiles[$index]);
                    }
                }
                $existingFiles = array_values($existingFiles);
            }

            if (!empty($_FILES['uploaded_files']['name'][0])) {
                $filesCount = count($_FILES['uploaded_files']['name']);
                $config = [
                    'upload_path' => './api/file_uploads/',
                    'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                    'max_size' => 50000,
                    'encrypt_name' => FALSE
                ];
                $this->load->library('upload');
                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file'] = [
                        'name' => $_FILES['uploaded_files']['name'][$i],
                        'type' => $_FILES['uploaded_files']['type'][$i],
                        'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                        'error' => $_FILES['uploaded_files']['error'][$i],
                        'size' => $_FILES['uploaded_files']['size'][$i]
                    ];
                    $this->upload->initialize($config);
                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();
                        $existingFiles[] = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];
                    }
                }
            }

            $dataset['files_name'] = array_values($existingFiles);
            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            $this->audit_model->update_clinical_active_mdc_feedback($id, [
                'dataset' => json_encode($dataset),

            ]);

            redirect('audit/clinical_active_mdc_feedback?id=' . $id);
        } else {
            $data['record'] = $this->audit_model->get_clinical_active_mdc_feedback_byid($id);
            $this->load->view('audit/edit_clinical_active_mdc_feedback', $data);
        }
    }

    public function edit_clinical_closed_mdc_feedback_byid($id)
    {
        if ($this->input->post()) {

            $existing = $this->audit_model->get_clinical_closed_mdc_feedback_byid($id);
            $dataset = json_decode($existing->dataset, true) ?: [];
            $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];

            $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath))
                            @unlink($absolutePath);
                        unset($existingFiles[$index]);
                    }
                }
                $existingFiles = array_values($existingFiles);
            }

            if (!empty($_FILES['uploaded_files']['name'][0])) {
                $filesCount = count($_FILES['uploaded_files']['name']);
                $config = [
                    'upload_path' => './api/file_uploads/',
                    'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                    'max_size' => 50000,
                    'encrypt_name' => FALSE
                ];
                $this->load->library('upload');
                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file'] = [
                        'name' => $_FILES['uploaded_files']['name'][$i],
                        'type' => $_FILES['uploaded_files']['type'][$i],
                        'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                        'error' => $_FILES['uploaded_files']['error'][$i],
                        'size' => $_FILES['uploaded_files']['size'][$i]
                    ];
                    $this->upload->initialize($config);
                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();
                        $existingFiles[] = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];
                    }
                }
            }

            $dataset['files_name'] = array_values($existingFiles);
            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            $this->audit_model->update_clinical_closed_mdc_feedback($id, [
                'dataset' => json_encode($dataset),

            ]);

            redirect('audit/clinical_closed_mdc_feedback?id=' . $id);
        } else {
            $data['record'] = $this->audit_model->get_clinical_closed_mdc_feedback_byid($id);
            $this->load->view('audit/edit_clinical_closed_mdc_feedback', $data);
        }
    }

    public function edit_clinical_pharmacy_closed_feedback_byid($id)
    {
        if ($this->input->post()) {

            $existing = $this->audit_model->get_clinical_pharmacy_closed_feedback_byid($id);
            $dataset = json_decode($existing->dataset, true) ?: [];
            $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];

            $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath))
                            @unlink($absolutePath);
                        unset($existingFiles[$index]);
                    }
                }
                $existingFiles = array_values($existingFiles);
            }

            if (!empty($_FILES['uploaded_files']['name'][0])) {
                $filesCount = count($_FILES['uploaded_files']['name']);
                $config = [
                    'upload_path' => './api/file_uploads/',
                    'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                    'max_size' => 50000,
                    'encrypt_name' => FALSE
                ];
                $this->load->library('upload');
                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file'] = [
                        'name' => $_FILES['uploaded_files']['name'][$i],
                        'type' => $_FILES['uploaded_files']['type'][$i],
                        'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                        'error' => $_FILES['uploaded_files']['error'][$i],
                        'size' => $_FILES['uploaded_files']['size'][$i]
                    ];
                    $this->upload->initialize($config);
                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();
                        $existingFiles[] = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];
                    }
                }
            }

            $dataset['files_name'] = array_values($existingFiles);
            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            $this->audit_model->update_clinical_pharmacy_closed_feedback($id, [
                'dataset' => json_encode($dataset),

            ]);

            redirect('audit/clinical_pharmacy_closed_feedback?id=' . $id);
        } else {
            $data['record'] = $this->audit_model->get_clinical_pharmacy_closed_feedback_byid($id);
            $this->load->view('audit/edit_clinical_pharmacy_closed_feedback', $data);
        }
    }

    public function edit_clinical_pharmacy_op_feedback_byid($id)
    {
        if ($this->input->post()) {

            $existing = $this->audit_model->get_clinical_pharmacy_op_feedback_byid($id);
            $dataset = json_decode($existing->dataset, true) ?: [];
            $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];

            $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath))
                            @unlink($absolutePath);
                        unset($existingFiles[$index]);
                    }
                }
                $existingFiles = array_values($existingFiles);
            }

            if (!empty($_FILES['uploaded_files']['name'][0])) {
                $filesCount = count($_FILES['uploaded_files']['name']);
                $config = [
                    'upload_path' => './api/file_uploads/',
                    'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                    'max_size' => 50000,
                    'encrypt_name' => FALSE
                ];
                $this->load->library('upload');
                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file'] = [
                        'name' => $_FILES['uploaded_files']['name'][$i],
                        'type' => $_FILES['uploaded_files']['type'][$i],
                        'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                        'error' => $_FILES['uploaded_files']['error'][$i],
                        'size' => $_FILES['uploaded_files']['size'][$i]
                    ];
                    $this->upload->initialize($config);
                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();
                        $existingFiles[] = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];
                    }
                }
            }

            $dataset['files_name'] = array_values($existingFiles);
            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            $this->audit_model->update_clinical_pharmacy_op_feedback($id, [
                'dataset' => json_encode($dataset),

            ]);

            redirect('audit/clinical_pharmacy_op_feedback?id=' . $id);
        } else {
            $data['record'] = $this->audit_model->get_clinical_pharmacy_op_feedback_byid($id);
            $this->load->view('audit/edit_clinical_pharmacy_op_feedback', $data);
        }
    }

    public function edit_clinical_pharmacy_open_feedback_byid($id)
    {
        if ($this->input->post()) {

            $existing = $this->audit_model->get_clinical_pharmacy_open_feedback_byid($id);
            $dataset = json_decode($existing->dataset, true) ?: [];
            $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];

            $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath))
                            @unlink($absolutePath);
                        unset($existingFiles[$index]);
                    }
                }
                $existingFiles = array_values($existingFiles);
            }

            if (!empty($_FILES['uploaded_files']['name'][0])) {
                $filesCount = count($_FILES['uploaded_files']['name']);
                $config = [
                    'upload_path' => './api/file_uploads/',
                    'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                    'max_size' => 50000,
                    'encrypt_name' => FALSE
                ];
                $this->load->library('upload');
                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file'] = [
                        'name' => $_FILES['uploaded_files']['name'][$i],
                        'type' => $_FILES['uploaded_files']['type'][$i],
                        'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                        'error' => $_FILES['uploaded_files']['error'][$i],
                        'size' => $_FILES['uploaded_files']['size'][$i]
                    ];
                    $this->upload->initialize($config);
                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();
                        $existingFiles[] = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];
                    }
                }
            }

            $dataset['files_name'] = array_values($existingFiles);
            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            $this->audit_model->update_clinical_pharmacy_open_feedback($id, [
                'dataset' => json_encode($dataset),

            ]);

            redirect('audit/clinical_pharmacy_open_feedback?id=' . $id);
        } else {
            $data['record'] = $this->audit_model->get_clinical_pharmacy_open_feedback_byid($id);
            $this->load->view('audit/edit_clinical_pharmacy_open_feedback', $data);
        }
    }

    public function edit_anesthesia_active_feedback_byid($id)
    {
        if ($this->input->post()) {

            $existing = $this->audit_model->get_anesthesia_active_feedback_byid($id);
            $dataset = json_decode($existing->dataset, true) ?: [];
            $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];

            $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath))
                            @unlink($absolutePath);
                        unset($existingFiles[$index]);
                    }
                }
                $existingFiles = array_values($existingFiles);
            }

            if (!empty($_FILES['uploaded_files']['name'][0])) {
                $filesCount = count($_FILES['uploaded_files']['name']);
                $config = [
                    'upload_path' => './api/file_uploads/',
                    'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                    'max_size' => 50000,
                    'encrypt_name' => FALSE
                ];
                $this->load->library('upload');
                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file'] = [
                        'name' => $_FILES['uploaded_files']['name'][$i],
                        'type' => $_FILES['uploaded_files']['type'][$i],
                        'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                        'error' => $_FILES['uploaded_files']['error'][$i],
                        'size' => $_FILES['uploaded_files']['size'][$i]
                    ];
                    $this->upload->initialize($config);
                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();
                        $existingFiles[] = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];
                    }
                }
            }

            $dataset['files_name'] = array_values($existingFiles);
            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            $this->audit_model->update_anesthesia_active_feedback($id, [
                'dataset' => json_encode($dataset),

            ]);

            redirect('audit/anesthesia_active_feedback?id=' . $id);
        } else {
            $data['record'] = $this->audit_model->get_anesthesia_active_feedback_byid($id);
            $this->load->view('audit/edit_anesthesia_active_feedback', $data);
        }
    }

    public function edit_anesthesia_closed_feedback_byid($id)
    {
        if ($this->input->post()) {

            $existing = $this->audit_model->get_anesthesia_closed_feedback_byid($id);
            $dataset = json_decode($existing->dataset, true) ?: [];
            $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];

            $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath))
                            @unlink($absolutePath);
                        unset($existingFiles[$index]);
                    }
                }
                $existingFiles = array_values($existingFiles);
            }

            if (!empty($_FILES['uploaded_files']['name'][0])) {
                $filesCount = count($_FILES['uploaded_files']['name']);
                $config = [
                    'upload_path' => './api/file_uploads/',
                    'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                    'max_size' => 50000,
                    'encrypt_name' => FALSE
                ];
                $this->load->library('upload');
                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file'] = [
                        'name' => $_FILES['uploaded_files']['name'][$i],
                        'type' => $_FILES['uploaded_files']['type'][$i],
                        'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                        'error' => $_FILES['uploaded_files']['error'][$i],
                        'size' => $_FILES['uploaded_files']['size'][$i]
                    ];
                    $this->upload->initialize($config);
                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();
                        $existingFiles[] = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];
                    }
                }
            }

            $dataset['files_name'] = array_values($existingFiles);
            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            $this->audit_model->update_anesthesia_closed_feedback($id, [
                'dataset' => json_encode($dataset),

            ]);

            redirect('audit/anesthesia_closed_feedback?id=' . $id);
        } else {
            $data['record'] = $this->audit_model->get_anesthesia_closed_feedback_byid($id);
            $this->load->view('audit/edit_anesthesia_closed_feedback', $data);
        }
    }


    public function edit_ed_active_feedback_byid($id)
    {
        if ($this->input->post()) {
            $existing = $this->audit_model->get_ed_active_feedback_byid($id);
            $dataset = json_decode($existing->dataset, true) ?: [];
            $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];

            $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath))
                            @unlink($absolutePath);
                        unset($existingFiles[$index]);
                    }
                }
                $existingFiles = array_values($existingFiles);
            }

            if (!empty($_FILES['uploaded_files']['name'][0])) {
                $filesCount = count($_FILES['uploaded_files']['name']);
                $config = [
                    'upload_path' => './api/file_uploads/',
                    'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                    'max_size' => 50000,
                    'encrypt_name' => FALSE
                ];
                $this->load->library('upload');
                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file'] = [
                        'name' => $_FILES['uploaded_files']['name'][$i],
                        'type' => $_FILES['uploaded_files']['type'][$i],
                        'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                        'error' => $_FILES['uploaded_files']['error'][$i],
                        'size' => $_FILES['uploaded_files']['size'][$i]
                    ];
                    $this->upload->initialize($config);
                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();
                        $existingFiles[] = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];
                    }
                }
            }

            $dataset['files_name'] = array_values($existingFiles);
            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            $this->audit_model->update_ed_active_feedback($id, [
                'dataset' => json_encode($dataset),

            ]);

            redirect('audit/ed_active_feedback?id=' . $id);
        } else {
            $data['record'] = $this->audit_model->get_ed_active_feedback_byid($id);
            $this->load->view('audit/edit_ed_active_feedback', $data);
        }
    }

    public function edit_ed_closed_feedback_byid($id)
    {
        if ($this->input->post()) {
            $existing = $this->audit_model->get_ed_closed_feedback_byid($id);
            $dataset = json_decode($existing->dataset, true) ?: [];
            $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];

            $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath))
                            @unlink($absolutePath);
                        unset($existingFiles[$index]);
                    }
                }
                $existingFiles = array_values($existingFiles);
            }

            if (!empty($_FILES['uploaded_files']['name'][0])) {
                $filesCount = count($_FILES['uploaded_files']['name']);
                $config = [
                    'upload_path' => './api/file_uploads/',
                    'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                    'max_size' => 50000,
                    'encrypt_name' => FALSE
                ];
                $this->load->library('upload');
                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file'] = [
                        'name' => $_FILES['uploaded_files']['name'][$i],
                        'type' => $_FILES['uploaded_files']['type'][$i],
                        'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                        'error' => $_FILES['uploaded_files']['error'][$i],
                        'size' => $_FILES['uploaded_files']['size'][$i]
                    ];
                    $this->upload->initialize($config);
                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();
                        $existingFiles[] = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];
                    }
                }
            }

            $dataset['files_name'] = array_values($existingFiles);
            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            $this->audit_model->update_ed_closed_feedback($id, [
                'dataset' => json_encode($dataset),

            ]);

            redirect('audit/ed_closed_feedback?id=' . $id);
        } else {
            $data['record'] = $this->audit_model->get_ed_closed_feedback_byid($id);
            $this->load->view('audit/edit_ed_closed_feedback', $data);
        }
    }

    public function edit_icu_active_feedback_byid($id)
    {
        if ($this->input->post()) {
            $existing = $this->audit_model->get_icu_active_feedback_byid($id);
            $dataset = json_decode($existing->dataset, true) ?: [];
            $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];

            $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath))
                            @unlink($absolutePath);
                        unset($existingFiles[$index]);
                    }
                }
                $existingFiles = array_values($existingFiles);
            }

            if (!empty($_FILES['uploaded_files']['name'][0])) {
                $filesCount = count($_FILES['uploaded_files']['name']);
                $config = [
                    'upload_path' => './api/file_uploads/',
                    'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                    'max_size' => 50000,
                    'encrypt_name' => FALSE
                ];
                $this->load->library('upload');
                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file'] = [
                        'name' => $_FILES['uploaded_files']['name'][$i],
                        'type' => $_FILES['uploaded_files']['type'][$i],
                        'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                        'error' => $_FILES['uploaded_files']['error'][$i],
                        'size' => $_FILES['uploaded_files']['size'][$i]
                    ];
                    $this->upload->initialize($config);
                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();
                        $existingFiles[] = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];
                    }
                }
            }

            $dataset['files_name'] = array_values($existingFiles);
            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            $this->audit_model->update_icu_active_feedback($id, [
                'dataset' => json_encode($dataset),

            ]);

            redirect('audit/icu_active_feedback?id=' . $id);
        } else {
            $data['record'] = $this->audit_model->get_icu_active_feedback_byid($id);
            $this->load->view('audit/edit_icu_active_feedback', $data);
        }
    }

    public function edit_icu_closed_feedback_byid($id)
    {
        if ($this->input->post()) {
            $existing = $this->audit_model->get_icu_closed_feedback_byid($id);
            $dataset = json_decode($existing->dataset, true) ?: [];
            $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];

            $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath))
                            @unlink($absolutePath);
                        unset($existingFiles[$index]);
                    }
                }
                $existingFiles = array_values($existingFiles);
            }

            if (!empty($_FILES['uploaded_files']['name'][0])) {
                $filesCount = count($_FILES['uploaded_files']['name']);
                $config = [
                    'upload_path' => './api/file_uploads/',
                    'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                    'max_size' => 50000,
                    'encrypt_name' => FALSE
                ];
                $this->load->library('upload');
                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file'] = [
                        'name' => $_FILES['uploaded_files']['name'][$i],
                        'type' => $_FILES['uploaded_files']['type'][$i],
                        'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                        'error' => $_FILES['uploaded_files']['error'][$i],
                        'size' => $_FILES['uploaded_files']['size'][$i]
                    ];
                    $this->upload->initialize($config);
                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();
                        $existingFiles[] = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];
                    }
                }
            }

            $dataset['files_name'] = array_values($existingFiles);
            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            $this->audit_model->update_icu_closed_feedback($id, [
                'dataset' => json_encode($dataset),

            ]);

            redirect('audit/icu_closed_feedback?id=' . $id);
        } else {
            $data['record'] = $this->audit_model->get_icu_closed_feedback_byid($id);
            $this->load->view('audit/edit_icu_closed_feedback', $data);
        }
    }

    public function edit_primarycare_active_feedback_byid($id)
    {
        if ($this->input->post()) {
            $existing = $this->audit_model->get_primarycare_active_feedback_byid($id);
            $dataset = json_decode($existing->dataset, true) ?: [];
            $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];

            $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath))
                            @unlink($absolutePath);
                        unset($existingFiles[$index]);
                    }
                }
                $existingFiles = array_values($existingFiles);
            }

            if (!empty($_FILES['uploaded_files']['name'][0])) {
                $filesCount = count($_FILES['uploaded_files']['name']);
                $config = [
                    'upload_path' => './api/file_uploads/',
                    'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                    'max_size' => 50000,
                    'encrypt_name' => FALSE
                ];
                $this->load->library('upload');
                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file'] = [
                        'name' => $_FILES['uploaded_files']['name'][$i],
                        'type' => $_FILES['uploaded_files']['type'][$i],
                        'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                        'error' => $_FILES['uploaded_files']['error'][$i],
                        'size' => $_FILES['uploaded_files']['size'][$i]
                    ];
                    $this->upload->initialize($config);
                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();
                        $existingFiles[] = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];
                    }
                }
            }

            $dataset['files_name'] = array_values($existingFiles);
            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            $this->audit_model->update_primarycare_active_feedback($id, [
                'dataset' => json_encode($dataset),

            ]);

            redirect('audit/primarycare_active_feedback?id=' . $id);
        } else {
            $data['record'] = $this->audit_model->get_primarycare_active_feedback_byid($id);
            $this->load->view('audit/edit_primarycare_active_feedback', $data);
        }
    }

    public function edit_primarycare_closed_feedback_byid($id)
    {
        if ($this->input->post()) {
            $existing = $this->audit_model->get_primarycare_closed_feedback_byid($id);
            $dataset = json_decode($existing->dataset, true) ?: [];
            $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];

            $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath))
                            @unlink($absolutePath);
                        unset($existingFiles[$index]);
                    }
                }
                $existingFiles = array_values($existingFiles);
            }

            if (!empty($_FILES['uploaded_files']['name'][0])) {
                $filesCount = count($_FILES['uploaded_files']['name']);
                $config = [
                    'upload_path' => './api/file_uploads/',
                    'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                    'max_size' => 50000,
                    'encrypt_name' => FALSE
                ];
                $this->load->library('upload');
                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file'] = [
                        'name' => $_FILES['uploaded_files']['name'][$i],
                        'type' => $_FILES['uploaded_files']['type'][$i],
                        'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                        'error' => $_FILES['uploaded_files']['error'][$i],
                        'size' => $_FILES['uploaded_files']['size'][$i]
                    ];
                    $this->upload->initialize($config);
                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();
                        $existingFiles[] = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];
                    }
                }
            }

            $dataset['files_name'] = array_values($existingFiles);
            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            $this->audit_model->update_primarycare_closed_feedback($id, [
                'dataset' => json_encode($dataset),

            ]);

            redirect('audit/primarycare_closed_feedback?id=' . $id);
        } else {
            $data['record'] = $this->audit_model->get_primarycare_closed_feedback_byid($id);
            $this->load->view('audit/edit_primarycare_closed_feedback', $data);
        }
    }


    public function edit_sedation_active_feedback_byid($id)
    {
        if ($this->input->post()) {
            $existing = $this->audit_model->get_sedation_active_feedback_byid($id);
            $dataset = json_decode($existing->dataset, true) ?: [];
            $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];

            $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath))
                            @unlink($absolutePath);
                        unset($existingFiles[$index]);
                    }
                }
                $existingFiles = array_values($existingFiles);
            }

            if (!empty($_FILES['uploaded_files']['name'][0])) {
                $filesCount = count($_FILES['uploaded_files']['name']);
                $config = [
                    'upload_path' => './api/file_uploads/',
                    'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                    'max_size' => 50000,
                    'encrypt_name' => FALSE
                ];
                $this->load->library('upload');
                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file'] = [
                        'name' => $_FILES['uploaded_files']['name'][$i],
                        'type' => $_FILES['uploaded_files']['type'][$i],
                        'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                        'error' => $_FILES['uploaded_files']['error'][$i],
                        'size' => $_FILES['uploaded_files']['size'][$i]
                    ];
                    $this->upload->initialize($config);
                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();
                        $existingFiles[] = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];
                    }
                }
            }

            $dataset['files_name'] = array_values($existingFiles);
            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            $this->audit_model->update_sedation_active_feedback($id, [
                'dataset' => json_encode($dataset),

            ]);

            redirect('audit/sedation_active_feedback?id=' . $id);
        } else {
            $data['record'] = $this->audit_model->get_sedation_active_feedback_byid($id);
            $this->load->view('audit/edit_sedation_active_feedback', $data);
        }
    }

    public function edit_sedation_closed_feedback_byid($id)
    {
        if ($this->input->post()) {
            $existing = $this->audit_model->get_sedation_closed_feedback_byid($id);
            $dataset = json_decode($existing->dataset, true) ?: [];
            $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];

            $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath))
                            @unlink($absolutePath);
                        unset($existingFiles[$index]);
                    }
                }
                $existingFiles = array_values($existingFiles);
            }

            if (!empty($_FILES['uploaded_files']['name'][0])) {
                $filesCount = count($_FILES['uploaded_files']['name']);
                $config = [
                    'upload_path' => './api/file_uploads/',
                    'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                    'max_size' => 50000,
                    'encrypt_name' => FALSE
                ];
                $this->load->library('upload');
                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file'] = [
                        'name' => $_FILES['uploaded_files']['name'][$i],
                        'type' => $_FILES['uploaded_files']['type'][$i],
                        'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                        'error' => $_FILES['uploaded_files']['error'][$i],
                        'size' => $_FILES['uploaded_files']['size'][$i]
                    ];
                    $this->upload->initialize($config);
                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();
                        $existingFiles[] = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];
                    }
                }
            }

            $dataset['files_name'] = array_values($existingFiles);
            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            $this->audit_model->update_sedation_closed_feedback($id, [
                'dataset' => json_encode($dataset),

            ]);

            redirect('audit/sedation_closed_feedback?id=' . $id);
        } else {
            $data['record'] = $this->audit_model->get_sedation_closed_feedback_byid($id);
            $this->load->view('audit/edit_sedation_closed_feedback', $data);
        }
    }

    public function edit_surgeons_active_feedback_byid($id)
    {
        if ($this->input->post()) {
            $existing = $this->audit_model->get_surgeons_active_feedback_byid($id);
            $dataset = json_decode($existing->dataset, true) ?: [];
            $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];

            $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath))
                            @unlink($absolutePath);
                        unset($existingFiles[$index]);
                    }
                }
                $existingFiles = array_values($existingFiles);
            }

            if (!empty($_FILES['uploaded_files']['name'][0])) {
                $filesCount = count($_FILES['uploaded_files']['name']);
                $config = [
                    'upload_path' => './api/file_uploads/',
                    'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                    'max_size' => 50000,
                    'encrypt_name' => FALSE
                ];
                $this->load->library('upload');
                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file'] = [
                        'name' => $_FILES['uploaded_files']['name'][$i],
                        'type' => $_FILES['uploaded_files']['type'][$i],
                        'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                        'error' => $_FILES['uploaded_files']['error'][$i],
                        'size' => $_FILES['uploaded_files']['size'][$i]
                    ];
                    $this->upload->initialize($config);
                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();
                        $existingFiles[] = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];
                    }
                }
            }

            $dataset['files_name'] = array_values($existingFiles);
            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            $this->audit_model->update_surgeons_active_feedback($id, [
                'dataset' => json_encode($dataset),

            ]);

            redirect('audit/surgeons_active_feedback?id=' . $id);
        } else {
            $data['record'] = $this->audit_model->get_surgeons_active_feedback_byid($id);
            $this->load->view('audit/edit_surgeons_active_feedback', $data);
        }
    }

    public function edit_surgeons_closed_feedback_byid($id)
    {
        if ($this->input->post()) {
            $existing = $this->audit_model->get_surgeons_closed_feedback_byid($id);
            $dataset = json_decode($existing->dataset, true) ?: [];
            $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];

            $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath))
                            @unlink($absolutePath);
                        unset($existingFiles[$index]);
                    }
                }
                $existingFiles = array_values($existingFiles);
            }

            if (!empty($_FILES['uploaded_files']['name'][0])) {
                $filesCount = count($_FILES['uploaded_files']['name']);
                $config = [
                    'upload_path' => './api/file_uploads/',
                    'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                    'max_size' => 50000,
                    'encrypt_name' => FALSE
                ];
                $this->load->library('upload');
                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file'] = [
                        'name' => $_FILES['uploaded_files']['name'][$i],
                        'type' => $_FILES['uploaded_files']['type'][$i],
                        'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                        'error' => $_FILES['uploaded_files']['error'][$i],
                        'size' => $_FILES['uploaded_files']['size'][$i]
                    ];
                    $this->upload->initialize($config);
                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();
                        $existingFiles[] = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];
                    }
                }
            }

            $dataset['files_name'] = array_values($existingFiles);
            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            $this->audit_model->update_surgeons_closed_feedback($id, [
                'dataset' => json_encode($dataset),

            ]);

            redirect('audit/surgeons_closed_feedback?id=' . $id);
        } else {
            $data['record'] = $this->audit_model->get_surgeons_closed_feedback_byid($id);
            $this->load->view('audit/edit_surgeons_closed_feedback', $data);
        }
    }


    public function edit_diet_consultation_op_feedback_byid($id)
    {
        if ($this->input->post()) {
            $existing = $this->audit_model->get_diet_consultation_op_feedback_byid($id);
            $dataset = json_decode($existing->dataset, true) ?: [];
            $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];

            $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath))
                            @unlink($absolutePath);
                        unset($existingFiles[$index]);
                    }
                }
                $existingFiles = array_values($existingFiles);
            }

            if (!empty($_FILES['uploaded_files']['name'][0])) {
                $filesCount = count($_FILES['uploaded_files']['name']);
                $config = [
                    'upload_path' => './api/file_uploads/',
                    'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                    'max_size' => 50000,
                    'encrypt_name' => FALSE
                ];
                $this->load->library('upload');
                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file'] = [
                        'name' => $_FILES['uploaded_files']['name'][$i],
                        'type' => $_FILES['uploaded_files']['type'][$i],
                        'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                        'error' => $_FILES['uploaded_files']['error'][$i],
                        'size' => $_FILES['uploaded_files']['size'][$i]
                    ];
                    $this->upload->initialize($config);
                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();
                        $existingFiles[] = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];
                    }
                }
            }

            $dataset['files_name'] = array_values($existingFiles);
            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            $this->audit_model->update_diet_consultation_op_feedback($id, [
                'dataset' => json_encode($dataset),

            ]);

            redirect('audit/diet_consultation_op_feedback?id=' . $id);
        } else {
            $data['record'] = $this->audit_model->get_diet_consultation_op_feedback_byid($id);
            $this->load->view('audit/edit_diet_consultation_op_feedback', $data);
        }
    }

    public function edit_physiotherapy_closed_feedback_byid($id)
    {
        if ($this->input->post()) {
            $existing = $this->audit_model->get_physiotherapy_closed_feedback_byid($id);
            $dataset = json_decode($existing->dataset, true) ?: [];
            $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];

            $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath))
                            @unlink($absolutePath);
                        unset($existingFiles[$index]);
                    }
                }
                $existingFiles = array_values($existingFiles);
            }

            if (!empty($_FILES['uploaded_files']['name'][0])) {
                $filesCount = count($_FILES['uploaded_files']['name']);
                $config = [
                    'upload_path' => './api/file_uploads/',
                    'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                    'max_size' => 50000,
                    'encrypt_name' => FALSE
                ];
                $this->load->library('upload');
                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file'] = [
                        'name' => $_FILES['uploaded_files']['name'][$i],
                        'type' => $_FILES['uploaded_files']['type'][$i],
                        'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                        'error' => $_FILES['uploaded_files']['error'][$i],
                        'size' => $_FILES['uploaded_files']['size'][$i]
                    ];
                    $this->upload->initialize($config);
                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();
                        $existingFiles[] = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];
                    }
                }
            }

            $dataset['files_name'] = array_values($existingFiles);
            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            $this->audit_model->update_physiotherapy_closed_feedback($id, [
                'dataset' => json_encode($dataset),

            ]);

            redirect('audit/physiotherapy_closed_feedback?id=' . $id);
        } else {
            $data['record'] = $this->audit_model->get_physiotherapy_closed_feedback_byid($id);
            $this->load->view('audit/edit_physiotherapy_closed_feedback', $data);
        }
    }

    public function edit_physiotherapy_op_feedback_byid($id)
    {
        if ($this->input->post()) {
            $existing = $this->audit_model->get_physiotherapy_op_feedback_byid($id);
            $dataset = json_decode($existing->dataset, true) ?: [];
            $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];

            $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath))
                            @unlink($absolutePath);
                        unset($existingFiles[$index]);
                    }
                }
                $existingFiles = array_values($existingFiles);
            }

            if (!empty($_FILES['uploaded_files']['name'][0])) {
                $filesCount = count($_FILES['uploaded_files']['name']);
                $config = [
                    'upload_path' => './api/file_uploads/',
                    'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                    'max_size' => 50000,
                    'encrypt_name' => FALSE
                ];
                $this->load->library('upload');
                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file'] = [
                        'name' => $_FILES['uploaded_files']['name'][$i],
                        'type' => $_FILES['uploaded_files']['type'][$i],
                        'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                        'error' => $_FILES['uploaded_files']['error'][$i],
                        'size' => $_FILES['uploaded_files']['size'][$i]
                    ];
                    $this->upload->initialize($config);
                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();
                        $existingFiles[] = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];
                    }
                }
            }

            $dataset['files_name'] = array_values($existingFiles);
            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            $this->audit_model->update_physiotherapy_op_feedback($id, [
                'dataset' => json_encode($dataset),

            ]);

            redirect('audit/physiotherapy_op_feedback?id=' . $id);
        } else {
            $data['record'] = $this->audit_model->get_physiotherapy_op_feedback_byid($id);
            $this->load->view('audit/edit_physiotherapy_op_feedback', $data);
        }
    }

    public function edit_physiotherapy_open_feedback_byid($id)
    {
        if ($this->input->post()) {
            $existing = $this->audit_model->get_physiotherapy_open_feedback_byid($id);
            $dataset = json_decode($existing->dataset, true) ?: [];
            $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];

            $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath))
                            @unlink($absolutePath);
                        unset($existingFiles[$index]);
                    }
                }
                $existingFiles = array_values($existingFiles);
            }

            if (!empty($_FILES['uploaded_files']['name'][0])) {
                $filesCount = count($_FILES['uploaded_files']['name']);
                $config = [
                    'upload_path' => './api/file_uploads/',
                    'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                    'max_size' => 50000,
                    'encrypt_name' => FALSE
                ];
                $this->load->library('upload');
                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file'] = [
                        'name' => $_FILES['uploaded_files']['name'][$i],
                        'type' => $_FILES['uploaded_files']['type'][$i],
                        'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                        'error' => $_FILES['uploaded_files']['error'][$i],
                        'size' => $_FILES['uploaded_files']['size'][$i]
                    ];
                    $this->upload->initialize($config);
                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();
                        $existingFiles[] = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];
                    }
                }
            }

            $dataset['files_name'] = array_values($existingFiles);
            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            $this->audit_model->update_physiotherapy_open_feedback($id, [
                'dataset' => json_encode($dataset),

            ]);

            redirect('audit/physiotherapy_open_feedback?id=' . $id);
        } else {
            $data['record'] = $this->audit_model->get_physiotherapy_open_feedback_byid($id);
            $this->load->view('audit/edit_physiotherapy_open_feedback', $data);
        }
    }

    public function edit_mrd_ed_feedback_byid($id)
    {
        if ($this->input->post()) {
            $existing = $this->audit_model->get_mrd_ed_feedback_byid($id);
            $dataset = json_decode($existing->dataset, true) ?: [];
            $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];

            $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath))
                            @unlink($absolutePath);
                        unset($existingFiles[$index]);
                    }
                }
                $existingFiles = array_values($existingFiles);
            }

            if (!empty($_FILES['uploaded_files']['name'][0])) {
                $filesCount = count($_FILES['uploaded_files']['name']);
                $config = [
                    'upload_path' => './api/file_uploads/',
                    'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                    'max_size' => 50000,
                    'encrypt_name' => FALSE
                ];
                $this->load->library('upload');
                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file'] = [
                        'name' => $_FILES['uploaded_files']['name'][$i],
                        'type' => $_FILES['uploaded_files']['type'][$i],
                        'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                        'error' => $_FILES['uploaded_files']['error'][$i],
                        'size' => $_FILES['uploaded_files']['size'][$i]
                    ];
                    $this->upload->initialize($config);
                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();
                        $existingFiles[] = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];
                    }
                }
            }

            $dataset['files_name'] = array_values($existingFiles);
            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            $this->audit_model->update_mrd_ed_feedback($id, [
                'dataset' => json_encode($dataset),

            ]);

            redirect('audit/mrd_ed_feedback?id=' . $id);
        } else {
            $data['record'] = $this->audit_model->get_mrd_ed_feedback_byid($id);
            $this->load->view('audit/edit_mrd_ed_feedback', $data);
        }
    }

    public function edit_mrd_lama_feedback_byid($id)
    {
        if ($this->input->post()) {
            $existing = $this->audit_model->get_mrd_lama_feedback_byid($id);
            $dataset = json_decode($existing->dataset, true) ?: [];
            $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];

            $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath))
                            @unlink($absolutePath);
                        unset($existingFiles[$index]);
                    }
                }
                $existingFiles = array_values($existingFiles);
            }

            if (!empty($_FILES['uploaded_files']['name'][0])) {
                $filesCount = count($_FILES['uploaded_files']['name']);
                $config = [
                    'upload_path' => './api/file_uploads/',
                    'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                    'max_size' => 50000,
                    'encrypt_name' => FALSE
                ];
                $this->load->library('upload');
                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file'] = [
                        'name' => $_FILES['uploaded_files']['name'][$i],
                        'type' => $_FILES['uploaded_files']['type'][$i],
                        'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                        'error' => $_FILES['uploaded_files']['error'][$i],
                        'size' => $_FILES['uploaded_files']['size'][$i]
                    ];
                    $this->upload->initialize($config);
                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();
                        $existingFiles[] = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];
                    }
                }
            }

            $dataset['files_name'] = array_values($existingFiles);
            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            $this->audit_model->update_mrd_lama_feedback($id, [
                'dataset' => json_encode($dataset),

            ]);

            redirect('audit/mrd_lama_feedback?id=' . $id);
        } else {
            $data['record'] = $this->audit_model->get_mrd_lama_feedback_byid($id);
            $this->load->view('audit/edit_mrd_lama_feedback', $data);
        }
    }

    public function edit_mrd_op_feedback_byid($id)
    {
        if ($this->input->post()) {
            $existing = $this->audit_model->get_mrd_op_feedback_byid($id);
            $dataset = json_decode($existing->dataset, true) ?: [];
            $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];

            $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath))
                            @unlink($absolutePath);
                        unset($existingFiles[$index]);
                    }
                }
                $existingFiles = array_values($existingFiles);
            }

            if (!empty($_FILES['uploaded_files']['name'][0])) {
                $filesCount = count($_FILES['uploaded_files']['name']);
                $config = [
                    'upload_path' => './api/file_uploads/',
                    'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                    'max_size' => 50000,
                    'encrypt_name' => FALSE
                ];
                $this->load->library('upload');
                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file'] = [
                        'name' => $_FILES['uploaded_files']['name'][$i],
                        'type' => $_FILES['uploaded_files']['type'][$i],
                        'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                        'error' => $_FILES['uploaded_files']['error'][$i],
                        'size' => $_FILES['uploaded_files']['size'][$i]
                    ];
                    $this->upload->initialize($config);
                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();
                        $existingFiles[] = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];
                    }
                }
            }

            $dataset['files_name'] = array_values($existingFiles);
            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            $this->audit_model->update_mrd_op_feedback($id, [
                'dataset' => json_encode($dataset),

            ]);

            redirect('audit/mrd_op_feedback?id=' . $id);
        } else {
            $data['record'] = $this->audit_model->get_mrd_op_feedback_byid($id);
            $this->load->view('audit/edit_mrd_op_feedback', $data);
        }
    }


    //edit page and to edit for Nursing & IPSG
    public function edit_accidental_delining_feedback()
    {

        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }


        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_accidental_delining_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_accidental_delining_feedback', $data, true);
            }
            //    $data['content'] = $this->load->view('qualitymodules/ticket_track', $data, true);

            $this->load->view('layout/main_wrapper', $data);
        }
    }
    public function edit_admission_holding_area_feedback()
    {

        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }


        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_admission_holding_area_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_admission_holding_area_feedback', $data, true);
            }
            //    $data['content'] = $this->load->view('qualitymodules/ticket_track', $data, true);

            $this->load->view('layout/main_wrapper', $data);
        }
    }
    public function edit_cardio_pulmonary_feedback()
    {

        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }


        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_cardio_pulmonary_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_cardio_pulmonary_feedback', $data, true);
            }
            //    $data['content'] = $this->load->view('qualitymodules/ticket_track', $data, true);

            $this->load->view('layout/main_wrapper', $data);
        }
    }
    public function edit_extravasation_audit_feedback()
    {

        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }


        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_extravasation_audit_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_extravasation_audit_feedback', $data, true);
            }
            //    $data['content'] = $this->load->view('qualitymodules/ticket_track', $data, true);

            $this->load->view('layout/main_wrapper', $data);
        }
    }
    public function edit_hapu_audit_feedback()
    {

        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }


        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_hapu_audit_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_hapu_audit_feedback', $data, true);
            }
            //    $data['content'] = $this->load->view('qualitymodules/ticket_track', $data, true);

            $this->load->view('layout/main_wrapper', $data);
        }
    }
    public function edit_initial_assessment_ae_feedback()
    {

        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }


        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_initial_assessment_ae_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_initial_assessment_ae_feedback', $data, true);
            }
            //    $data['content'] = $this->load->view('qualitymodules/ticket_track', $data, true);

            $this->load->view('layout/main_wrapper', $data);
        }
    }
    public function edit_initial_assessment_ipd_feedback()
    {

        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }


        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_initial_assessment_ipd_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_initial_assessment_ipd_feedback', $data, true);
            }
            //    $data['content'] = $this->load->view('qualitymodules/ticket_track', $data, true);

            $this->load->view('layout/main_wrapper', $data);
        }
    }
    public function edit_initial_assessment_opd_feedback()
    {

        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }


        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_initial_assessment_opd_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_initial_assessment_opd_feedback', $data, true);
            }
            //    $data['content'] = $this->load->view('qualitymodules/ticket_track', $data, true);

            $this->load->view('layout/main_wrapper', $data);
        }
    }
    public function edit_ipsg1_feedback()
    {

        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }


        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_ipsg1_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_ipsg1_feedback', $data, true);
            }
            //    $data['content'] = $this->load->view('qualitymodules/ticket_track', $data, true);

            $this->load->view('layout/main_wrapper', $data);
        }
    }

    public function edit_ipsg2_er_feedback()
    {

        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }


        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_ipsg2_er_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_ipsg2_er_feedback', $data, true);
            }
            //    $data['content'] = $this->load->view('qualitymodules/ticket_track', $data, true);

            $this->load->view('layout/main_wrapper', $data);
        }
    }

    public function edit_ipsg2_ae_feedback()
    {

        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }


        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_ipsg2_ae_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_ipsg2_ae_feedback', $data, true);
            }
            //    $data['content'] = $this->load->view('qualitymodules/ticket_track', $data, true);

            $this->load->view('layout/main_wrapper', $data);
        }
    }

    public function edit_ipsg2_ipd_feedback()
    {

        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }


        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_ipsg2_ipd_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_ipsg2_ipd_feedback', $data, true);
            }
            //    $data['content'] = $this->load->view('qualitymodules/ticket_track', $data, true);

            $this->load->view('layout/main_wrapper', $data);
        }
    }
    public function edit_ipsg4_timeout_feedback()
    {

        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }


        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_ipsg4_timeout_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_ipsg4_timeout_feedback', $data, true);
            }
            //    $data['content'] = $this->load->view('qualitymodules/ticket_track', $data, true);

            $this->load->view('layout/main_wrapper', $data);
        }
    }
    public function edit_ipsg6_ip_feedback()
    {

        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }


        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_ipsg6_ip_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_ipsg6_ip_feedback', $data, true);
            }
            //    $data['content'] = $this->load->view('qualitymodules/ticket_track', $data, true);

            $this->load->view('layout/main_wrapper', $data);
        }
    }
    public function edit_ipsg6_opd_feedback()
    {

        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }


        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_ipsg6_opd_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_ipsg6_opd_feedback', $data, true);
            }
            //    $data['content'] = $this->load->view('qualitymodules/ticket_track', $data, true);

            $this->load->view('layout/main_wrapper', $data);
        }
    }
    public function edit_point_prevelance_feedback()
    {

        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }


        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_point_prevelance_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_point_prevelance_feedback', $data, true);
            }
            //    $data['content'] = $this->load->view('qualitymodules/ticket_track', $data, true);

            $this->load->view('layout/main_wrapper', $data);
        }
    }

    // To Edit audit by id Nursing & IPSG

    public function edit_accidental_delining_feedback_byid($id)
    {
        if ($this->input->post()) {
            $existing = $this->audit_model->get_accidental_delining_feedback_byid($id);
            $dataset = json_decode($existing->dataset, true) ?: [];
            $existingFiles = $dataset['files_name'] ?? [];

            $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath))
                            @unlink($absolutePath);
                        unset($existingFiles[$index]);
                    }
                }
                $existingFiles = array_values($existingFiles);
            }

            if (!empty($_FILES['uploaded_files']['name'][0])) {
                $filesCount = count($_FILES['uploaded_files']['name']);
                $config = [
                    'upload_path' => './api/file_uploads/',
                    'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                    'max_size' => 50000,
                    'encrypt_name' => FALSE
                ];
                $this->load->library('upload');
                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file'] = [
                        'name' => $_FILES['uploaded_files']['name'][$i],
                        'type' => $_FILES['uploaded_files']['type'][$i],
                        'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                        'error' => $_FILES['uploaded_files']['error'][$i],
                        'size' => $_FILES['uploaded_files']['size'][$i]
                    ];
                    $this->upload->initialize($config);
                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();
                        $existingFiles[] = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];
                    }
                }
            }

            $dataset['files_name'] = array_values($existingFiles);

            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            $this->audit_model->update_accidental_delining_feedback($id, [
                'dataset' => json_encode($dataset),

            ]);

            redirect('audit/accidental_delining_feedback?id=' . $id);
        } else {
            $data['record'] = $this->audit_model->get_accidental_delining_feedback_byid($id);
            $this->load->view('audit/edit_accidental_delining_feedback', $data);
        }
    }

    public function edit_admission_holding_area_feedback_byid($id)
    {
        if ($this->input->post()) {
            $existing = $this->audit_model->get_admission_holding_area_feedback_byid($id);
            $dataset = json_decode($existing->dataset, true) ?: [];
            $existingFiles = $dataset['files_name'] ?? [];

            $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath))
                            @unlink($absolutePath);
                        unset($existingFiles[$index]);
                    }
                }
                $existingFiles = array_values($existingFiles);
            }

            if (!empty($_FILES['uploaded_files']['name'][0])) {
                $filesCount = count($_FILES['uploaded_files']['name']);
                $config = [
                    'upload_path' => './api/file_uploads/',
                    'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                    'max_size' => 50000,
                    'encrypt_name' => FALSE
                ];
                $this->load->library('upload');
                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file'] = [
                        'name' => $_FILES['uploaded_files']['name'][$i],
                        'type' => $_FILES['uploaded_files']['type'][$i],
                        'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                        'error' => $_FILES['uploaded_files']['error'][$i],
                        'size' => $_FILES['uploaded_files']['size'][$i]
                    ];
                    $this->upload->initialize($config);
                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();
                        $existingFiles[] = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];
                    }
                }
            }

            $dataset['files_name'] = array_values($existingFiles);

            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            $this->audit_model->update_admission_holding_area_feedback($id, [
                'dataset' => json_encode($dataset),

            ]);

            redirect('audit/admission_holding_area_feedback?id=' . $id);
        } else {
            $data['record'] = $this->audit_model->get_admission_holding_area_feedback_byid($id);
            $this->load->view('audit/edit_admission_holding_area_feedback', $data);
        }
    }

    public function edit_cardio_pulmonary_feedback_byid($id)
    {
        if ($this->input->post()) {
            $existing = $this->audit_model->get_cardio_pulmonary_feedback_byid($id);
            $dataset = json_decode($existing->dataset, true) ?: [];
            $existingFiles = $dataset['files_name'] ?? [];

            $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath))
                            @unlink($absolutePath);
                        unset($existingFiles[$index]);
                    }
                }
                $existingFiles = array_values($existingFiles);
            }

            if (!empty($_FILES['uploaded_files']['name'][0])) {
                $filesCount = count($_FILES['uploaded_files']['name']);
                $config = [
                    'upload_path' => './api/file_uploads/',
                    'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                    'max_size' => 50000,
                    'encrypt_name' => FALSE
                ];
                $this->load->library('upload');
                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file'] = [
                        'name' => $_FILES['uploaded_files']['name'][$i],
                        'type' => $_FILES['uploaded_files']['type'][$i],
                        'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                        'error' => $_FILES['uploaded_files']['error'][$i],
                        'size' => $_FILES['uploaded_files']['size'][$i]
                    ];
                    $this->upload->initialize($config);
                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();
                        $existingFiles[] = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];
                    }
                }
            }

            $dataset['files_name'] = array_values($existingFiles);

            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            $this->audit_model->update_cardio_pulmonary_feedback($id, [
                'dataset' => json_encode($dataset),

            ]);

            redirect('audit/cardio_pulmonary_feedback?id=' . $id);
        } else {
            $data['record'] = $this->audit_model->get_cardio_pulmonary_feedback_byid($id);
            $this->load->view('audit/edit_cardio_pulmonary_feedback', $data);
        }
    }

    public function edit_extravasation_audit_feedback_byid($id)
    {
        if ($this->input->post()) {
            $existing = $this->audit_model->get_extravasation_audit_feedback_byid($id);
            $dataset = json_decode($existing->dataset, true) ?: [];
            $existingFiles = $dataset['files_name'] ?? [];

            $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath))
                            @unlink($absolutePath);
                        unset($existingFiles[$index]);
                    }
                }
                $existingFiles = array_values($existingFiles);
            }

            if (!empty($_FILES['uploaded_files']['name'][0])) {
                $filesCount = count($_FILES['uploaded_files']['name']);
                $config = [
                    'upload_path' => './api/file_uploads/',
                    'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                    'max_size' => 50000,
                    'encrypt_name' => FALSE
                ];
                $this->load->library('upload');
                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file'] = [
                        'name' => $_FILES['uploaded_files']['name'][$i],
                        'type' => $_FILES['uploaded_files']['type'][$i],
                        'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                        'error' => $_FILES['uploaded_files']['error'][$i],
                        'size' => $_FILES['uploaded_files']['size'][$i]
                    ];
                    $this->upload->initialize($config);
                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();
                        $existingFiles[] = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];
                    }
                }
            }

            $dataset['files_name'] = array_values($existingFiles);

            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            $this->audit_model->update_extravasation_audit_feedback($id, [
                'dataset' => json_encode($dataset),

            ]);

            redirect('audit/extravasation_audit_feedback?id=' . $id);
        } else {
            $data['record'] = $this->audit_model->get_extravasation_audit_feedback_byid($id);
            $this->load->view('audit/edit_extravasation_audit_feedback', $data);
        }
    }

    public function edit_hapu_audit_feedback_byid($id)
    {
        if ($this->input->post()) {
            $existing = $this->audit_model->get_hapu_audit_feedback_byid($id);
            $dataset = json_decode($existing->dataset, true) ?: [];
            $existingFiles = $dataset['files_name'] ?? [];

            $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath))
                            @unlink($absolutePath);
                        unset($existingFiles[$index]);
                    }
                }
                $existingFiles = array_values($existingFiles);
            }

            if (!empty($_FILES['uploaded_files']['name'][0])) {
                $filesCount = count($_FILES['uploaded_files']['name']);
                $config = [
                    'upload_path' => './api/file_uploads/',
                    'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                    'max_size' => 50000,
                    'encrypt_name' => FALSE
                ];
                $this->load->library('upload');
                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file'] = [
                        'name' => $_FILES['uploaded_files']['name'][$i],
                        'type' => $_FILES['uploaded_files']['type'][$i],
                        'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                        'error' => $_FILES['uploaded_files']['error'][$i],
                        'size' => $_FILES['uploaded_files']['size'][$i]
                    ];
                    $this->upload->initialize($config);
                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();
                        $existingFiles[] = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];
                    }
                }
            }

            $dataset['files_name'] = array_values($existingFiles);

            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            $this->audit_model->update_hapu_audit_feedback($id, [
                'dataset' => json_encode($dataset),

            ]);

            redirect('audit/hapu_audit_feedback?id=' . $id);
        } else {
            $data['record'] = $this->audit_model->get_hapu_audit_feedback_byid($id);
            $this->load->view('audit/edit_hapu_audit_feedback', $data);
        }
    }

    public function edit_initial_assessment_ae_feedback_byid($id)
    {
        if ($this->input->post()) {
            $existing = $this->audit_model->get_initial_assessment_ae_feedback_byid($id);
            $dataset = json_decode($existing->dataset, true) ?: [];
            $existingFiles = $dataset['files_name'] ?? [];

            $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath))
                            @unlink($absolutePath);
                        unset($existingFiles[$index]);
                    }
                }
                $existingFiles = array_values($existingFiles);
            }

            if (!empty($_FILES['uploaded_files']['name'][0])) {
                $filesCount = count($_FILES['uploaded_files']['name']);
                $config = [
                    'upload_path' => './api/file_uploads/',
                    'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                    'max_size' => 50000,
                    'encrypt_name' => FALSE
                ];
                $this->load->library('upload');
                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file'] = [
                        'name' => $_FILES['uploaded_files']['name'][$i],
                        'type' => $_FILES['uploaded_files']['type'][$i],
                        'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                        'error' => $_FILES['uploaded_files']['error'][$i],
                        'size' => $_FILES['uploaded_files']['size'][$i]
                    ];
                    $this->upload->initialize($config);
                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();
                        $existingFiles[] = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];
                    }
                }
            }

            $dataset['files_name'] = array_values($existingFiles);

            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            $this->audit_model->update_initial_assessment_ae_feedback($id, [
                'dataset' => json_encode($dataset),

            ]);

            redirect('audit/initial_assessment_ae_feedback?id=' . $id);
        } else {
            $data['record'] = $this->audit_model->get_initial_assessment_ae_feedback_byid($id);
            $this->load->view('audit/edit_initial_assessment_ae_feedback', $data);
        }
    }

    public function edit_initial_assessment_ipd_feedback_byid($id)
    {
        if ($this->input->post()) {
            $existing = $this->audit_model->get_initial_assessment_ipd_feedback_byid($id);
            $dataset = json_decode($existing->dataset, true) ?: [];
            $existingFiles = $dataset['files_name'] ?? [];

            $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath))
                            @unlink($absolutePath);
                        unset($existingFiles[$index]);
                    }
                }
                $existingFiles = array_values($existingFiles);
            }

            if (!empty($_FILES['uploaded_files']['name'][0])) {
                $filesCount = count($_FILES['uploaded_files']['name']);
                $config = [
                    'upload_path' => './api/file_uploads/',
                    'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                    'max_size' => 50000,
                    'encrypt_name' => FALSE
                ];
                $this->load->library('upload');
                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file'] = [
                        'name' => $_FILES['uploaded_files']['name'][$i],
                        'type' => $_FILES['uploaded_files']['type'][$i],
                        'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                        'error' => $_FILES['uploaded_files']['error'][$i],
                        'size' => $_FILES['uploaded_files']['size'][$i]
                    ];
                    $this->upload->initialize($config);
                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();
                        $existingFiles[] = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];
                    }
                }
            }

            $dataset['files_name'] = array_values($existingFiles);

            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            $this->audit_model->update_initial_assessment_ipd_feedback($id, [
                'dataset' => json_encode($dataset),

            ]);

            redirect('audit/initial_assessment_ipd_feedback?id=' . $id);
        } else {
            $data['record'] = $this->audit_model->get_initial_assessment_ipd_feedback_byid($id);
            $this->load->view('audit/edit_initial_assessment_ipd_feedback', $data);
        }
    }

    public function edit_initial_assessment_opd_feedback_byid($id)
    {
        if ($this->input->post()) {
            $existing = $this->audit_model->get_initial_assessment_opd_feedback_byid($id);
            $dataset = json_decode($existing->dataset, true) ?: [];
            $existingFiles = $dataset['files_name'] ?? [];

            $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath))
                            @unlink($absolutePath);
                        unset($existingFiles[$index]);
                    }
                }
                $existingFiles = array_values($existingFiles);
            }

            if (!empty($_FILES['uploaded_files']['name'][0])) {
                $filesCount = count($_FILES['uploaded_files']['name']);
                $config = [
                    'upload_path' => './api/file_uploads/',
                    'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                    'max_size' => 50000,
                    'encrypt_name' => FALSE
                ];
                $this->load->library('upload');
                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file'] = [
                        'name' => $_FILES['uploaded_files']['name'][$i],
                        'type' => $_FILES['uploaded_files']['type'][$i],
                        'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                        'error' => $_FILES['uploaded_files']['error'][$i],
                        'size' => $_FILES['uploaded_files']['size'][$i]
                    ];
                    $this->upload->initialize($config);
                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();
                        $existingFiles[] = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];
                    }
                }
            }

            $dataset['files_name'] = array_values($existingFiles);

            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            $this->audit_model->update_initial_assessment_opd_feedback($id, [
                'dataset' => json_encode($dataset),

            ]);

            redirect('audit/initial_assessment_opd_feedback?id=' . $id);
        } else {
            $data['record'] = $this->audit_model->get_initial_assessment_opd_feedback_byid($id);
            $this->load->view('audit/edit_initial_assessment_opd_feedback', $data);
        }
    }

    public function edit_ipsg1_feedback_byid($id)
    {
        if ($this->input->post()) {
            $existing = $this->audit_model->get_ipsg1_feedback_byid($id);
            $dataset = json_decode($existing->dataset, true) ?: [];
            $existingFiles = $dataset['files_name'] ?? [];

            $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath))
                            @unlink($absolutePath);
                        unset($existingFiles[$index]);
                    }
                }
                $existingFiles = array_values($existingFiles);
            }

            if (!empty($_FILES['uploaded_files']['name'][0])) {
                $filesCount = count($_FILES['uploaded_files']['name']);
                $config = [
                    'upload_path' => './api/file_uploads/',
                    'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                    'max_size' => 50000,
                    'encrypt_name' => FALSE
                ];
                $this->load->library('upload');
                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file'] = [
                        'name' => $_FILES['uploaded_files']['name'][$i],
                        'type' => $_FILES['uploaded_files']['type'][$i],
                        'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                        'error' => $_FILES['uploaded_files']['error'][$i],
                        'size' => $_FILES['uploaded_files']['size'][$i]
                    ];
                    $this->upload->initialize($config);
                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();
                        $existingFiles[] = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];
                    }
                }
            }

            $dataset['files_name'] = array_values($existingFiles);

            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            $this->audit_model->update_ipsg1_feedback($id, [
                'dataset' => json_encode($dataset),

            ]);

            redirect('audit/ipsg1_feedback?id=' . $id);
        } else {
            $data['record'] = $this->audit_model->get_ipsg1_feedback_byid($id);
            $this->load->view('audit/edit_ipsg1_feedback', $data);
        }
    }

    public function edit_ipsg2_er_feedback_byid($id)
    {
        if ($this->input->post()) {
            $existing = $this->audit_model->get_ipsg2_ae_feedback_byid($id);
            $dataset = json_decode($existing->dataset, true) ?: [];
            $existingFiles = $dataset['files_name'] ?? [];

            $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath))
                            @unlink($absolutePath);
                        unset($existingFiles[$index]);
                    }
                }
                $existingFiles = array_values($existingFiles);
            }

            if (!empty($_FILES['uploaded_files']['name'][0])) {
                $filesCount = count($_FILES['uploaded_files']['name']);
                $config = [
                    'upload_path' => './api/file_uploads/',
                    'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                    'max_size' => 50000,
                    'encrypt_name' => FALSE
                ];
                $this->load->library('upload');
                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file'] = [
                        'name' => $_FILES['uploaded_files']['name'][$i],
                        'type' => $_FILES['uploaded_files']['type'][$i],
                        'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                        'error' => $_FILES['uploaded_files']['error'][$i],
                        'size' => $_FILES['uploaded_files']['size'][$i]
                    ];
                    $this->upload->initialize($config);
                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();
                        $existingFiles[] = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];
                    }
                }
            }

            $dataset['files_name'] = array_values($existingFiles);

            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            $this->audit_model->update_ipsg2_er_feedback($id, [
                'dataset' => json_encode($dataset),

            ]);

            redirect('audit/ipsg2_er_feedback?id=' . $id);
        } else {
            $data['record'] = $this->audit_model->get_ipsg2_er_feedback_byid($id);
            $this->load->view('audit/edit_ipsg2_er_feedback', $data);
        }
    }

    public function edit_ipsg2_ae_feedback_byid($id)
    {
        if ($this->input->post()) {
            $existing = $this->audit_model->get_ipsg2_ae_feedback_byid($id);
            $dataset = json_decode($existing->dataset, true) ?: [];
            $existingFiles = $dataset['files_name'] ?? [];

            $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath))
                            @unlink($absolutePath);
                        unset($existingFiles[$index]);
                    }
                }
                $existingFiles = array_values($existingFiles);
            }

            if (!empty($_FILES['uploaded_files']['name'][0])) {
                $filesCount = count($_FILES['uploaded_files']['name']);
                $config = [
                    'upload_path' => './api/file_uploads/',
                    'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                    'max_size' => 50000,
                    'encrypt_name' => FALSE
                ];
                $this->load->library('upload');
                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file'] = [
                        'name' => $_FILES['uploaded_files']['name'][$i],
                        'type' => $_FILES['uploaded_files']['type'][$i],
                        'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                        'error' => $_FILES['uploaded_files']['error'][$i],
                        'size' => $_FILES['uploaded_files']['size'][$i]
                    ];
                    $this->upload->initialize($config);
                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();
                        $existingFiles[] = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];
                    }
                }
            }

            $dataset['files_name'] = array_values($existingFiles);

            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            $this->audit_model->update_ipsg2_ae_feedback($id, [
                'dataset' => json_encode($dataset),

            ]);

            redirect('audit/ipsg2_ae_feedback?id=' . $id);
        } else {
            $data['record'] = $this->audit_model->get_ipsg2_ae_feedback_byid($id);
            $this->load->view('audit/edit_ipsg2_ae_feedback', $data);
        }
    }

    public function edit_ipsg2_ipd_feedback_byid($id)
    {
        if ($this->input->post()) {
            $existing = $this->audit_model->get_ipsg2_ipd_feedback_byid($id);
            $dataset = json_decode($existing->dataset, true) ?: [];
            $existingFiles = $dataset['files_name'] ?? [];

            $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath))
                            @unlink($absolutePath);
                        unset($existingFiles[$index]);
                    }
                }
                $existingFiles = array_values($existingFiles);
            }

            if (!empty($_FILES['uploaded_files']['name'][0])) {
                $filesCount = count($_FILES['uploaded_files']['name']);
                $config = [
                    'upload_path' => './api/file_uploads/',
                    'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                    'max_size' => 50000,
                    'encrypt_name' => FALSE
                ];
                $this->load->library('upload');
                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file'] = [
                        'name' => $_FILES['uploaded_files']['name'][$i],
                        'type' => $_FILES['uploaded_files']['type'][$i],
                        'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                        'error' => $_FILES['uploaded_files']['error'][$i],
                        'size' => $_FILES['uploaded_files']['size'][$i]
                    ];
                    $this->upload->initialize($config);
                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();
                        $existingFiles[] = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];
                    }
                }
            }

            $dataset['files_name'] = array_values($existingFiles);

            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            $this->audit_model->update_ipsg2_ipd_feedback($id, [
                'dataset' => json_encode($dataset),

            ]);

            redirect('audit/ipsg2_ipd_feedback?id=' . $id);
        } else {
            $data['record'] = $this->audit_model->get_ipsg2_ipd_feedback_byid($id);
            $this->load->view('audit/edit_ipsg2_ipd_feedback', $data);
        }
    }

    public function edit_ipsg4_timeout_feedback_byid($id)
    {
        if ($this->input->post()) {
            $existing = $this->audit_model->get_ipsg4_timeout_feedback_byid($id);
            $dataset = json_decode($existing->dataset, true) ?: [];
            $existingFiles = $dataset['files_name'] ?? [];

            $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath))
                            @unlink($absolutePath);
                        unset($existingFiles[$index]);
                    }
                }
                $existingFiles = array_values($existingFiles);
            }

            if (!empty($_FILES['uploaded_files']['name'][0])) {
                $filesCount = count($_FILES['uploaded_files']['name']);
                $config = [
                    'upload_path' => './api/file_uploads/',
                    'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                    'max_size' => 50000,
                    'encrypt_name' => FALSE
                ];
                $this->load->library('upload');
                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file'] = [
                        'name' => $_FILES['uploaded_files']['name'][$i],
                        'type' => $_FILES['uploaded_files']['type'][$i],
                        'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                        'error' => $_FILES['uploaded_files']['error'][$i],
                        'size' => $_FILES['uploaded_files']['size'][$i]
                    ];
                    $this->upload->initialize($config);
                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();
                        $existingFiles[] = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];
                    }
                }
            }

            $dataset['files_name'] = array_values($existingFiles);

            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            $this->audit_model->update_ipsg4_timeout_feedback($id, [
                'dataset' => json_encode($dataset),

            ]);

            redirect('audit/ipsg4_timeout_feedback?id=' . $id);
        } else {
            $data['record'] = $this->audit_model->get_ipsg4_timeout_feedback_byid($id);
            $this->load->view('audit/edit_ipsg4_timeout_feedback', $data);
        }
    }

    public function edit_ipsg6_ip_feedback_byid($id)
    {
        if ($this->input->post()) {
            $existing = $this->audit_model->get_ipsg6_ip_feedback_byid($id);
            $dataset = json_decode($existing->dataset, true) ?: [];
            $existingFiles = $dataset['files_name'] ?? [];

            $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath))
                            @unlink($absolutePath);
                        unset($existingFiles[$index]);
                    }
                }
                $existingFiles = array_values($existingFiles);
            }

            if (!empty($_FILES['uploaded_files']['name'][0])) {
                $filesCount = count($_FILES['uploaded_files']['name']);
                $config = [
                    'upload_path' => './api/file_uploads/',
                    'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                    'max_size' => 50000,
                    'encrypt_name' => FALSE
                ];
                $this->load->library('upload');
                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file'] = [
                        'name' => $_FILES['uploaded_files']['name'][$i],
                        'type' => $_FILES['uploaded_files']['type'][$i],
                        'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                        'error' => $_FILES['uploaded_files']['error'][$i],
                        'size' => $_FILES['uploaded_files']['size'][$i]
                    ];
                    $this->upload->initialize($config);
                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();
                        $existingFiles[] = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];
                    }
                }
            }

            $dataset['files_name'] = array_values($existingFiles);

            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            $this->audit_model->update_ipsg6_ip_feedback($id, [
                'dataset' => json_encode($dataset),

            ]);

            redirect('audit/ipsg6_ip_feedback?id=' . $id);
        } else {
            $data['record'] = $this->audit_model->get_ipsg6_ip_feedback_byid($id);
            $this->load->view('audit/edit_ipsg6_ip_feedback', $data);
        }
    }

    public function edit_ipsg6_opd_feedback_byid($id)
    {
        if ($this->input->post()) {
            $existing = $this->audit_model->get_ipsg6_opd_feedback_byid($id);
            $dataset = json_decode($existing->dataset, true) ?: [];
            $existingFiles = $dataset['files_name'] ?? [];

            $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath))
                            @unlink($absolutePath);
                        unset($existingFiles[$index]);
                    }
                }
                $existingFiles = array_values($existingFiles);
            }

            if (!empty($_FILES['uploaded_files']['name'][0])) {
                $filesCount = count($_FILES['uploaded_files']['name']);
                $config = [
                    'upload_path' => './api/file_uploads/',
                    'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                    'max_size' => 50000,
                    'encrypt_name' => FALSE
                ];
                $this->load->library('upload');
                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file'] = [
                        'name' => $_FILES['uploaded_files']['name'][$i],
                        'type' => $_FILES['uploaded_files']['type'][$i],
                        'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                        'error' => $_FILES['uploaded_files']['error'][$i],
                        'size' => $_FILES['uploaded_files']['size'][$i]
                    ];
                    $this->upload->initialize($config);
                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();
                        $existingFiles[] = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];
                    }
                }
            }

            $dataset['files_name'] = array_values($existingFiles);

            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            $this->audit_model->update_ipsg6_opd_feedback($id, [
                'dataset' => json_encode($dataset),

            ]);

            redirect('audit/ipsg6_opd_feedback?id=' . $id);
        } else {
            $data['record'] = $this->audit_model->get_ipsg6_opd_feedback_byid($id);
            $this->load->view('audit/edit_ipsg6_opd_feedback', $data);
        }
    }

    public function edit_point_prevelance_feedback_byid($id)
    {
        if ($this->input->post()) {
            $existing = $this->audit_model->get_point_prevelance_feedback_byid($id);
            $dataset = json_decode($existing->dataset, true) ?: [];
            $existingFiles = $dataset['files_name'] ?? [];

            $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath))
                            @unlink($absolutePath);
                        unset($existingFiles[$index]);
                    }
                }
                $existingFiles = array_values($existingFiles);
            }

            if (!empty($_FILES['uploaded_files']['name'][0])) {
                $filesCount = count($_FILES['uploaded_files']['name']);
                $config = [
                    'upload_path' => './api/file_uploads/',
                    'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                    'max_size' => 50000,
                    'encrypt_name' => FALSE
                ];
                $this->load->library('upload');
                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file'] = [
                        'name' => $_FILES['uploaded_files']['name'][$i],
                        'type' => $_FILES['uploaded_files']['type'][$i],
                        'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                        'error' => $_FILES['uploaded_files']['error'][$i],
                        'size' => $_FILES['uploaded_files']['size'][$i]
                    ];
                    $this->upload->initialize($config);
                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();
                        $existingFiles[] = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];
                    }
                }
            }

            $dataset['files_name'] = array_values($existingFiles);

            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            $this->audit_model->update_point_prevelance_feedback($id, [
                'dataset' => json_encode($dataset),

            ]);

            redirect('audit/point_prevelance_feedback?id=' . $id);
        } else {
            $data['record'] = $this->audit_model->get_point_prevelance_feedback_byid($id);
            $this->load->view('audit/edit_point_prevelance_feedback', $data);
        }
    }


    //edit page and to edit for Clinical Outcome

    public function edit_clinical_audit_acl_feedback()
    {

        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }


        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_clinical_audit_acl_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_clinical_audit_acl_feedback', $data, true);
            }
            //    $data['content'] = $this->load->view('qualitymodules/ticket_track', $data, true);

            $this->load->view('layout/main_wrapper', $data);
        }
    }
    public function edit_clinical_allogenic_bone_marrow_feedback()
    {

        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }


        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_clinical_allogenic_bone_marrow_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_clinical_allogenic_bone_marrow_feedback', $data, true);
            }
            //    $data['content'] = $this->load->view('qualitymodules/ticket_track', $data, true);

            $this->load->view('layout/main_wrapper', $data);
        }
    }
    public function edit_clinical_aortic_value_replacement_feedback()
    {

        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }


        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_clinical_aortic_value_replacement_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_clinical_aortic_value_replacement_feedback', $data, true);
            }
            //    $data['content'] = $this->load->view('qualitymodules/ticket_track', $data, true);

            $this->load->view('layout/main_wrapper', $data);
        }
    }
    public function edit_clinical_autologous_bone_feedback()
    {

        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }


        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_clinical_autologous_bone_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_clinical_autologous_bone_feedback', $data, true);
            }
            //    $data['content'] = $this->load->view('qualitymodules/ticket_track', $data, true);

            $this->load->view('layout/main_wrapper', $data);
        }
    }
    public function edit_clinical_brain_tumour_feedback()
    {

        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }


        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_clinical_brain_tumour_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_clinical_brain_tumour_feedback', $data, true);
            }
            //    $data['content'] = $this->load->view('qualitymodules/ticket_track', $data, true);

            $this->load->view('layout/main_wrapper', $data);
        }
    }
    public function edit_clinical_cabg_feedback()
    {

        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }


        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_clinical_cabg_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_clinical_cabg_feedback', $data, true);
            }
            //    $data['content'] = $this->load->view('qualitymodules/ticket_track', $data, true);

            $this->load->view('layout/main_wrapper', $data);
        }
    }
    public function edit_clinical_carotid_stenting_feedback()
    {

        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }


        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_clinical_carotid_stenting_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_clinical_carotid_stenting_feedback', $data, true);
            }
            //    $data['content'] = $this->load->view('qualitymodules/ticket_track', $data, true);

            $this->load->view('layout/main_wrapper', $data);
        }
    }
    public function edit_clinical_chemotherapy_feedback()
    {

        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }


        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_clinical_chemotherapy_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_clinical_chemotherapy_feedback', $data, true);
            }
            //    $data['content'] = $this->load->view('qualitymodules/ticket_track', $data, true);

            $this->load->view('layout/main_wrapper', $data);
        }
    }
    public function edit_clinical_colo_rectal_feedback()
    {

        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }


        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_clinical_colo_rectal_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_clinical_colo_rectal_feedback', $data, true);
            }
            //    $data['content'] = $this->load->view('qualitymodules/ticket_track', $data, true);

            $this->load->view('layout/main_wrapper', $data);
        }
    }
    public function edit_clinical_endoscopy_feedback()
    {

        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }


        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_clinical_endoscopy_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_clinical_endoscopy_feedback', $data, true);
            }
            //    $data['content'] = $this->load->view('qualitymodules/ticket_track', $data, true);

            $this->load->view('layout/main_wrapper', $data);
        }
    }
    public function edit_clinical_epilepsy_feedback()
    {

        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }


        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_clinical_epilepsy_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_clinical_epilepsy_feedback', $data, true);
            }
            //    $data['content'] = $this->load->view('qualitymodules/ticket_track', $data, true);

            $this->load->view('layout/main_wrapper', $data);
        }
    }
    public function edit_clinical_herniorrhaphy_feedback()
    {

        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }


        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_clinical_herniorrhaphy_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_clinical_herniorrhaphy_feedback', $data, true);
            }
            //    $data['content'] = $this->load->view('qualitymodules/ticket_track', $data, true);

            $this->load->view('layout/main_wrapper', $data);
        }
    }
    public function edit_clinical_holep_feedback()
    {

        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }


        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_clinical_holep_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_clinical_holep_feedback', $data, true);
            }
            //    $data['content'] = $this->load->view('qualitymodules/ticket_track', $data, true);

            $this->load->view('layout/main_wrapper', $data);
        }
    }
    public function edit_clinical_laparoscopic_feedback()
    {

        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }


        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_clinical_laparoscopic_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_clinical_laparoscopic_feedback', $data, true);
            }
            //    $data['content'] = $this->load->view('qualitymodules/ticket_track', $data, true);

            $this->load->view('layout/main_wrapper', $data);
        }
    }
    public function edit_clinical_mechanical_thrombectomy_feedback()
    {

        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }


        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_clinical_mechanical_thrombectomy_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_clinical_mechanical_thrombectomy_feedback', $data, true);
            }
            //    $data['content'] = $this->load->view('qualitymodules/ticket_track', $data, true);

            $this->load->view('layout/main_wrapper', $data);
        }
    }
    public function edit_clinical_mvr_feedback()
    {

        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }


        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_clinical_mvr_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_clinical_mvr_feedback', $data, true);
            }
            //    $data['content'] = $this->load->view('qualitymodules/ticket_track', $data, true);

            $this->load->view('layout/main_wrapper', $data);
        }
    }
    public function edit_clinical_ptca_feedback()
    {

        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }


        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_clinical_ptca_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_clinical_ptca_feedback', $data, true);
            }
            //    $data['content'] = $this->load->view('qualitymodules/ticket_track', $data, true);

            $this->load->view('layout/main_wrapper', $data);
        }
    }
    public function edit_clinical_renal_transplantation_feedback()
    {

        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }


        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_clinical_renal_transplantation_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_clinical_renal_transplantation_feedback', $data, true);
            }
            //    $data['content'] = $this->load->view('qualitymodules/ticket_track', $data, true);

            $this->load->view('layout/main_wrapper', $data);
        }
    }
    public function edit_clinical_scoliosis_correction_feedback()
    {

        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }


        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_clinical_scoliosis_correction_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_clinical_scoliosis_correction_feedback', $data, true);
            }
            //    $data['content'] = $this->load->view('qualitymodules/ticket_track', $data, true);

            $this->load->view('layout/main_wrapper', $data);
        }
    }
    public function edit_clinical_spinal_dysraphism_feedback()
    {

        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }


        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_clinical_spinal_dysraphism_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_clinical_spinal_dysraphism_feedback', $data, true);
            }
            //    $data['content'] = $this->load->view('qualitymodules/ticket_track', $data, true);

            $this->load->view('layout/main_wrapper', $data);
        }
    }
    public function edit_clinical_spine_disc_surgery_feedback()
    {

        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }


        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_clinical_spine_disc_surgery_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_clinical_spine_disc_surgery_feedback', $data, true);
            }
            //    $data['content'] = $this->load->view('qualitymodules/ticket_track', $data, true);

            $this->load->view('layout/main_wrapper', $data);
        }
    }
    public function edit_clinical_thoracotomy_feedback()
    {

        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }


        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_clinical_thoracotomy_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_clinical_thoracotomy_feedback', $data, true);
            }
            //    $data['content'] = $this->load->view('qualitymodules/ticket_track', $data, true);

            $this->load->view('layout/main_wrapper', $data);
        }
    }
    public function edit_clinical_tkr_feedback()
    {

        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }


        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_clinical_tkr_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_clinical_tkr_feedback', $data, true);
            }
            //    $data['content'] = $this->load->view('qualitymodules/ticket_track', $data, true);

            $this->load->view('layout/main_wrapper', $data);
        }
    }
    public function edit_clinical_uro_oncology_feedback()
    {

        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }


        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_clinical_uro_oncology_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_clinical_uro_oncology_feedback', $data, true);
            }
            //    $data['content'] = $this->load->view('qualitymodules/ticket_track', $data, true);

            $this->load->view('layout/main_wrapper', $data);
        }
    }
    public function edit_clinical_whipples_surgery_feedback()
    {

        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }


        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_clinical_whipples_surgery_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_clinical_whipples_surgery_feedback', $data, true);
            }
            //    $data['content'] = $this->load->view('qualitymodules/ticket_track', $data, true);

            $this->load->view('layout/main_wrapper', $data);
        }
    }
    public function edit_clinical_laparoscopic_cholecystectomy_feedback()
    {

        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }


        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_clinical_laparoscopic_cholecystectomy_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_clinical_laparoscopic_cholecystectomy_feedback', $data, true);
            }
            //    $data['content'] = $this->load->view('qualitymodules/ticket_track', $data, true);

            $this->load->view('layout/main_wrapper', $data);
        }
    }

    // To Edit audit by id Clinical Outcome

    public function edit_clinical_audit_acl_feedback_byid($id)
    {
        if ($this->input->post()) {
            $existing = $this->audit_model->get_clinical_audit_acl_feedback_byid($id);
            $dataset = json_decode($existing->dataset, true) ?: [];
            $existingFiles = $dataset['files_name'] ?? [];

            $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath))
                            @unlink($absolutePath);
                        unset($existingFiles[$index]);
                    }
                }
                $existingFiles = array_values($existingFiles);
            }

            if (!empty($_FILES['uploaded_files']['name'][0])) {
                $filesCount = count($_FILES['uploaded_files']['name']);
                $config = [
                    'upload_path' => './api/file_uploads/',
                    'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                    'max_size' => 50000,
                    'encrypt_name' => FALSE
                ];
                $this->load->library('upload');
                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file'] = [
                        'name' => $_FILES['uploaded_files']['name'][$i],
                        'type' => $_FILES['uploaded_files']['type'][$i],
                        'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                        'error' => $_FILES['uploaded_files']['error'][$i],
                        'size' => $_FILES['uploaded_files']['size'][$i]
                    ];
                    $this->upload->initialize($config);
                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();
                        $existingFiles[] = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];
                    }
                }
            }

            $dataset['files_name'] = array_values($existingFiles);

            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            $this->audit_model->update_clinical_audit_acl_feedback($id, [
                'dataset' => json_encode($dataset),

            ]);

            redirect('audit/clinical_audit_acl_feedback?id=' . $id);
        } else {
            $data['record'] = $this->audit_model->get_clinical_audit_acl_feedback_byid($id);
            $this->load->view('audit/edit_clinical_audit_acl_feedback', $data);
        }
    }

    public function edit_clinical_allogenic_bone_marrow_feedback_byid($id)
    {
        if ($this->input->post()) {
            $existing = $this->audit_model->get_clinical_allogenic_bone_marrow_feedback_byid($id);
            $dataset = json_decode($existing->dataset, true) ?: [];
            $existingFiles = $dataset['files_name'] ?? [];

            $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath))
                            @unlink($absolutePath);
                        unset($existingFiles[$index]);
                    }
                }
                $existingFiles = array_values($existingFiles);
            }

            if (!empty($_FILES['uploaded_files']['name'][0])) {
                $filesCount = count($_FILES['uploaded_files']['name']);
                $config = [
                    'upload_path' => './api/file_uploads/',
                    'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                    'max_size' => 50000,
                    'encrypt_name' => FALSE
                ];
                $this->load->library('upload');
                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file'] = [
                        'name' => $_FILES['uploaded_files']['name'][$i],
                        'type' => $_FILES['uploaded_files']['type'][$i],
                        'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                        'error' => $_FILES['uploaded_files']['error'][$i],
                        'size' => $_FILES['uploaded_files']['size'][$i]
                    ];
                    $this->upload->initialize($config);
                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();
                        $existingFiles[] = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];
                    }
                }
            }

            $dataset['files_name'] = array_values($existingFiles);

            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            $this->audit_model->update_clinical_allogenic_bone_marrow_feedback($id, [
                'dataset' => json_encode($dataset),

            ]);

            redirect('audit/clinical_allogenic_bone_marrow_feedback?id=' . $id);
        } else {
            $data['record'] = $this->audit_model->get_clinical_allogenic_bone_marrow_feedback_byid($id);
            $this->load->view('audit/edit_clinical_allogenic_bone_marrow_feedback', $data);
        }
    }

    public function edit_clinical_aortic_value_replacement_feedback_byid($id)
    {
        if ($this->input->post()) {
            $existing = $this->audit_model->get_clinical_aortic_value_replacement_feedback_byid($id);
            $dataset = json_decode($existing->dataset, true) ?: [];
            $existingFiles = $dataset['files_name'] ?? [];

            $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath))
                            @unlink($absolutePath);
                        unset($existingFiles[$index]);
                    }
                }
                $existingFiles = array_values($existingFiles);
            }

            if (!empty($_FILES['uploaded_files']['name'][0])) {
                $filesCount = count($_FILES['uploaded_files']['name']);
                $config = [
                    'upload_path' => './api/file_uploads/',
                    'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                    'max_size' => 50000,
                    'encrypt_name' => FALSE
                ];
                $this->load->library('upload');
                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file'] = [
                        'name' => $_FILES['uploaded_files']['name'][$i],
                        'type' => $_FILES['uploaded_files']['type'][$i],
                        'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                        'error' => $_FILES['uploaded_files']['error'][$i],
                        'size' => $_FILES['uploaded_files']['size'][$i]
                    ];
                    $this->upload->initialize($config);
                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();
                        $existingFiles[] = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];
                    }
                }
            }

            $dataset['files_name'] = array_values($existingFiles);

            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            $this->audit_model->update_clinical_aortic_value_replacement_feedback($id, [
                'dataset' => json_encode($dataset),

            ]);

            redirect('audit/clinical_aortic_value_replacement_feedback?id=' . $id);
        } else {
            $data['record'] = $this->audit_model->get_clinical_aortic_value_replacement_feedback_byid($id);
            $this->load->view('audit/edit_clinical_aortic_value_replacement_feedback', $data);
        }
    }

    public function edit_clinical_autologous_bone_feedback_byid($id)
    {
        if ($this->input->post()) {
            $existing = $this->audit_model->get_clinical_autologous_bone_feedback_byid($id);
            $dataset = json_decode($existing->dataset, true) ?: [];
            $existingFiles = $dataset['files_name'] ?? [];

            $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath))
                            @unlink($absolutePath);
                        unset($existingFiles[$index]);
                    }
                }
                $existingFiles = array_values($existingFiles);
            }

            if (!empty($_FILES['uploaded_files']['name'][0])) {
                $filesCount = count($_FILES['uploaded_files']['name']);
                $config = [
                    'upload_path' => './api/file_uploads/',
                    'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                    'max_size' => 50000,
                    'encrypt_name' => FALSE
                ];
                $this->load->library('upload');
                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file'] = [
                        'name' => $_FILES['uploaded_files']['name'][$i],
                        'type' => $_FILES['uploaded_files']['type'][$i],
                        'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                        'error' => $_FILES['uploaded_files']['error'][$i],
                        'size' => $_FILES['uploaded_files']['size'][$i]
                    ];
                    $this->upload->initialize($config);
                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();
                        $existingFiles[] = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];
                    }
                }
            }

            $dataset['files_name'] = array_values($existingFiles);

            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            $this->audit_model->update_clinical_autologous_bone_feedback($id, [
                'dataset' => json_encode($dataset),

            ]);

            redirect('audit/clinical_autologous_bone_feedback?id=' . $id);
        } else {
            $data['record'] = $this->audit_model->get_clinical_autologous_bone_feedback_byid($id);
            $this->load->view('audit/edit_clinical_autologous_bone_feedback', $data);
        }
    }

    public function edit_clinical_brain_tumour_feedback_byid($id)
    {
        if ($this->input->post()) {
            $existing = $this->audit_model->get_clinical_brain_tumour_feedback_byid($id);
            $dataset = json_decode($existing->dataset, true) ?: [];
            $existingFiles = $dataset['files_name'] ?? [];

            $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath))
                            @unlink($absolutePath);
                        unset($existingFiles[$index]);
                    }
                }
                $existingFiles = array_values($existingFiles);
            }

            if (!empty($_FILES['uploaded_files']['name'][0])) {
                $filesCount = count($_FILES['uploaded_files']['name']);
                $config = [
                    'upload_path' => './api/file_uploads/',
                    'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                    'max_size' => 50000,
                    'encrypt_name' => FALSE
                ];
                $this->load->library('upload');
                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file'] = [
                        'name' => $_FILES['uploaded_files']['name'][$i],
                        'type' => $_FILES['uploaded_files']['type'][$i],
                        'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                        'error' => $_FILES['uploaded_files']['error'][$i],
                        'size' => $_FILES['uploaded_files']['size'][$i]
                    ];
                    $this->upload->initialize($config);
                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();
                        $existingFiles[] = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];
                    }
                }
            }

            $dataset['files_name'] = array_values($existingFiles);

            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            $this->audit_model->update_clinical_brain_tumour_feedback($id, [
                'dataset' => json_encode($dataset),

            ]);

            redirect('audit/clinical_brain_tumour_feedback?id=' . $id);
        } else {
            $data['record'] = $this->audit_model->get_clinical_brain_tumour_feedback_byid($id);
            $this->load->view('audit/edit_clinical_brain_tumour_feedback', $data);
        }
    }

    public function edit_clinical_cabg_feedback_byid($id)
    {
        if ($this->input->post()) {
            $existing = $this->audit_model->get_clinical_cabg_feedback_byid($id);
            $dataset = json_decode($existing->dataset, true) ?: [];
            $existingFiles = $dataset['files_name'] ?? [];

            $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath))
                            @unlink($absolutePath);
                        unset($existingFiles[$index]);
                    }
                }
                $existingFiles = array_values($existingFiles);
            }

            if (!empty($_FILES['uploaded_files']['name'][0])) {
                $filesCount = count($_FILES['uploaded_files']['name']);
                $config = [
                    'upload_path' => './api/file_uploads/',
                    'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                    'max_size' => 50000,
                    'encrypt_name' => FALSE
                ];
                $this->load->library('upload');
                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file'] = [
                        'name' => $_FILES['uploaded_files']['name'][$i],
                        'type' => $_FILES['uploaded_files']['type'][$i],
                        'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                        'error' => $_FILES['uploaded_files']['error'][$i],
                        'size' => $_FILES['uploaded_files']['size'][$i]
                    ];
                    $this->upload->initialize($config);
                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();
                        $existingFiles[] = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];
                    }
                }
            }

            $dataset['files_name'] = array_values($existingFiles);

            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            $this->audit_model->update_clinical_cabg_feedback($id, [
                'dataset' => json_encode($dataset),

            ]);

            redirect('audit/clinical_cabg_feedback?id=' . $id);
        } else {
            $data['record'] = $this->audit_model->get_clinical_cabg_feedback_byid($id);
            $this->load->view('audit/edit_clinical_cabg_feedback', $data);
        }
    }

    public function edit_clinical_carotid_stenting_feedback_byid($id)
    {
        if ($this->input->post()) {
            $existing = $this->audit_model->get_clinical_carotid_stenting_feedback_byid($id);
            $dataset = json_decode($existing->dataset, true) ?: [];
            $existingFiles = $dataset['files_name'] ?? [];

            $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath))
                            @unlink($absolutePath);
                        unset($existingFiles[$index]);
                    }
                }
                $existingFiles = array_values($existingFiles);
            }

            if (!empty($_FILES['uploaded_files']['name'][0])) {
                $filesCount = count($_FILES['uploaded_files']['name']);
                $config = [
                    'upload_path' => './api/file_uploads/',
                    'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                    'max_size' => 50000,
                    'encrypt_name' => FALSE
                ];
                $this->load->library('upload');
                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file'] = [
                        'name' => $_FILES['uploaded_files']['name'][$i],
                        'type' => $_FILES['uploaded_files']['type'][$i],
                        'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                        'error' => $_FILES['uploaded_files']['error'][$i],
                        'size' => $_FILES['uploaded_files']['size'][$i]
                    ];
                    $this->upload->initialize($config);
                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();
                        $existingFiles[] = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];
                    }
                }
            }

            $dataset['files_name'] = array_values($existingFiles);

            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            $this->audit_model->update_clinical_carotid_stenting_feedback($id, [
                'dataset' => json_encode($dataset),

            ]);

            redirect('audit/clinical_carotid_stenting_feedback?id=' . $id);
        } else {
            $data['record'] = $this->audit_model->get_clinical_carotid_stenting_feedback_byid($id);
            $this->load->view('audit/edit_clinical_carotid_stenting_feedback', $data);
        }
    }

    public function edit_clinical_chemotherapy_feedback_byid($id)
    {
        if ($this->input->post()) {
            $existing = $this->audit_model->get_clinical_chemotherapy_feedback_byid($id);
            $dataset = json_decode($existing->dataset, true) ?: [];
            $existingFiles = $dataset['files_name'] ?? [];

            $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath))
                            @unlink($absolutePath);
                        unset($existingFiles[$index]);
                    }
                }
                $existingFiles = array_values($existingFiles);
            }

            if (!empty($_FILES['uploaded_files']['name'][0])) {
                $filesCount = count($_FILES['uploaded_files']['name']);
                $config = [
                    'upload_path' => './api/file_uploads/',
                    'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                    'max_size' => 50000,
                    'encrypt_name' => FALSE
                ];
                $this->load->library('upload');
                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file'] = [
                        'name' => $_FILES['uploaded_files']['name'][$i],
                        'type' => $_FILES['uploaded_files']['type'][$i],
                        'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                        'error' => $_FILES['uploaded_files']['error'][$i],
                        'size' => $_FILES['uploaded_files']['size'][$i]
                    ];
                    $this->upload->initialize($config);
                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();
                        $existingFiles[] = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];
                    }
                }
            }

            $dataset['files_name'] = array_values($existingFiles);

            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            $this->audit_model->update_clinical_chemotherapy_feedback($id, [
                'dataset' => json_encode($dataset),

            ]);

            redirect('audit/clinical_chemotherapy_feedback?id=' . $id);
        } else {
            $data['record'] = $this->audit_model->get_clinical_chemotherapy_feedback_byid($id);
            $this->load->view('audit/edit_clinical_chemotherapy_feedback', $data);
        }
    }

    public function edit_clinical_colo_rectal_feedback_byid($id)
    {
        if ($this->input->post()) {
            $existing = $this->audit_model->get_clinical_colo_rectal_feedback_byid($id);
            $dataset = json_decode($existing->dataset, true) ?: [];
            $existingFiles = $dataset['files_name'] ?? [];

            $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath))
                            @unlink($absolutePath);
                        unset($existingFiles[$index]);
                    }
                }
                $existingFiles = array_values($existingFiles);
            }

            if (!empty($_FILES['uploaded_files']['name'][0])) {
                $filesCount = count($_FILES['uploaded_files']['name']);
                $config = [
                    'upload_path' => './api/file_uploads/',
                    'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                    'max_size' => 50000,
                    'encrypt_name' => FALSE
                ];
                $this->load->library('upload');
                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file'] = [
                        'name' => $_FILES['uploaded_files']['name'][$i],
                        'type' => $_FILES['uploaded_files']['type'][$i],
                        'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                        'error' => $_FILES['uploaded_files']['error'][$i],
                        'size' => $_FILES['uploaded_files']['size'][$i]
                    ];
                    $this->upload->initialize($config);
                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();
                        $existingFiles[] = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];
                    }
                }
            }

            $dataset['files_name'] = array_values($existingFiles);

            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            $this->audit_model->update_clinical_colo_rectal_feedback($id, [
                'dataset' => json_encode($dataset),

            ]);

            redirect('audit/clinical_colo_rectal_feedback?id=' . $id);
        } else {
            $data['record'] = $this->audit_model->get_clinical_colo_rectal_feedback_byid($id);
            $this->load->view('audit/edit_clinical_colo_rectal_feedback', $data);
        }
    }

    public function edit_clinical_endoscopy_feedback_byid($id)
    {
        if ($this->input->post()) {
            $existing = $this->audit_model->get_clinical_endoscopy_feedback_byid($id);
            $dataset = json_decode($existing->dataset, true) ?: [];
            $existingFiles = $dataset['files_name'] ?? [];

            $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath))
                            @unlink($absolutePath);
                        unset($existingFiles[$index]);
                    }
                }
                $existingFiles = array_values($existingFiles);
            }

            if (!empty($_FILES['uploaded_files']['name'][0])) {
                $filesCount = count($_FILES['uploaded_files']['name']);
                $config = [
                    'upload_path' => './api/file_uploads/',
                    'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                    'max_size' => 50000,
                    'encrypt_name' => FALSE
                ];
                $this->load->library('upload');
                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file'] = [
                        'name' => $_FILES['uploaded_files']['name'][$i],
                        'type' => $_FILES['uploaded_files']['type'][$i],
                        'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                        'error' => $_FILES['uploaded_files']['error'][$i],
                        'size' => $_FILES['uploaded_files']['size'][$i]
                    ];
                    $this->upload->initialize($config);
                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();
                        $existingFiles[] = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];
                    }
                }
            }

            $dataset['files_name'] = array_values($existingFiles);

            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            $this->audit_model->update_clinical_endoscopy_feedback($id, [
                'dataset' => json_encode($dataset),

            ]);

            redirect('audit/clinical_endoscopy_feedback?id=' . $id);
        } else {
            $data['record'] = $this->audit_model->get_clinical_endoscopy_feedback_byid($id);
            $this->load->view('audit/edit_clinical_endoscopy_feedback', $data);
        }
    }

    public function edit_clinical_epilepsy_feedback_byid($id)
    {
        if ($this->input->post()) {
            $existing = $this->audit_model->get_clinical_epilepsy_feedback_byid($id);
            $dataset = json_decode($existing->dataset, true) ?: [];
            $existingFiles = $dataset['files_name'] ?? [];

            $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath))
                            @unlink($absolutePath);
                        unset($existingFiles[$index]);
                    }
                }
                $existingFiles = array_values($existingFiles);
            }

            if (!empty($_FILES['uploaded_files']['name'][0])) {
                $filesCount = count($_FILES['uploaded_files']['name']);
                $config = [
                    'upload_path' => './api/file_uploads/',
                    'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                    'max_size' => 50000,
                    'encrypt_name' => FALSE
                ];
                $this->load->library('upload');
                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file'] = [
                        'name' => $_FILES['uploaded_files']['name'][$i],
                        'type' => $_FILES['uploaded_files']['type'][$i],
                        'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                        'error' => $_FILES['uploaded_files']['error'][$i],
                        'size' => $_FILES['uploaded_files']['size'][$i]
                    ];
                    $this->upload->initialize($config);
                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();
                        $existingFiles[] = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];
                    }
                }
            }

            $dataset['files_name'] = array_values($existingFiles);

            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            $this->audit_model->update_clinical_epilepsy_feedback($id, [
                'dataset' => json_encode($dataset),

            ]);

            redirect('audit/clinical_epilepsy_feedback?id=' . $id);
        } else {
            $data['record'] = $this->audit_model->get_clinical_epilepsy_feedback_byid($id);
            $this->load->view('audit/edit_clinical_epilepsy_feedback', $data);
        }
    }

    public function edit_clinical_herniorrhaphy_feedback_byid($id)
    {
        if ($this->input->post()) {
            $existing = $this->audit_model->get_clinical_herniorrhaphy_feedback_byid($id);
            $dataset = json_decode($existing->dataset, true) ?: [];
            $existingFiles = $dataset['files_name'] ?? [];

            $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath))
                            @unlink($absolutePath);
                        unset($existingFiles[$index]);
                    }
                }
                $existingFiles = array_values($existingFiles);
            }

            if (!empty($_FILES['uploaded_files']['name'][0])) {
                $filesCount = count($_FILES['uploaded_files']['name']);
                $config = [
                    'upload_path' => './api/file_uploads/',
                    'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                    'max_size' => 50000,
                    'encrypt_name' => FALSE
                ];
                $this->load->library('upload');
                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file'] = [
                        'name' => $_FILES['uploaded_files']['name'][$i],
                        'type' => $_FILES['uploaded_files']['type'][$i],
                        'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                        'error' => $_FILES['uploaded_files']['error'][$i],
                        'size' => $_FILES['uploaded_files']['size'][$i]
                    ];
                    $this->upload->initialize($config);
                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();
                        $existingFiles[] = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];
                    }
                }
            }

            $dataset['files_name'] = array_values($existingFiles);

            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            $this->audit_model->update_clinical_herniorrhaphy_feedback($id, [
                'dataset' => json_encode($dataset),

            ]);

            redirect('audit/clinical_herniorrhaphy_feedback?id=' . $id);
        } else {
            $data['record'] = $this->audit_model->get_clinical_herniorrhaphy_feedback_byid($id);
            $this->load->view('audit/edit_clinical_herniorrhaphy_feedback', $data);
        }
    }

    public function edit_clinical_holep_feedback_byid($id)
    {
        if ($this->input->post()) {
            $existing = $this->audit_model->get_clinical_holep_feedback_byid($id);
            $dataset = json_decode($existing->dataset, true) ?: [];
            $existingFiles = $dataset['files_name'] ?? [];

            $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath))
                            @unlink($absolutePath);
                        unset($existingFiles[$index]);
                    }
                }
                $existingFiles = array_values($existingFiles);
            }

            if (!empty($_FILES['uploaded_files']['name'][0])) {
                $filesCount = count($_FILES['uploaded_files']['name']);
                $config = [
                    'upload_path' => './api/file_uploads/',
                    'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                    'max_size' => 50000,
                    'encrypt_name' => FALSE
                ];
                $this->load->library('upload');
                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file'] = [
                        'name' => $_FILES['uploaded_files']['name'][$i],
                        'type' => $_FILES['uploaded_files']['type'][$i],
                        'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                        'error' => $_FILES['uploaded_files']['error'][$i],
                        'size' => $_FILES['uploaded_files']['size'][$i]
                    ];
                    $this->upload->initialize($config);
                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();
                        $existingFiles[] = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];
                    }
                }
            }

            $dataset['files_name'] = array_values($existingFiles);

            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            $this->audit_model->update_clinical_holep_feedback($id, [
                'dataset' => json_encode($dataset),

            ]);

            redirect('audit/clinical_holep_feedback?id=' . $id);
        } else {
            $data['record'] = $this->audit_model->get_clinical_holep_feedback_byid($id);
            $this->load->view('audit/edit_clinical_holep_feedback', $data);
        }
    }

    public function edit_clinical_laparoscopic_feedback_byid($id)
    {
        if ($this->input->post()) {
            $existing = $this->audit_model->get_clinical_laparoscopic_feedback_byid($id);
            $dataset = json_decode($existing->dataset, true) ?: [];
            $existingFiles = $dataset['files_name'] ?? [];

            $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath))
                            @unlink($absolutePath);
                        unset($existingFiles[$index]);
                    }
                }
                $existingFiles = array_values($existingFiles);
            }

            if (!empty($_FILES['uploaded_files']['name'][0])) {
                $filesCount = count($_FILES['uploaded_files']['name']);
                $config = [
                    'upload_path' => './api/file_uploads/',
                    'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                    'max_size' => 50000,
                    'encrypt_name' => FALSE
                ];
                $this->load->library('upload');
                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file'] = [
                        'name' => $_FILES['uploaded_files']['name'][$i],
                        'type' => $_FILES['uploaded_files']['type'][$i],
                        'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                        'error' => $_FILES['uploaded_files']['error'][$i],
                        'size' => $_FILES['uploaded_files']['size'][$i]
                    ];
                    $this->upload->initialize($config);
                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();
                        $existingFiles[] = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];
                    }
                }
            }

            $dataset['files_name'] = array_values($existingFiles);

            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            $this->audit_model->update_clinical_laparoscopic_feedback($id, [
                'dataset' => json_encode($dataset),

            ]);

            redirect('audit/clinical_laparoscopic_feedback?id=' . $id);
        } else {
            $data['record'] = $this->audit_model->get_clinical_laparoscopic_feedback_byid($id);
            $this->load->view('audit/edit_clinical_laparoscopic_feedback', $data);
        }
    }

    public function edit_clinical_mechanical_thrombectomy_feedback_byid($id)
    {
        if ($this->input->post()) {
            $existing = $this->audit_model->get_clinical_mechanical_thrombectomy_feedback_byid($id);
            $dataset = json_decode($existing->dataset, true) ?: [];
            $existingFiles = $dataset['files_name'] ?? [];

            $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath))
                            @unlink($absolutePath);
                        unset($existingFiles[$index]);
                    }
                }
                $existingFiles = array_values($existingFiles);
            }

            if (!empty($_FILES['uploaded_files']['name'][0])) {
                $filesCount = count($_FILES['uploaded_files']['name']);
                $config = [
                    'upload_path' => './api/file_uploads/',
                    'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                    'max_size' => 50000,
                    'encrypt_name' => FALSE
                ];
                $this->load->library('upload');
                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file'] = [
                        'name' => $_FILES['uploaded_files']['name'][$i],
                        'type' => $_FILES['uploaded_files']['type'][$i],
                        'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                        'error' => $_FILES['uploaded_files']['error'][$i],
                        'size' => $_FILES['uploaded_files']['size'][$i]
                    ];
                    $this->upload->initialize($config);
                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();
                        $existingFiles[] = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];
                    }
                }
            }

            $dataset['files_name'] = array_values($existingFiles);

            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            $this->audit_model->update_clinical_mechanical_thrombectomy_feedback($id, [
                'dataset' => json_encode($dataset),

            ]);

            redirect('audit/clinical_mechanical_thrombectomy_feedback?id=' . $id);
        } else {
            $data['record'] = $this->audit_model->get_clinical_mechanical_thrombectomy_feedback_byid($id);
            $this->load->view('audit/edit_clinical_mechanical_thrombectomy_feedback', $data);
        }
    }

    public function edit_clinical_mvr_feedback_byid($id)
    {
        if ($this->input->post()) {
            $existing = $this->audit_model->get_clinical_mvr_feedback_byid($id);
            $dataset = json_decode($existing->dataset, true) ?: [];
            $existingFiles = $dataset['files_name'] ?? [];

            // Remove files if requested
            $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath))
                            @unlink($absolutePath);
                        unset($existingFiles[$index]);
                    }
                }
                $existingFiles = array_values($existingFiles);
            }

            // Upload new files
            if (!empty($_FILES['uploaded_files']['name'][0])) {
                $filesCount = count($_FILES['uploaded_files']['name']);
                $config = [
                    'upload_path' => './api/file_uploads/',
                    'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                    'max_size' => 50000,
                    'encrypt_name' => FALSE
                ];
                $this->load->library('upload');
                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file'] = [
                        'name' => $_FILES['uploaded_files']['name'][$i],
                        'type' => $_FILES['uploaded_files']['type'][$i],
                        'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                        'error' => $_FILES['uploaded_files']['error'][$i],
                        'size' => $_FILES['uploaded_files']['size'][$i]
                    ];
                    $this->upload->initialize($config);
                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();
                        $existingFiles[] = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];
                    }
                }
            }

            // Merge POST data into dataset
            $dataset['files_name'] = array_values($existingFiles);
            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            // Update database
            $this->audit_model->update_clinical_mvr_feedback($id, [
                'dataset' => json_encode($dataset),

            ]);

            // Redirect back
            redirect('audit/clinical_mvr_feedback?id=' . $id);
        } else {
            $data['record'] = $this->audit_model->get_clinical_mvr_feedback_byid($id);
            $this->load->view('audit/edit_clinical_mvr_feedback', $data);
        }
    }



    public function edit_clinical_ptca_feedback_byid($id)
    {
        if ($this->input->post()) {
            $existing = $this->audit_model->get_clinical_ptca_feedback_byid($id);
            $dataset = json_decode($existing->dataset, true) ?: [];
            $existingFiles = $dataset['files_name'] ?? [];

            $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath))
                            @unlink($absolutePath);
                        unset($existingFiles[$index]);
                    }
                }
                $existingFiles = array_values($existingFiles);
            }

            if (!empty($_FILES['uploaded_files']['name'][0])) {
                $filesCount = count($_FILES['uploaded_files']['name']);
                $config = [
                    'upload_path' => './api/file_uploads/',
                    'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                    'max_size' => 50000,
                    'encrypt_name' => FALSE
                ];
                $this->load->library('upload');
                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file'] = [
                        'name' => $_FILES['uploaded_files']['name'][$i],
                        'type' => $_FILES['uploaded_files']['type'][$i],
                        'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                        'error' => $_FILES['uploaded_files']['error'][$i],
                        'size' => $_FILES['uploaded_files']['size'][$i]
                    ];
                    $this->upload->initialize($config);
                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();
                        $existingFiles[] = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];
                    }
                }
            }

            $dataset['files_name'] = array_values($existingFiles);
            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            $this->audit_model->update_clinical_ptca_feedback($id, [
                'dataset' => json_encode($dataset),

            ]);

            redirect('audit/clinical_ptca_feedback?id=' . $id);
        } else {
            $data['record'] = $this->audit_model->get_clinical_ptca_feedback_byid($id);
            $this->load->view('audit/edit_clinical_ptca_feedback', $data);
        }
    }

    public function edit_clinical_renal_transplantation_feedback_byid($id)
    {
        if ($this->input->post()) {
            $existing = $this->audit_model->get_clinical_renal_transplantation_feedback_byid($id);
            $dataset = json_decode($existing->dataset, true) ?: [];
            $existingFiles = $dataset['files_name'] ?? [];

            $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath))
                            @unlink($absolutePath);
                        unset($existingFiles[$index]);
                    }
                }
                $existingFiles = array_values($existingFiles);
            }

            if (!empty($_FILES['uploaded_files']['name'][0])) {
                $filesCount = count($_FILES['uploaded_files']['name']);
                $config = [
                    'upload_path' => './api/file_uploads/',
                    'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                    'max_size' => 50000,
                    'encrypt_name' => FALSE
                ];
                $this->load->library('upload');
                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file'] = [
                        'name' => $_FILES['uploaded_files']['name'][$i],
                        'type' => $_FILES['uploaded_files']['type'][$i],
                        'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                        'error' => $_FILES['uploaded_files']['error'][$i],
                        'size' => $_FILES['uploaded_files']['size'][$i]
                    ];
                    $this->upload->initialize($config);
                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();
                        $existingFiles[] = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];
                    }
                }
            }

            $dataset['files_name'] = array_values($existingFiles);
            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            $this->audit_model->update_clinical_renal_transplantation_feedback($id, [
                'dataset' => json_encode($dataset),

            ]);

            redirect('audit/clinical_renal_transplantation_feedback?id=' . $id);
        } else {
            $data['record'] = $this->audit_model->get_clinical_renal_transplantation_feedback_byid($id);
            $this->load->view('audit/edit_clinical_renal_transplantation_feedback', $data);
        }
    }

    public function edit_clinical_scoliosis_correction_feedback_byid($id)
    {
        if ($this->input->post()) {
            $existing = $this->audit_model->get_clinical_scoliosis_correction_feedback_byid($id);
            $dataset = json_decode($existing->dataset, true) ?: [];
            $existingFiles = $dataset['files_name'] ?? [];

            $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath))
                            @unlink($absolutePath);
                        unset($existingFiles[$index]);
                    }
                }
                $existingFiles = array_values($existingFiles);
            }

            if (!empty($_FILES['uploaded_files']['name'][0])) {
                $filesCount = count($_FILES['uploaded_files']['name']);
                $config = [
                    'upload_path' => './api/file_uploads/',
                    'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                    'max_size' => 50000,
                    'encrypt_name' => FALSE
                ];
                $this->load->library('upload');
                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file'] = [
                        'name' => $_FILES['uploaded_files']['name'][$i],
                        'type' => $_FILES['uploaded_files']['type'][$i],
                        'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                        'error' => $_FILES['uploaded_files']['error'][$i],
                        'size' => $_FILES['uploaded_files']['size'][$i]
                    ];
                    $this->upload->initialize($config);
                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();
                        $existingFiles[] = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];
                    }
                }
            }

            $dataset['files_name'] = array_values($existingFiles);
            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            $this->audit_model->update_clinical_scoliosis_correction_feedback($id, [
                'dataset' => json_encode($dataset),

            ]);

            redirect('audit/clinical_scoliosis_correction_feedback?id=' . $id);
        } else {
            $data['record'] = $this->audit_model->get_clinical_scoliosis_correction_feedback_byid($id);
            $this->load->view('audit/edit_clinical_scoliosis_correction_feedback', $data);
        }
    }

    public function edit_clinical_spinal_dysraphism_feedback_byid($id)
    {
        if ($this->input->post()) {
            $existing = $this->audit_model->get_clinical_spinal_dysraphism_feedback_byid($id);
            $dataset = json_decode($existing->dataset, true) ?: [];
            $existingFiles = $dataset['files_name'] ?? [];

            $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath))
                            @unlink($absolutePath);
                        unset($existingFiles[$index]);
                    }
                }
                $existingFiles = array_values($existingFiles);
            }

            if (!empty($_FILES['uploaded_files']['name'][0])) {
                $filesCount = count($_FILES['uploaded_files']['name']);
                $config = [
                    'upload_path' => './api/file_uploads/',
                    'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                    'max_size' => 50000,
                    'encrypt_name' => FALSE
                ];
                $this->load->library('upload');
                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file'] = [
                        'name' => $_FILES['uploaded_files']['name'][$i],
                        'type' => $_FILES['uploaded_files']['type'][$i],
                        'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                        'error' => $_FILES['uploaded_files']['error'][$i],
                        'size' => $_FILES['uploaded_files']['size'][$i]
                    ];
                    $this->upload->initialize($config);
                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();
                        $existingFiles[] = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];
                    }
                }
            }

            $dataset['files_name'] = array_values($existingFiles);
            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            $this->audit_model->update_clinical_spinal_dysraphism_feedback($id, [
                'dataset' => json_encode($dataset),

            ]);

            redirect('audit/clinical_spinal_dysraphism_feedback?id=' . $id);
        } else {
            $data['record'] = $this->audit_model->get_clinical_spinal_dysraphism_feedback_byid($id);
            $this->load->view('audit/edit_clinical_spinal_dysraphism_feedback', $data);
        }
    }

    public function edit_clinical_spine_disc_surgery_feedback_byid($id)
    {
        if ($this->input->post()) {
            $existing = $this->audit_model->get_clinical_spine_disc_surgery_feedback_byid($id);
            $dataset = json_decode($existing->dataset, true) ?: [];
            $existingFiles = $dataset['files_name'] ?? [];

            $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath))
                            @unlink($absolutePath);
                        unset($existingFiles[$index]);
                    }
                }
                $existingFiles = array_values($existingFiles);
            }

            if (!empty($_FILES['uploaded_files']['name'][0])) {
                $filesCount = count($_FILES['uploaded_files']['name']);
                $config = [
                    'upload_path' => './api/file_uploads/',
                    'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                    'max_size' => 50000,
                    'encrypt_name' => FALSE
                ];
                $this->load->library('upload');
                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file'] = [
                        'name' => $_FILES['uploaded_files']['name'][$i],
                        'type' => $_FILES['uploaded_files']['type'][$i],
                        'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                        'error' => $_FILES['uploaded_files']['error'][$i],
                        'size' => $_FILES['uploaded_files']['size'][$i]
                    ];
                    $this->upload->initialize($config);
                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();
                        $existingFiles[] = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];
                    }
                }
            }

            $dataset['files_name'] = array_values($existingFiles);
            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            $this->audit_model->update_clinical_spine_disc_surgery_feedback($id, [
                'dataset' => json_encode($dataset),

            ]);

            redirect('audit/clinical_spine_disc_surgery_feedback?id=' . $id);
        } else {
            $data['record'] = $this->audit_model->get_clinical_spine_disc_surgery_feedback_byid($id);
            $this->load->view('audit/edit_clinical_spine_disc_surgery_feedback', $data);
        }
    }

    public function edit_clinical_thoracotomy_feedback_byid($id)
    {
        if ($this->input->post()) {
            $existing = $this->audit_model->get_clinical_thoracotomy_feedback_byid($id);
            $dataset = json_decode($existing->dataset, true) ?: [];
            $existingFiles = $dataset['files_name'] ?? [];

            $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath))
                            @unlink($absolutePath);
                        unset($existingFiles[$index]);
                    }
                }
                $existingFiles = array_values($existingFiles);
            }

            if (!empty($_FILES['uploaded_files']['name'][0])) {
                $filesCount = count($_FILES['uploaded_files']['name']);
                $config = [
                    'upload_path' => './api/file_uploads/',
                    'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                    'max_size' => 50000,
                    'encrypt_name' => FALSE
                ];
                $this->load->library('upload');
                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file'] = [
                        'name' => $_FILES['uploaded_files']['name'][$i],
                        'type' => $_FILES['uploaded_files']['type'][$i],
                        'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                        'error' => $_FILES['uploaded_files']['error'][$i],
                        'size' => $_FILES['uploaded_files']['size'][$i]
                    ];
                    $this->upload->initialize($config);
                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();
                        $existingFiles[] = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];
                    }
                }
            }

            $dataset['files_name'] = array_values($existingFiles);
            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            $this->audit_model->update_clinical_thoracotomy_feedback($id, [
                'dataset' => json_encode($dataset),

            ]);

            redirect('audit/clinical_thoracotomy_feedback?id=' . $id);
        } else {
            $data['record'] = $this->audit_model->get_clinical_thoracotomy_feedback_byid($id);
            $this->load->view('audit/edit_clinical_thoracotomy_feedback', $data);
        }
    }

    public function edit_clinical_tkr_feedback_byid($id)
    {
        if ($this->input->post()) {
            $existing = $this->audit_model->get_clinical_tkr_feedback_byid($id);
            $dataset = json_decode($existing->dataset, true) ?: [];
            $existingFiles = $dataset['files_name'] ?? [];

            $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath))
                            @unlink($absolutePath);
                        unset($existingFiles[$index]);
                    }
                }
                $existingFiles = array_values($existingFiles);
            }

            if (!empty($_FILES['uploaded_files']['name'][0])) {
                $filesCount = count($_FILES['uploaded_files']['name']);
                $config = [
                    'upload_path' => './api/file_uploads/',
                    'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                    'max_size' => 50000,
                    'encrypt_name' => FALSE
                ];
                $this->load->library('upload');
                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file'] = [
                        'name' => $_FILES['uploaded_files']['name'][$i],
                        'type' => $_FILES['uploaded_files']['type'][$i],
                        'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                        'error' => $_FILES['uploaded_files']['error'][$i],
                        'size' => $_FILES['uploaded_files']['size'][$i]
                    ];
                    $this->upload->initialize($config);
                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();
                        $existingFiles[] = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];
                    }
                }
            }

            $dataset['files_name'] = array_values($existingFiles);
            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            $this->audit_model->update_clinical_tkr_feedback($id, [
                'dataset' => json_encode($dataset),

            ]);

            redirect('audit/clinical_tkr_feedback?id=' . $id);
        } else {
            $data['record'] = $this->audit_model->get_clinical_tkr_feedback_byid($id);
            $this->load->view('audit/edit_clinical_tkr_feedback', $data);
        }
    }

    public function edit_clinical_uro_oncology_feedback_byid($id)
    {
        if ($this->input->post()) {
            $existing = $this->audit_model->get_clinical_uro_oncology_feedback_byid($id);
            $dataset = json_decode($existing->dataset, true) ?: [];
            $existingFiles = $dataset['files_name'] ?? [];

            $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath))
                            @unlink($absolutePath);
                        unset($existingFiles[$index]);
                    }
                }
                $existingFiles = array_values($existingFiles);
            }

            if (!empty($_FILES['uploaded_files']['name'][0])) {
                $filesCount = count($_FILES['uploaded_files']['name']);
                $config = [
                    'upload_path' => './api/file_uploads/',
                    'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                    'max_size' => 50000,
                    'encrypt_name' => FALSE
                ];
                $this->load->library('upload');
                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file'] = [
                        'name' => $_FILES['uploaded_files']['name'][$i],
                        'type' => $_FILES['uploaded_files']['type'][$i],
                        'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                        'error' => $_FILES['uploaded_files']['error'][$i],
                        'size' => $_FILES['uploaded_files']['size'][$i]
                    ];
                    $this->upload->initialize($config);
                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();
                        $existingFiles[] = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];
                    }
                }
            }

            $dataset['files_name'] = array_values($existingFiles);
            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            $this->audit_model->update_clinical_uro_oncology_feedback($id, [
                'dataset' => json_encode($dataset),

            ]);

            redirect('audit/clinical_uro_oncology_feedback?id=' . $id);
        } else {
            $data['record'] = $this->audit_model->get_clinical_uro_oncology_feedback_byid($id);
            $this->load->view('audit/edit_clinical_uro_oncology_feedback', $data);
        }
    }

    public function edit_clinical_whipples_surgery_feedback_byid($id)
    {
        if ($this->input->post()) {
            $existing = $this->audit_model->get_clinical_whipples_surgery_feedback_byid($id);
            $dataset = json_decode($existing->dataset, true) ?: [];
            $existingFiles = $dataset['files_name'] ?? [];

            $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath))
                            @unlink($absolutePath);
                        unset($existingFiles[$index]);
                    }
                }
                $existingFiles = array_values($existingFiles);
            }

            if (!empty($_FILES['uploaded_files']['name'][0])) {
                $filesCount = count($_FILES['uploaded_files']['name']);
                $config = [
                    'upload_path' => './api/file_uploads/',
                    'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                    'max_size' => 50000,
                    'encrypt_name' => FALSE
                ];
                $this->load->library('upload');
                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file'] = [
                        'name' => $_FILES['uploaded_files']['name'][$i],
                        'type' => $_FILES['uploaded_files']['type'][$i],
                        'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                        'error' => $_FILES['uploaded_files']['error'][$i],
                        'size' => $_FILES['uploaded_files']['size'][$i]
                    ];
                    $this->upload->initialize($config);
                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();
                        $existingFiles[] = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];
                    }
                }
            }

            $dataset['files_name'] = array_values($existingFiles);
            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            $this->audit_model->update_clinical_whipples_surgery_feedback($id, [
                'dataset' => json_encode($dataset),

            ]);

            redirect('audit/clinical_whipples_surgery_feedback?id=' . $id);
        } else {
            $data['record'] = $this->audit_model->get_clinical_whipples_surgery_feedback_byid($id);
            $this->load->view('audit/edit_clinical_whipples_surgery_feedback', $data);
        }
    }

    public function edit_clinical_laparoscopic_cholecystectomy_feedback_byid($id)
    {
        if ($this->input->post()) {
            $existing = $this->audit_model->get_clinical_laparoscopic_cholecystectomy_feedback_byid($id);
            $dataset = json_decode($existing->dataset, true) ?: [];
            $existingFiles = $dataset['files_name'] ?? [];

            $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath))
                            @unlink($absolutePath);
                        unset($existingFiles[$index]);
                    }
                }
                $existingFiles = array_values($existingFiles);
            }

            if (!empty($_FILES['uploaded_files']['name'][0])) {
                $filesCount = count($_FILES['uploaded_files']['name']);
                $config = [
                    'upload_path' => './api/file_uploads/',
                    'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                    'max_size' => 50000,
                    'encrypt_name' => FALSE
                ];
                $this->load->library('upload');
                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file'] = [
                        'name' => $_FILES['uploaded_files']['name'][$i],
                        'type' => $_FILES['uploaded_files']['type'][$i],
                        'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                        'error' => $_FILES['uploaded_files']['error'][$i],
                        'size' => $_FILES['uploaded_files']['size'][$i]
                    ];
                    $this->upload->initialize($config);
                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();
                        $existingFiles[] = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];
                    }
                }
            }

            $dataset['files_name'] = array_values($existingFiles);
            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            $this->audit_model->update_clinical_laparoscopic_cholecystectomy_feedback($id, [
                'dataset' => json_encode($dataset),

            ]);

            redirect('audit/clinical_laparoscopic_cholecystectomy_feedback?id=' . $id);
        } else {
            $data['record'] = $this->audit_model->get_clinical_laparoscopic_cholecystectomy_feedback_byid($id);
            $this->load->view('audit/edit_clinical_laparoscopic_cholecystectomy_feedback', $data);
        }
    }

    //edit page and to edit for Clinical KPI

    public function edit_clinicalkpi_bronchodilators_feedback()
    {

        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }


        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_clinicalkpi_bronchodilators_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_clinicalkpi_bronchodilators_feedback', $data, true);
            }
            //    $data['content'] = $this->load->view('qualitymodules/ticket_track', $data, true);

            $this->load->view('layout/main_wrapper', $data);
        }
    }
    public function edit_clinicalkpi_copd_protocol_feedback()
    {

        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }


        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_clinicalkpi_copd_protocol_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_clinicalkpi_copd_protocol_feedback', $data, true);
            }
            //    $data['content'] = $this->load->view('qualitymodules/ticket_track', $data, true);

            $this->load->view('layout/main_wrapper', $data);
        }
    }

    // To Edit audit by id Clinical KPI

    public function edit_clinicalkpi_bronchodilators_feedback_byid($id)
    {
        if ($this->input->post()) {
            $existing = $this->audit_model->get_clinicalkpi_bronchodilators_feedback_byid($id);
            $dataset = json_decode($existing->dataset, true) ?: [];
            $existingFiles = $dataset['files_name'] ?? [];

            $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath))
                            @unlink($absolutePath);
                        unset($existingFiles[$index]);
                    }
                }
                $existingFiles = array_values($existingFiles);
            }

            if (!empty($_FILES['uploaded_files']['name'][0])) {
                $filesCount = count($_FILES['uploaded_files']['name']);
                $config = [
                    'upload_path' => './api/file_uploads/',
                    'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                    'max_size' => 50000,
                    'encrypt_name' => FALSE
                ];
                $this->load->library('upload');
                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file'] = [
                        'name' => $_FILES['uploaded_files']['name'][$i],
                        'type' => $_FILES['uploaded_files']['type'][$i],
                        'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                        'error' => $_FILES['uploaded_files']['error'][$i],
                        'size' => $_FILES['uploaded_files']['size'][$i]
                    ];
                    $this->upload->initialize($config);
                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();
                        $existingFiles[] = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];
                    }
                }
            }

            $dataset['files_name'] = array_values($existingFiles);
            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            $this->audit_model->update_clinicalkpi_bronchodilators_feedback($id, [
                'dataset' => json_encode($dataset),

            ]);

            redirect('audit/clinicalkpi_bronchodilators_feedback?id=' . $id);
        } else {
            $data['record'] = $this->audit_model->get_clinicalkpi_bronchodilators_feedback_byid($id);
            $this->load->view('audit/edit_clinicalkpi_bronchodilators_feedback', $data);
        }
    }

    public function edit_clinicalkpi_copd_protocol_feedback_byid($id)
    {
        if ($this->input->post()) {
            $existing = $this->audit_model->get_clinicalkpi_copd_protocol_feedback_byid($id);
            $dataset = json_decode($existing->dataset, true) ?: [];
            $existingFiles = $dataset['files_name'] ?? [];

            $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath))
                            @unlink($absolutePath);
                        unset($existingFiles[$index]);
                    }
                }
                $existingFiles = array_values($existingFiles);
            }

            if (!empty($_FILES['uploaded_files']['name'][0])) {
                $filesCount = count($_FILES['uploaded_files']['name']);
                $config = [
                    'upload_path' => './api/file_uploads/',
                    'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                    'max_size' => 50000,
                    'encrypt_name' => FALSE
                ];
                $this->load->library('upload');
                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file'] = [
                        'name' => $_FILES['uploaded_files']['name'][$i],
                        'type' => $_FILES['uploaded_files']['type'][$i],
                        'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                        'error' => $_FILES['uploaded_files']['error'][$i],
                        'size' => $_FILES['uploaded_files']['size'][$i]
                    ];
                    $this->upload->initialize($config);
                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();
                        $existingFiles[] = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];
                    }
                }
            }

            $dataset['files_name'] = array_values($existingFiles);
            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            $this->audit_model->update_clinicalkpi_copd_protocol_feedback($id, [
                'dataset' => json_encode($dataset),

            ]);

            redirect('audit/clinicalkpi_copd_protocol_feedback?id=' . $id);
        } else {
            $data['record'] = $this->audit_model->get_clinicalkpi_copd_protocol_feedback_byid($id);
            $this->load->view('audit/edit_clinicalkpi_copd_protocol_feedback', $data);
        }
    }


    //edit page and to edit for Infection Control

    public function edit_infection_control_biomedical_waste_feedback()
    {

        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }


        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_infection_control_biomedical_waste_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_infection_control_biomedical_waste_feedback', $data, true);
            }
            //    $data['content'] = $this->load->view('qualitymodules/ticket_track', $data, true);

            $this->load->view('layout/main_wrapper', $data);
        }
    }
    public function edit_infection_control_canteen_audit_feedback()
    {

        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }


        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_infection_control_canteen_audit_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_infection_control_canteen_audit_feedback', $data, true);
            }
            //    $data['content'] = $this->load->view('qualitymodules/ticket_track', $data, true);

            $this->load->view('layout/main_wrapper', $data);
        }
    }
    public function edit_infection_control_cssd_audit_feedback()
    {

        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }


        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_infection_control_cssd_audit_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_infection_control_cssd_audit_feedback', $data, true);
            }
            //    $data['content'] = $this->load->view('qualitymodules/ticket_track', $data, true);

            $this->load->view('layout/main_wrapper', $data);
        }
    }
    public function edit_infection_control_hand_hygiene_feedback()
    {

        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }


        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_infection_control_hand_hygiene_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_infection_control_hand_hygiene_feedback', $data, true);
            }
            //    $data['content'] = $this->load->view('qualitymodules/ticket_track', $data, true);

            $this->load->view('layout/main_wrapper', $data);
        }
    }
    public function edit_infection_control_bundle_audit_feedback()
    {

        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }


        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_infection_control_bundle_audit_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_infection_control_bundle_audit_feedback', $data, true);
            }
            //    $data['content'] = $this->load->view('qualitymodules/ticket_track', $data, true);

            $this->load->view('layout/main_wrapper', $data);
        }
    }
    public function edit_infection_control_ot_audit_feedback()
    {

        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }


        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_infection_control_ot_audit_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_infection_control_ot_audit_feedback', $data, true);
            }
            //    $data['content'] = $this->load->view('qualitymodules/ticket_track', $data, true);

            $this->load->view('layout/main_wrapper', $data);
        }
    }
    public function edit_infection_control_linen_audit_feedback()
    {

        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }


        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_infection_control_linen_audit_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_infection_control_linen_audit_feedback', $data, true);
            }
            //    $data['content'] = $this->load->view('qualitymodules/ticket_track', $data, true);

            $this->load->view('layout/main_wrapper', $data);
        }
    }
    public function edit_infection_control_ambulance_audit_feedback()
    {

        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }


        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_infection_control_ambulance_audit_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_infection_control_ambulance_audit_feedback', $data, true);
            }
            //    $data['content'] = $this->load->view('qualitymodules/ticket_track', $data, true);

            $this->load->view('layout/main_wrapper', $data);
        }
    }
    public function edit_infection_control_coffee_audit_feedback()
    {

        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }


        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_infection_control_coffee_audit_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_infection_control_coffee_audit_feedback', $data, true);
            }
            //    $data['content'] = $this->load->view('qualitymodules/ticket_track', $data, true);

            $this->load->view('layout/main_wrapper', $data);
        }
    }
    public function edit_infection_control_laboratory_audit_feedback()
    {

        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }


        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_infection_control_laboratory_audit_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_infection_control_laboratory_audit_feedback', $data, true);
            }
            //    $data['content'] = $this->load->view('qualitymodules/ticket_track', $data, true);

            $this->load->view('layout/main_wrapper', $data);
        }
    }
    public function edit_infection_control_mortuary_audit_feedback()
    {

        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }


        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_infection_control_mortuary_audit_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_infection_control_mortuary_audit_feedback', $data, true);
            }
            //    $data['content'] = $this->load->view('qualitymodules/ticket_track', $data, true);

            $this->load->view('layout/main_wrapper', $data);
        }
    }
    public function edit_infection_control_radiology_audit_feedback()
    {

        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }


        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_infection_control_radiology_audit_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_infection_control_radiology_audit_feedback', $data, true);
            }
            //    $data['content'] = $this->load->view('qualitymodules/ticket_track', $data, true);

            $this->load->view('layout/main_wrapper', $data);
        }
    }
    public function edit_infection_control_ssi_survelliance_audit_feedback()
    {

        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }


        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_infection_control_ssi_survelliance_audit_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_infection_control_ssi_survelliance_audit_feedback', $data, true);
            }
            //    $data['content'] = $this->load->view('qualitymodules/ticket_track', $data, true);

            $this->load->view('layout/main_wrapper', $data);
        }
    }
    public function edit_infection_control_peripheralivline_audit_feedback()
    {

        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }


        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_infection_control_peripheralivline_audit_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_infection_control_peripheralivline_audit_feedback', $data, true);
            }
            //    $data['content'] = $this->load->view('qualitymodules/ticket_track', $data, true);

            $this->load->view('layout/main_wrapper', $data);
        }
    }
    public function edit_infection_control_personalprotective_audit_feedback()
    {

        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }


        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_infection_control_personalprotective_audit_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_infection_control_personalprotective_audit_feedback', $data, true);
            }
            //    $data['content'] = $this->load->view('qualitymodules/ticket_track', $data, true);

            $this->load->view('layout/main_wrapper', $data);
        }
    }
    public function edit_infection_control_safe_injection_audit_feedback()
    {

        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }


        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_infection_control_safe_injection_audit_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_infection_control_safe_injection_audit_feedback', $data, true);
            }
            //    $data['content'] = $this->load->view('qualitymodules/ticket_track', $data, true);

            $this->load->view('layout/main_wrapper', $data);
        }
    }
    public function edit_infection_control_surface_cleaning_audit_feedback()
    {

        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }


        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_infection_control_surface_cleaning_audit_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_infection_control_surface_cleaning_audit_feedback', $data, true);
            }
            //    $data['content'] = $this->load->view('qualitymodules/ticket_track', $data, true);

            $this->load->view('layout/main_wrapper', $data);
        }
    }

    // To Edit audit by id Infection Control

    public function edit_infection_control_biomedical_waste_feedback_byid($id)
    {
        if ($this->input->post()) {
            $existing = $this->audit_model->get_infection_control_biomedical_waste_feedback_byid($id);
            $dataset = json_decode($existing->dataset, true) ?: [];
            $existingFiles = $dataset['files_name'] ?? [];

            $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath))
                            @unlink($absolutePath);
                        unset($existingFiles[$index]);
                    }
                }
                $existingFiles = array_values($existingFiles);
            }

            if (!empty($_FILES['uploaded_files']['name'][0])) {
                $filesCount = count($_FILES['uploaded_files']['name']);
                $config = [
                    'upload_path' => './api/file_uploads/',
                    'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                    'max_size' => 50000,
                    'encrypt_name' => FALSE
                ];
                $this->load->library('upload');
                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file'] = [
                        'name' => $_FILES['uploaded_files']['name'][$i],
                        'type' => $_FILES['uploaded_files']['type'][$i],
                        'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                        'error' => $_FILES['uploaded_files']['error'][$i],
                        'size' => $_FILES['uploaded_files']['size'][$i]
                    ];
                    $this->upload->initialize($config);
                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();
                        $existingFiles[] = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];
                    }
                }
            }

            $dataset['files_name'] = array_values($existingFiles);
            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            $this->audit_model->update_infection_control_biomedical_waste_feedback($id, [
                'dataset' => json_encode($dataset),

            ]);

            redirect('audit/infection_control_biomedical_waste_feedback?id=' . $id);
        } else {
            $data['record'] = $this->audit_model->get_infection_control_biomedical_waste_feedback_byid($id);
            $this->load->view('audit/edit_infection_control_biomedical_waste_feedback', $data);
        }
    }

    public function edit_infection_control_canteen_audit_feedback_byid($id)
    {
        if ($this->input->post()) {
            $existing = $this->audit_model->get_infection_control_canteen_audit_feedback_byid($id);
            $dataset = json_decode($existing->dataset, true) ?: [];
            $existingFiles = $dataset['files_name'] ?? [];

            $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath))
                            @unlink($absolutePath);
                        unset($existingFiles[$index]);
                    }
                }
                $existingFiles = array_values($existingFiles);
            }

            if (!empty($_FILES['uploaded_files']['name'][0])) {
                $filesCount = count($_FILES['uploaded_files']['name']);
                $config = [
                    'upload_path' => './api/file_uploads/',
                    'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                    'max_size' => 50000,
                    'encrypt_name' => FALSE
                ];
                $this->load->library('upload');
                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file'] = [
                        'name' => $_FILES['uploaded_files']['name'][$i],
                        'type' => $_FILES['uploaded_files']['type'][$i],
                        'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                        'error' => $_FILES['uploaded_files']['error'][$i],
                        'size' => $_FILES['uploaded_files']['size'][$i]
                    ];
                    $this->upload->initialize($config);
                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();
                        $existingFiles[] = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];
                    }
                }
            }

            $dataset['files_name'] = array_values($existingFiles);
            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            $this->audit_model->update_infection_control_canteen_audit_feedback($id, [
                'dataset' => json_encode($dataset),

            ]);

            redirect('audit/infection_control_canteen_audit_feedback?id=' . $id);
        } else {
            $data['record'] = $this->audit_model->get_infection_control_canteen_audit_feedback_byid($id);
            $this->load->view('audit/edit_infection_control_canteen_audit_feedback', $data);
        }
    }

    public function edit_infection_control_cssd_audit_feedback_byid($id)
    {
        if ($this->input->post()) {
            $existing = $this->audit_model->get_infection_control_cssd_audit_feedback_byid($id);
            $dataset = json_decode($existing->dataset, true) ?: [];
            $existingFiles = $dataset['files_name'] ?? [];

            $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath))
                            @unlink($absolutePath);
                        unset($existingFiles[$index]);
                    }
                }
                $existingFiles = array_values($existingFiles);
            }

            if (!empty($_FILES['uploaded_files']['name'][0])) {
                $filesCount = count($_FILES['uploaded_files']['name']);
                $config = [
                    'upload_path' => './api/file_uploads/',
                    'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                    'max_size' => 50000,
                    'encrypt_name' => FALSE
                ];
                $this->load->library('upload');
                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file'] = [
                        'name' => $_FILES['uploaded_files']['name'][$i],
                        'type' => $_FILES['uploaded_files']['type'][$i],
                        'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                        'error' => $_FILES['uploaded_files']['error'][$i],
                        'size' => $_FILES['uploaded_files']['size'][$i]
                    ];
                    $this->upload->initialize($config);
                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();
                        $existingFiles[] = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];
                    }
                }
            }

            $dataset['files_name'] = array_values($existingFiles);
            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            $this->audit_model->update_infection_control_cssd_audit_feedback($id, [
                'dataset' => json_encode($dataset),

            ]);

            redirect('audit/infection_control_cssd_audit_feedback?id=' . $id);
        } else {
            $data['record'] = $this->audit_model->get_infection_control_cssd_audit_feedback_byid($id);
            $this->load->view('audit/edit_infection_control_cssd_audit_feedback', $data);
        }
    }

    public function edit_infection_control_hand_hygiene_feedback_byid($id)
    {
        if ($this->input->post()) {
            $existing = $this->audit_model->get_infection_control_hand_hygiene_feedback_byid($id);
            $dataset = json_decode($existing->dataset, true) ?: [];
            $existingFiles = $dataset['files_name'] ?? [];

            $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath))
                            @unlink($absolutePath);
                        unset($existingFiles[$index]);
                    }
                }
                $existingFiles = array_values($existingFiles);
            }

            if (!empty($_FILES['uploaded_files']['name'][0])) {
                $filesCount = count($_FILES['uploaded_files']['name']);
                $config = [
                    'upload_path' => './api/file_uploads/',
                    'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                    'max_size' => 50000,
                    'encrypt_name' => FALSE
                ];
                $this->load->library('upload');
                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file'] = [
                        'name' => $_FILES['uploaded_files']['name'][$i],
                        'type' => $_FILES['uploaded_files']['type'][$i],
                        'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                        'error' => $_FILES['uploaded_files']['error'][$i],
                        'size' => $_FILES['uploaded_files']['size'][$i]
                    ];
                    $this->upload->initialize($config);
                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();
                        $existingFiles[] = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];
                    }
                }
            }

            $dataset['files_name'] = array_values($existingFiles);
            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            $this->audit_model->update_infection_control_hand_hygiene_feedback($id, [
                'dataset' => json_encode($dataset),

            ]);

            redirect('audit/infection_control_hand_hygiene_feedback?id=' . $id);
        } else {
            $data['record'] = $this->audit_model->get_infection_control_hand_hygiene_feedback_byid($id);
            $this->load->view('audit/edit_infection_control_hand_hygiene_feedback', $data);
        }
    }

    public function edit_infection_control_bundle_audit_feedback_byid($id)
    {
        if ($this->input->post()) {
            $existing = $this->audit_model->get_infection_control_bundle_audit_feedback_byid($id);
            $dataset = json_decode($existing->dataset, true) ?: [];
            $existingFiles = $dataset['files_name'] ?? [];

            $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath))
                            @unlink($absolutePath);
                        unset($existingFiles[$index]);
                    }
                }
                $existingFiles = array_values($existingFiles);
            }

            if (!empty($_FILES['uploaded_files']['name'][0])) {
                $filesCount = count($_FILES['uploaded_files']['name']);
                $config = [
                    'upload_path' => './api/file_uploads/',
                    'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                    'max_size' => 50000,
                    'encrypt_name' => FALSE
                ];
                $this->load->library('upload');
                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file'] = [
                        'name' => $_FILES['uploaded_files']['name'][$i],
                        'type' => $_FILES['uploaded_files']['type'][$i],
                        'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                        'error' => $_FILES['uploaded_files']['error'][$i],
                        'size' => $_FILES['uploaded_files']['size'][$i]
                    ];
                    $this->upload->initialize($config);
                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();
                        $existingFiles[] = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];
                    }
                }
            }

            $dataset['files_name'] = array_values($existingFiles);
            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            $this->audit_model->update_infection_control_bundle_audit_feedback($id, [
                'dataset' => json_encode($dataset),

            ]);

            redirect('audit/infection_control_bundle_audit_feedback?id=' . $id);
        } else {
            $data['record'] = $this->audit_model->get_infection_control_bundle_audit_feedback_byid($id);
            $this->load->view('audit/edit_infection_control_bundle_audit_feedback', $data);
        }
    }

    public function edit_infection_control_ot_audit_feedback_byid($id)
    {
        if ($this->input->post()) {
            $existing = $this->audit_model->get_infection_control_ot_audit_feedback_byid($id);
            $dataset = json_decode($existing->dataset, true) ?: [];
            $existingFiles = $dataset['files_name'] ?? [];

            $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath))
                            @unlink($absolutePath);
                        unset($existingFiles[$index]);
                    }
                }
                $existingFiles = array_values($existingFiles);
            }

            if (!empty($_FILES['uploaded_files']['name'][0])) {
                $filesCount = count($_FILES['uploaded_files']['name']);
                $config = [
                    'upload_path' => './api/file_uploads/',
                    'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                    'max_size' => 50000,
                    'encrypt_name' => FALSE
                ];
                $this->load->library('upload');
                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file'] = [
                        'name' => $_FILES['uploaded_files']['name'][$i],
                        'type' => $_FILES['uploaded_files']['type'][$i],
                        'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                        'error' => $_FILES['uploaded_files']['error'][$i],
                        'size' => $_FILES['uploaded_files']['size'][$i]
                    ];
                    $this->upload->initialize($config);
                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();
                        $existingFiles[] = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];
                    }
                }
            }

            $dataset['files_name'] = array_values($existingFiles);
            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            $this->audit_model->update_infection_control_ot_audit_feedback($id, [
                'dataset' => json_encode($dataset),

            ]);

            redirect('audit/infection_control_ot_audit_feedback?id=' . $id);
        } else {
            $data['record'] = $this->audit_model->get_infection_control_ot_audit_feedback_byid($id);
            $this->load->view('audit/edit_infection_control_ot_audit_feedback', $data);
        }
    }

    public function edit_infection_control_linen_audit_feedback_byid($id)
    {
        if ($this->input->post()) {
            $existing = $this->audit_model->get_infection_control_linen_audit_feedback_byid($id);
            $dataset = json_decode($existing->dataset, true) ?: [];
            $existingFiles = $dataset['files_name'] ?? [];

            $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath))
                            @unlink($absolutePath);
                        unset($existingFiles[$index]);
                    }
                }
                $existingFiles = array_values($existingFiles);
            }

            if (!empty($_FILES['uploaded_files']['name'][0])) {
                $filesCount = count($_FILES['uploaded_files']['name']);
                $config = [
                    'upload_path' => './api/file_uploads/',
                    'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                    'max_size' => 50000,
                    'encrypt_name' => FALSE
                ];
                $this->load->library('upload');
                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file'] = [
                        'name' => $_FILES['uploaded_files']['name'][$i],
                        'type' => $_FILES['uploaded_files']['type'][$i],
                        'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                        'error' => $_FILES['uploaded_files']['error'][$i],
                        'size' => $_FILES['uploaded_files']['size'][$i]
                    ];
                    $this->upload->initialize($config);
                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();
                        $existingFiles[] = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];
                    }
                }
            }

            $dataset['files_name'] = array_values($existingFiles);
            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            $this->audit_model->update_infection_control_linen_audit_feedback($id, [
                'dataset' => json_encode($dataset),

            ]);

            redirect('audit/infection_control_linen_audit_feedback?id=' . $id);
        } else {
            $data['record'] = $this->audit_model->get_infection_control_linen_audit_feedback_byid($id);
            $this->load->view('audit/edit_infection_control_linen_audit_feedback', $data);
        }
    }

    public function edit_infection_control_ambulance_audit_feedback_byid($id)
    {
        if ($this->input->post()) {
            $existing = $this->audit_model->get_infection_control_ambulance_audit_feedback_byid($id);
            $dataset = json_decode($existing->dataset, true) ?: [];
            $existingFiles = $dataset['files_name'] ?? [];

            $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath))
                            @unlink($absolutePath);
                        unset($existingFiles[$index]);
                    }
                }
                $existingFiles = array_values($existingFiles);
            }

            if (!empty($_FILES['uploaded_files']['name'][0])) {
                $filesCount = count($_FILES['uploaded_files']['name']);
                $config = [
                    'upload_path' => './api/file_uploads/',
                    'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                    'max_size' => 50000,
                    'encrypt_name' => FALSE
                ];
                $this->load->library('upload');
                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file'] = [
                        'name' => $_FILES['uploaded_files']['name'][$i],
                        'type' => $_FILES['uploaded_files']['type'][$i],
                        'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                        'error' => $_FILES['uploaded_files']['error'][$i],
                        'size' => $_FILES['uploaded_files']['size'][$i]
                    ];
                    $this->upload->initialize($config);
                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();
                        $existingFiles[] = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];
                    }
                }
            }

            $dataset['files_name'] = array_values($existingFiles);
            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            $this->audit_model->update_infection_control_ambulance_audit_feedback($id, [
                'dataset' => json_encode($dataset),

            ]);

            redirect('audit/infection_control_ambulance_audit_feedback?id=' . $id);
        } else {
            $data['record'] = $this->audit_model->get_infection_control_ambulance_audit_feedback_byid($id);
            $this->load->view('audit/edit_infection_control_ambulance_audit_feedback', $data);
        }
    }

    public function edit_infection_control_coffee_audit_feedback_byid($id)
    {
        if ($this->input->post()) {
            $existing = $this->audit_model->get_infection_control_coffee_audit_feedback_byid($id);
            $dataset = json_decode($existing->dataset, true) ?: [];
            $existingFiles = $dataset['files_name'] ?? [];

            $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath))
                            @unlink($absolutePath);
                        unset($existingFiles[$index]);
                    }
                }
                $existingFiles = array_values($existingFiles);
            }

            if (!empty($_FILES['uploaded_files']['name'][0])) {
                $filesCount = count($_FILES['uploaded_files']['name']);
                $config = [
                    'upload_path' => './api/file_uploads/',
                    'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                    'max_size' => 50000,
                    'encrypt_name' => FALSE
                ];
                $this->load->library('upload');
                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file'] = [
                        'name' => $_FILES['uploaded_files']['name'][$i],
                        'type' => $_FILES['uploaded_files']['type'][$i],
                        'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                        'error' => $_FILES['uploaded_files']['error'][$i],
                        'size' => $_FILES['uploaded_files']['size'][$i]
                    ];
                    $this->upload->initialize($config);
                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();
                        $existingFiles[] = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];
                    }
                }
            }

            $dataset['files_name'] = array_values($existingFiles);
            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            $this->audit_model->update_infection_control_coffee_audit_feedback($id, [
                'dataset' => json_encode($dataset),

            ]);

            redirect('audit/infection_control_coffee_audit_feedback?id=' . $id);
        } else {
            $data['record'] = $this->audit_model->get_infection_control_coffee_audit_feedback_byid($id);
            $this->load->view('audit/edit_infection_control_coffee_audit_feedback', $data);
        }
    }

    public function edit_infection_control_laboratory_audit_feedback_byid($id)
    {
        if ($this->input->post()) {
            $existing = $this->audit_model->get_infection_control_laboratory_audit_feedback_byid($id);
            $dataset = json_decode($existing->dataset, true) ?: [];
            $existingFiles = $dataset['files_name'] ?? [];

            $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath))
                            @unlink($absolutePath);
                        unset($existingFiles[$index]);
                    }
                }
                $existingFiles = array_values($existingFiles);
            }

            if (!empty($_FILES['uploaded_files']['name'][0])) {
                $filesCount = count($_FILES['uploaded_files']['name']);
                $config = [
                    'upload_path' => './api/file_uploads/',
                    'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                    'max_size' => 50000,
                    'encrypt_name' => FALSE
                ];
                $this->load->library('upload');
                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file'] = [
                        'name' => $_FILES['uploaded_files']['name'][$i],
                        'type' => $_FILES['uploaded_files']['type'][$i],
                        'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                        'error' => $_FILES['uploaded_files']['error'][$i],
                        'size' => $_FILES['uploaded_files']['size'][$i]
                    ];
                    $this->upload->initialize($config);
                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();
                        $existingFiles[] = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];
                    }
                }
            }

            $dataset['files_name'] = array_values($existingFiles);
            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            $this->audit_model->update_infection_control_laboratory_audit_feedback($id, [
                'dataset' => json_encode($dataset),

            ]);

            redirect('audit/infection_control_laboratory_audit_feedback?id=' . $id);
        } else {
            $data['record'] = $this->audit_model->get_infection_control_laboratory_audit_feedback_byid($id);
            $this->load->view('audit/edit_infection_control_laboratory_audit_feedback', $data);
        }
    }

    public function edit_infection_control_mortuary_audit_feedback_byid($id)
    {
        if ($this->input->post()) {
            $existing = $this->audit_model->get_infection_control_mortuary_audit_feedback_byid($id);
            $dataset = json_decode($existing->dataset, true) ?: [];
            $existingFiles = $dataset['files_name'] ?? [];

            $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath))
                            @unlink($absolutePath);
                        unset($existingFiles[$index]);
                    }
                }
                $existingFiles = array_values($existingFiles);
            }

            if (!empty($_FILES['uploaded_files']['name'][0])) {
                $filesCount = count($_FILES['uploaded_files']['name']);
                $config = [
                    'upload_path' => './api/file_uploads/',
                    'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                    'max_size' => 50000,
                    'encrypt_name' => FALSE
                ];
                $this->load->library('upload');
                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file'] = [
                        'name' => $_FILES['uploaded_files']['name'][$i],
                        'type' => $_FILES['uploaded_files']['type'][$i],
                        'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                        'error' => $_FILES['uploaded_files']['error'][$i],
                        'size' => $_FILES['uploaded_files']['size'][$i]
                    ];
                    $this->upload->initialize($config);
                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();
                        $existingFiles[] = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];
                    }
                }
            }

            $dataset['files_name'] = array_values($existingFiles);
            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            $this->audit_model->update_infection_control_mortuary_audit_feedback($id, [
                'dataset' => json_encode($dataset),

            ]);

            redirect('audit/infection_control_mortuary_audit_feedback?id=' . $id);
        } else {
            $data['record'] = $this->audit_model->get_infection_control_mortuary_audit_feedback_byid($id);
            $this->load->view('audit/edit_infection_control_mortuary_audit_feedback', $data);
        }
    }

    public function edit_infection_control_radiology_audit_feedback_byid($id)
    {
        if ($this->input->post()) {
            $existing = $this->audit_model->get_infection_control_radiology_audit_feedback_byid($id);
            $dataset = json_decode($existing->dataset, true) ?: [];
            $existingFiles = $dataset['files_name'] ?? [];

            $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath))
                            @unlink($absolutePath);
                        unset($existingFiles[$index]);
                    }
                }
                $existingFiles = array_values($existingFiles);
            }

            if (!empty($_FILES['uploaded_files']['name'][0])) {
                $filesCount = count($_FILES['uploaded_files']['name']);
                $config = [
                    'upload_path' => './api/file_uploads/',
                    'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                    'max_size' => 50000,
                    'encrypt_name' => FALSE
                ];
                $this->load->library('upload');
                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file'] = [
                        'name' => $_FILES['uploaded_files']['name'][$i],
                        'type' => $_FILES['uploaded_files']['type'][$i],
                        'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                        'error' => $_FILES['uploaded_files']['error'][$i],
                        'size' => $_FILES['uploaded_files']['size'][$i]
                    ];
                    $this->upload->initialize($config);
                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();
                        $existingFiles[] = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];
                    }
                }
            }

            $dataset['files_name'] = array_values($existingFiles);
            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            $this->audit_model->update_infection_control_radiology_audit_feedback($id, [
                'dataset' => json_encode($dataset),

            ]);

            redirect('audit/infection_control_radiology_audit_feedback?id=' . $id);
        } else {
            $data['record'] = $this->audit_model->get_infection_control_radiology_audit_feedback_byid($id);
            $this->load->view('audit/edit_infection_control_radiology_audit_feedback', $data);
        }
    }

    public function edit_infection_control_ssi_survelliance_audit_feedback_byid($id)
    {
        if ($this->input->post()) {
            $existing = $this->audit_model->get_infection_control_ssi_survelliance_audit_feedback_byid($id);
            $dataset = json_decode($existing->dataset, true) ?: [];
            $existingFiles = $dataset['files_name'] ?? [];

            $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath))
                            @unlink($absolutePath);
                        unset($existingFiles[$index]);
                    }
                }
                $existingFiles = array_values($existingFiles);
            }

            if (!empty($_FILES['uploaded_files']['name'][0])) {
                $filesCount = count($_FILES['uploaded_files']['name']);
                $config = [
                    'upload_path' => './api/file_uploads/',
                    'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                    'max_size' => 50000,
                    'encrypt_name' => FALSE
                ];
                $this->load->library('upload');
                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file'] = [
                        'name' => $_FILES['uploaded_files']['name'][$i],
                        'type' => $_FILES['uploaded_files']['type'][$i],
                        'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                        'error' => $_FILES['uploaded_files']['error'][$i],
                        'size' => $_FILES['uploaded_files']['size'][$i]
                    ];
                    $this->upload->initialize($config);
                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();
                        $existingFiles[] = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];
                    }
                }
            }

            $dataset['files_name'] = array_values($existingFiles);
            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            $this->audit_model->update_infection_control_ssi_survelliance_audit_feedback($id, [
                'dataset' => json_encode($dataset),

            ]);

            redirect('audit/infection_control_ssi_survelliance_audit_feedback?id=' . $id);
        } else {
            $data['record'] = $this->audit_model->get_infection_control_ssi_survelliance_audit_feedback_byid($id);
            $this->load->view('audit/edit_infection_control_ssi_survelliance_audit_feedback', $data);
        }
    }

    public function edit_infection_control_peripheralivline_audit_feedback_byid($id)
    {
        if ($this->input->post()) {
            $existing = $this->audit_model->get_infection_control_peripheralivline_audit_feedback_byid($id);
            $dataset = json_decode($existing->dataset, true) ?: [];
            $existingFiles = $dataset['files_name'] ?? [];

            $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath))
                            @unlink($absolutePath);
                        unset($existingFiles[$index]);
                    }
                }
                $existingFiles = array_values($existingFiles);
            }

            if (!empty($_FILES['uploaded_files']['name'][0])) {
                $filesCount = count($_FILES['uploaded_files']['name']);
                $config = [
                    'upload_path' => './api/file_uploads/',
                    'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                    'max_size' => 50000,
                    'encrypt_name' => FALSE
                ];
                $this->load->library('upload');
                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file'] = [
                        'name' => $_FILES['uploaded_files']['name'][$i],
                        'type' => $_FILES['uploaded_files']['type'][$i],
                        'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                        'error' => $_FILES['uploaded_files']['error'][$i],
                        'size' => $_FILES['uploaded_files']['size'][$i]
                    ];
                    $this->upload->initialize($config);
                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();
                        $existingFiles[] = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];
                    }
                }
            }

            $dataset['files_name'] = array_values($existingFiles);
            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            $this->audit_model->update_infection_control_peripheralivline_audit_feedback($id, [
                'dataset' => json_encode($dataset),

            ]);

            redirect('audit/infection_control_peripheralivline_audit_feedback?id=' . $id);
        } else {
            $data['record'] = $this->audit_model->get_infection_control_peripheralivline_audit_feedback_byid($id);
            $this->load->view('audit/edit_infection_control_peripheralivline_audit_feedback', $data);
        }
    }

    public function edit_infection_control_personalprotective_audit_feedback_byid($id)
    {
        if ($this->input->post()) {
            $existing = $this->audit_model->get_infection_control_personalprotective_audit_feedback_byid($id);
            $dataset = json_decode($existing->dataset, true) ?: [];
            $existingFiles = $dataset['files_name'] ?? [];

            $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath))
                            @unlink($absolutePath);
                        unset($existingFiles[$index]);
                    }
                }
                $existingFiles = array_values($existingFiles);
            }

            if (!empty($_FILES['uploaded_files']['name'][0])) {
                $filesCount = count($_FILES['uploaded_files']['name']);
                $config = [
                    'upload_path' => './api/file_uploads/',
                    'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                    'max_size' => 50000,
                    'encrypt_name' => FALSE
                ];
                $this->load->library('upload');
                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file'] = [
                        'name' => $_FILES['uploaded_files']['name'][$i],
                        'type' => $_FILES['uploaded_files']['type'][$i],
                        'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                        'error' => $_FILES['uploaded_files']['error'][$i],
                        'size' => $_FILES['uploaded_files']['size'][$i]
                    ];
                    $this->upload->initialize($config);
                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();
                        $existingFiles[] = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];
                    }
                }
            }

            $dataset['files_name'] = array_values($existingFiles);
            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            $this->audit_model->update_infection_control_personalprotective_audit_feedback($id, [
                'dataset' => json_encode($dataset),

            ]);

            redirect('audit/infection_control_personalprotective_audit_feedback?id=' . $id);
        } else {
            $data['record'] = $this->audit_model->get_infection_control_personalprotective_audit_feedback_byid($id);
            $this->load->view('audit/edit_infection_control_personalprotective_audit_feedback', $data);
        }
    }

    public function edit_infection_control_safe_injection_audit_feedback_byid($id)
    {
        if ($this->input->post()) {
            $existing = $this->audit_model->get_infection_control_safe_injection_audit_feedback_byid($id);
            $dataset = json_decode($existing->dataset, true) ?: [];
            $existingFiles = $dataset['files_name'] ?? [];

            $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath))
                            @unlink($absolutePath);
                        unset($existingFiles[$index]);
                    }
                }
                $existingFiles = array_values($existingFiles);
            }

            if (!empty($_FILES['uploaded_files']['name'][0])) {
                $filesCount = count($_FILES['uploaded_files']['name']);
                $config = [
                    'upload_path' => './api/file_uploads/',
                    'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                    'max_size' => 50000,
                    'encrypt_name' => FALSE
                ];
                $this->load->library('upload');
                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file'] = [
                        'name' => $_FILES['uploaded_files']['name'][$i],
                        'type' => $_FILES['uploaded_files']['type'][$i],
                        'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                        'error' => $_FILES['uploaded_files']['error'][$i],
                        'size' => $_FILES['uploaded_files']['size'][$i]
                    ];
                    $this->upload->initialize($config);
                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();
                        $existingFiles[] = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];
                    }
                }
            }

            $dataset['files_name'] = array_values($existingFiles);
            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            $this->audit_model->update_infection_control_safe_injection_audit_feedback($id, [
                'dataset' => json_encode($dataset),

            ]);

            redirect('audit/infection_control_safe_injection_audit_feedback?id=' . $id);
        } else {
            $data['record'] = $this->audit_model->get_infection_control_safe_injection_audit_feedback_byid($id);
            $this->load->view('audit/edit_infection_control_safe_injection_audit_feedback', $data);
        }
    }

    public function edit_infection_control_surface_cleaning_audit_feedback_byid($id)
    {
        if ($this->input->post()) {
            $existing = $this->audit_model->get_infection_control_surface_cleaning_audit_feedback_byid($id);
            $dataset = json_decode($existing->dataset, true) ?: [];
            $existingFiles = $dataset['files_name'] ?? [];

            $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath))
                            @unlink($absolutePath);
                        unset($existingFiles[$index]);
                    }
                }
                $existingFiles = array_values($existingFiles);
            }

            if (!empty($_FILES['uploaded_files']['name'][0])) {
                $filesCount = count($_FILES['uploaded_files']['name']);
                $config = [
                    'upload_path' => './api/file_uploads/',
                    'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                    'max_size' => 50000,
                    'encrypt_name' => FALSE
                ];
                $this->load->library('upload');
                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file'] = [
                        'name' => $_FILES['uploaded_files']['name'][$i],
                        'type' => $_FILES['uploaded_files']['type'][$i],
                        'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                        'error' => $_FILES['uploaded_files']['error'][$i],
                        'size' => $_FILES['uploaded_files']['size'][$i]
                    ];
                    $this->upload->initialize($config);
                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();
                        $existingFiles[] = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];
                    }
                }
            }

            $dataset['files_name'] = array_values($existingFiles);
            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            $this->audit_model->update_infection_control_surface_cleaning_audit_feedback($id, [
                'dataset' => json_encode($dataset),

            ]);

            redirect('audit/infection_control_surface_cleaning_audit_feedback?id=' . $id);
        } else {
            $data['record'] = $this->audit_model->get_infection_control_surface_cleaning_audit_feedback_byid($id);
            $this->load->view('audit/edit_infection_control_surface_cleaning_audit_feedback', $data);
        }
    }


    //edit page and to edit for Clinical Pathways

    public function edit_clinical_pathway_arthroscopic_audit_feedback()
    {

        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }


        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_clinical_pathway_arthroscopic_audit_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_clinical_pathway_arthroscopic_audit_feedback', $data, true);
            }
            //    $data['content'] = $this->load->view('qualitymodules/ticket_track', $data, true);

            $this->load->view('layout/main_wrapper', $data);
        }
    }
    public function edit_clinical_pathway_breast_lump_audit_feedback()
    {

        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }


        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_clinical_pathway_breast_lump_audit_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_clinical_pathway_breast_lump_audit_feedback', $data, true);
            }
            //    $data['content'] = $this->load->view('qualitymodules/ticket_track', $data, true);

            $this->load->view('layout/main_wrapper', $data);
        }
    }
    public function edit_clinical_pathway_cardiac_arrest_audit_feedback()
    {

        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }


        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_clinical_pathway_cardiac_arrest_audit_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_clinical_pathway_cardiac_arrest_audit_feedback', $data, true);
            }
            //    $data['content'] = $this->load->view('qualitymodules/ticket_track', $data, true);

            $this->load->view('layout/main_wrapper', $data);
        }
    }
    public function edit_clinical_pathway_donor_hepatectomy_audit_feedback()
    {

        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }


        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_clinical_pathway_donor_hepatectomy_audit_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_clinical_pathway_donor_hepatectomy_audit_feedback', $data, true);
            }
            //    $data['content'] = $this->load->view('qualitymodules/ticket_track', $data, true);

            $this->load->view('layout/main_wrapper', $data);
        }
    }
    public function edit_clinical_pathway_febrile_seizure_audit_feedback()
    {

        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }


        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_clinical_pathway_febrile_seizure_audit_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_clinical_pathway_febrile_seizure_audit_feedback', $data, true);
            }
            //    $data['content'] = $this->load->view('qualitymodules/ticket_track', $data, true);

            $this->load->view('layout/main_wrapper', $data);
        }
    }
    public function edit_clinical_pathway_heart_transplant_audit_feedback()
    {

        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }


        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_clinical_pathway_heart_transplant_audit_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_clinical_pathway_heart_transplant_audit_feedback', $data, true);
            }
            //    $data['content'] = $this->load->view('qualitymodules/ticket_track', $data, true);

            $this->load->view('layout/main_wrapper', $data);
        }
    }
    public function edit_clinical_pathway_laproscopic_audit_feedback()
    {

        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }


        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_clinical_pathway_laproscopic_audit_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_clinical_pathway_laproscopic_audit_feedback', $data, true);
            }
            //    $data['content'] = $this->load->view('qualitymodules/ticket_track', $data, true);

            $this->load->view('layout/main_wrapper', $data);
        }
    }
    public function edit_clinical_pathway_picc_line_audit_feedback()
    {

        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }


        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_clinical_pathway_picc_line_audit_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_clinical_pathway_picc_line_audit_feedback', $data, true);
            }
            //    $data['content'] = $this->load->view('qualitymodules/ticket_track', $data, true);

            $this->load->view('layout/main_wrapper', $data);
        }
    }
    public function edit_clinical_pathway_stroke_audit_feedback()
    {

        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }


        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_clinical_pathway_stroke_audit_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_clinical_pathway_stroke_audit_feedback', $data, true);
            }
            //    $data['content'] = $this->load->view('qualitymodules/ticket_track', $data, true);

            $this->load->view('layout/main_wrapper', $data);
        }
    }
    public function edit_clinical_pathway_urodynamics_audit_feedback()
    {

        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }


        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_clinical_pathway_urodynamics_audit_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_clinical_pathway_urodynamics_audit_feedback', $data, true);
            }
            //    $data['content'] = $this->load->view('qualitymodules/ticket_track', $data, true);

            $this->load->view('layout/main_wrapper', $data);
        }
    }
    public function edit_clinical_pathway_stemi_audit_feedback()
    {

        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }


        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT AUDIT FORM';
            $data['departments'] = $this->tickets_model->read_by_id($this->uri->segment(3));
            if (isfeature_active('AUDIT-DASHBOARD') === true) {
                $data['content'] = $this->load->view('auditmodules/edit_clinical_pathway_stemi_audit_feedback', $data, true);
            } else {
                $data['content'] = $this->load->view('auditmodules/dephead/edit_clinical_pathway_stemi_audit_feedback', $data, true);
            }
            //    $data['content'] = $this->load->view('qualitymodules/ticket_track', $data, true);

            $this->load->view('layout/main_wrapper', $data);
        }
    }

    // To Edit audit by id Clinical Pathways

    public function edit_clinical_pathway_arthroscopic_audit_feedback_byid($id)
    {
        if ($this->input->post()) {
            $existing = $this->audit_model->get_clinical_pathway_arthroscopic_audit_feedback_byid($id);
            $dataset = json_decode($existing->dataset, true) ?: [];
            $existingFiles = $dataset['files_name'] ?? [];

            // Remove files if requested
            $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath))
                            @unlink($absolutePath);
                        unset($existingFiles[$index]);
                    }
                }
                $existingFiles = array_values($existingFiles);
            }

            // Upload new files
            if (!empty($_FILES['uploaded_files']['name'][0])) {
                $filesCount = count($_FILES['uploaded_files']['name']);
                $config = [
                    'upload_path' => './api/file_uploads/',
                    'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                    'max_size' => 50000,
                    'encrypt_name' => FALSE
                ];
                $this->load->library('upload');
                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file'] = [
                        'name' => $_FILES['uploaded_files']['name'][$i],
                        'type' => $_FILES['uploaded_files']['type'][$i],
                        'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                        'error' => $_FILES['uploaded_files']['error'][$i],
                        'size' => $_FILES['uploaded_files']['size'][$i]
                    ];
                    $this->upload->initialize($config);
                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();
                        $existingFiles[] = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];
                    }
                }
            }

            $dataset['files_name'] = array_values($existingFiles);
            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            $this->audit_model->update_clinical_pathway_arthroscopic_audit_feedback($id, [
                'dataset' => json_encode($dataset),

            ]);

            redirect('audit/clinical_pathway_arthroscopic_audit_feedback?id=' . $id);
        } else {
            $data['record'] = $this->audit_model->get_clinical_pathway_arthroscopic_audit_feedback_byid($id);
            $this->load->view('audit/edit_clinical_pathway_arthroscopic_audit_feedback', $data);
        }
    }

    public function edit_clinical_pathway_breast_lump_audit_feedback_byid($id)
    {
        if ($this->input->post()) {
            $existing = $this->audit_model->get_clinical_pathway_breast_lump_audit_feedback_byid($id);
            $dataset = json_decode($existing->dataset, true) ?: [];
            $existingFiles = $dataset['files_name'] ?? [];

            $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath))
                            @unlink($absolutePath);
                        unset($existingFiles[$index]);
                    }
                }
                $existingFiles = array_values($existingFiles);
            }

            if (!empty($_FILES['uploaded_files']['name'][0])) {
                $filesCount = count($_FILES['uploaded_files']['name']);
                $config = [
                    'upload_path' => './api/file_uploads/',
                    'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                    'max_size' => 50000,
                    'encrypt_name' => FALSE
                ];
                $this->load->library('upload');
                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file'] = [
                        'name' => $_FILES['uploaded_files']['name'][$i],
                        'type' => $_FILES['uploaded_files']['type'][$i],
                        'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                        'error' => $_FILES['uploaded_files']['error'][$i],
                        'size' => $_FILES['uploaded_files']['size'][$i]
                    ];
                    $this->upload->initialize($config);
                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();
                        $existingFiles[] = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];
                    }
                }
            }

            $dataset['files_name'] = array_values($existingFiles);
            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            $this->audit_model->update_clinical_pathway_breast_lump_audit_feedback($id, [
                'dataset' => json_encode($dataset),

            ]);

            redirect('audit/clinical_pathway_breast_lump_audit_feedback?id=' . $id);
        } else {
            $data['record'] = $this->audit_model->get_clinical_pathway_breast_lump_audit_feedback_byid($id);
            $this->load->view('audit/edit_clinical_pathway_breast_lump_audit_feedback', $data);
        }
    }

    public function edit_clinical_pathway_cardiac_arrest_audit_feedback_byid($id)
    {
        if ($this->input->post()) {
            $existing = $this->audit_model->get_clinical_pathway_cardiac_arrest_audit_feedback_byid($id);
            $dataset = json_decode($existing->dataset, true) ?: [];
            $existingFiles = $dataset['files_name'] ?? [];

            $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath))
                            @unlink($absolutePath);
                        unset($existingFiles[$index]);
                    }
                }
                $existingFiles = array_values($existingFiles);
            }

            if (!empty($_FILES['uploaded_files']['name'][0])) {
                $filesCount = count($_FILES['uploaded_files']['name']);
                $config = [
                    'upload_path' => './api/file_uploads/',
                    'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                    'max_size' => 50000,
                    'encrypt_name' => FALSE
                ];
                $this->load->library('upload');
                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file'] = [
                        'name' => $_FILES['uploaded_files']['name'][$i],
                        'type' => $_FILES['uploaded_files']['type'][$i],
                        'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                        'error' => $_FILES['uploaded_files']['error'][$i],
                        'size' => $_FILES['uploaded_files']['size'][$i]
                    ];
                    $this->upload->initialize($config);
                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();
                        $existingFiles[] = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];
                    }
                }
            }

            $dataset['files_name'] = array_values($existingFiles);
            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            $this->audit_model->update_clinical_pathway_cardiac_arrest_audit_feedback($id, [
                'dataset' => json_encode($dataset),

            ]);

            redirect('audit/clinical_pathway_cardiac_arrest_audit_feedback?id=' . $id);
        } else {
            $data['record'] = $this->audit_model->get_clinical_pathway_cardiac_arrest_audit_feedback_byid($id);
            $this->load->view('audit/edit_clinical_pathway_cardiac_arrest_audit_feedback', $data);
        }
    }



    public function edit_clinical_pathway_donor_hepatectomy_audit_feedback_byid($id)
    {
        if ($this->input->post()) {
            $existing = $this->audit_model->get_clinical_pathway_donor_hepatectomy_audit_feedback_byid($id);
            $dataset = json_decode($existing->dataset, true) ?: [];
            $existingFiles = $dataset['files_name'] ?? [];

            $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath))
                            @unlink($absolutePath);
                        unset($existingFiles[$index]);
                    }
                }
                $existingFiles = array_values($existingFiles);
            }

            if (!empty($_FILES['uploaded_files']['name'][0])) {
                $filesCount = count($_FILES['uploaded_files']['name']);
                $config = [
                    'upload_path' => './api/file_uploads/',
                    'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                    'max_size' => 50000,
                    'encrypt_name' => FALSE
                ];
                $this->load->library('upload');
                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file'] = [
                        'name' => $_FILES['uploaded_files']['name'][$i],
                        'type' => $_FILES['uploaded_files']['type'][$i],
                        'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                        'error' => $_FILES['uploaded_files']['error'][$i],
                        'size' => $_FILES['uploaded_files']['size'][$i]
                    ];
                    $this->upload->initialize($config);
                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();
                        $existingFiles[] = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];
                    }
                }
            }

            $dataset['files_name'] = array_values($existingFiles);
            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            $this->audit_model->update_clinical_pathway_donor_hepatectomy_audit_feedback($id, [
                'dataset' => json_encode($dataset),

            ]);

            redirect('audit/clinical_pathway_donor_hepatectomy_audit_feedback?id=' . $id);
        } else {
            $data['record'] = $this->audit_model->get_clinical_pathway_donor_hepatectomy_audit_feedback_byid($id);
            $this->load->view('audit/edit_clinical_pathway_donor_hepatectomy_audit_feedback', $data);
        }
    }

    public function edit_clinical_pathway_febrile_seizure_audit_feedback_byid($id)
    {
        if ($this->input->post()) {
            $existing = $this->audit_model->get_clinical_pathway_febrile_seizure_audit_feedback_byid($id);
            $dataset = json_decode($existing->dataset, true) ?: [];
            $existingFiles = $dataset['files_name'] ?? [];

            $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath))
                            @unlink($absolutePath);
                        unset($existingFiles[$index]);
                    }
                }
                $existingFiles = array_values($existingFiles);
            }

            if (!empty($_FILES['uploaded_files']['name'][0])) {
                $filesCount = count($_FILES['uploaded_files']['name']);
                $config = [
                    'upload_path' => './api/file_uploads/',
                    'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                    'max_size' => 50000,
                    'encrypt_name' => FALSE
                ];
                $this->load->library('upload');
                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file'] = [
                        'name' => $_FILES['uploaded_files']['name'][$i],
                        'type' => $_FILES['uploaded_files']['type'][$i],
                        'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                        'error' => $_FILES['uploaded_files']['error'][$i],
                        'size' => $_FILES['uploaded_files']['size'][$i]
                    ];
                    $this->upload->initialize($config);
                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();
                        $existingFiles[] = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];
                    }
                }
            }

            $dataset['files_name'] = array_values($existingFiles);
            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            $this->audit_model->update_clinical_pathway_febrile_seizure_audit_feedback($id, [
                'dataset' => json_encode($dataset),

            ]);

            redirect('audit/clinical_pathway_febrile_seizure_audit_feedback?id=' . $id);
        } else {
            $data['record'] = $this->audit_model->get_clinical_pathway_febrile_seizure_audit_feedback_byid($id);
            $this->load->view('audit/edit_clinical_pathway_febrile_seizure_audit_feedback', $data);
        }
    }

    public function edit_clinical_pathway_heart_transplant_audit_feedback_byid($id)
    {
        if ($this->input->post()) {
            $existing = $this->audit_model->get_clinical_pathway_heart_transplant_audit_feedback_byid($id);
            $dataset = json_decode($existing->dataset, true) ?: [];
            $existingFiles = $dataset['files_name'] ?? [];

            $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath))
                            @unlink($absolutePath);
                        unset($existingFiles[$index]);
                    }
                }
                $existingFiles = array_values($existingFiles);
            }

            if (!empty($_FILES['uploaded_files']['name'][0])) {
                $filesCount = count($_FILES['uploaded_files']['name']);
                $config = [
                    'upload_path' => './api/file_uploads/',
                    'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                    'max_size' => 50000,
                    'encrypt_name' => FALSE
                ];
                $this->load->library('upload');
                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file'] = [
                        'name' => $_FILES['uploaded_files']['name'][$i],
                        'type' => $_FILES['uploaded_files']['type'][$i],
                        'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                        'error' => $_FILES['uploaded_files']['error'][$i],
                        'size' => $_FILES['uploaded_files']['size'][$i]
                    ];
                    $this->upload->initialize($config);
                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();
                        $existingFiles[] = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];
                    }
                }
            }

            $dataset['files_name'] = array_values($existingFiles);
            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            $this->audit_model->update_clinical_pathway_heart_transplant_audit_feedback($id, [
                'dataset' => json_encode($dataset),

            ]);

            redirect('audit/clinical_pathway_heart_transplant_audit_feedback?id=' . $id);
        } else {
            $data['record'] = $this->audit_model->get_clinical_pathway_heart_transplant_audit_feedback_byid($id);
            $this->load->view('audit/edit_clinical_pathway_heart_transplant_audit_feedback', $data);
        }
    }

    public function edit_clinical_pathway_laproscopic_audit_feedback_byid($id)
    {
        if ($this->input->post()) {
            $existing = $this->audit_model->get_clinical_pathway_laproscopic_audit_feedback_byid($id);
            $dataset = json_decode($existing->dataset, true) ?: [];
            $existingFiles = $dataset['files_name'] ?? [];

            $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath))
                            @unlink($absolutePath);
                        unset($existingFiles[$index]);
                    }
                }
                $existingFiles = array_values($existingFiles);
            }

            if (!empty($_FILES['uploaded_files']['name'][0])) {
                $filesCount = count($_FILES['uploaded_files']['name']);
                $config = [
                    'upload_path' => './api/file_uploads/',
                    'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                    'max_size' => 50000,
                    'encrypt_name' => FALSE
                ];
                $this->load->library('upload');
                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file'] = [
                        'name' => $_FILES['uploaded_files']['name'][$i],
                        'type' => $_FILES['uploaded_files']['type'][$i],
                        'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                        'error' => $_FILES['uploaded_files']['error'][$i],
                        'size' => $_FILES['uploaded_files']['size'][$i]
                    ];
                    $this->upload->initialize($config);
                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();
                        $existingFiles[] = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];
                    }
                }
            }

            $dataset['files_name'] = array_values($existingFiles);
            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            $this->audit_model->update_clinical_pathway_laproscopic_audit_feedback($id, [
                'dataset' => json_encode($dataset),

            ]);

            redirect('audit/clinical_pathway_laproscopic_audit_feedback?id=' . $id);
        } else {
            $data['record'] = $this->audit_model->get_clinical_pathway_laproscopic_audit_feedback_byid($id);
            $this->load->view('audit/edit_clinical_pathway_laproscopic_audit_feedback', $data);
        }
    }

    public function edit_clinical_pathway_picc_line_audit_feedback_byid($id)
    {
        if ($this->input->post()) {
            $existing = $this->audit_model->get_clinical_pathway_picc_line_audit_feedback_byid($id);
            $dataset = json_decode($existing->dataset, true) ?: [];
            $existingFiles = $dataset['files_name'] ?? [];

            $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath))
                            @unlink($absolutePath);
                        unset($existingFiles[$index]);
                    }
                }
                $existingFiles = array_values($existingFiles);
            }

            if (!empty($_FILES['uploaded_files']['name'][0])) {
                $filesCount = count($_FILES['uploaded_files']['name']);
                $config = [
                    'upload_path' => './api/file_uploads/',
                    'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                    'max_size' => 50000,
                    'encrypt_name' => FALSE
                ];
                $this->load->library('upload');
                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file'] = [
                        'name' => $_FILES['uploaded_files']['name'][$i],
                        'type' => $_FILES['uploaded_files']['type'][$i],
                        'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                        'error' => $_FILES['uploaded_files']['error'][$i],
                        'size' => $_FILES['uploaded_files']['size'][$i]
                    ];
                    $this->upload->initialize($config);
                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();
                        $existingFiles[] = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];
                    }
                }
            }

            $dataset['files_name'] = array_values($existingFiles);
            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            $this->audit_model->update_clinical_pathway_picc_line_audit_feedback($id, [
                'dataset' => json_encode($dataset),

            ]);

            redirect('audit/clinical_pathway_picc_line_audit_feedback?id=' . $id);
        } else {
            $data['record'] = $this->audit_model->get_clinical_pathway_picc_line_audit_feedback_byid($id);
            $this->load->view('audit/edit_clinical_pathway_picc_line_audit_feedback', $data);
        }
    }

    public function edit_clinical_pathway_stroke_audit_feedback_byid($id)
    {
        if ($this->input->post()) {
            $existing = $this->audit_model->get_clinical_pathway_stroke_audit_feedback_byid($id);
            $dataset = json_decode($existing->dataset, true) ?: [];
            $existingFiles = $dataset['files_name'] ?? [];

            $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath))
                            @unlink($absolutePath);
                        unset($existingFiles[$index]);
                    }
                }
                $existingFiles = array_values($existingFiles);
            }

            if (!empty($_FILES['uploaded_files']['name'][0])) {
                $filesCount = count($_FILES['uploaded_files']['name']);
                $config = [
                    'upload_path' => './api/file_uploads/',
                    'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                    'max_size' => 50000,
                    'encrypt_name' => FALSE
                ];
                $this->load->library('upload');
                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file'] = [
                        'name' => $_FILES['uploaded_files']['name'][$i],
                        'type' => $_FILES['uploaded_files']['type'][$i],
                        'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                        'error' => $_FILES['uploaded_files']['error'][$i],
                        'size' => $_FILES['uploaded_files']['size'][$i]
                    ];
                    $this->upload->initialize($config);
                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();
                        $existingFiles[] = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];
                    }
                }
            }

            $dataset['files_name'] = array_values($existingFiles);
            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            $this->audit_model->update_clinical_pathway_stroke_audit_feedback($id, [
                'dataset' => json_encode($dataset),

            ]);

            redirect('audit/clinical_pathway_stroke_audit_feedback?id=' . $id);
        } else {
            $data['record'] = $this->audit_model->get_clinical_pathway_stroke_audit_feedback_byid($id);
            $this->load->view('audit/edit_clinical_pathway_stroke_audit_feedback', $data);
        }
    }

    public function edit_clinical_pathway_urodynamics_audit_feedback_byid($id)
    {
        if ($this->input->post()) {
            $existing = $this->audit_model->get_clinical_pathway_urodynamics_audit_feedback_byid($id);
            $dataset = json_decode($existing->dataset, true) ?: [];
            $existingFiles = $dataset['files_name'] ?? [];

            $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath))
                            @unlink($absolutePath);
                        unset($existingFiles[$index]);
                    }
                }
                $existingFiles = array_values($existingFiles);
            }

            if (!empty($_FILES['uploaded_files']['name'][0])) {
                $filesCount = count($_FILES['uploaded_files']['name']);
                $config = [
                    'upload_path' => './api/file_uploads/',
                    'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                    'max_size' => 50000,
                    'encrypt_name' => FALSE
                ];
                $this->load->library('upload');
                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file'] = [
                        'name' => $_FILES['uploaded_files']['name'][$i],
                        'type' => $_FILES['uploaded_files']['type'][$i],
                        'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                        'error' => $_FILES['uploaded_files']['error'][$i],
                        'size' => $_FILES['uploaded_files']['size'][$i]
                    ];
                    $this->upload->initialize($config);
                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();
                        $existingFiles[] = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];
                    }
                }
            }

            $dataset['files_name'] = array_values($existingFiles);
            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            $this->audit_model->update_clinical_pathway_urodynamics_audit_feedback($id, [
                'dataset' => json_encode($dataset),

            ]);

            redirect('audit/clinical_pathway_urodynamics_audit_feedback?id=' . $id);
        } else {
            $data['record'] = $this->audit_model->get_clinical_pathway_urodynamics_audit_feedback_byid($id);
            $this->load->view('audit/edit_clinical_pathway_urodynamics_audit_feedback', $data);
        }
    }

    public function edit_clinical_pathway_stemi_audit_feedback_byid($id)
    {
        if ($this->input->post()) {
            $existing = $this->audit_model->get_clinical_pathway_stemi_audit_feedback_byid($id);
            $dataset = json_decode($existing->dataset, true) ?: [];
            $existingFiles = $dataset['files_name'] ?? [];

            $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
            if (!empty($removeIndexes)) {
                foreach ($removeIndexes as $index) {
                    if (isset($existingFiles[$index])) {
                        $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                        $absolutePath = FCPATH . $oldFilePath;
                        if (file_exists($absolutePath))
                            @unlink($absolutePath);
                        unset($existingFiles[$index]);
                    }
                }
                $existingFiles = array_values($existingFiles);
            }

            if (!empty($_FILES['uploaded_files']['name'][0])) {
                $filesCount = count($_FILES['uploaded_files']['name']);
                $config = [
                    'upload_path' => './api/file_uploads/',
                    'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                    'max_size' => 50000,
                    'encrypt_name' => FALSE
                ];
                $this->load->library('upload');
                for ($i = 0; $i < $filesCount; $i++) {
                    $_FILES['file'] = [
                        'name' => $_FILES['uploaded_files']['name'][$i],
                        'type' => $_FILES['uploaded_files']['type'][$i],
                        'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                        'error' => $_FILES['uploaded_files']['error'][$i],
                        'size' => $_FILES['uploaded_files']['size'][$i]
                    ];
                    $this->upload->initialize($config);
                    if ($this->upload->do_upload('file')) {
                        $uploadData = $this->upload->data();
                        $existingFiles[] = [
                            'url' => base_url('api/file_uploads/' . $uploadData['file_name']),
                            'name' => $uploadData['file_name']
                        ];
                    }
                }
            }

            $dataset['files_name'] = array_values($existingFiles);
            foreach ($_POST as $key => $value) {
                if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                    $dataset[$key] = $value;
                }
            }

            $this->audit_model->update_clinical_pathway_stemi_audit_feedback($id, [
                'dataset' => json_encode($dataset),

            ]);

            redirect('audit/clinical_pathway_stemi_audit_feedback?id=' . $id);
        } else {
            $data['record'] = $this->audit_model->get_clinical_pathway_stemi_audit_feedback_byid($id);
            $this->load->view('audit/edit_clinical_pathway_stemi_audit_feedback', $data);
        }
    }














    // Download reports  for all audit 

    public function overall_active_cases_mrd()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_ma_active_cases_mrdip';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->audit_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Audit Name';
            $header[1] = 'Date & Time of Audit';
            $header[2] = 'Audit by';
            $header[3] = 'Patient MID';
            $header[4] = 'Patient Name';
            $header[5] = 'Patient Age';
            $header[6] = 'Patient Gender';

            $j = 7;

            $header[$j++] = 'Area';
            $header[$j++] = 'Department';
            $header[$j++] = 'Attended Doctor';
            $header[$j++] = 'Admission Date & Time';
            $header[$j++] = 'Discharge Date & Time';
            $header[$j++] = 'Is the plan of care available?';
            $header[$j++] = 'Is the admitting diagnosis recorded?';
            $header[$j++] = 'Are physical findings available?';
            $header[$j++] = 'Are present complaint details available?';
            $header[$j++] = 'Are history details available?';
            $header[$j++] = 'Is the plan for discharge available?';
            $header[$j++] = 'Are vitals recorded?';
            $header[$j++] = 'Is ABC assessment available?';
            $header[$j++] = 'Is pain score available?';
            $header[$j++] = 'Is functional assessment available?';
            $header[$j++] = 'Is psychological status recorded?';
            $header[$j++] = 'Is vulnerability status recorded?';
            $header[$j++] = 'Is social status screening available?';
            $header[$j++] = 'Is nutritional screening available?';
            $header[$j++] = 'Is spiritual needs screening recorded?';
            $header[$j++] = 'Is suicide risk screening recorded?';
            $header[$j++] = 'Is fall risk assessment recorded?';
            $header[$j++] = 'Is care plan available?';
            $header[$j++] = 'Is PFE available?';
            $header[$j++] = 'Is discharge planning recorded?';
            $header[$j++] = 'Is nutritional assessment available?';
            $header[$j++] = 'Is dietitian assessment done within 30 days for haemodialysis?';
            $header[$j++] = 'Are appropriate IV fluids started within an hour?';
            $header[$j++] = 'Is serum lactate checked?';
            $header[$j++] = 'Are cultures taken before antibiotics?';
            $header[$j++] = 'Are broad spectrum antibiotics started within one hour?';
            $header[$j++] = 'Is noradrenaline started if required?';


            $header[$j++] = 'Additional comments';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['audit_type'] = $data['audit_type'];
                $dataexport[$i]['date'] = date('Y-m-d H:i', strtotime($row->datetime));
                $dataexport[$i]['audit_by'] = $data['audit_by'];

                $dataexport[$i]['mid_no'] = $data['mid_no'];
                $dataexport[$i]['patient_name'] = $data['patient_name'];
                $dataexport[$i]['patient_age'] = $data['patient_age'];
                $dataexport[$i]['patient_gender'] = $data['patient_gender'];
                $dataexport[$i]['location'] = $data['location'];
                $dataexport[$i]['department'] = $data['department'];
                $dataexport[$i]['attended_doctor'] = $data['attended_doctor'];
                $dataexport[$i]['initial_assessment_hr6'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr6']));
                $dataexport[$i]['discharge_date_time'] = date('Y-m-d H:i', strtotime($data['discharge_date_time']));

                $dataexport[$i]['identification_details'] = ucfirst($data['identification_details']) . "\r\nRemarks: " . $data['identification_details_text'];
                $dataexport[$i]['vital_signs'] = ucfirst($data['vital_signs']) . "\r\nRemarks: " . $data['vital_signs_text'];
                $dataexport[$i]['surgery'] = ucfirst($data['surgery']) . "\r\nRemarks: " . $data['surgery_text'];
                $dataexport[$i]['complaints_communicated'] = ucfirst($data['complaints_communicated']) . "\r\nRemarks: " . $data['complaints_communicated_text'];
                $dataexport[$i]['intake'] = ucfirst($data['intake']) . "\r\nRemarks: " . $data['intake_text'];
                $dataexport[$i]['output'] = ucfirst($data['output']) . "\r\nRemarks: " . $data['output_text'];
                $dataexport[$i]['focus'] = ucfirst($data['focus']) . "\r\nRemarks: " . $data['focus_text'];
                $dataexport[$i]['meti'] = ucfirst($data['meti']) . "\r\nRemarks: " . $data['meti_text'];

                $dataexport[$i]['diagnostic'] = ucfirst($data['diagnostic']) . "\r\nRemarks: " . $data['diagnostic_text'];
                $dataexport[$i]['lab_results'] = ucfirst($data['lab_results']) . "\r\nRemarks: " . $data['lab_results_text'];
                $dataexport[$i]['pending_investigation'] = ucfirst($data['pending_investigation']) . "\r\nRemarks: " . $data['pending_investigation_text'];
                $dataexport[$i]['medicine_order'] = ucfirst($data['medicine_order']) . "\r\nRemarks: " . $data['medicine_order_text'];

                $dataexport[$i]['psychological'] = ucfirst($data['psychological']) . "\r\nRemarks: " . $data['psychological_text'];
                $dataexport[$i]['vulnerab'] = ucfirst($data['vulnerab']) . "\r\nRemarks: " . $data['vulnerab_text'];
                $dataexport[$i]['social'] = ucfirst($data['social']) . "\r\nRemarks: " . $data['social_text'];
                $dataexport[$i]['nutri'] = ucfirst($data['nutri']) . "\r\nRemarks: " . $data['nutri_text'];
                $dataexport[$i]['spiritual'] = ucfirst($data['spiritual']) . "\r\nRemarks: " . $data['spiritual_text'];
                $dataexport[$i]['suicide'] = ucfirst($data['suicide']) . "\r\nRemarks: " . $data['suicide_text'];
                $dataexport[$i]['risk'] = ucfirst($data['risk']) . "\r\nRemarks: " . $data['risk_text'];
                $dataexport[$i]['care'] = ucfirst($data['care']) . "\r\nRemarks: " . $data['care_text'];
                $dataexport[$i]['pfe'] = ucfirst($data['pfe']) . "\r\nRemarks: " . $data['pfe_text'];
                $dataexport[$i]['disch'] = ucfirst($data['disch']) . "\r\nRemarks: " . $data['disch_text'];

                $dataexport[$i]['facility_communicated'] = ucfirst($data['facility_communicated']) . "\r\nRemarks: " . $data['facility_communicated_text'];
                $dataexport[$i]['health_education'] = ucfirst($data['health_education']) . "\r\nRemarks: " . $data['health_education_text'];
                $dataexport[$i]['remarks1'] = ucfirst($data['remarks1']) . "\r\nRemarks: " . $data['remarks1_text'];
                $dataexport[$i]['urethral'] = ucfirst($data['urethral']) . "\r\nRemarks: " . $data['urethral_text'];
                $dataexport[$i]['urine_sample'] = ucfirst($data['urine_sample']) . "\r\nRemarks: " . $data['urine_sample_text'];



                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];


                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();

            if (isset($_GET['filtertype']) && $_GET['filtertype'] === 'admission') {
                $fileName = 'EF- Active Cases MRD Audit (IP) - Filtered by Admission Date - ' . $tdate . ' to ' . $fdate . '.csv';
            } else {
                $fileName = 'EF- Active Cases MRD Audit (IP) - ' . $tdate . ' to ' . $fdate . '.csv';
            }

            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function overall_discharged_patients_mrd()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_ma_dischargedpatients_mrd_audit';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->audit_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Audit Name';
            $header[1] = 'Date & Time of Audit';
            $header[2] = 'Audit by';
            $header[3] = 'Patient MID';
            $header[4] = 'Patient Name';
            $header[5] = 'Patient Age';
            $header[6] = 'Patient Gender';

            $j = 7;

            $header[$j++] = 'Area';
            $header[$j++] = 'Department';
            $header[$j++] = 'Attended Doctor';
            $header[$j++] = 'Admission Date & Time';
            $header[$j++] = 'Discharge Date & Time';

            $header[$j++] = 'Are present complaints documented?';
            $header[$j++] = 'Is Patient History recorded properly?';
            $header[$j++] = 'Are Clinical Findings noted?';
            $header[$j++] = 'Is Admitting Diagnosis clearly mentioned?';
            $header[$j++] = 'Is Plan of Care documented?';
            $header[$j++] = 'Is Plan for Discharge prepared?';
            $header[$j++] = 'Is Patient and Family Education (PFE) provided?';
            $header[$j++] = 'Is Medication History documented accurately?';
            $header[$j++] = 'Is the use of abbreviations as per guidelines?';

            $header[$j++] = 'Are Complaints updated in the notes?';
            $header[$j++] = 'Are Investigation Findings recorded?';
            $header[$j++] = 'Are Vital signs monitored and documented?';
            $header[$j++] = 'Is Diagnosis clearly mentioned?';
            $header[$j++] = 'Is Plan for Care updated?';
            $header[$j++] = 'Is Discharge Plan communicated?';
            $header[$j++] = 'Is Nutritional Assessment done?';
            $header[$j++] = 'Is Spiritual support provided when required?';
            $header[$j++] = 'Is Copy and Paste practice avoided?';
            $header[$j++] = 'Are Critical values identified and actions taken?';
            $header[$j++] = 'Is Preoperative assessment completed?';

            $header[$j++] = 'Are ICU Initial Notes documented?';
            $header[$j++] = 'Are ICU Progress Notes updated?';
            $header[$j++] = 'Are ICU Transfer Notes properly filled?';
            $header[$j++] = 'Is ICU Handover completed?';
            $header[$j++] = 'Is Abbreviation use compliant with guidelines?';

            $header[$j++] = 'Is Pre Anaesthesia Assessment documented?';
            $header[$j++] = 'Is Pre Anaesthesia Order completed?';
            $header[$j++] = 'Are Post Procedure Notes - Anaesthesia documented?';
            $header[$j++] = 'Is Pre-Induction Assessment (PIA) completed?';
            $header[$j++] = 'Is Plan of Anaesthesia prepared?';
            $header[$j++] = 'Is Anaesthesia Record complete?';
            $header[$j++] = 'Is Consent for Anaesthesia obtained?';

            $header[$j++] = 'Is Date & Time of procedure recorded?';
            $header[$j++] = 'Is Preoperative Assessment documented?';
            $header[$j++] = 'Are Pre & Post-Operative Diagnosis recorded?';
            $header[$j++] = 'Is Surgery/Procedure Name documented?';
            $header[$j++] = 'Are Surgeon & Anaesthetist names recorded?';
            $header[$j++] = 'Are Scrub Nurse & OT Technician names documented?';
            $header[$j++] = 'Is Type of Anaesthesia & Position recorded?';
            $header[$j++] = 'Are Procedure Details documented?';
            $header[$j++] = 'Is Post-Operative Status & Orders updated?';
            $header[$j++] = 'Are Peri-Operative Complications documented?';
            $header[$j++] = 'Is the amount of blood loss documented?';
            $header[$j++] = 'Is the amount of blood transfused recorded?';

            $header[$j++] = 'Is patient identification verified before procedure?';
            $header[$j++] = 'Is the Name & Type of Anaesthesia documented?';
            $header[$j++] = 'Is the Name of Surgery/Procedure recorded?';
            $header[$j++] = 'Is the Doctor and Patient signature obtained?';
            $header[$j++] = 'Is Date & Time documented?';
            $header[$j++] = 'Is it ensured that abbreviations are not used?';
            $header[$j++] = 'Are Risk, Benefits, and Alternatives documented?';
            $header[$j++] = 'Is the legibility of Consent maintained?';

            $header[$j++] = 'Is Consultation Request documented?';
            $header[$j++] = 'Is Consultation Response documented?';
            $header[$j++] = 'Has the priority of Consultation been marked?';


            $header[$j++] = 'Are DOA, DOD, and DOS recorded?';
            $header[$j++] = 'Is Diagnosis documented?';
            $header[$j++] = 'Is Course in the Hospital recorded?';
            $header[$j++] = 'Is Cross Consultation (if applicable) documented?';
            $header[$j++] = 'Are Discharge Medications & Instructions provided?';
            $header[$j++] = 'Is Patient Condition at Discharge recorded?';
            $header[$j++] = 'Is "When to Contact" instruction given?';
            $header[$j++] = 'Is Emergency Contact information provided?';
            $header[$j++] = 'Is it ensured that no abbreviations are used?';
            $header[$j++] = 'Is Document finalized and signed?';

            $header[$j++] = 'Is ED Initial Assessment completed?';
            $header[$j++] = 'Are ED Transfer Notes documented?';
            $header[$j++] = 'Is the Triage process completed?';

            $header[$j++] = 'Is Pre and Post-Operative Checklist completed?';
            $header[$j++] = 'Is Surgical Safety Checklist followed?';
            $header[$j++] = 'Is Operation Room Count completed?';
            $header[$j++] = 'Is PACU documentation updated?';
            $header[$j++] = 'Is Anaesthesia Technician Checklist filled?';

            $header[$j++] = 'Is Pain Assessment documented?';
            $header[$j++] = 'Is Fall Risk Assessment completed?';
            $header[$j++] = 'Are Patient Needs assessed?';
            $header[$j++] = 'Is Discharge Planning done?';
            $header[$j++] = 'Is Pain Reassessment performed?';
            $header[$j++] = 'Is Fall Risk Reassessment documented?';

            $header[$j++] = 'Is End of Life (EOL) care documented?';
            $header[$j++] = 'Is Geriatric Assessment completed?';
            $header[$j++] = 'Is Psychiatric Assessment documented?';
            $header[$j++] = 'Is Chemotherapy Assessment completed?';

            $header[$j++] = 'Is Physiotherapy Initial Assessment documented?';
            $header[$j++] = 'Are Physiotherapy Progress Notes updated?';
            $header[$j++] = 'Is Narcotic Drug Form filled?';
            $header[$j++] = 'Is Blood Transfusion Form completed?';
            $header[$j++] = 'Is Sedation Assessment performed?';
            $header[$j++] = 'Is Reason for Restraint documented?';
            $header[$j++] = 'Is Type of Restraint specified?';
            $header[$j++] = 'Is Scanned Status uploaded?';
            $header[$j++] = 'Is Planned Length of Stay (LOS) documented?';
            $header[$j++] = 'Is Actual Length of Stay (LOS) documented?';
            $header[$j++] = 'Are Remarks updated?';

            $header[$j++] = 'Is Procedure Name recorded?';
            $header[$j++] = 'Is Date & Time documented?';
            $header[$j++] = 'Are Special Issues documented?';
            $header[$j++] = 'Is Condition after Procedure recorded?';
            $header[$j++] = 'Is Post Operative Care Plan documented?';

            $header[$j++] = 'Is MEWS (Modified Early Warning Score) assessment done?';
            $header[$j++] = 'Is ABC (Airway, Breathing, Circulation) check completed?';
            $header[$j++] = 'Is Pain Reassessment performed?';
            $header[$j++] = 'Are Lines and Tubes checked and documented?';
            $header[$j++] = 'Is Care Bundle followed?';

            $header[$j++] = 'Are Types of Handover documented?';
            $header[$j++] = 'Is Date and Time recorded?';
            $header[$j++] = 'Are Handover Details documented?';

            $header[$j++] = 'Is Date and Time recorded?';
            $header[$j++] = 'Is Reason for Transfer specified?';
            $header[$j++] = 'Is Name of Procedure documented?';
            $header[$j++] = 'Are From & To Departments mentioned?';
            $header[$j++] = 'Are Handover Details updated?';
            $header[$j++] = 'Are Takeover Details recorded?';

            $header[$j++] = 'Is Date and Time documented?';
            $header[$j++] = 'Is Type of Restraint specified?';
            $header[$j++] = 'Is Location documented?';
            $header[$j++] = 'Is Reassessment completed?';
            $header[$j++] = 'Are Discontinued Details recorded?';

            $header[$j++] = 'Is Date and Time documented?';
            $header[$j++] = 'Is Bag Number documented?';
            $header[$j++] = 'Is Date of Expiry mentioned?';
            $header[$j++] = 'Are Start and End Date with Time documented?';
            $header[$j++] = 'Are Verification Details recorded?';
            $header[$j++] = 'Are Vitals recorded?';

            $header[$j++] = 'Is Sign-In Date and Time recorded?';
            $header[$j++] = 'Are Co-Morbidities documented?';
            $header[$j++] = 'Is Time-Out Date and Time documented?';
            $header[$j++] = 'Is Patient & Procedure Identification confirmed?';
            $header[$j++] = 'Is Sign-Out Date and Time recorded?';
            $header[$j++] = 'Are Specimen Details documented?';
            $header[$j++] = 'Are Transfer Details recorded?';
            $header[$j++] = 'Are Handover Details updated?';

            $header[$j++] = 'Is Sign-In Date and Time recorded?';
            $header[$j++] = 'Are Identification Details documented?';
            $header[$j++] = 'Is Time-Out Date and Time recorded?';
            $header[$j++] = 'Is Confirmation by Team done?';
            $header[$j++] = 'Is Sign-Out Date and Time recorded?';
            $header[$j++] = 'Are Count and Specimen details documented?';
            $header[$j++] = 'Are Transfer Details recorded?';
            $header[$j++] = 'Are Handover Details documented?';

            $header[$j++] = 'Is Mallampati Score recorded?';
            $header[$j++] = 'Is ASA (American Society of Anesthesiologists) classification documented?';
            $header[$j++] = 'Are Intra-Procedural Vitals monitored and recorded?';
            $header[$j++] = 'Are Post-Sedation Vitals documented?';
            $header[$j++] = 'Is Discharge Note completed?';

            $header[$j++] = 'Is Stroke Timeline entry completed?';
            $header[$j++] = 'Is NIHSS score documented in initial notes (ED/IP)?';
            $header[$j++] = 'Is Initial GRBS documented at admission?';
            $header[$j++] = 'Are Consent forms for IV Thrombolysis / Mechanical Thrombectomy completed?';
            $header[$j++] = 'Is Informed Refusal form documented (if applicable)?';
            $header[$j++] = 'Is Post-Thrombolysis Monitoring form completed?';
            $header[$j++] = 'Does the record contain admission reasons, assessments, diagnosis, investigations, procedures, monitoring, and care details?';
            $header[$j++] = 'Is documentation provided if an eligible ischemic stroke patient did not receive IV thrombolytic therapy?';
            $header[$j++] = 'Is Pre-morbid mRS documented in all initial IP notes?';
            $header[$j++] = 'Are key infection control indicators defined and measured (Hand Hygiene, CAUTI, CLABSI, VAP, SSI)?';
            $header[$j++] = 'Are all assessments documented and signed/authenticated by staff?';
            $header[$j++] = 'Do assessments result in appropriate care/monitoring plans that are documented?';
            $header[$j++] = 'Is Dysphagia Screening documented before starting oral feeds?';
            $header[$j++] = 'Is Nutritional Screening documented for all patients?';
            $header[$j++] = 'Is Care guided by functional assessment and periodic reassessments documented?';
            $header[$j++] = 'Are Assessments completed within 24 hours of admission or once patient is stable?';
            $header[$j++] = 'Does the Discharge/Treatment summary include instructions for urgent care?';
            $header[$j++] = 'Are NIHSS / mRS scores documented at discharge?';
            $header[$j++] = 'In case of death, does the record include a Death Summary?';

            $header[$j++] = 'Is there missing/ incomplete documentation related to Medico-Legal Case?';
            $header[$j++] = 'Does the record reflect accurate and timely documentation of death details?';



            $header[$j++] = 'Additional comments';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['audit_type'] = $data['audit_type'];
                $dataexport[$i]['date'] = date('Y-m-d H:i', strtotime($row->datetime));
                $dataexport[$i]['audit_by'] = $data['audit_by'];

                $dataexport[$i]['mid_no'] = $data['mid_no'];
                $dataexport[$i]['patient_name'] = $data['patient_name'];
                $dataexport[$i]['patient_age'] = $data['patient_age'];
                $dataexport[$i]['patient_gender'] = $data['patient_gender'];
                $dataexport[$i]['location'] = $data['location'];
                $dataexport[$i]['department'] = $data['department'];
                $dataexport[$i]['attended_doctor'] = $data['attended_doctor'];
                $dataexport[$i]['initial_assessment_hr6'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr6']));
                $dataexport[$i]['discharge_date_time'] = date('Y-m-d H:i', strtotime($data['discharge_date_time']));



                $dataexport[$i]['identification_details'] = ucfirst($data['identification_details']) . "\r\nRemarks: " . $data['identification_details_text'];
                $dataexport[$i]['vital_signs'] = ucfirst($data['vital_signs']) . "\r\nRemarks: " . $data['vital_signs_text'];
                $dataexport[$i]['surgery'] = ucfirst($data['surgery']) . "\r\nRemarks: " . $data['surgery_text'];
                $dataexport[$i]['complaints_communicated'] = ucfirst($data['complaints_communicated']) . "\r\nRemarks: " . $data['complaints_communicated_text'];
                $dataexport[$i]['intake'] = ucfirst($data['intake']) . "\r\nRemarks: " . $data['intake_text'];
                $dataexport[$i]['output'] = ucfirst($data['output']) . "\r\nRemarks: " . $data['output_text'];
                $dataexport[$i]['focus'] = ucfirst($data['focus']) . "\r\nRemarks: " . $data['focus_text'];
                $dataexport[$i]['meti'] = ucfirst($data['meti']) . "\r\nRemarks: " . $data['meti_text'];
                $dataexport[$i]['diagnostic'] = ucfirst($data['diagnostic']) . "\r\nRemarks: " . $data['diagnostic_text'];
                $dataexport[$i]['lab_results'] = ucfirst($data['lab_results']) . "\r\nRemarks: " . $data['lab_results_text'];
                $dataexport[$i]['pending_investigation'] = ucfirst($data['pending_investigation']) . "\r\nRemarks: " . $data['pending_investigation_text'];
                $dataexport[$i]['medicine_order'] = ucfirst($data['medicine_order']) . "\r\nRemarks: " . $data['medicine_order_text'];
                $dataexport[$i]['psychological'] = ucfirst($data['psychological']) . "\r\nRemarks: " . $data['psychological_text'];
                $dataexport[$i]['vulnerab'] = ucfirst($data['vulnerab']) . "\r\nRemarks: " . $data['vulnerab_text'];
                $dataexport[$i]['social'] = ucfirst($data['social']) . "\r\nRemarks: " . $data['social_text'];


                $dataexport[$i]['nutri'] = ucfirst($data['nutri']) . "\r\nRemarks: " . $data['nutri_text'];
                $dataexport[$i]['spiritual'] = ucfirst($data['spiritual']) . "\r\nRemarks: " . $data['spiritual_text'];
                $dataexport[$i]['suicide'] = ucfirst($data['suicide']) . "\r\nRemarks: " . $data['suicide_text'];
                $dataexport[$i]['risk'] = ucfirst($data['risk']) . "\r\nRemarks: " . $data['risk_text'];
                $dataexport[$i]['care'] = ucfirst($data['care']) . "\r\nRemarks: " . $data['care_text'];
                $dataexport[$i]['pfe'] = ucfirst($data['pfe']) . "\r\nRemarks: " . $data['pfe_text'];
                $dataexport[$i]['disch'] = ucfirst($data['disch']) . "\r\nRemarks: " . $data['disch_text'];
                $dataexport[$i]['facility_communicated'] = ucfirst($data['facility_communicated']) . "\r\nRemarks: " . $data['facility_communicated_text'];
                $dataexport[$i]['health_education'] = ucfirst($data['health_education']) . "\r\nRemarks: " . $data['health_education_text'];
                $dataexport[$i]['remarks1'] = ucfirst($data['remarks1']) . "\r\nRemarks: " . $data['remarks1_text'];
                $dataexport[$i]['urethral'] = ucfirst($data['urethral']) . "\r\nRemarks: " . $data['urethral_text'];
                $dataexport[$i]['urine_sample'] = ucfirst($data['urine_sample']) . "\r\nRemarks: " . $data['urine_sample_text'];
                $dataexport[$i]['bystander'] = ucfirst($data['bystander']) . "\r\nRemarks: " . $data['bystander_text'];
                $dataexport[$i]['instruments'] = ucfirst($data['instruments']) . "\r\nRemarks: " . $data['instruments_text'];
                $dataexport[$i]['sterile'] = ucfirst($data['sterile']) . "\r\nRemarks: " . $data['sterile_text'];
                $dataexport[$i]['antibiotics'] = ucfirst($data['antibiotics']) . "\r\nRemarks: " . $data['antibiotics_text'];
                $dataexport[$i]['surgical_site'] = ucfirst($data['surgical_site']) . "\r\nRemarks: " . $data['surgical_site_text'];
                $dataexport[$i]['wound'] = ucfirst($data['wound']) . "\r\nRemarks: " . $data['wound_text'];
                $dataexport[$i]['documented'] = ucfirst($data['documented']) . "\r\nRemarks: " . $data['documented_text'];
                $dataexport[$i]['adequate_facilities'] = ucfirst($data['adequate_facilities']) . "\r\nRemarks: " . $data['adequate_facilities_text'];
                $dataexport[$i]['sufficient_lighting'] = ucfirst($data['sufficient_lighting']) . "\r\nRemarks: " . $data['sufficient_lighting_text'];
                $dataexport[$i]['storage_facility_for_food'] = ucfirst($data['storage_facility_for_food']) . "\r\nRemarks: " . $data['storage_facility_for_food_text'];
                $dataexport[$i]['personnel_hygiene_facilities'] = ucfirst($data['personnel_hygiene_facilities']) . "\r\nRemarks: " . $data['personnel_hygiene_facilities_text'];
                $dataexport[$i]['food_material_testing'] = ucfirst($data['food_material_testing']) . "\r\nRemarks: " . $data['food_material_testing_text'];
                $dataexport[$i]['incoming_material'] = ucfirst($data['incoming_material']) . "\r\nRemarks: " . $data['incoming_material_text'];
                $dataexport[$i]['raw_materials_inspection'] = ucfirst($data['raw_materials_inspection']) . "\r\nRemarks: " . $data['raw_materials_inspection_text'];
                $dataexport[$i]['storage_of_materials'] = ucfirst($data['storage_of_materials']) . "\r\nRemarks: " . $data['storage_of_materials_text'];
                $dataexport[$i]['raw_materials_cleaning'] = ucfirst($data['raw_materials_cleaning']) . "\r\nRemarks: " . $data['raw_materials_cleaning_text'];
                $dataexport[$i]['equipment_sanitization'] = ucfirst($data['equipment_sanitization']) . "\r\nRemarks: " . $data['equipment_sanitization_text'];
                $dataexport[$i]['frozen_food_thawing'] = ucfirst($data['frozen_food_thawing']) . "\r\nRemarks: " . $data['frozen_food_thawing_text'];
                $dataexport[$i]['vegetarian_and_non_vegetarian'] = ucfirst($data['vegetarian_and_non_vegetarian']) . "\r\nRemarks: " . $data['vegetarian_and_non_vegetarian_text'];
                $dataexport[$i]['cooked_food_cooling'] = ucfirst($data['cooked_food_cooling']) . "\r\nRemarks: " . $data['cooked_food_cooling_text'];
                $dataexport[$i]['food_portioning'] = ucfirst($data['food_portioning']) . "\r\nRemarks: " . $data['food_portioning_text'];


                $dataexport[$i]['ab1'] = ucfirst($data['ab1']) . "\r\nRemarks: " . $data['ab1_text'];
                $dataexport[$i]['ab2'] = ucfirst($data['ab2']) . "\r\nRemarks: " . $data['ab2_text'];
                $dataexport[$i]['ab3'] = ucfirst($data['ab3']) . "\r\nRemarks: " . $data['ab3_text'];
                $dataexport[$i]['ab4'] = ucfirst($data['ab4']) . "\r\nRemarks: " . $data['ab4_text'];
                $dataexport[$i]['ab5'] = ucfirst($data['ab5']) . "\r\nRemarks: " . $data['ab5_text'];
                $dataexport[$i]['ab6'] = ucfirst($data['ab6']) . "\r\nRemarks: " . $data['ab6_text'];
                $dataexport[$i]['ab7'] = ucfirst($data['ab7']) . "\r\nRemarks: " . $data['ab7_text'];
                $dataexport[$i]['ab8'] = ucfirst($data['ab8']) . "\r\nRemarks: " . $data['ab8_text'];
                $dataexport[$i]['ab9'] = ucfirst($data['ab9']) . "\r\nRemarks: " . $data['ab9_text'];
                $dataexport[$i]['ab10'] = ucfirst($data['ab10']) . "\r\nRemarks: " . $data['ab10_text'];
                $dataexport[$i]['ab11'] = ucfirst($data['ab11']) . "\r\nRemarks: " . $data['ab11_text'];
                $dataexport[$i]['ab12'] = ucfirst($data['ab12']) . "\r\nRemarks: " . $data['ab12_text'];
                $dataexport[$i]['ab13'] = ucfirst($data['ab13']) . "\r\nRemarks: " . $data['ab13_text'];
                $dataexport[$i]['ab14'] = ucfirst($data['ab14']) . "\r\nRemarks: " . $data['ab14_text'];
                $dataexport[$i]['ab15'] = ucfirst($data['ab15']) . "\r\nRemarks: " . $data['ab15_text'];
                $dataexport[$i]['ab16'] = ucfirst($data['ab16']) . "\r\nRemarks: " . $data['ab16_text'];
                $dataexport[$i]['ab17'] = ucfirst($data['ab17']) . "\r\nRemarks: " . $data['ab17_text'];
                $dataexport[$i]['ab18'] = ucfirst($data['ab18']) . "\r\nRemarks: " . $data['ab18_text'];
                $dataexport[$i]['ab19'] = ucfirst($data['ab19']) . "\r\nRemarks: " . $data['ab19_text'];
                $dataexport[$i]['ab20'] = ucfirst($data['ab20']) . "\r\nRemarks: " . $data['ab20_text'];
                $dataexport[$i]['ab21'] = ucfirst($data['ab21']) . "\r\nRemarks: " . $data['ab21_text'];
                $dataexport[$i]['ab22'] = ucfirst($data['ab22']) . "\r\nRemarks: " . $data['ab22_text'];
                $dataexport[$i]['ab23'] = ucfirst($data['ab23']) . "\r\nRemarks: " . $data['ab23_text'];
                $dataexport[$i]['ab24'] = ucfirst($data['ab24']) . "\r\nRemarks: " . $data['ab24_text'];
                $dataexport[$i]['ab25'] = ucfirst($data['ab25']) . "\r\nRemarks: " . $data['ab25_text'];
                $dataexport[$i]['ab26'] = ucfirst($data['ab26']) . "\r\nRemarks: " . $data['ab26_text'];
                $dataexport[$i]['ab27'] = ucfirst($data['ab27']) . "\r\nRemarks: " . $data['ab27_text'];
                $dataexport[$i]['ab28'] = ucfirst($data['ab28']) . "\r\nRemarks: " . $data['ab28_text'];
                $dataexport[$i]['ab29'] = ucfirst($data['ab29']) . "\r\nRemarks: " . $data['ab29_text'];
                $dataexport[$i]['ab30'] = ucfirst($data['ab30']) . "\r\nRemarks: " . $data['ab30_text'];
                $dataexport[$i]['ab31'] = ucfirst($data['ab31']) . "\r\nRemarks: " . $data['ab31_text'];
                $dataexport[$i]['ab32'] = ucfirst($data['ab32']) . "\r\nRemarks: " . $data['ab32_text'];
                $dataexport[$i]['ab33'] = ucfirst($data['ab33']) . "\r\nRemarks: " . $data['ab33_text'];
                $dataexport[$i]['ab34'] = ucfirst($data['ab34']) . "\r\nRemarks: " . $data['ab34_text'];
                $dataexport[$i]['ab35'] = ucfirst($data['ab35']) . "\r\nRemarks: " . $data['ab35_text'];
                $dataexport[$i]['ab36'] = ucfirst($data['ab36']) . "\r\nRemarks: " . $data['ab36_text'];
                $dataexport[$i]['ab37'] = ucfirst($data['ab37']) . "\r\nRemarks: " . $data['ab37_text'];
                $dataexport[$i]['ab38'] = ucfirst($data['ab38']) . "\r\nRemarks: " . $data['ab38_text'];
                $dataexport[$i]['ab39'] = ucfirst($data['ab39']) . "\r\nRemarks: " . $data['ab39_text'];
                $dataexport[$i]['ab40'] = ucfirst($data['ab40']) . "\r\nRemarks: " . $data['ab40_text'];
                $dataexport[$i]['ab41'] = ucfirst($data['ab41']) . "\r\nRemarks: " . $data['ab41_text'];
                $dataexport[$i]['ab42'] = ucfirst($data['ab42']) . "\r\nRemarks: " . $data['ab42_text'];
                $dataexport[$i]['ab43'] = ucfirst($data['ab43']) . "\r\nRemarks: " . $data['ab43_text'];
                $dataexport[$i]['ab44'] = ucfirst($data['ab44']) . "\r\nRemarks: " . $data['ab44_text'];
                $dataexport[$i]['ab45'] = ucfirst($data['ab45']) . "\r\nRemarks: " . $data['ab45_text'];
                $dataexport[$i]['ab46'] = ucfirst($data['ab46']) . "\r\nRemarks: " . $data['ab46_text'];
                $dataexport[$i]['ab47'] = ucfirst($data['ab47']) . "\r\nRemarks: " . $data['ab47_text'];
                $dataexport[$i]['ab48'] = ucfirst($data['ab48']) . "\r\nRemarks: " . $data['ab48_text'];
                $dataexport[$i]['ab49'] = ucfirst($data['ab49']) . "\r\nRemarks: " . $data['ab49_text'];
                $dataexport[$i]['ab50'] = ucfirst($data['ab50']) . "\r\nRemarks: " . $data['ab50_text'];
                $dataexport[$i]['ab51'] = ucfirst($data['ab51']) . "\r\nRemarks: " . $data['ab51_text'];
                $dataexport[$i]['ab52'] = ucfirst($data['ab52']) . "\r\nRemarks: " . $data['ab52_text'];
                $dataexport[$i]['ab53'] = ucfirst($data['ab53']) . "\r\nRemarks: " . $data['ab53_text'];
                $dataexport[$i]['ab54'] = ucfirst($data['ab54']) . "\r\nRemarks: " . $data['ab54_text'];
                $dataexport[$i]['ab55'] = ucfirst($data['ab55']) . "\r\nRemarks: " . $data['ab55_text'];
                $dataexport[$i]['ab56'] = ucfirst($data['ab56']) . "\r\nRemarks: " . $data['ab56_text'];
                $dataexport[$i]['ab57'] = ucfirst($data['ab57']) . "\r\nRemarks: " . $data['ab57_text'];
                $dataexport[$i]['ab58'] = ucfirst($data['ab58']) . "\r\nRemarks: " . $data['ab58_text'];
                $dataexport[$i]['ab59'] = ucfirst($data['ab59']) . "\r\nRemarks: " . $data['ab59_text'];
                $dataexport[$i]['ab60'] = ucfirst($data['ab60']) . "\r\nRemarks: " . $data['ab60_text'];
                $dataexport[$i]['ab61'] = ucfirst($data['ab61']) . "\r\nRemarks: " . $data['ab61_text'];
                $dataexport[$i]['ab62'] = ucfirst($data['ab62']) . "\r\nRemarks: " . $data['ab62_text'];
                $dataexport[$i]['ab63'] = ucfirst($data['ab63']) . "\r\nRemarks: " . $data['ab63_text'];
                $dataexport[$i]['ab64'] = ucfirst($data['ab64']) . "\r\nRemarks: " . $data['ab64_text'];
                $dataexport[$i]['ab65'] = ucfirst($data['ab65']) . "\r\nRemarks: " . $data['ab65_text'];
                $dataexport[$i]['ab66'] = ucfirst($data['ab66']) . "\r\nRemarks: " . $data['ab66_text'];
                $dataexport[$i]['ab67'] = ucfirst($data['ab67']) . "\r\nRemarks: " . $data['ab67_text'];
                $dataexport[$i]['ab68'] = ucfirst($data['ab68']) . "\r\nRemarks: " . $data['ab68_text'];
                $dataexport[$i]['ab69'] = ucfirst($data['ab69']) . "\r\nRemarks: " . $data['ab69_text'];
                $dataexport[$i]['ab70'] = ucfirst($data['ab70']) . "\r\nRemarks: " . $data['ab70_text'];

                $dataexport[$i]['ab71'] = ucfirst($data['ab71']) . "\r\nRemarks: " . $data['ab71_text'];
                $dataexport[$i]['ab72'] = ucfirst($data['ab72']) . "\r\nRemarks: " . $data['ab72_text'];
                $dataexport[$i]['ab73'] = ucfirst($data['ab73']) . "\r\nRemarks: " . $data['ab73_text'];
                $dataexport[$i]['ab74'] = ucfirst($data['ab74']) . "\r\nRemarks: " . $data['ab74_text'];
                $dataexport[$i]['ab75'] = ucfirst($data['ab75']) . "\r\nRemarks: " . $data['ab75_text'];
                $dataexport[$i]['ab76'] = ucfirst($data['ab76']) . "\r\nRemarks: " . $data['ab76_text'];
                $dataexport[$i]['ab77'] = ucfirst($data['ab77']) . "\r\nRemarks: " . $data['ab77_text'];
                $dataexport[$i]['ab78'] = ucfirst($data['ab78']) . "\r\nRemarks: " . $data['ab78_text'];
                $dataexport[$i]['ab79'] = ucfirst($data['ab79']) . "\r\nRemarks: " . $data['ab79_text'];
                $dataexport[$i]['ab80'] = ucfirst($data['ab80']) . "\r\nRemarks: " . $data['ab80_text'];
                $dataexport[$i]['ab81'] = ucfirst($data['ab81']) . "\r\nRemarks: " . $data['ab81_text'];
                $dataexport[$i]['ab82'] = ucfirst($data['ab82']) . "\r\nRemarks: " . $data['ab82_text'];
                $dataexport[$i]['ab83'] = ucfirst($data['ab83']) . "\r\nRemarks: " . $data['ab83_text'];
                $dataexport[$i]['ab84'] = ucfirst($data['ab84']) . "\r\nRemarks: " . $data['ab84_text'];
                $dataexport[$i]['ab85'] = ucfirst($data['ab85']) . "\r\nRemarks: " . $data['ab85_text'];
                $dataexport[$i]['ab86'] = ucfirst($data['ab86']) . "\r\nRemarks: " . $data['ab86_text'];
                $dataexport[$i]['ab87'] = ucfirst($data['ab87']) . "\r\nRemarks: " . $data['ab87_text'];
                $dataexport[$i]['ab88'] = ucfirst($data['ab88']) . "\r\nRemarks: " . $data['ab88_text'];
                $dataexport[$i]['ab89'] = ucfirst($data['ab89']) . "\r\nRemarks: " . $data['ab89_text'];
                $dataexport[$i]['ab90'] = ucfirst($data['ab90']) . "\r\nRemarks: " . $data['ab90_text'];
                $dataexport[$i]['ab100'] = ucfirst($data['ab100']) . "\r\nRemarks: " . $data['ab100_text'];
                $dataexport[$i]['ab101'] = ucfirst($data['ab101']) . "\r\nRemarks: " . $data['ab101_text'];
                $dataexport[$i]['ab102'] = ucfirst($data['ab102']) . "\r\nRemarks: " . $data['ab102_text'];
                $dataexport[$i]['ab103'] = ucfirst($data['ab103']) . "\r\nRemarks: " . $data['ab103_text'];
                $dataexport[$i]['ab104'] = ucfirst($data['ab104']) . "\r\nRemarks: " . $data['ab104_text'];
                $dataexport[$i]['ab105'] = ucfirst($data['ab105']) . "\r\nRemarks: " . $data['ab105_text'];
                $dataexport[$i]['ab106'] = ucfirst($data['ab106']) . "\r\nRemarks: " . $data['ab106_text'];
                $dataexport[$i]['ab107'] = ucfirst($data['ab107']) . "\r\nRemarks: " . $data['ab107_text'];
                $dataexport[$i]['ab108'] = ucfirst($data['ab108']) . "\r\nRemarks: " . $data['ab108_text'];
                $dataexport[$i]['ab109'] = ucfirst($data['ab109']) . "\r\nRemarks: " . $data['ab109_text'];
                $dataexport[$i]['ab110'] = ucfirst($data['ab110']) . "\r\nRemarks: " . $data['ab110_text'];
                $dataexport[$i]['ab111'] = ucfirst($data['ab111']) . "\r\nRemarks: " . $data['ab111_text'];
                $dataexport[$i]['ab112'] = ucfirst($data['ab112']) . "\r\nRemarks: " . $data['ab112_text'];
                $dataexport[$i]['ab113'] = ucfirst($data['ab113']) . "\r\nRemarks: " . $data['ab113_text'];
                $dataexport[$i]['ab114'] = ucfirst($data['ab114']) . "\r\nRemarks: " . $data['ab114_text'];
                $dataexport[$i]['ab115'] = ucfirst($data['ab115']) . "\r\nRemarks: " . $data['ab115_text'];
                $dataexport[$i]['ab116'] = ucfirst($data['ab116']) . "\r\nRemarks: " . $data['ab116_text'];
                $dataexport[$i]['ab117'] = ucfirst($data['ab117']) . "\r\nRemarks: " . $data['ab117_text'];
                $dataexport[$i]['ab118'] = ucfirst($data['ab118']) . "\r\nRemarks: " . $data['ab118_text'];
                $dataexport[$i]['ab119'] = ucfirst($data['ab119']) . "\r\nRemarks: " . $data['ab119_text'];
                $dataexport[$i]['ab120'] = ucfirst($data['ab120']) . "\r\nRemarks: " . $data['ab120_text'];
                $dataexport[$i]['ab121'] = ucfirst($data['ab121']) . "\r\nRemarks: " . $data['ab121_text'];
                $dataexport[$i]['ab122'] = ucfirst($data['ab122']) . "\r\nRemarks: " . $data['ab122_text'];
                $dataexport[$i]['ab123'] = ucfirst($data['ab123']) . "\r\nRemarks: " . $data['ab123_text'];
                $dataexport[$i]['ab124'] = ucfirst($data['ab124']) . "\r\nRemarks: " . $data['ab124_text'];
                $dataexport[$i]['ab125'] = ucfirst($data['ab125']) . "\r\nRemarks: " . $data['ab125_text'];
                $dataexport[$i]['ab126'] = ucfirst($data['ab126']) . "\r\nRemarks: " . $data['ab126_text'];
                $dataexport[$i]['ab127'] = ucfirst($data['ab127']) . "\r\nRemarks: " . $data['ab127_text'];


                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];


                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- Discharged Patients MRD Audit - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function overall_nursing_ip_closed()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_ma_nursingip_closed_cases';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->audit_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Audit Name';
            $header[1] = 'Date & Time of Audit';
            $header[2] = 'Audit by';
            $header[3] = 'Patient MID';
            $header[4] = 'Patient Name';
            $header[5] = 'Patient Age';
            $header[6] = 'Patient Gender';

            $j = 7;

            $header[$j++] = 'Area';
            $header[$j++] = 'Department';
            $header[$j++] = 'Attended Doctor';
            $header[$j++] = 'Admission Date & Time';
            $header[$j++] = 'Discharge Date & Time';

            $header[$j++] = 'Are allergy entries documented?';
            $header[$j++] = 'Are verbal/telephonic orders compliant with IPSG:2?';
            $header[$j++] = 'Are all medication orders administered through HIS (eMAR)?';
            $header[$j++] = 'Is triage documentation in emergency recorded?';
            $header[$j++] = 'Is compliance to blood transfusion monitoring recorded?';
            $header[$j++] = 'Is intra-cath monitoring performed?';
            $header[$j++] = 'Is post-cath monitoring performed?';
            $header[$j++] = 'Is pre-cath monitoring performed?';
            $header[$j++] = 'Does the discharge process checklist assess transportation needs (Daycare, ED, IPD)?';
            $header[$j++] = 'In the Haemodialysis Record, is there evidence of pain screening during initial assessment?';
            $header[$j++] = 'In the Mobile ICU transfer record, is there evidence of patient handover to another facility?';
            $header[$j++] = 'In the Mobile ICU transfer record, is the patient monitoring form available in the ambulance?';
            $header[$j++] = 'Is the ability to learn, barriers to learning, and learning needs documented?';
            $header[$j++] = 'Is the care plan documentation available?';
            $header[$j++] = 'Is fall risk reassessment completed in every shift?';
            $header[$j++] = 'Is shift-to-shift handover entry available?';
            $header[$j++] = 'Is handover during inter-department transfer documented?';
            $header[$j++] = 'Are invasive lines records documented?';
            $header[$j++] = 'Is MEWS monitoring in wards done as per policy?';
            $header[$j++] = 'Is pain reassessment recorded, if applicable?';
            $header[$j++] = 'Is risk of self-harm assessment documented, if applicable?';
            $header[$j++] = 'Is the ability to learn, barriers to learning, and learning needs documented?';
            $header[$j++] = 'Is the care plan documentation available?';
            $header[$j++] = 'Is fall risk assessment completed within 2 hours of admission?';
            $header[$j++] = 'Is fall risk reassessment completed, if applicable?';
            $header[$j++] = 'Is nursing initial assessment completed within 60 minutes?';
            $header[$j++] = 'Is pain reassessment recorded, if applicable?';
            $header[$j++] = 'Is pain screening done during initial assessment?';
            $header[$j++] = 'Is patient and family education status documented?';
            $header[$j++] = 'Is screening for abuse and neglect during initial assessment documented?';
            $header[$j++] = 'Is screening for alcohol or drug dependency during initial assessment documented?';
            $header[$j++] = 'Is the ability to learn, barriers to learning, and learning needs documented?';
            $header[$j++] = 'Is the care plan documentation available?';
            $header[$j++] = 'Is fall risk screening completed within 30 minutes of registration/billing?';
            $header[$j++] = 'Is nursing initial assessment completed within 30 minutes?';
            $header[$j++] = 'Is pain screening done during initial assessment?';
            $header[$j++] = 'Is patient and family education status documented?';
            $header[$j++] = 'Is screening for abuse and neglect during initial assessment documented?';
            $header[$j++] = 'Is screening for alcohol or drug dependency during initial assessment documented?';
            $header[$j++] = 'Is the ability to learn, barriers to learning, and learning needs documented?';
            $header[$j++] = 'Is care plan documentation available?';
            $header[$j++] = 'Is fall risk assessment completed within 2 hours of admission?';
            $header[$j++] = 'Is nursing initial assessment completed within 4 hours for ICU patients?';
            $header[$j++] = 'Is nursing initial assessment completed within 6 hours for ward patients?';
            $header[$j++] = 'Is pain screening done during initial assessment?';
            $header[$j++] = 'Is patient and family education status documented?';
            $header[$j++] = 'Is screening for abuse and neglect during initial assessment documented?';
            $header[$j++] = 'Is screening for alcohol or drug dependency during initial assessment documented?';
            $header[$j++] = 'Is care plan documentation recorded?';
            $header[$j++] = 'Is fall risk reassessment completed every shift for post-surgery patients?';
            $header[$j++] = 'Are vitals monitored in PACU recorded?';
            $header[$j++] = 'Is pain reassessment recorded, if applicable?';
            $header[$j++] = 'Is procedure safety checklist documented outside OT (e.g., Endoscopy, ENT, OPD Procedure Room, Radiology, Urology)?';
            $header[$j++] = 'Does the sedation documentation include pre-sedation assessment?';
            $header[$j++] = 'Does the sedation documentation include pre-sedation assessment and monitoring during endoscopy, ED, or ICU?';
            $header[$j++] = 'Is sign-in recorded?';
            $header[$j++] = 'Is sign-out recorded?';
            $header[$j++] = 'Is time-out recorded?';


            $header[$j++] = 'Additional comments';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['audit_type'] = $data['audit_type'];
                $dataexport[$i]['date'] = date('Y-m-d H:i', strtotime($row->datetime));
                $dataexport[$i]['audit_by'] = $data['audit_by'];

                $dataexport[$i]['mid_no'] = $data['mid_no'];
                $dataexport[$i]['patient_name'] = $data['patient_name'];
                $dataexport[$i]['patient_age'] = $data['patient_age'];
                $dataexport[$i]['patient_gender'] = $data['patient_gender'];
                $dataexport[$i]['location'] = $data['location'];
                $dataexport[$i]['department'] = $data['department'];
                $dataexport[$i]['attended_doctor'] = $data['attended_doctor'];
                $dataexport[$i]['initial_assessment_hr6'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr6']));
                $dataexport[$i]['discharge_date_time'] = date('Y-m-d H:i', strtotime($data['discharge_date_time']));

                $dataexport[$i]['identification_details'] = ucfirst($data['identification_details']) . "\r\nRemarks: " . $data['identification_details_text'];
                $dataexport[$i]['vital_signs'] = ucfirst($data['vital_signs']) . "\r\nRemarks: " . $data['vital_signs_text'];
                $dataexport[$i]['surgery'] = ucfirst($data['surgery']) . "\r\nRemarks: " . $data['surgery_text'];
                $dataexport[$i]['complaints_communicated'] = ucfirst($data['complaints_communicated']) . "\r\nRemarks: " . $data['complaints_communicated_text'];
                $dataexport[$i]['intake'] = ucfirst($data['intake']) . "\r\nRemarks: " . $data['intake_text'];
                $dataexport[$i]['output'] = ucfirst($data['output']) . "\r\nRemarks: " . $data['output_text'];
                $dataexport[$i]['focus'] = ucfirst($data['focus']) . "\r\nRemarks: " . $data['focus_text'];
                $dataexport[$i]['meti'] = ucfirst($data['meti']) . "\r\nRemarks: " . $data['meti_text'];
                $dataexport[$i]['diagnostic'] = ucfirst($data['diagnostic']) . "\r\nRemarks: " . $data['diagnostic_text'];
                $dataexport[$i]['lab_results'] = ucfirst($data['lab_results']) . "\r\nRemarks: " . $data['lab_results_text'];
                $dataexport[$i]['pending_investigation'] = ucfirst($data['pending_investigation']) . "\r\nRemarks: " . $data['pending_investigation_text'];
                $dataexport[$i]['medicine_order'] = ucfirst($data['medicine_order']) . "\r\nRemarks: " . $data['medicine_order_text'];
                $dataexport[$i]['psychological'] = ucfirst($data['psychological']) . "\r\nRemarks: " . $data['psychological_text'];
                $dataexport[$i]['vulnerab'] = ucfirst($data['vulnerab']) . "\r\nRemarks: " . $data['vulnerab_text'];
                $dataexport[$i]['social'] = ucfirst($data['social']) . "\r\nRemarks: " . $data['social_text'];

                $dataexport[$i]['nutri'] = ucfirst($data['nutri']) . "\r\nRemarks: " . $data['nutri_text'];
                $dataexport[$i]['spiritual'] = ucfirst($data['spiritual']) . "\r\nRemarks: " . $data['spiritual_text'];
                $dataexport[$i]['suicide'] = ucfirst($data['suicide']) . "\r\nRemarks: " . $data['suicide_text'];
                $dataexport[$i]['risk'] = ucfirst($data['risk']) . "\r\nRemarks: " . $data['risk_text'];
                $dataexport[$i]['care'] = ucfirst($data['care']) . "\r\nRemarks: " . $data['care_text'];
                $dataexport[$i]['pfe'] = ucfirst($data['pfe']) . "\r\nRemarks: " . $data['pfe_text'];
                $dataexport[$i]['disch'] = ucfirst($data['disch']) . "\r\nRemarks: " . $data['disch_text'];
                $dataexport[$i]['facility_communicated'] = ucfirst($data['facility_communicated']) . "\r\nRemarks: " . $data['facility_communicated_text'];
                $dataexport[$i]['health_education'] = ucfirst($data['health_education']) . "\r\nRemarks: " . $data['health_education_text'];
                $dataexport[$i]['remarks1'] = ucfirst($data['remarks1']) . "\r\nRemarks: " . $data['remarks1_text'];
                $dataexport[$i]['urethral'] = ucfirst($data['urethral']) . "\r\nRemarks: " . $data['urethral_text'];

                $dataexport[$i]['bystander'] = ucfirst($data['bystander']) . "\r\nRemarks: " . $data['bystander_text'];
                $dataexport[$i]['instruments'] = ucfirst($data['instruments']) . "\r\nRemarks: " . $data['instruments_text'];
                $dataexport[$i]['sterile'] = ucfirst($data['sterile']) . "\r\nRemarks: " . $data['sterile_text'];
                $dataexport[$i]['antibiotics'] = ucfirst($data['antibiotics']) . "\r\nRemarks: " . $data['antibiotics_text'];
                $dataexport[$i]['surgical_site'] = ucfirst($data['surgical_site']) . "\r\nRemarks: " . $data['surgical_site_text'];
                $dataexport[$i]['wound'] = ucfirst($data['wound']) . "\r\nRemarks: " . $data['wound_text'];
                $dataexport[$i]['documented'] = ucfirst($data['documented']) . "\r\nRemarks: " . $data['documented_text'];
                $dataexport[$i]['adequate_facilities'] = ucfirst($data['adequate_facilities']) . "\r\nRemarks: " . $data['adequate_facilities_text'];
                $dataexport[$i]['sufficient_lighting'] = ucfirst($data['sufficient_lighting']) . "\r\nRemarks: " . $data['sufficient_lighting_text'];
                $dataexport[$i]['storage_facility_for_food'] = ucfirst($data['storage_facility_for_food']) . "\r\nRemarks: " . $data['storage_facility_for_food_text'];
                $dataexport[$i]['personnel_hygiene_facilities'] = ucfirst($data['personnel_hygiene_facilities']) . "\r\nRemarks: " . $data['personnel_hygiene_facilities_text'];
                $dataexport[$i]['food_material_testing'] = ucfirst($data['food_material_testing']) . "\r\nRemarks: " . $data['food_material_testing_text'];
                $dataexport[$i]['incoming_material'] = ucfirst($data['incoming_material']) . "\r\nRemarks: " . $data['incoming_material_text'];
                $dataexport[$i]['raw_materials_inspection'] = ucfirst($data['raw_materials_inspection']) . "\r\nRemarks: " . $data['raw_materials_inspection_text'];
                $dataexport[$i]['storage_of_materials'] = ucfirst($data['storage_of_materials']) . "\r\nRemarks: " . $data['storage_of_materials_text'];
                $dataexport[$i]['raw_materials_cleaning'] = ucfirst($data['raw_materials_cleaning']) . "\r\nRemarks: " . $data['raw_materials_cleaning_text'];
                $dataexport[$i]['equipment_sanitization'] = ucfirst($data['equipment_sanitization']) . "\r\nRemarks: " . $data['equipment_sanitization_text'];
                $dataexport[$i]['frozen_food_thawing'] = ucfirst($data['frozen_food_thawing']) . "\r\nRemarks: " . $data['frozen_food_thawing_text'];
                $dataexport[$i]['vegetarian_and_non_vegetarian'] = ucfirst($data['vegetarian_and_non_vegetarian']) . "\r\nRemarks: " . $data['vegetarian_and_non_vegetarian_text'];
                $dataexport[$i]['cooked_food_cooling'] = ucfirst($data['cooked_food_cooling']) . "\r\nRemarks: " . $data['cooked_food_cooling_text'];
                $dataexport[$i]['food_portioning'] = ucfirst($data['food_portioning']) . "\r\nRemarks: " . $data['food_portioning_text'];

                $dataexport[$i]['ab1'] = ucfirst($data['ab1']) . "\r\nRemarks: " . $data['ab1_text'];
                $dataexport[$i]['ab2'] = ucfirst($data['ab2']) . "\r\nRemarks: " . $data['ab2_text'];
                $dataexport[$i]['ab3'] = ucfirst($data['ab3']) . "\r\nRemarks: " . $data['ab3_text'];
                $dataexport[$i]['ab4'] = ucfirst($data['ab4']) . "\r\nRemarks: " . $data['ab4_text'];
                $dataexport[$i]['ab5'] = ucfirst($data['ab5']) . "\r\nRemarks: " . $data['ab5_text'];
                $dataexport[$i]['ab6'] = ucfirst($data['ab6']) . "\r\nRemarks: " . $data['ab6_text'];
                $dataexport[$i]['ab7'] = ucfirst($data['ab7']) . "\r\nRemarks: " . $data['ab7_text'];
                $dataexport[$i]['ab8'] = ucfirst($data['ab8']) . "\r\nRemarks: " . $data['ab8_text'];
                $dataexport[$i]['ab9'] = ucfirst($data['ab9']) . "\r\nRemarks: " . $data['ab9_text'];
                $dataexport[$i]['ab10'] = ucfirst($data['ab10']) . "\r\nRemarks: " . $data['ab10_text'];


                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];


                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- Nursing (IP Closed Cases) - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function overall_nursing_ip_open()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_ma_nursingip_open_cases';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->audit_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Audit Name';
            $header[1] = 'Date & Time of Audit';
            $header[2] = 'Audit by';
            $header[3] = 'Patient MID';
            $header[4] = 'Patient Name';
            $header[5] = 'Patient Age';
            $header[6] = 'Patient Gender';

            $j = 7;

            $header[$j++] = 'Area';
            $header[$j++] = 'Department';
            $header[$j++] = 'Attended Doctor';
            $header[$j++] = 'Admission Date & Time';
            $header[$j++] = 'Discharge Date & Time';

            $header[$j++] = 'Are allergy entries documented?';
            $header[$j++] = 'Are verbal/telephonic orders compliant with IPSG:2?';
            $header[$j++] = 'Are all medication orders administered through HIS (eMAR)?';
            $header[$j++] = 'Is triage documentation in emergency recorded?';
            $header[$j++] = 'Is compliance to blood transfusion monitoring recorded?';
            $header[$j++] = 'Is intra-cath monitoring performed?';
            $header[$j++] = 'Is post-cath monitoring performed?';
            $header[$j++] = 'Is pre-cath monitoring performed?';
            $header[$j++] = 'In the Haemodialysis Record, is there evidence of pain screening during initial assessment?';
            $header[$j++] = 'Is the ability to learn, barriers to learning, and learning needs documented?';
            $header[$j++] = 'Is the care plan documentation available?';
            $header[$j++] = 'Is fall risk reassessment completed in every shift?';
            $header[$j++] = 'Is shift-to-shift handover entry available?';
            $header[$j++] = 'Is handover during inter-department transfer documented?';
            $header[$j++] = 'Are invasive lines records documented?';
            $header[$j++] = 'Is MEWS monitoring in wards done as per policy?';
            $header[$j++] = 'Is pain reassessment recorded, if applicable?';
            $header[$j++] = 'Is risk of self-harm assessment documented, if applicable?';
            $header[$j++] = 'Is the ability to learn, barriers to learning, and learning needs documented?';
            $header[$j++] = 'Is the care plan documentation available?';
            $header[$j++] = 'Is fall risk assessment completed within 2 hours of admission?';
            $header[$j++] = 'Is fall risk reassessment completed, if applicable?';
            $header[$j++] = 'Is nursing initial assessment completed within 60 minutes?';
            $header[$j++] = 'Is pain reassessment recorded, if applicable?';
            $header[$j++] = 'Is pain screening done during initial assessment?';
            $header[$j++] = 'Is patient and family education status documented?';
            $header[$j++] = 'Is screening for abuse and neglect during initial assessment documented?';
            $header[$j++] = 'Is screening for alcohol or drug dependency during initial assessment documented?';
            $header[$j++] = 'Is the ability to learn, barriers to learning, and learning needs documented?';
            $header[$j++] = 'Is the care plan documentation available?';
            $header[$j++] = 'Is fall risk screening completed within 30 minutes of registration/billing?';
            $header[$j++] = 'Is nursing initial assessment completed within 30 minutes?';
            $header[$j++] = 'Is pain screening done during initial assessment?';
            $header[$j++] = 'Is patient and family education status documented?';
            $header[$j++] = 'Is screening for abuse and neglect during initial assessment documented?';
            $header[$j++] = 'Is screening for alcohol or drug dependency during initial assessment documented?';
            $header[$j++] = 'Is the ability to learn, barriers to learning, and learning needs documented?';
            $header[$j++] = 'Is care plan documentation available?';
            $header[$j++] = 'Is fall risk assessment completed within 2 hours of admission?';
            $header[$j++] = 'Is nursing initial assessment completed within 4 hours for ICU patients?';
            $header[$j++] = 'Is nursing initial assessment completed within 6 hours for ward patients?';
            $header[$j++] = 'Is pain screening done during initial assessment?';
            $header[$j++] = 'Is patient and family education status documented?';
            $header[$j++] = 'Is screening for abuse and neglect during initial assessment documented?';
            $header[$j++] = 'Is screening for alcohol or drug dependency during initial assessment documented?';
            $header[$j++] = 'Is care plan documentation recorded?';
            $header[$j++] = 'Is fall risk reassessment completed every shift for post-surgery patients?';
            $header[$j++] = 'Are vitals monitored in PACU recorded?';
            $header[$j++] = 'Is pain reassessment recorded, if applicable?';
            $header[$j++] = 'Is procedure safety checklist documented outside OT (e.g., Endoscopy, ENT, OPD Procedure Room, Radiology, Urology)?';
            $header[$j++] = 'Does the sedation documentation include pre-sedation assessment?';
            $header[$j++] = 'Does the sedation documentation include pre-sedation assessment and monitoring during endoscopy, ED, or ICU?';
            $header[$j++] = 'Is sign-in recorded?';
            $header[$j++] = 'Is sign-out recorded?';
            $header[$j++] = 'Is time-out recorded?';


            $header[$j++] = 'Additional comments';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['audit_type'] = $data['audit_type'];
                $dataexport[$i]['date'] = date('Y-m-d H:i', strtotime($row->datetime));
                $dataexport[$i]['audit_by'] = $data['audit_by'];

                $dataexport[$i]['mid_no'] = $data['mid_no'];
                $dataexport[$i]['patient_name'] = $data['patient_name'];
                $dataexport[$i]['patient_age'] = $data['patient_age'];
                $dataexport[$i]['patient_gender'] = $data['patient_gender'];
                $dataexport[$i]['location'] = $data['location'];
                $dataexport[$i]['department'] = $data['department'];
                $dataexport[$i]['attended_doctor'] = $data['attended_doctor'];
                $dataexport[$i]['initial_assessment_hr6'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr6']));
                $dataexport[$i]['discharge_date_time'] = date('Y-m-d H:i', strtotime($data['discharge_date_time']));

                $dataexport[$i]['identification_details'] = ucfirst($data['identification_details']) . "\r\nRemarks: " . $data['identification_details_text'];
                $dataexport[$i]['vital_signs'] = ucfirst($data['vital_signs']) . "\r\nRemarks: " . $data['vital_signs_text'];
                $dataexport[$i]['surgery'] = ucfirst($data['surgery']) . "\r\nRemarks: " . $data['surgery_text'];
                $dataexport[$i]['complaints_communicated'] = ucfirst($data['complaints_communicated']) . "\r\nRemarks: " . $data['complaints_communicated_text'];
                $dataexport[$i]['intake'] = ucfirst($data['intake']) . "\r\nRemarks: " . $data['intake_text'];
                $dataexport[$i]['output'] = ucfirst($data['output']) . "\r\nRemarks: " . $data['output_text'];
                $dataexport[$i]['focus'] = ucfirst($data['focus']) . "\r\nRemarks: " . $data['focus_text'];
                $dataexport[$i]['meti'] = ucfirst($data['meti']) . "\r\nRemarks: " . $data['meti_text'];
                $dataexport[$i]['diagnostic'] = ucfirst($data['diagnostic']) . "\r\nRemarks: " . $data['diagnostic_text'];
                $dataexport[$i]['lab_results'] = ucfirst($data['lab_results']) . "\r\nRemarks: " . $data['lab_results_text'];
                $dataexport[$i]['psychological'] = ucfirst($data['psychological']) . "\r\nRemarks: " . $data['psychological_text'];
                $dataexport[$i]['vulnerab'] = ucfirst($data['vulnerab']) . "\r\nRemarks: " . $data['vulnerab_text'];
                $dataexport[$i]['social'] = ucfirst($data['social']) . "\r\nRemarks: " . $data['social_text'];

                $dataexport[$i]['nutri'] = ucfirst($data['nutri']) . "\r\nRemarks: " . $data['nutri_text'];
                $dataexport[$i]['spiritual'] = ucfirst($data['spiritual']) . "\r\nRemarks: " . $data['spiritual_text'];
                $dataexport[$i]['suicide'] = ucfirst($data['suicide']) . "\r\nRemarks: " . $data['suicide_text'];
                $dataexport[$i]['risk'] = ucfirst($data['risk']) . "\r\nRemarks: " . $data['risk_text'];
                $dataexport[$i]['care'] = ucfirst($data['care']) . "\r\nRemarks: " . $data['care_text'];
                $dataexport[$i]['pfe'] = ucfirst($data['pfe']) . "\r\nRemarks: " . $data['pfe_text'];
                $dataexport[$i]['disch'] = ucfirst($data['disch']) . "\r\nRemarks: " . $data['disch_text'];
                $dataexport[$i]['facility_communicated'] = ucfirst($data['facility_communicated']) . "\r\nRemarks: " . $data['facility_communicated_text'];
                $dataexport[$i]['health_education'] = ucfirst($data['health_education']) . "\r\nRemarks: " . $data['health_education_text'];
                $dataexport[$i]['remarks1'] = ucfirst($data['remarks1']) . "\r\nRemarks: " . $data['remarks1_text'];
                $dataexport[$i]['urethral'] = ucfirst($data['urethral']) . "\r\nRemarks: " . $data['urethral_text'];

                $dataexport[$i]['urine_sample'] = ucfirst($data['urine_sample']) . "\r\nRemarks: " . $data['urine_sample_text'];

                $dataexport[$i]['bystander'] = ucfirst($data['bystander']) . "\r\nRemarks: " . $data['bystander_text'];
                $dataexport[$i]['instruments'] = ucfirst($data['instruments']) . "\r\nRemarks: " . $data['instruments_text'];
                $dataexport[$i]['sterile'] = ucfirst($data['sterile']) . "\r\nRemarks: " . $data['sterile_text'];
                $dataexport[$i]['antibiotics'] = ucfirst($data['antibiotics']) . "\r\nRemarks: " . $data['antibiotics_text'];
                $dataexport[$i]['surgical_site'] = ucfirst($data['surgical_site']) . "\r\nRemarks: " . $data['surgical_site_text'];
                $dataexport[$i]['wound'] = ucfirst($data['wound']) . "\r\nRemarks: " . $data['wound_text'];
                $dataexport[$i]['documented'] = ucfirst($data['documented']) . "\r\nRemarks: " . $data['documented_text'];
                $dataexport[$i]['adequate_facilities'] = ucfirst($data['adequate_facilities']) . "\r\nRemarks: " . $data['adequate_facilities_text'];
                $dataexport[$i]['sufficient_lighting'] = ucfirst($data['sufficient_lighting']) . "\r\nRemarks: " . $data['sufficient_lighting_text'];
                $dataexport[$i]['storage_facility_for_food'] = ucfirst($data['storage_facility_for_food']) . "\r\nRemarks: " . $data['storage_facility_for_food_text'];
                $dataexport[$i]['personnel_hygiene_facilities'] = ucfirst($data['personnel_hygiene_facilities']) . "\r\nRemarks: " . $data['personnel_hygiene_facilities_text'];
                $dataexport[$i]['food_material_testing'] = ucfirst($data['food_material_testing']) . "\r\nRemarks: " . $data['food_material_testing_text'];
                $dataexport[$i]['incoming_material'] = ucfirst($data['incoming_material']) . "\r\nRemarks: " . $data['incoming_material_text'];
                $dataexport[$i]['raw_materials_inspection'] = ucfirst($data['raw_materials_inspection']) . "\r\nRemarks: " . $data['raw_materials_inspection_text'];
                $dataexport[$i]['storage_of_materials'] = ucfirst($data['storage_of_materials']) . "\r\nRemarks: " . $data['storage_of_materials_text'];
                $dataexport[$i]['raw_materials_cleaning'] = ucfirst($data['raw_materials_cleaning']) . "\r\nRemarks: " . $data['raw_materials_cleaning_text'];
                $dataexport[$i]['equipment_sanitization'] = ucfirst($data['equipment_sanitization']) . "\r\nRemarks: " . $data['equipment_sanitization_text'];
                $dataexport[$i]['frozen_food_thawing'] = ucfirst($data['frozen_food_thawing']) . "\r\nRemarks: " . $data['frozen_food_thawing_text'];
                $dataexport[$i]['vegetarian_and_non_vegetarian'] = ucfirst($data['vegetarian_and_non_vegetarian']) . "\r\nRemarks: " . $data['vegetarian_and_non_vegetarian_text'];
                $dataexport[$i]['cooked_food_cooling'] = ucfirst($data['cooked_food_cooling']) . "\r\nRemarks: " . $data['cooked_food_cooling_text'];
                $dataexport[$i]['food_portioning'] = ucfirst($data['food_portioning']) . "\r\nRemarks: " . $data['food_portioning_text'];

                $dataexport[$i]['ab1'] = ucfirst($data['ab1']) . "\r\nRemarks: " . $data['ab1_text'];
                $dataexport[$i]['ab2'] = ucfirst($data['ab2']) . "\r\nRemarks: " . $data['ab2_text'];
                $dataexport[$i]['ab3'] = ucfirst($data['ab3']) . "\r\nRemarks: " . $data['ab3_text'];
                $dataexport[$i]['ab4'] = ucfirst($data['ab4']) . "\r\nRemarks: " . $data['ab4_text'];
                $dataexport[$i]['ab5'] = ucfirst($data['ab5']) . "\r\nRemarks: " . $data['ab5_text'];
                $dataexport[$i]['ab6'] = ucfirst($data['ab6']) . "\r\nRemarks: " . $data['ab6_text'];
                $dataexport[$i]['ab7'] = ucfirst($data['ab7']) . "\r\nRemarks: " . $data['ab7_text'];
                $dataexport[$i]['ab8'] = ucfirst($data['ab8']) . "\r\nRemarks: " . $data['ab8_text'];
                $dataexport[$i]['ab9'] = ucfirst($data['ab9']) . "\r\nRemarks: " . $data['ab9_text'];
                $dataexport[$i]['ab10'] = ucfirst($data['ab10']) . "\r\nRemarks: " . $data['ab10_text'];


                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];


                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- Nursing (IP Open Cases) - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function overall_nursing_op_closed()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_ma_nursingop_closed_cases';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->audit_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Audit Name';
            $header[1] = 'Date & Time of Audit';
            $header[2] = 'Audit by';
            $header[3] = 'Patient MID';
            $header[4] = 'Patient Name';
            $header[5] = 'Patient Age';
            $header[6] = 'Patient Gender';

            $j = 7;

            $header[$j++] = 'Area';
            $header[$j++] = 'Department';
            $header[$j++] = 'Attended Doctor';
            $header[$j++] = 'Admission Date & Time';
            $header[$j++] = 'Discharge Date & Time';

            $header[$j++] = 'Are Allergies entries available?';
            $header[$j++] = 'Are all medication orders administered in HIS (eMAr)?';
            $header[$j++] = 'Is Nursing initial Assessment is completed in 60 minutes?';
            $header[$j++] = 'Is Fall Risk Screening completed within 60 minutes of registration/Billing?';
            $header[$j++] = 'Is Pain Screening done during initial assessment?';
            $header[$j++] = 'Is Patient & Family Education: Educational Status recorded?';
            $header[$j++] = 'Is Screening for abuse and neglect during initial assessment recorded?';
            $header[$j++] = 'Is Screening for alcohol or drug dependency during initial assessment recorded?';


            $header[$j++] = 'Additional comments';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['audit_type'] = $data['audit_type'];
                $dataexport[$i]['date'] = date('Y-m-d H:i', strtotime($row->datetime));
                $dataexport[$i]['audit_by'] = $data['audit_by'];

                $dataexport[$i]['mid_no'] = $data['mid_no'];
                $dataexport[$i]['patient_name'] = $data['patient_name'];
                $dataexport[$i]['patient_age'] = $data['patient_age'];
                $dataexport[$i]['patient_gender'] = $data['patient_gender'];
                $dataexport[$i]['location'] = $data['location'];
                $dataexport[$i]['department'] = $data['department'];
                $dataexport[$i]['attended_doctor'] = $data['attended_doctor'];
                $dataexport[$i]['initial_assessment_hr6'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr6']));
                $dataexport[$i]['discharge_date_time'] = date('Y-m-d H:i', strtotime($data['discharge_date_time']));

                $dataexport[$i]['identification_details'] = ucfirst($data['identification_details']) . "\r\nRemarks: " . $data['identification_details_text'];
                $dataexport[$i]['vital_signs'] = ucfirst($data['vital_signs']) . "\r\nRemarks: " . $data['vital_signs_text'];
                $dataexport[$i]['surgery'] = ucfirst($data['surgery']) . "\r\nRemarks: " . $data['surgery_text'];
                $dataexport[$i]['complaints_communicated'] = ucfirst($data['complaints_communicated']) . "\r\nRemarks: " . $data['complaints_communicated_text'];
                $dataexport[$i]['intake'] = ucfirst($data['intake']) . "\r\nRemarks: " . $data['intake_text'];
                $dataexport[$i]['output'] = ucfirst($data['output']) . "\r\nRemarks: " . $data['output_text'];
                $dataexport[$i]['focus'] = ucfirst($data['focus']) . "\r\nRemarks: " . $data['focus_text'];
                $dataexport[$i]['meti'] = ucfirst($data['meti']) . "\r\nRemarks: " . $data['meti_text'];


                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];


                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- Nursing (OP Closed Cases) - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function overall_clinical_active_mdc()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_ma_clinical_active_mdc';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->audit_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Audit Name';
            $header[1] = 'Date & Time of Audit';
            $header[2] = 'Audit by';
            $header[3] = 'Patient MID';
            $header[4] = 'Patient Name';
            $header[5] = 'Patient Age';
            $header[6] = 'Patient Gender';

            $j = 7;

            $header[$j++] = 'Area';
            $header[$j++] = 'Department';
            $header[$j++] = 'Attended Doctor';
            $header[$j++] = 'Admission Date & Time';
            $header[$j++] = 'Discharge Date & Time';

            $header[$j++] = 'Is Initial assessment done within 24 hrs?';
            $header[$j++] = 'Is Diagnosis recorded in Initial assessment?';
            $header[$j++] = 'Are food allergies recorded in initial assessment?';
            $header[$j++] = 'Are food preferences recorded in initial assessments?';
            $header[$j++] = 'Are all columns of food intake filled ?';
            $header[$j++] = 'Are Biochemical Markers, Nutrition Assessment Rating, Plan of Care filled?';
            $header[$j++] = 'Is the Dieticians Name, Signature, Date & Time filled?';
            $header[$j++] = 'Is Nutritional Risk Assessment filled?';


            $header[$j++] = 'Additional comments';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['audit_type'] = $data['audit_type'];
                $dataexport[$i]['date'] = date('Y-m-d H:i', strtotime($row->datetime));
                $dataexport[$i]['audit_by'] = $data['audit_by'];

                $dataexport[$i]['mid_no'] = $data['mid_no'];
                $dataexport[$i]['patient_name'] = $data['patient_name'];
                $dataexport[$i]['patient_age'] = $data['patient_age'];
                $dataexport[$i]['patient_gender'] = $data['patient_gender'];
                $dataexport[$i]['location'] = $data['location'];
                $dataexport[$i]['department'] = $data['department'];
                $dataexport[$i]['attended_doctor'] = $data['attended_doctor'];
                $dataexport[$i]['initial_assessment_hr6'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr6']));
                $dataexport[$i]['discharge_date_time'] = date('Y-m-d H:i', strtotime($data['discharge_date_time']));

                $dataexport[$i]['identification_details'] = ucfirst($data['identification_details']) . "\r\nRemarks: " . $data['identification_details_text'];
                $dataexport[$i]['vital_signs'] = ucfirst($data['vital_signs']) . "\r\nRemarks: " . $data['vital_signs_text'];
                $dataexport[$i]['surgery'] = ucfirst($data['surgery']) . "\r\nRemarks: " . $data['surgery_text'];
                $dataexport[$i]['complaints_communicated'] = ucfirst($data['complaints_communicated']) . "\r\nRemarks: " . $data['complaints_communicated_text'];
                $dataexport[$i]['intake'] = ucfirst($data['intake']) . "\r\nRemarks: " . $data['intake_text'];
                $dataexport[$i]['output'] = ucfirst($data['output']) . "\r\nRemarks: " . $data['output_text'];
                $dataexport[$i]['focus'] = ucfirst($data['focus']) . "\r\nRemarks: " . $data['focus_text'];
                $dataexport[$i]['meti'] = ucfirst($data['meti']) . "\r\nRemarks: " . $data['meti_text'];


                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];


                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- Clinical Dietetics (Active) - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function overall_clinical_closed_mdc()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_ma_clinical_closedcases_mdc';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->audit_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Audit Name';
            $header[1] = 'Date & Time of Audit';
            $header[2] = 'Audit by';
            $header[3] = 'Patient MID';
            $header[4] = 'Patient Name';
            $header[5] = 'Patient Age';
            $header[6] = 'Patient Gender';

            $j = 7;

            $header[$j++] = 'Area';
            $header[$j++] = 'Department';
            $header[$j++] = 'Attended Doctor';
            $header[$j++] = 'Admission Date & Time';
            $header[$j++] = 'Discharge Date & Time';

            $header[$j++] = 'Is Initial assessment done within 24 hrs?';
            $header[$j++] = 'Is Diagnosis recorded in Initial assessment?';
            $header[$j++] = 'Are food allergies recorded in initial assessment?';
            $header[$j++] = 'Are food preferences recorded in initial assessments?';
            $header[$j++] = 'Are all columns of food intake filled ?';
            $header[$j++] = 'Are Biochemical Markers, Nutrition Assessment Rating, Plan of Care filled?';
            $header[$j++] = 'Is the Dietcians Name, Signature, Date & Time filled?';
            $header[$j++] = 'Is Nutritional Risk Assessment filled?';
            $header[$j++] = 'Is Date, Time filled?';
            $header[$j++] = 'Is remarks filled?';
            $header[$j++] = 'Is Signature available?';
            $header[$j++] = 'Is Name & Date filled?';
            $header[$j++] = 'Is Energy, Protein, Nutrition Plan filled?';
            $header[$j++] = 'Is Dietician comment entered?';
            $header[$j++] = 'Is date and time filled?';
            $header[$j++] = 'Is Diet Advice entered?';
            $header[$j++] = 'Is signature entered?';


            $header[$j++] = 'Additional comments';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['audit_type'] = $data['audit_type'];
                $dataexport[$i]['date'] = date('Y-m-d H:i', strtotime($row->datetime));
                $dataexport[$i]['audit_by'] = $data['audit_by'];

                $dataexport[$i]['mid_no'] = $data['mid_no'];
                $dataexport[$i]['patient_name'] = $data['patient_name'];
                $dataexport[$i]['patient_age'] = $data['patient_age'];
                $dataexport[$i]['patient_gender'] = $data['patient_gender'];
                $dataexport[$i]['location'] = $data['location'];
                $dataexport[$i]['department'] = $data['department'];
                $dataexport[$i]['attended_doctor'] = $data['attended_doctor'];
                $dataexport[$i]['initial_assessment_hr6'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr6']));
                $dataexport[$i]['discharge_date_time'] = date('Y-m-d H:i', strtotime($data['discharge_date_time']));

                $dataexport[$i]['identification_details'] = ucfirst($data['identification_details']) . "\r\nRemarks: " . $data['identification_details_text'];
                $dataexport[$i]['vital_signs'] = ucfirst($data['vital_signs']) . "\r\nRemarks: " . $data['vital_signs_text'];
                $dataexport[$i]['surgery'] = ucfirst($data['surgery']) . "\r\nRemarks: " . $data['surgery_text'];
                $dataexport[$i]['complaints_communicated'] = ucfirst($data['complaints_communicated']) . "\r\nRemarks: " . $data['complaints_communicated_text'];
                $dataexport[$i]['intake'] = ucfirst($data['intake']) . "\r\nRemarks: " . $data['intake_text'];
                $dataexport[$i]['output'] = ucfirst($data['output']) . "\r\nRemarks: " . $data['output_text'];
                $dataexport[$i]['focus'] = ucfirst($data['focus']) . "\r\nRemarks: " . $data['focus_text'];
                $dataexport[$i]['meti'] = ucfirst($data['meti']) . "\r\nRemarks: " . $data['meti_text'];
                $dataexport[$i]['diagnostic'] = ucfirst($data['diagnostic']) . "\r\nRemarks: " . $data['diagnostic_text'];
                $dataexport[$i]['lab_results'] = ucfirst($data['lab_results']) . "\r\nRemarks: " . $data['lab_results_text'];
                $dataexport[$i]['pending_investigation'] = ucfirst($data['pending_investigation']) . "\r\nRemarks: " . $data['pending_investigation_text'];
                $dataexport[$i]['medicine_order'] = ucfirst($data['medicine_order']) . "\r\nRemarks: " . $data['medicine_order_text'];
                $dataexport[$i]['psychological'] = ucfirst($data['psychological']) . "\r\nRemarks: " . $data['psychological_text'];
                $dataexport[$i]['vulnerab'] = ucfirst($data['vulnerab']) . "\r\nRemarks: " . $data['vulnerab_text'];
                $dataexport[$i]['social'] = ucfirst($data['social']) . "\r\nRemarks: " . $data['social_text'];

                $dataexport[$i]['nutri'] = ucfirst($data['nutri']) . "\r\nRemarks: " . $data['nutri_text'];
                $dataexport[$i]['spiritual'] = ucfirst($data['spiritual']) . "\r\nRemarks: " . $data['spiritual_text'];


                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];


                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- Clinical Dietetics (Closed Cases) - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function overall_clinical_pharmacy_closed()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_ma_clinical_pharmacy_closed';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->audit_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Audit Name';
            $header[1] = 'Date & Time of Audit';
            $header[2] = 'Audit by';
            $header[3] = 'Patient MID';
            $header[4] = 'Patient Name';
            $header[5] = 'Patient Age';
            $header[6] = 'Patient Gender';

            $j = 7;

            $header[$j++] = 'Area';
            $header[$j++] = 'Department';
            $header[$j++] = 'Attended Doctor';
            $header[$j++] = 'Admission Date & Time';
            $header[$j++] = 'Discharge Date & Time';

            $header[$j++] = 'Is Past medication History available?';
            $header[$j++] = 'Is Drug appropriateness review noted?';
            $header[$j++] = 'Are Current Medication details available?';
            $header[$j++] = 'Is the Source of Information noted?';
            $header[$j++] = 'Is the Physician decision recorded?';
            $header[$j++] = 'Is Reconciliation during Transfer done?';


            $header[$j++] = 'Additional comments';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['audit_type'] = $data['audit_type'];
                $dataexport[$i]['date'] = date('Y-m-d H:i', strtotime($row->datetime));
                $dataexport[$i]['audit_by'] = $data['audit_by'];

                $dataexport[$i]['mid_no'] = $data['mid_no'];
                $dataexport[$i]['patient_name'] = $data['patient_name'];
                $dataexport[$i]['patient_age'] = $data['patient_age'];
                $dataexport[$i]['patient_gender'] = $data['patient_gender'];
                $dataexport[$i]['location'] = $data['location'];
                $dataexport[$i]['department'] = $data['department'];
                $dataexport[$i]['attended_doctor'] = $data['attended_doctor'];
                $dataexport[$i]['initial_assessment_hr6'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr6']));
                $dataexport[$i]['discharge_date_time'] = date('Y-m-d H:i', strtotime($data['discharge_date_time']));

                $dataexport[$i]['identification_details'] = ucfirst($data['identification_details']) . "\r\nRemarks: " . $data['identification_details_text'];
                $dataexport[$i]['vital_signs'] = ucfirst($data['vital_signs']) . "\r\nRemarks: " . $data['vital_signs_text'];
                $dataexport[$i]['surgery'] = ucfirst($data['surgery']) . "\r\nRemarks: " . $data['surgery_text'];
                $dataexport[$i]['complaints_communicated'] = ucfirst($data['complaints_communicated']) . "\r\nRemarks: " . $data['complaints_communicated_text'];
                $dataexport[$i]['intake'] = ucfirst($data['intake']) . "\r\nRemarks: " . $data['intake_text'];
                $dataexport[$i]['output'] = ucfirst($data['output']) . "\r\nRemarks: " . $data['output_text'];


                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];


                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- Clinical Pharmacy-(Closed) - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function overall_clinical_pharmacy_op()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_ma_clinical_pharmacy_op';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->audit_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Audit Name';
            $header[1] = 'Date & Time of Audit';
            $header[2] = 'Audit by';
            $header[3] = 'Patient MID';
            $header[4] = 'Patient Name';
            $header[5] = 'Patient Age';
            $header[6] = 'Patient Gender';

            $j = 7;

            $header[$j++] = 'Area';
            $header[$j++] = 'Department';
            $header[$j++] = 'Attended Doctor';
            $header[$j++] = 'Admission Date & Time';
            $header[$j++] = 'Discharge Date & Time';

            $header[$j++] = 'Is Past medication History available?';
            $header[$j++] = 'Is Drug appropriateness review noted?';
            $header[$j++] = 'Are Current Medication details available?';
            $header[$j++] = 'Is the Source of Information noted?';
            $header[$j++] = 'Is the Physician decision recorded?';
            $header[$j++] = 'Is Reconciliation during Transfer done?';


            $header[$j++] = 'Additional comments';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['audit_type'] = $data['audit_type'];
                $dataexport[$i]['date'] = date('Y-m-d H:i', strtotime($row->datetime));
                $dataexport[$i]['audit_by'] = $data['audit_by'];

                $dataexport[$i]['mid_no'] = $data['mid_no'];
                $dataexport[$i]['patient_name'] = $data['patient_name'];
                $dataexport[$i]['patient_age'] = $data['patient_age'];
                $dataexport[$i]['patient_gender'] = $data['patient_gender'];
                $dataexport[$i]['location'] = $data['location'];
                $dataexport[$i]['department'] = $data['department'];
                $dataexport[$i]['attended_doctor'] = $data['attended_doctor'];
                $dataexport[$i]['initial_assessment_hr6'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr6']));
                $dataexport[$i]['discharge_date_time'] = date('Y-m-d H:i', strtotime($data['discharge_date_time']));

                $dataexport[$i]['identification_details'] = ucfirst($data['identification_details']) . "\r\nRemarks: " . $data['identification_details_text'];
                $dataexport[$i]['vital_signs'] = ucfirst($data['vital_signs']) . "\r\nRemarks: " . $data['vital_signs_text'];
                $dataexport[$i]['surgery'] = ucfirst($data['surgery']) . "\r\nRemarks: " . $data['surgery_text'];
                $dataexport[$i]['complaints_communicated'] = ucfirst($data['complaints_communicated']) . "\r\nRemarks: " . $data['complaints_communicated_text'];
                $dataexport[$i]['intake'] = ucfirst($data['intake']) . "\r\nRemarks: " . $data['intake_text'];
                $dataexport[$i]['output'] = ucfirst($data['output']) . "\r\nRemarks: " . $data['output_text'];


                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];


                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- Clinical Pharmacy- (OP) - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function overall_clinical_pharmacy_open()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_ma_clinical_pharmacy_open';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->audit_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Audit Name';
            $header[1] = 'Date & Time of Audit';
            $header[2] = 'Audit by';
            $header[3] = 'Patient MID';
            $header[4] = 'Patient Name';
            $header[5] = 'Patient Age';
            $header[6] = 'Patient Gender';

            $j = 7;

            $header[$j++] = 'Area';
            $header[$j++] = 'Department';
            $header[$j++] = 'Attended Doctor';
            $header[$j++] = 'Admission Date & Time';
            $header[$j++] = 'Discharge Date & Time';

            $header[$j++] = 'Is Past medication History available?';
            $header[$j++] = 'Is Drug appropriateness review noted?';
            $header[$j++] = 'Are Current Medication details available?';
            $header[$j++] = 'Is the Source of Information noted?';
            $header[$j++] = 'Is the Physician decision recorded?';
            $header[$j++] = 'Is Reconciliation during Transfer done?';


            $header[$j++] = 'Additional comments';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['audit_type'] = $data['audit_type'];
                $dataexport[$i]['date'] = date('Y-m-d H:i', strtotime($row->datetime));
                $dataexport[$i]['audit_by'] = $data['audit_by'];

                $dataexport[$i]['mid_no'] = $data['mid_no'];
                $dataexport[$i]['patient_name'] = $data['patient_name'];
                $dataexport[$i]['patient_age'] = $data['patient_age'];
                $dataexport[$i]['patient_gender'] = $data['patient_gender'];
                $dataexport[$i]['location'] = $data['location'];
                $dataexport[$i]['department'] = $data['department'];
                $dataexport[$i]['attended_doctor'] = $data['attended_doctor'];
                $dataexport[$i]['initial_assessment_hr6'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr6']));
                $dataexport[$i]['discharge_date_time'] = date('Y-m-d H:i', strtotime($data['discharge_date_time']));

                $dataexport[$i]['identification_details'] = ucfirst($data['identification_details']) . "\r\nRemarks: " . $data['identification_details_text'];
                $dataexport[$i]['vital_signs'] = ucfirst($data['vital_signs']) . "\r\nRemarks: " . $data['vital_signs_text'];
                $dataexport[$i]['surgery'] = ucfirst($data['surgery']) . "\r\nRemarks: " . $data['surgery_text'];
                $dataexport[$i]['complaints_communicated'] = ucfirst($data['complaints_communicated']) . "\r\nRemarks: " . $data['complaints_communicated_text'];
                $dataexport[$i]['intake'] = ucfirst($data['intake']) . "\r\nRemarks: " . $data['intake_text'];
                $dataexport[$i]['output'] = ucfirst($data['output']) . "\r\nRemarks: " . $data['output_text'];


                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];


                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- Clinical Pharmacy-(Open) - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function overall_anesthesia_active()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_ma_anesthesia_active_mdc';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->audit_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Audit Name';
            $header[1] = 'Date & Time of Audit';
            $header[2] = 'Audit by';
            $header[3] = 'Patient MID';
            $header[4] = 'Patient Name';
            $header[5] = 'Patient Age';
            $header[6] = 'Patient Gender';

            $j = 7;

            $header[$j++] = 'Area';
            $header[$j++] = 'Department';
            $header[$j++] = 'Attended Doctor';
            $header[$j++] = 'Admission Date & Time';
            $header[$j++] = 'Discharge Date & Time';

            $header[$j++] = 'Is the high-risk procedures and treatments consent form available in the health record of an applicable patient?';
            $header[$j++] = 'Is the signature of patient or representative, witness, and individual obtaining consent obtained?';
            $header[$j++] = 'Is the administration of anesthesia/sedation consent form available in the health record of an applicable patient?';
            $header[$j++] = 'Is the risks, benefits, and alternatives of anesthesia, moderate sedation, or deep sedation explained and fully documented on administration of anesthesia consent form?';
            $header[$j++] = 'Is it ensured that No abbreviations are used on consent forms?';
            $header[$j++] = 'Is Planned care documented in the form of measurable progress (goals)?';
            $header[$j++] = 'Is Planned Care reviewed by other disciplines?';
            $header[$j++] = 'Is a pre-anesthesia assessment completed for an applicable patient?';
            $header[$j++] = 'Is a pre-induction assessment completed immediately before induction?';
            $header[$j++] = 'Is a Plan of Anesthesia documented?';
            $header[$j++] = 'Is Post Anesthesia order completed?';
            $header[$j++] = 'Is the Anesthesia document completed?';
            $header[$j++] = 'Is PACU Document complete?';
            $header[$j++] = 'Are the times of each dose of anesthesia medications recorded?';
            $header[$j++] = 'Are names of Anesthesia staff including technicians recorded?';


            $header[$j++] = 'Additional comments';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['audit_type'] = $data['audit_type'];
                $dataexport[$i]['date'] = date('Y-m-d H:i', strtotime($row->datetime));
                $dataexport[$i]['audit_by'] = $data['audit_by'];

                $dataexport[$i]['mid_no'] = $data['mid_no'];
                $dataexport[$i]['patient_name'] = $data['patient_name'];
                $dataexport[$i]['patient_age'] = $data['patient_age'];
                $dataexport[$i]['patient_gender'] = $data['patient_gender'];
                $dataexport[$i]['location'] = $data['location'];
                $dataexport[$i]['department'] = $data['department'];
                $dataexport[$i]['attended_doctor'] = $data['attended_doctor'];
                $dataexport[$i]['initial_assessment_hr6'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr6']));
                $dataexport[$i]['discharge_date_time'] = date('Y-m-d H:i', strtotime($data['discharge_date_time']));

                $dataexport[$i]['identification_details'] = ucfirst($data['identification_details']) . "\r\nRemarks: " . $data['identification_details_text'];
                $dataexport[$i]['vital_signs'] = ucfirst($data['vital_signs']) . "\r\nRemarks: " . $data['vital_signs_text'];
                $dataexport[$i]['surgery'] = ucfirst($data['surgery']) . "\r\nRemarks: " . $data['surgery_text'];
                $dataexport[$i]['complaints_communicated'] = ucfirst($data['complaints_communicated']) . "\r\nRemarks: " . $data['complaints_communicated_text'];
                $dataexport[$i]['ensure'] = ucfirst($data['ensure']) . "\r\nRemarks: " . $data['ensure_text'];
                $dataexport[$i]['intake'] = ucfirst($data['intake']) . "\r\nRemarks: " . $data['intake_text'];
                $dataexport[$i]['output'] = ucfirst($data['output']) . "\r\nRemarks: " . $data['output_text'];
                $dataexport[$i]['focus'] = ucfirst($data['focus']) . "\r\nRemarks: " . $data['focus_text'];
                $dataexport[$i]['meti'] = ucfirst($data['meti']) . "\r\nRemarks: " . $data['meti_text'];
                $dataexport[$i]['diagnostic'] = ucfirst($data['diagnostic']) . "\r\nRemarks: " . $data['diagnostic_text'];
                $dataexport[$i]['lab_results'] = ucfirst($data['lab_results']) . "\r\nRemarks: " . $data['lab_results_text'];
                $dataexport[$i]['pending_investigation'] = ucfirst($data['pending_investigation']) . "\r\nRemarks: " . $data['pending_investigation_text'];
                $dataexport[$i]['medicine_order'] = ucfirst($data['medicine_order']) . "\r\nRemarks: " . $data['medicine_order_text'];
                $dataexport[$i]['psychological'] = ucfirst($data['psychological']) . "\r\nRemarks: " . $data['psychological_text'];
                $dataexport[$i]['vulnerab'] = ucfirst($data['vulnerab']) . "\r\nRemarks: " . $data['vulnerab_text'];

                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];


                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- Clinicians-Anesthesia(Active) - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function overall_anesthesia_closed()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_ma_anesthesia_closed_mdc';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->audit_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Audit Name';
            $header[1] = 'Date & Time of Audit';
            $header[2] = 'Audit by';
            $header[3] = 'Patient MID';
            $header[4] = 'Patient Name';
            $header[5] = 'Patient Age';
            $header[6] = 'Patient Gender';

            $j = 7;

            $header[$j++] = 'Area';
            $header[$j++] = 'Department';
            $header[$j++] = 'Attended Doctor';
            $header[$j++] = 'Admission Date & Time';
            $header[$j++] = 'Discharge Date & Time';

            $header[$j++] = 'Is the type of Anesthesia selected in consent properly?';
            $header[$j++] = 'Has the Anesthetist signed the consent with date and time?';
            $header[$j++] = 'Is the signature of patient or representative, witness, and individual obtaining consent obtained?';
            $header[$j++] = 'Is the administration of anesthesia/sedation consent form available in the health record of an applicable patient?';
            $header[$j++] = 'Is the risks, benefits, and alternatives of anesthesia, moderate sedation, or deep sedation explained and fully documented on administration of anesthesia consent form?';
            $header[$j++] = 'Is it ensured that No abbreviations are used on consent forms?';
            $header[$j++] = 'Is Planned care documented in the form of measurable progress (goals)?';
            $header[$j++] = 'Is Planned Care reviewed by other disciplines?';
            $header[$j++] = 'Is a pre-anesthesia assessment completed for an applicable patient?';
            $header[$j++] = 'Is a pre-induction assessment completed immediately before induction?';
            $header[$j++] = 'Is a Plan of Anesthesia documented?';
            $header[$j++] = 'Is Post Anesthesia order completed?';
            $header[$j++] = 'Is the Anesthesia document completed?';
            $header[$j++] = 'Is PACU Document complete?';
            $header[$j++] = 'Are the times of each dose of anesthesia medications recorded?';


            $header[$j++] = 'Additional comments';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['audit_type'] = $data['audit_type'];
                $dataexport[$i]['date'] = date('Y-m-d H:i', strtotime($row->datetime));
                $dataexport[$i]['audit_by'] = $data['audit_by'];

                $dataexport[$i]['mid_no'] = $data['mid_no'];
                $dataexport[$i]['patient_name'] = $data['patient_name'];
                $dataexport[$i]['patient_age'] = $data['patient_age'];
                $dataexport[$i]['patient_gender'] = $data['patient_gender'];
                $dataexport[$i]['location'] = $data['location'];
                $dataexport[$i]['department'] = $data['department'];
                $dataexport[$i]['attended_doctor'] = $data['attended_doctor'];
                $dataexport[$i]['initial_assessment_hr6'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr6']));
                $dataexport[$i]['discharge_date_time'] = date('Y-m-d H:i', strtotime($data['discharge_date_time']));

                $dataexport[$i]['identification_details'] = ucfirst($data['identification_details']) . "\r\nRemarks: " . $data['identification_details_text'];
                $dataexport[$i]['vital_signs'] = ucfirst($data['vital_signs']) . "\r\nRemarks: " . $data['vital_signs_text'];
                $dataexport[$i]['surgery'] = ucfirst($data['surgery']) . "\r\nRemarks: " . $data['surgery_text'];
                $dataexport[$i]['complaints_communicated'] = ucfirst($data['complaints_communicated']) . "\r\nRemarks: " . $data['complaints_communicated_text'];
                $dataexport[$i]['ensure'] = ucfirst($data['ensure']) . "\r\nRemarks: " . $data['ensure_text'];
                $dataexport[$i]['intake'] = ucfirst($data['intake']) . "\r\nRemarks: " . $data['intake_text'];
                $dataexport[$i]['output'] = ucfirst($data['output']) . "\r\nRemarks: " . $data['output_text'];
                $dataexport[$i]['focus'] = ucfirst($data['focus']) . "\r\nRemarks: " . $data['focus_text'];
                $dataexport[$i]['meti'] = ucfirst($data['meti']) . "\r\nRemarks: " . $data['meti_text'];
                $dataexport[$i]['diagnostic'] = ucfirst($data['diagnostic']) . "\r\nRemarks: " . $data['diagnostic_text'];
                $dataexport[$i]['lab_results'] = ucfirst($data['lab_results']) . "\r\nRemarks: " . $data['lab_results_text'];
                $dataexport[$i]['pending_investigation'] = ucfirst($data['pending_investigation']) . "\r\nRemarks: " . $data['pending_investigation_text'];
                $dataexport[$i]['medicine_order'] = ucfirst($data['medicine_order']) . "\r\nRemarks: " . $data['medicine_order_text'];
                $dataexport[$i]['psychological'] = ucfirst($data['psychological']) . "\r\nRemarks: " . $data['psychological_text'];
                $dataexport[$i]['vulnerab'] = ucfirst($data['vulnerab']) . "\r\nRemarks: " . $data['vulnerab_text'];

                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];


                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- Clinicians-Anesthesia(Closed) - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function overall_ed_active()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_ma_ed_active_mdc';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->audit_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Audit Name';
            $header[1] = 'Date & Time of Audit';
            $header[2] = 'Audit by';
            $header[3] = 'Patient MID';
            $header[4] = 'Patient Name';
            $header[5] = 'Patient Age';
            $header[6] = 'Patient Gender';

            $j = 7;

            $header[$j++] = 'Area';
            $header[$j++] = 'Department';
            $header[$j++] = 'Attended Doctor';
            $header[$j++] = 'Admission Date & Time';
            $header[$j++] = 'Discharge Date & Time';

            $header[$j++] = 'Is the General Consent form obtained?';
            $header[$j++] = 'Is the General Consent form complete?';
            $header[$j++] = 'Is Triage completed soon after the arrival?';
            $header[$j++] = 'Is the initial assessment completed within 10 minutes of arrival?';
            $header[$j++] = 'Is the patients name and health record number correct?';
            $header[$j++] = 'Is the Blood Investigation section completed correctly, if applicable';
            $header[$j++] = 'Is the Known Allergies section completed correctly?';
            $header[$j++] = 'Is the Medication section completed correctly?';
            $header[$j++] = 'Is it ensured that only approved abbreviations are used?';
            $header[$j++] = 'Are the Chief complaints and history are documented in Initial assessment?';
            $header[$j++] = 'Is the medication history documented in initial assessment?';
            $header[$j++] = 'Are the Physical examination and diagnosis documented in Initial assessment?';
            $header[$j++] = 'Is the time of arrival documented in Initial assessment?';
            $header[$j++] = 'Is the time of discharge documented in ED Discharge summary?';
            $header[$j++] = 'Are Advise and follow up instructions documented in ED Discharge summary?';
            $header[$j++] = 'Is the ED transfer note documented if the patient is admitted?';
            $header[$j++] = 'Is the Transfer order documented for Referred /Transferred patient?';
            $header[$j++] = 'Is the consent for transfer obtained for the Referred/Transferred patient?';


            $header[$j++] = 'Additional comments';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['audit_type'] = $data['audit_type'];
                $dataexport[$i]['date'] = date('Y-m-d H:i', strtotime($row->datetime));
                $dataexport[$i]['audit_by'] = $data['audit_by'];

                $dataexport[$i]['mid_no'] = $data['mid_no'];
                $dataexport[$i]['patient_name'] = $data['patient_name'];
                $dataexport[$i]['patient_age'] = $data['patient_age'];
                $dataexport[$i]['patient_gender'] = $data['patient_gender'];
                $dataexport[$i]['location'] = $data['location'];
                $dataexport[$i]['department'] = $data['department'];
                $dataexport[$i]['attended_doctor'] = $data['attended_doctor'];
                $dataexport[$i]['initial_assessment_hr6'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr6']));
                $dataexport[$i]['discharge_date_time'] = date('Y-m-d H:i', strtotime($data['discharge_date_time']));

                $dataexport[$i]['identification_details'] = ucfirst($data['identification_details']) . "\r\nRemarks: " . $data['identification_details_text'];
                $dataexport[$i]['vital_signs'] = ucfirst($data['vital_signs']) . "\r\nRemarks: " . $data['vital_signs_text'];
                $dataexport[$i]['surgery'] = ucfirst($data['surgery']) . "\r\nRemarks: " . $data['surgery_text'];
                $dataexport[$i]['complaints_communicated'] = ucfirst($data['complaints_communicated']) . "\r\nRemarks: " . $data['complaints_communicated_text'];
                $dataexport[$i]['ensure'] = ucfirst($data['ensure']) . "\r\nRemarks: " . $data['ensure_text'];
                $dataexport[$i]['intake'] = ucfirst($data['intake']) . "\r\nRemarks: " . $data['intake_text'];
                $dataexport[$i]['output'] = ucfirst($data['output']) . "\r\nRemarks: " . $data['output_text'];
                $dataexport[$i]['focus'] = ucfirst($data['focus']) . "\r\nRemarks: " . $data['focus_text'];
                $dataexport[$i]['meti'] = ucfirst($data['meti']) . "\r\nRemarks: " . $data['meti_text'];
                $dataexport[$i]['diagnostic'] = ucfirst($data['diagnostic']) . "\r\nRemarks: " . $data['diagnostic_text'];
                $dataexport[$i]['lab_results'] = ucfirst($data['lab_results']) . "\r\nRemarks: " . $data['lab_results_text'];
                $dataexport[$i]['pending_investigation'] = ucfirst($data['pending_investigation']) . "\r\nRemarks: " . $data['pending_investigation_text'];
                $dataexport[$i]['medicine_order'] = ucfirst($data['medicine_order']) . "\r\nRemarks: " . $data['medicine_order_text'];
                $dataexport[$i]['psychological'] = ucfirst($data['psychological']) . "\r\nRemarks: " . $data['psychological_text'];
                $dataexport[$i]['vulnerab'] = ucfirst($data['vulnerab']) . "\r\nRemarks: " . $data['vulnerab_text'];
                $dataexport[$i]['social'] = ucfirst($data['social']) . "\r\nRemarks: " . $data['social_text'];
                $dataexport[$i]['nutri'] = ucfirst($data['nutri']) . "\r\nRemarks: " . $data['nutri_text'];
                $dataexport[$i]['spiritual'] = ucfirst($data['spiritual']) . "\r\nRemarks: " . $data['spiritual_text'];

                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];


                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- Clinicians-ED (Active) - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function overall_ed_closed()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_ma_ed_closed_mdc';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->audit_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Audit Name';
            $header[1] = 'Date & Time of Audit';
            $header[2] = 'Audit by';
            $header[3] = 'Patient MID';
            $header[4] = 'Patient Name';
            $header[5] = 'Patient Age';
            $header[6] = 'Patient Gender';

            $j = 7;

            $header[$j++] = 'Area';
            $header[$j++] = 'Department';
            $header[$j++] = 'Attended Doctor';
            $header[$j++] = 'Admission Date & Time';
            $header[$j++] = 'Discharge Date & Time';

            $header[$j++] = 'Is the General Consent form obtained?';
            $header[$j++] = 'Is the General Consent form complete?';
            $header[$j++] = 'Is Triage completed soon after the arrival?';
            $header[$j++] = 'Is the initial assessment completed within 10 minutes of arrival?';
            $header[$j++] = 'Is the patients name and health record number correct?';
            $header[$j++] = 'Is the Blood Investigation section completed correctly, if applicable';
            $header[$j++] = 'Is the Known Allergies section completed correctly?';
            $header[$j++] = 'Is the Medication section completed correctly?';
            $header[$j++] = 'Is it ensured that only approved abbreviations are used?';
            $header[$j++] = 'Are the Chief complaints and history are documented in Initial assessment?';
            $header[$j++] = 'Is the medication history documented in initial assessment?';
            $header[$j++] = 'Are the Physical examination and diagnosis documented in Initial assessment?';
            $header[$j++] = 'Is the time of arrival documented in Initial assessment?';
            $header[$j++] = 'Is the time of discharge documented in ED Discharge summary?';
            $header[$j++] = 'Are Advise and follow up instructions documented in ED Discharge summary?';
            $header[$j++] = 'Is the ED transfer note documented if the patient is admitted?';
            $header[$j++] = 'Is the Transfer order documented for Referred /Transferred patient?';
            $header[$j++] = 'Is the consent for transfer obtained for the Referred/Transferred patient?';
            $header[$j++] = 'Is Transfer summary/Discharge summary complete?';
            $header[$j++] = 'Is the name of the accepting physician/organization documented?';
            $header[$j++] = 'Is the Record during transfer complete?';

            $header[$j++] = 'Additional comments';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['audit_type'] = $data['audit_type'];
                $dataexport[$i]['date'] = date('Y-m-d H:i', strtotime($row->datetime));
                $dataexport[$i]['audit_by'] = $data['audit_by'];

                $dataexport[$i]['mid_no'] = $data['mid_no'];
                $dataexport[$i]['patient_name'] = $data['patient_name'];
                $dataexport[$i]['patient_age'] = $data['patient_age'];
                $dataexport[$i]['patient_gender'] = $data['patient_gender'];
                $dataexport[$i]['location'] = $data['location'];
                $dataexport[$i]['department'] = $data['department'];
                $dataexport[$i]['attended_doctor'] = $data['attended_doctor'];
                $dataexport[$i]['initial_assessment_hr6'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr6']));
                $dataexport[$i]['discharge_date_time'] = date('Y-m-d H:i', strtotime($data['discharge_date_time']));

                $dataexport[$i]['identification_details'] = ucfirst($data['identification_details']) . "\r\nRemarks: " . $data['identification_details_text'];
                $dataexport[$i]['vital_signs'] = ucfirst($data['vital_signs']) . "\r\nRemarks: " . $data['vital_signs_text'];
                $dataexport[$i]['surgery'] = ucfirst($data['surgery']) . "\r\nRemarks: " . $data['surgery_text'];
                $dataexport[$i]['complaints_communicated'] = ucfirst($data['complaints_communicated']) . "\r\nRemarks: " . $data['complaints_communicated_text'];
                $dataexport[$i]['ensure'] = ucfirst($data['ensure']) . "\r\nRemarks: " . $data['ensure_text'];
                $dataexport[$i]['intake'] = ucfirst($data['intake']) . "\r\nRemarks: " . $data['intake_text'];
                $dataexport[$i]['output'] = ucfirst($data['output']) . "\r\nRemarks: " . $data['output_text'];
                $dataexport[$i]['focus'] = ucfirst($data['focus']) . "\r\nRemarks: " . $data['focus_text'];
                $dataexport[$i]['meti'] = ucfirst($data['meti']) . "\r\nRemarks: " . $data['meti_text'];
                $dataexport[$i]['diagnostic'] = ucfirst($data['diagnostic']) . "\r\nRemarks: " . $data['diagnostic_text'];
                $dataexport[$i]['lab_results'] = ucfirst($data['lab_results']) . "\r\nRemarks: " . $data['lab_results_text'];
                $dataexport[$i]['pending_investigation'] = ucfirst($data['pending_investigation']) . "\r\nRemarks: " . $data['pending_investigation_text'];
                $dataexport[$i]['medicine_order'] = ucfirst($data['medicine_order']) . "\r\nRemarks: " . $data['medicine_order_text'];
                $dataexport[$i]['psychological'] = ucfirst($data['psychological']) . "\r\nRemarks: " . $data['psychological_text'];
                $dataexport[$i]['vulnerab'] = ucfirst($data['vulnerab']) . "\r\nRemarks: " . $data['vulnerab_text'];
                $dataexport[$i]['social'] = ucfirst($data['social']) . "\r\nRemarks: " . $data['social_text'];
                $dataexport[$i]['nutri'] = ucfirst($data['nutri']) . "\r\nRemarks: " . $data['nutri_text'];
                $dataexport[$i]['spiritual'] = ucfirst($data['spiritual']) . "\r\nRemarks: " . $data['spiritual_text'];
                $dataexport[$i]['suicide'] = ucfirst($data['suicide']) . "\r\nRemarks: " . $data['suicide_text'];
                $dataexport[$i]['risk'] = ucfirst($data['risk']) . "\r\nRemarks: " . $data['risk_text'];
                $dataexport[$i]['care'] = ucfirst($data['care']) . "\r\nRemarks: " . $data['care_text'];


                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];


                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- Clinicians-ED (Closed) - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function overall_icu_active()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_ma_icu_active_mdc';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->audit_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Audit Name';
            $header[1] = 'Date & Time of Audit';
            $header[2] = 'Audit by';
            $header[3] = 'Patient MID';
            $header[4] = 'Patient Name';
            $header[5] = 'Patient Age';
            $header[6] = 'Patient Gender';

            $j = 7;

            $header[$j++] = 'Area';
            $header[$j++] = 'Department';
            $header[$j++] = 'Attended Doctor';
            $header[$j++] = 'Admission Date & Time';
            $header[$j++] = 'Discharge Date & Time';

            $header[$j++] = 'Is the Consent form for ICU admission available in the health record of an inpatient?';
            $header[$j++] = 'Is the Consent form for ICU admission complete?';
            $header[$j++] = 'Is the procedures consent form available in the health record of an applicable patient?';
            $header[$j++] = 'Are the risks, benefits, potential complications and alternatives to surgery explained and fully documented on consent form?';
            $header[$j++] = 'Is the signature of patient or representative, witness, and individual obtaining consent obtained?';
            $header[$j++] = 'Is the administration of anesthesia/sedation consent form available in the health record of an applicable patient?';
            $header[$j++] = 'Is it ensured that No abbreviations are used on consent forms?';
            $header[$j++] = 'Is the Initial assessment completed within 2 hours of admission to ICU?';
            $header[$j++] = 'Is the patients name and health record number, correct?';
            $header[$j++] = 'Is the Blood Investigation section completed correctly, if applicable?';
            $header[$j++] = 'Is the Known Allergies section completed correctly?';
            $header[$j++] = 'Is the Medication section completed correctly?';
            $header[$j++] = 'Are only approved abbreviations used?';
            $header[$j++] = 'Are the Chief complaints and history documented in Initial assessment?';
            $header[$j++] = 'Is the medication history documented in initial assessment?';
            $header[$j++] = 'Are the clinical findings and diagnosis documented In Initial assessment?';
            $header[$j++] = 'Is the medical assessment documented prior to surgery?';
            $header[$j++] = 'Is the Patient and Family Education documented?';
            $header[$j++] = 'Is the patient reassessed daily?';
            $header[$j++] = 'Is the diagnosis documented in Progress Note?';
            $header[$j++] = 'Are the clinical findings and status documented in Progress Note?';
            $header[$j++] = 'Is the Planned care documented in the form of measurable progress (goals)?';
            $header[$j++] = 'Is Planned Care reviewed by other disciplines?';
            $header[$j++] = 'Is the handover communication documented in every shift?';
            $header[$j++] = 'Is the care team note documented, if applicable?';
            $header[$j++] = 'Is the ICU transfer record documented, if applicable?';
            $header[$j++] = 'Is the critical care note documented, if applicable?';
            $header[$j++] = 'Is the restrain order documented, if applicable?';
            $header[$j++] = 'Is the restrain consent form obtained, if applicable?';


            $header[$j++] = 'Additional comments';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['audit_type'] = $data['audit_type'];
                $dataexport[$i]['date'] = date('Y-m-d H:i', strtotime($row->datetime));
                $dataexport[$i]['audit_by'] = $data['audit_by'];

                $dataexport[$i]['mid_no'] = $data['mid_no'];
                $dataexport[$i]['patient_name'] = $data['patient_name'];
                $dataexport[$i]['patient_age'] = $data['patient_age'];
                $dataexport[$i]['patient_gender'] = $data['patient_gender'];
                $dataexport[$i]['location'] = $data['location'];
                $dataexport[$i]['department'] = $data['department'];
                $dataexport[$i]['attended_doctor'] = $data['attended_doctor'];
                $dataexport[$i]['initial_assessment_hr6'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr6']));
                $dataexport[$i]['discharge_date_time'] = date('Y-m-d H:i', strtotime($data['discharge_date_time']));

                $dataexport[$i]['identification_details'] = ucfirst($data['identification_details']) . "\r\nRemarks: " . $data['identification_details_text'];
                $dataexport[$i]['vital_signs'] = ucfirst($data['vital_signs']) . "\r\nRemarks: " . $data['vital_signs_text'];
                $dataexport[$i]['surgery'] = ucfirst($data['surgery']) . "\r\nRemarks: " . $data['surgery_text'];
                $dataexport[$i]['complaints_communicated'] = ucfirst($data['complaints_communicated']) . "\r\nRemarks: " . $data['complaints_communicated_text'];
                $dataexport[$i]['ensure'] = ucfirst($data['ensure']) . "\r\nRemarks: " . $data['ensure_text'];
                $dataexport[$i]['intake'] = ucfirst($data['intake']) . "\r\nRemarks: " . $data['intake_text'];
                $dataexport[$i]['output'] = ucfirst($data['output']) . "\r\nRemarks: " . $data['output_text'];
                $dataexport[$i]['focus'] = ucfirst($data['focus']) . "\r\nRemarks: " . $data['focus_text'];
                $dataexport[$i]['meti'] = ucfirst($data['meti']) . "\r\nRemarks: " . $data['meti_text'];
                $dataexport[$i]['diagnostic'] = ucfirst($data['diagnostic']) . "\r\nRemarks: " . $data['diagnostic_text'];
                $dataexport[$i]['lab_results'] = ucfirst($data['lab_results']) . "\r\nRemarks: " . $data['lab_results_text'];
                $dataexport[$i]['pending_investigation'] = ucfirst($data['pending_investigation']) . "\r\nRemarks: " . $data['pending_investigation_text'];
                $dataexport[$i]['medicine_order'] = ucfirst($data['medicine_order']) . "\r\nRemarks: " . $data['medicine_order_text'];
                $dataexport[$i]['psychological'] = ucfirst($data['psychological']) . "\r\nRemarks: " . $data['psychological_text'];
                $dataexport[$i]['vulnerab'] = ucfirst($data['vulnerab']) . "\r\nRemarks: " . $data['vulnerab_text'];
                $dataexport[$i]['social'] = ucfirst($data['social']) . "\r\nRemarks: " . $data['social_text'];
                $dataexport[$i]['nutri'] = ucfirst($data['nutri']) . "\r\nRemarks: " . $data['nutri_text'];
                $dataexport[$i]['spiritual'] = ucfirst($data['spiritual']) . "\r\nRemarks: " . $data['spiritual_text'];
                $dataexport[$i]['suicide'] = ucfirst($data['suicide']) . "\r\nRemarks: " . $data['suicide_text'];
                $dataexport[$i]['risk'] = ucfirst($data['risk']) . "\r\nRemarks: " . $data['risk_text'];
                $dataexport[$i]['care'] = ucfirst($data['care']) . "\r\nRemarks: " . $data['care_text'];
                $dataexport[$i]['pfe'] = ucfirst($data['pfe']) . "\r\nRemarks: " . $data['pfe_text'];
                $dataexport[$i]['disch'] = ucfirst($data['disch']) . "\r\nRemarks: " . $data['disch_text'];
                $dataexport[$i]['facility_communicated'] = ucfirst($data['facility_communicated']) . "\r\nRemarks: " . $data['facility_communicated_text'];
                $dataexport[$i]['health_education'] = ucfirst($data['health_education']) . "\r\nRemarks: " . $data['health_education_text'];
                $dataexport[$i]['remarks1'] = ucfirst($data['remarks1']) . "\r\nRemarks: " . $data['remarks1_text'];
                $dataexport[$i]['urethral'] = ucfirst($data['urethral']) . "\r\nRemarks: " . $data['urethral_text'];
                $dataexport[$i]['urine_sample'] = ucfirst($data['urine_sample']) . "\r\nRemarks: " . $data['urine_sample_text'];
                $dataexport[$i]['bystander'] = ucfirst($data['bystander']) . "\r\nRemarks: " . $data['bystander_text'];


                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];


                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- Clinicians-ICU (Active) - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function overall_icu_closed()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_ma_icu_closed_mdc';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->audit_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Audit Name';
            $header[1] = 'Date & Time of Audit';
            $header[2] = 'Audit by';
            $header[3] = 'Patient MID';
            $header[4] = 'Patient Name';
            $header[5] = 'Patient Age';
            $header[6] = 'Patient Gender';

            $j = 7;

            $header[$j++] = 'Area';
            $header[$j++] = 'Department';
            $header[$j++] = 'Attended Doctor';
            $header[$j++] = 'Admission Date & Time';
            $header[$j++] = 'Discharge Date & Time';

            $header[$j++] = 'Is the Consent form for ICU admission available in the health record of an inpatient?';
            $header[$j++] = 'Is the Consent form for ICU admission complete?';
            $header[$j++] = 'Is the procedures consent form available in the health record of an applicable patient?';
            $header[$j++] = 'Are the risks, benefits, potential complications and alternatives to surgery explained and fully documented on consent form?';
            $header[$j++] = 'Is the signature of patient or representative, witness, and individual obtaining consent obtained?';
            $header[$j++] = 'Is the administration of anesthesia/sedation consent form available in the health record of an applicable patient?';
            $header[$j++] = 'Is it ensured that No abbreviations are used on consent forms?';
            $header[$j++] = 'Is the Initial assessment completed within 2 hours of admission to ICU?';
            $header[$j++] = 'Is the patients name and health record number, correct?';
            $header[$j++] = 'Is the Blood Investigation section completed correctly, if applicable?';
            $header[$j++] = 'Is the Known Allergies section completed correctly?';
            $header[$j++] = 'Is the Medication section completed correctly?';
            $header[$j++] = 'Are only approved abbreviations used?';
            $header[$j++] = 'Are the Chief complaints and history documented in Initial assessment?';
            $header[$j++] = 'Is the medication history documented in initial assessment?';
            $header[$j++] = 'Are the clinical findings and diagnosis documented In Initial assessment?';
            $header[$j++] = 'Is the medical assessment documented prior to surgery?';
            $header[$j++] = 'Is the Patient and Family Education documented?';
            $header[$j++] = 'Is the patient reassessed daily?';
            $header[$j++] = 'Is the diagnosis documented in Progress Note?';
            $header[$j++] = 'Are the clinical findings and status documented in Progress Note?';
            $header[$j++] = 'Is the Planned care documented in the form of measurable progress (goals)?';
            $header[$j++] = 'Is Planned Care reviewed by other disciplines?';
            $header[$j++] = 'Is the handover communication documented in every shift?';
            $header[$j++] = 'Is the care team note documented, if applicable?';
            $header[$j++] = 'Is the ICU transfer record documented, if applicable?';
            $header[$j++] = 'Is the critical care note documented, if applicable?';
            $header[$j++] = 'Is the restrain order documented, if applicable?';
            $header[$j++] = 'Is the restrain consent form obtained, if applicable?';


            $header[$j++] = 'Additional comments';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['audit_type'] = $data['audit_type'];
                $dataexport[$i]['date'] = date('Y-m-d H:i', strtotime($row->datetime));
                $dataexport[$i]['audit_by'] = $data['audit_by'];

                $dataexport[$i]['mid_no'] = $data['mid_no'];
                $dataexport[$i]['patient_name'] = $data['patient_name'];
                $dataexport[$i]['patient_age'] = $data['patient_age'];
                $dataexport[$i]['patient_gender'] = $data['patient_gender'];
                $dataexport[$i]['location'] = $data['location'];
                $dataexport[$i]['department'] = $data['department'];
                $dataexport[$i]['attended_doctor'] = $data['attended_doctor'];
                $dataexport[$i]['initial_assessment_hr6'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr6']));
                $dataexport[$i]['discharge_date_time'] = date('Y-m-d H:i', strtotime($data['discharge_date_time']));

                $dataexport[$i]['identification_details'] = ucfirst($data['identification_details']) . "\r\nRemarks: " . $data['identification_details_text'];
                $dataexport[$i]['vital_signs'] = ucfirst($data['vital_signs']) . "\r\nRemarks: " . $data['vital_signs_text'];
                $dataexport[$i]['surgery'] = ucfirst($data['surgery']) . "\r\nRemarks: " . $data['surgery_text'];
                $dataexport[$i]['complaints_communicated'] = ucfirst($data['complaints_communicated']) . "\r\nRemarks: " . $data['complaints_communicated_text'];
                $dataexport[$i]['ensure'] = ucfirst($data['ensure']) . "\r\nRemarks: " . $data['ensure_text'];
                $dataexport[$i]['intake'] = ucfirst($data['intake']) . "\r\nRemarks: " . $data['intake_text'];
                $dataexport[$i]['output'] = ucfirst($data['output']) . "\r\nRemarks: " . $data['output_text'];
                $dataexport[$i]['focus'] = ucfirst($data['focus']) . "\r\nRemarks: " . $data['focus_text'];
                $dataexport[$i]['meti'] = ucfirst($data['meti']) . "\r\nRemarks: " . $data['meti_text'];
                $dataexport[$i]['diagnostic'] = ucfirst($data['diagnostic']) . "\r\nRemarks: " . $data['diagnostic_text'];
                $dataexport[$i]['lab_results'] = ucfirst($data['lab_results']) . "\r\nRemarks: " . $data['lab_results_text'];
                $dataexport[$i]['pending_investigation'] = ucfirst($data['pending_investigation']) . "\r\nRemarks: " . $data['pending_investigation_text'];
                $dataexport[$i]['medicine_order'] = ucfirst($data['medicine_order']) . "\r\nRemarks: " . $data['medicine_order_text'];
                $dataexport[$i]['psychological'] = ucfirst($data['psychological']) . "\r\nRemarks: " . $data['psychological_text'];
                $dataexport[$i]['vulnerab'] = ucfirst($data['vulnerab']) . "\r\nRemarks: " . $data['vulnerab_text'];
                $dataexport[$i]['social'] = ucfirst($data['social']) . "\r\nRemarks: " . $data['social_text'];
                $dataexport[$i]['nutri'] = ucfirst($data['nutri']) . "\r\nRemarks: " . $data['nutri_text'];
                $dataexport[$i]['spiritual'] = ucfirst($data['spiritual']) . "\r\nRemarks: " . $data['spiritual_text'];
                $dataexport[$i]['suicide'] = ucfirst($data['suicide']) . "\r\nRemarks: " . $data['suicide_text'];
                $dataexport[$i]['risk'] = ucfirst($data['risk']) . "\r\nRemarks: " . $data['risk_text'];
                $dataexport[$i]['care'] = ucfirst($data['care']) . "\r\nRemarks: " . $data['care_text'];
                $dataexport[$i]['pfe'] = ucfirst($data['pfe']) . "\r\nRemarks: " . $data['pfe_text'];
                $dataexport[$i]['disch'] = ucfirst($data['disch']) . "\r\nRemarks: " . $data['disch_text'];
                $dataexport[$i]['facility_communicated'] = ucfirst($data['facility_communicated']) . "\r\nRemarks: " . $data['facility_communicated_text'];
                $dataexport[$i]['health_education'] = ucfirst($data['health_education']) . "\r\nRemarks: " . $data['health_education_text'];
                $dataexport[$i]['remarks1'] = ucfirst($data['remarks1']) . "\r\nRemarks: " . $data['remarks1_text'];
                $dataexport[$i]['urethral'] = ucfirst($data['urethral']) . "\r\nRemarks: " . $data['urethral_text'];
                $dataexport[$i]['urine_sample'] = ucfirst($data['urine_sample']) . "\r\nRemarks: " . $data['urine_sample_text'];
                $dataexport[$i]['bystander'] = ucfirst($data['bystander']) . "\r\nRemarks: " . $data['bystander_text'];


                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];


                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- Clinicians-ICU (Closed) - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function overall_primarycare_active()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_ma_primarycare_active_mdc';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->audit_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Audit Name';
            $header[1] = 'Date & Time of Audit';
            $header[2] = 'Audit by';
            $header[3] = 'Patient MID';
            $header[4] = 'Patient Name';
            $header[5] = 'Patient Age';
            $header[6] = 'Patient Gender';

            $j = 7;

            $header[$j++] = 'Area';
            $header[$j++] = 'Department';
            $header[$j++] = 'Attended Doctor';
            $header[$j++] = 'Admission Date & Time';
            $header[$j++] = 'Discharge Date & Time';

            $header[$j++] = 'Is the general consent form available in the health record of an inpatient?';
            $header[$j++] = 'Is the general consent form complete?';
            $header[$j++] = 'Is the high-risk procedures and treatments consent form (includes surgical or invasive procedures) is available in the health record of an applicable patient?';
            $header[$j++] = 'Is the blood and blood products consent form available in the health record of an applicable patient?';
            $header[$j++] = 'Is the blood and blood products consent form complete?';
            $header[$j++] = 'Are No abbreviations used on consent forms?';
            $header[$j++] = 'Is The signature of patient or representative, witness, and individual obtaining consent obtained?';
            $header[$j++] = 'Is the initial medical assessment completed within the first 24 hours of admission?';
            $header[$j++] = 'Is the Chief complaints and history are documented in Initial assessment?';
            $header[$j++] = 'Is the medication history documented in initial assessment?';
            $header[$j++] = 'Is the physical findings and diagnosis documented in Initial assessment?';
            $header[$j++] = 'Is the Significant Data Sheet complete, (outpatient Profile)?';
            $header[$j++] = 'Is the patient\'s name and health record number correct?';
            $header[$j++] = 'Is the Blood Investigation section completed correctly, if applicable?';
            $header[$j++] = 'Is the Known Allergies section completed correctly?';
            $header[$j++] = 'Is the Medication section completed correctly?';
            $header[$j++] = 'Is the Immunization section completed correctly, if applicable?';
            $header[$j++] = 'Are there dates and initials or signature against all applicable entries?';
            $header[$j++] = 'Are Only approved abbreviations used?';
            $header[$j++] = 'Are Patient and Family Education section of the Physician\'s Admission History and Physical Assessment completed?';
            $header[$j++] = 'Is the Discharge Planning section of the Physician\'s Admission History and Physical Assessment completed?';
            $header[$j++] = 'Is the patient screened for nutritional status and referred as necessary?';
            $header[$j++] = 'Is the patient screened for functional status and referred as necessary?';
            $header[$j++] = 'Is the patient reassessed daily. (Progress Notes)?';
            $header[$j++] = 'Is the diagnosis documented in Progress Note?';
            $header[$j++] = 'Are the complaints and physical findings documented in Progress Note?';
            $header[$j++] = 'Are the patient status and special issues documented in Progress Note?';
            $header[$j++] = 'Is Planned care documented in the form of measurable progress (goals)?';
            $header[$j++] = 'Is Planned Care reviewed by other disciplines?';
            $header[$j++] = 'Is a list of medications taken prior to admission documented (or there is documentation of none taken)?';
            $header[$j++] = 'Are Medications ordered written in patient\'s record and complete?';
            $header[$j++] = 'Do PRN orders contain indications?';
            $header[$j++] = 'Are all physician orders including non-medication orders in a uniform location?';
            $header[$j++] = 'Are Verbal/ Telephone orders signed within the approved timeframe?';
            $header[$j++] = 'Is Diet order documented?';
            $header[$j++] = 'Is it ensured that During all phases of inpatient care, the individual responsible for the patient\'s care is identified in documentation related to the patient\'s plan of care?';
            $header[$j++] = 'Is the Department handover documented,if applicable?';
            $header[$j++] = 'Are the consultation request and Consultation Response documented in EMR?';

            $header[$j++] = 'Additional comments';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['audit_type'] = $data['audit_type'];
                $dataexport[$i]['date'] = date('Y-m-d H:i', strtotime($row->datetime));
                $dataexport[$i]['audit_by'] = $data['audit_by'];

                $dataexport[$i]['mid_no'] = $data['mid_no'];
                $dataexport[$i]['patient_name'] = $data['patient_name'];
                $dataexport[$i]['patient_age'] = $data['patient_age'];
                $dataexport[$i]['patient_gender'] = $data['patient_gender'];
                $dataexport[$i]['location'] = $data['location'];
                $dataexport[$i]['department'] = $data['department'];
                $dataexport[$i]['attended_doctor'] = $data['attended_doctor'];
                $dataexport[$i]['initial_assessment_hr6'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr6']));
                $dataexport[$i]['discharge_date_time'] = date('Y-m-d H:i', strtotime($data['discharge_date_time']));

                $dataexport[$i]['identification_details'] = ucfirst($data['identification_details']) . "\r\nRemarks: " . $data['identification_details_text'];
                $dataexport[$i]['vital_signs'] = ucfirst($data['vital_signs']) . "\r\nRemarks: " . $data['vital_signs_text'];
                $dataexport[$i]['surgery'] = ucfirst($data['surgery']) . "\r\nRemarks: " . $data['surgery_text'];
                $dataexport[$i]['complaints_communicated'] = ucfirst($data['complaints_communicated']) . "\r\nRemarks: " . $data['complaints_communicated_text'];
                $dataexport[$i]['ensure'] = ucfirst($data['ensure']) . "\r\nRemarks: " . $data['ensure_text'];
                $dataexport[$i]['intake'] = ucfirst($data['intake']) . "\r\nRemarks: " . $data['intake_text'];
                $dataexport[$i]['output'] = ucfirst($data['output']) . "\r\nRemarks: " . $data['output_text'];
                $dataexport[$i]['focus'] = ucfirst($data['focus']) . "\r\nRemarks: " . $data['focus_text'];
                $dataexport[$i]['meti'] = ucfirst($data['meti']) . "\r\nRemarks: " . $data['meti_text'];
                $dataexport[$i]['diagnostic'] = ucfirst($data['diagnostic']) . "\r\nRemarks: " . $data['diagnostic_text'];
                $dataexport[$i]['lab_results'] = ucfirst($data['lab_results']) . "\r\nRemarks: " . $data['lab_results_text'];
                $dataexport[$i]['pending_investigation'] = ucfirst($data['pending_investigation']) . "\r\nRemarks: " . $data['pending_investigation_text'];
                $dataexport[$i]['medicine_order'] = ucfirst($data['medicine_order']) . "\r\nRemarks: " . $data['medicine_order_text'];
                $dataexport[$i]['psychological'] = ucfirst($data['psychological']) . "\r\nRemarks: " . $data['psychological_text'];
                $dataexport[$i]['vulnerab'] = ucfirst($data['vulnerab']) . "\r\nRemarks: " . $data['vulnerab_text'];
                $dataexport[$i]['social'] = ucfirst($data['social']) . "\r\nRemarks: " . $data['social_text'];
                $dataexport[$i]['nutri'] = ucfirst($data['nutri']) . "\r\nRemarks: " . $data['nutri_text'];
                $dataexport[$i]['spiritual'] = ucfirst($data['spiritual']) . "\r\nRemarks: " . $data['spiritual_text'];
                $dataexport[$i]['suicide'] = ucfirst($data['suicide']) . "\r\nRemarks: " . $data['suicide_text'];
                $dataexport[$i]['risk'] = ucfirst($data['risk']) . "\r\nRemarks: " . $data['risk_text'];
                $dataexport[$i]['care'] = ucfirst($data['care']) . "\r\nRemarks: " . $data['care_text'];
                $dataexport[$i]['pfe'] = ucfirst($data['pfe']) . "\r\nRemarks: " . $data['pfe_text'];
                $dataexport[$i]['disch'] = ucfirst($data['disch']) . "\r\nRemarks: " . $data['disch_text'];
                $dataexport[$i]['facility_communicated'] = ucfirst($data['facility_communicated']) . "\r\nRemarks: " . $data['facility_communicated_text'];
                $dataexport[$i]['health_education'] = ucfirst($data['health_education']) . "\r\nRemarks: " . $data['health_education_text'];
                $dataexport[$i]['remarks1'] = ucfirst($data['remarks1']) . "\r\nRemarks: " . $data['remarks1_text'];
                $dataexport[$i]['urethral'] = ucfirst($data['urethral']) . "\r\nRemarks: " . $data['urethral_text'];
                $dataexport[$i]['urine_sample'] = ucfirst($data['urine_sample']) . "\r\nRemarks: " . $data['urine_sample_text'];
                $dataexport[$i]['bystander'] = ucfirst($data['bystander']) . "\r\nRemarks: " . $data['bystander_text'];
                $dataexport[$i]['instruments'] = ucfirst($data['instruments']) . "\r\nRemarks: " . $data['instruments_text'];
                $dataexport[$i]['sterile'] = ucfirst($data['sterile']) . "\r\nRemarks: " . $data['sterile_text'];
                $dataexport[$i]['antibiotics'] = ucfirst($data['antibiotics']) . "\r\nRemarks: " . $data['antibiotics_text'];
                $dataexport[$i]['surgical_site'] = ucfirst($data['surgical_site']) . "\r\nRemarks: " . $data['surgical_site_text'];
                $dataexport[$i]['wound'] = ucfirst($data['wound']) . "\r\nRemarks: " . $data['wound_text'];
                $dataexport[$i]['documented'] = ucfirst($data['documented']) . "\r\nRemarks: " . $data['documented_text'];
                $dataexport[$i]['adequate_facilities'] = ucfirst($data['adequate_facilities']) . "\r\nRemarks: " . $data['adequate_facilities_text'];
                $dataexport[$i]['sufficient_lighting'] = ucfirst($data['sufficient_lighting']) . "\r\nRemarks: " . $data['sufficient_lighting_text'];
                $dataexport[$i]['storage_facility_for_food'] = ucfirst($data['storage_facility_for_food']) . "\r\nRemarks: " . $data['storage_facility_for_food_text'];


                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];


                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- Clinicians-Primary Care Provider (Active) - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function overall_primarycare_closed()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_ma_primarycare_closed_mdc';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->audit_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Audit Name';
            $header[1] = 'Date & Time of Audit';
            $header[2] = 'Audit by';
            $header[3] = 'Patient MID';
            $header[4] = 'Patient Name';
            $header[5] = 'Patient Age';
            $header[6] = 'Patient Gender';

            $j = 7;

            $header[$j++] = 'Area';
            $header[$j++] = 'Department';
            $header[$j++] = 'Attended Doctor';
            $header[$j++] = 'Admission Date & Time';
            $header[$j++] = 'Discharge Date & Time';

            $header[$j++] = 'Is the general consent form available in the health record of an inpatient?';
            $header[$j++] = 'Is the general consent form complete?';
            $header[$j++] = 'Is the high-risk procedures and treatments consent form (includes surgical or invasive procedures) is available in the health record of an applicable patient?';
            $header[$j++] = 'Is the blood and blood products consent form available in the health record of an applicable patient?';
            $header[$j++] = 'Is the blood and blood products consent form complete?';
            $header[$j++] = 'Are No abbreviations used on consent forms?';
            $header[$j++] = 'Is The signature of patient or representative, witness, and individual obtaining consent obtained?';
            $header[$j++] = 'Is the initial medical assessment completed within the first 24 hours of admission?';
            $header[$j++] = 'Is the Chief complaints and history are documented in Initial assessment?';
            $header[$j++] = 'Is the medication history documented in initial assessment?';
            $header[$j++] = 'Is the physical findings and diagnosis documented in Initial assessment?';
            $header[$j++] = 'Is the Significant Data Sheet complete, (outpatient Profile)?';
            $header[$j++] = 'Is the patient\'s name and health record number correct?';
            $header[$j++] = 'Is the Blood Investigation section completed correctly, if applicable?';
            $header[$j++] = 'Is the Known Allergies section completed correctly?';
            $header[$j++] = 'Is the Medication section completed correctly?';
            $header[$j++] = 'Is the Immunization section completed correctly, if applicable?';
            $header[$j++] = 'Are there dates and initials or signature against all applicable entries?';
            $header[$j++] = 'Are Only approved abbreviations used?';
            $header[$j++] = 'Are Patient and Family Education section of the Physician\'s Admission History and Physical Assessment completed?';
            $header[$j++] = 'Is the Discharge Planning section of the Physician\'s Admission History and Physical Assessment completed?';
            $header[$j++] = 'Is the patient screened for nutritional status and referred as necessary?';
            $header[$j++] = 'Is the patient screened for functional status and referred as necessary?';
            $header[$j++] = 'Is the patient reassessed daily. (Progress Notes)?';
            $header[$j++] = 'Is the diagnosis documented in Progress Note?';
            $header[$j++] = 'Are the complaints and physical findings documented in Progress Note?';
            $header[$j++] = 'Are the patient status and special issues documented in Progress Note?';
            $header[$j++] = 'Is Planned care documented in the form of measurable progress (goals)?';
            $header[$j++] = 'Is Planned Care reviewed by other disciplines?';
            $header[$j++] = 'Is a list of medications taken prior to admission documented (or there is documentation of none taken)?';
            $header[$j++] = 'Are Medications ordered written in patient\'s record and complete?';
            $header[$j++] = 'Do PRN orders contain indications?';
            $header[$j++] = 'Are all physician orders including non-medication orders in a uniform location?';
            $header[$j++] = 'Are Verbal/ Telephone orders signed within the approved timeframe?';
            $header[$j++] = 'Is Diet order documented?';
            $header[$j++] = 'Is it ensured that During all phases of inpatient care, the individual responsible for the patient\'s care is identified in documentation related to the patient\'s plan of care?';
            $header[$j++] = 'Is the Discharge order complete?';
            $header[$j++] = 'Is the Department handover documented,if applicable?';
            $header[$j++] = 'Are the consultation request and Consultation Response documented in EMR?';
            $header[$j++] = 'Is Discharge summary complete?';
            $header[$j++] = 'Are Discharge and follow up instructions individualized and complete?';
            $header[$j++] = 'Is Record of transferred patient complete?';
            $header[$j++] = 'Is the Name of accepting physician/organization documented?';
            $header[$j++] = 'Is Transfer summary report complete?';
            $header[$j++] = 'Is it ensured that No abbreviations are used in discharge summary?';
            $header[$j++] = 'Does the discharge summary contain information on when to obtain urgent care and how to obtain urgent care?';
            $header[$j++] = 'Are Medication and follow up advice documented in Discharge summary?';
            $header[$j++] = 'Are Significant findings and diagnosis documented in Discharge Summary?';


            $header[$j++] = 'Additional comments';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['audit_type'] = $data['audit_type'];
                $dataexport[$i]['date'] = date('Y-m-d H:i', strtotime($row->datetime));
                $dataexport[$i]['audit_by'] = $data['audit_by'];

                $dataexport[$i]['mid_no'] = $data['mid_no'];
                $dataexport[$i]['patient_name'] = $data['patient_name'];
                $dataexport[$i]['patient_age'] = $data['patient_age'];
                $dataexport[$i]['patient_gender'] = $data['patient_gender'];
                $dataexport[$i]['location'] = $data['location'];
                $dataexport[$i]['department'] = $data['department'];
                $dataexport[$i]['attended_doctor'] = $data['attended_doctor'];
                $dataexport[$i]['initial_assessment_hr6'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr6']));
                $dataexport[$i]['discharge_date_time'] = date('Y-m-d H:i', strtotime($data['discharge_date_time']));

                $dataexport[$i]['identification_details'] = ucfirst($data['identification_details']) . "\r\nRemarks: " . $data['identification_details_text'];
                $dataexport[$i]['vital_signs'] = ucfirst($data['vital_signs']) . "\r\nRemarks: " . $data['vital_signs_text'];
                $dataexport[$i]['surgery'] = ucfirst($data['surgery']) . "\r\nRemarks: " . $data['surgery_text'];
                $dataexport[$i]['complaints_communicated'] = ucfirst($data['complaints_communicated']) . "\r\nRemarks: " . $data['complaints_communicated_text'];
                $dataexport[$i]['ensure'] = ucfirst($data['ensure']) . "\r\nRemarks: " . $data['ensure_text'];
                $dataexport[$i]['intake'] = ucfirst($data['intake']) . "\r\nRemarks: " . $data['intake_text'];
                $dataexport[$i]['output'] = ucfirst($data['output']) . "\r\nRemarks: " . $data['output_text'];
                $dataexport[$i]['focus'] = ucfirst($data['focus']) . "\r\nRemarks: " . $data['focus_text'];
                $dataexport[$i]['meti'] = ucfirst($data['meti']) . "\r\nRemarks: " . $data['meti_text'];
                $dataexport[$i]['diagnostic'] = ucfirst($data['diagnostic']) . "\r\nRemarks: " . $data['diagnostic_text'];
                $dataexport[$i]['lab_results'] = ucfirst($data['lab_results']) . "\r\nRemarks: " . $data['lab_results_text'];
                $dataexport[$i]['pending_investigation'] = ucfirst($data['pending_investigation']) . "\r\nRemarks: " . $data['pending_investigation_text'];
                $dataexport[$i]['medicine_order'] = ucfirst($data['medicine_order']) . "\r\nRemarks: " . $data['medicine_order_text'];
                $dataexport[$i]['psychological'] = ucfirst($data['psychological']) . "\r\nRemarks: " . $data['psychological_text'];
                $dataexport[$i]['vulnerab'] = ucfirst($data['vulnerab']) . "\r\nRemarks: " . $data['vulnerab_text'];
                $dataexport[$i]['social'] = ucfirst($data['social']) . "\r\nRemarks: " . $data['social_text'];
                $dataexport[$i]['nutri'] = ucfirst($data['nutri']) . "\r\nRemarks: " . $data['nutri_text'];
                $dataexport[$i]['spiritual'] = ucfirst($data['spiritual']) . "\r\nRemarks: " . $data['spiritual_text'];
                $dataexport[$i]['suicide'] = ucfirst($data['suicide']) . "\r\nRemarks: " . $data['suicide_text'];
                $dataexport[$i]['risk'] = ucfirst($data['risk']) . "\r\nRemarks: " . $data['risk_text'];
                $dataexport[$i]['care'] = ucfirst($data['care']) . "\r\nRemarks: " . $data['care_text'];
                $dataexport[$i]['pfe'] = ucfirst($data['pfe']) . "\r\nRemarks: " . $data['pfe_text'];
                $dataexport[$i]['disch'] = ucfirst($data['disch']) . "\r\nRemarks: " . $data['disch_text'];
                $dataexport[$i]['facility_communicated'] = ucfirst($data['facility_communicated']) . "\r\nRemarks: " . $data['facility_communicated_text'];
                $dataexport[$i]['health_education'] = ucfirst($data['health_education']) . "\r\nRemarks: " . $data['health_education_text'];
                $dataexport[$i]['remarks1'] = ucfirst($data['remarks1']) . "\r\nRemarks: " . $data['remarks1_text'];
                $dataexport[$i]['urethral'] = ucfirst($data['urethral']) . "\r\nRemarks: " . $data['urethral_text'];
                $dataexport[$i]['urine_sample'] = ucfirst($data['urine_sample']) . "\r\nRemarks: " . $data['urine_sample_text'];
                $dataexport[$i]['bystander'] = ucfirst($data['bystander']) . "\r\nRemarks: " . $data['bystander_text'];
                $dataexport[$i]['instruments'] = ucfirst($data['instruments']) . "\r\nRemarks: " . $data['instruments_text'];
                $dataexport[$i]['sterile'] = ucfirst($data['sterile']) . "\r\nRemarks: " . $data['sterile_text'];
                $dataexport[$i]['antibiotics'] = ucfirst($data['antibiotics']) . "\r\nRemarks: " . $data['antibiotics_text'];
                $dataexport[$i]['surgical_site'] = ucfirst($data['surgical_site']) . "\r\nRemarks: " . $data['surgical_site_text'];
                $dataexport[$i]['wound'] = ucfirst($data['wound']) . "\r\nRemarks: " . $data['wound_text'];
                $dataexport[$i]['documented'] = ucfirst($data['documented']) . "\r\nRemarks: " . $data['documented_text'];
                $dataexport[$i]['adequate_facilities'] = ucfirst($data['adequate_facilities']) . "\r\nRemarks: " . $data['adequate_facilities_text'];
                $dataexport[$i]['char'] = ucfirst($data['char']) . "\r\nRemarks: " . $data['char_text'];
                $dataexport[$i]['sufficient_lighting'] = ucfirst($data['sufficient_lighting']) . "\r\nRemarks: " . $data['sufficient_lighting_text'];
                $dataexport[$i]['storage_facility_for_food'] = ucfirst($data['storage_facility_for_food']) . "\r\nRemarks: " . $data['storage_facility_for_food_text'];
                $dataexport[$i]['personnel_hygiene_facilities'] = ucfirst($data['personnel_hygiene_facilities']) . "\r\nRemarks: " . $data['personnel_hygiene_facilities_text'];
                $dataexport[$i]['food_material_testing'] = ucfirst($data['food_material_testing']) . "\r\nRemarks: " . $data['food_material_testing_text'];
                $dataexport[$i]['incoming_material'] = ucfirst($data['incoming_material']) . "\r\nRemarks: " . $data['incoming_material_text'];
                $dataexport[$i]['raw_materials_inspection'] = ucfirst($data['raw_materials_inspection']) . "\r\nRemarks: " . $data['raw_materials_inspection_text'];
                $dataexport[$i]['storage_of_materials'] = ucfirst($data['storage_of_materials']) . "\r\nRemarks: " . $data['storage_of_materials_text'];
                $dataexport[$i]['raw_materials_cleaning'] = ucfirst($data['raw_materials_cleaning']) . "\r\nRemarks: " . $data['raw_materials_cleaning_text'];
                $dataexport[$i]['equipment_sanitization'] = ucfirst($data['equipment_sanitization']) . "\r\nRemarks: " . $data['equipment_sanitization_text'];
                $dataexport[$i]['frozen_food_thawing'] = ucfirst($data['frozen_food_thawing']) . "\r\nRemarks: " . $data['frozen_food_thawing_text'];
                $dataexport[$i]['vegetarian_and_non_vegetarian'] = ucfirst($data['vegetarian_and_non_vegetarian']) . "\r\nRemarks: " . $data['vegetarian_and_non_vegetarian_text'];


                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];


                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- Clinicians-Primary Care Provider (Closed) - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function overall_sedation_active()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_ma_sedation_active_mdc';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->audit_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Audit Name';
            $header[1] = 'Date & Time of Audit';
            $header[2] = 'Audit by';
            $header[3] = 'Patient MID';
            $header[4] = 'Patient Name';
            $header[5] = 'Patient Age';
            $header[6] = 'Patient Gender';

            $j = 7;

            $header[$j++] = 'Area';
            $header[$j++] = 'Department';
            $header[$j++] = 'Attended Doctor';
            $header[$j++] = 'Admission Date & Time';
            $header[$j++] = 'Discharge Date & Time';

            $header[$j++] = 'Is the high-risk procedures and treatments consent form available in the health record of an applicable patient?';
            $header[$j++] = 'Are the risks, benefits, potential complications and alternatives to surgery explained and fully documented on high-risk procedures and treatments consent form?';
            $header[$j++] = 'Is the signature of patient or representative, witness, and individual obtaining consent obtained?';
            $header[$j++] = 'Is the administration of anesthesia/sedation consent form available in the health record of an applicable patient?';
            $header[$j++] = 'Is the risks, benefits, and alternatives of anesthesia, moderate sedation, or deep sedation explained and fully documented on administration of anesthesia consent form?';
            $header[$j++] = 'Is it ensured that No abbreviations are used on consent forms?';
            $header[$j++] = 'Is Planned care documented in the form of measurable progress (goals)?';
            $header[$j++] = 'Is Planned Care reviewed by other disciplines?';
            $header[$j++] = 'Is a pre-sedation assessment performed on an applicable patient?';
            $header[$j++] = 'Is an applicable patient monitored during sedation?';
            $header[$j++] = 'Is a Patient post sedation status monitored until reach recovery criteria?';
            $header[$j++] = 'Is Procedure Note / Report documented?';


            $header[$j++] = 'Additional comments';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['audit_type'] = $data['audit_type'];
                $dataexport[$i]['date'] = date('Y-m-d H:i', strtotime($row->datetime));
                $dataexport[$i]['audit_by'] = $data['audit_by'];

                $dataexport[$i]['mid_no'] = $data['mid_no'];
                $dataexport[$i]['patient_name'] = $data['patient_name'];
                $dataexport[$i]['patient_age'] = $data['patient_age'];
                $dataexport[$i]['patient_gender'] = $data['patient_gender'];
                $dataexport[$i]['location'] = $data['location'];
                $dataexport[$i]['department'] = $data['department'];
                $dataexport[$i]['attended_doctor'] = $data['attended_doctor'];
                $dataexport[$i]['initial_assessment_hr6'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr6']));
                $dataexport[$i]['discharge_date_time'] = date('Y-m-d H:i', strtotime($data['discharge_date_time']));

                $dataexport[$i]['identification_details'] = ucfirst($data['identification_details']) . "\r\nRemarks: " . $data['identification_details_text'];
                $dataexport[$i]['vital_signs'] = ucfirst($data['vital_signs']) . "\r\nRemarks: " . $data['vital_signs_text'];
                $dataexport[$i]['surgery'] = ucfirst($data['surgery']) . "\r\nRemarks: " . $data['surgery_text'];
                $dataexport[$i]['complaints_communicated'] = ucfirst($data['complaints_communicated']) . "\r\nRemarks: " . $data['complaints_communicated_text'];
                $dataexport[$i]['ensure'] = ucfirst($data['ensure']) . "\r\nRemarks: " . $data['ensure_text'];
                $dataexport[$i]['intake'] = ucfirst($data['intake']) . "\r\nRemarks: " . $data['intake_text'];
                $dataexport[$i]['output'] = ucfirst($data['output']) . "\r\nRemarks: " . $data['output_text'];
                $dataexport[$i]['focus'] = ucfirst($data['focus']) . "\r\nRemarks: " . $data['focus_text'];
                $dataexport[$i]['meti'] = ucfirst($data['meti']) . "\r\nRemarks: " . $data['meti_text'];
                $dataexport[$i]['diagnostic'] = ucfirst($data['diagnostic']) . "\r\nRemarks: " . $data['diagnostic_text'];
                $dataexport[$i]['lab_results'] = ucfirst($data['lab_results']) . "\r\nRemarks: " . $data['lab_results_text'];
                $dataexport[$i]['pending_investigation'] = ucfirst($data['pending_investigation']) . "\r\nRemarks: " . $data['pending_investigation_text'];


                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];


                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- Clinicians-Sedation (Active) - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function overall_sedation_closed()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_ma_sedation_closed_mdc';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->audit_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Audit Name';
            $header[1] = 'Date & Time of Audit';
            $header[2] = 'Audit by';
            $header[3] = 'Patient MID';
            $header[4] = 'Patient Name';
            $header[5] = 'Patient Age';
            $header[6] = 'Patient Gender';

            $j = 7;

            $header[$j++] = 'Area';
            $header[$j++] = 'Department';
            $header[$j++] = 'Attended Doctor';
            $header[$j++] = 'Admission Date & Time';
            $header[$j++] = 'Discharge Date & Time';

            $header[$j++] = 'Is the high-risk procedures and treatments consent form available in the health record of an applicable patient?';
            $header[$j++] = 'Are the risks, benefits, potential complications and alternatives to surgery explained and fully documented on high-risk procedures and treatments consent form?';
            $header[$j++] = 'Is the signature of patient or representative, witness, and individual obtaining consent obtained?';
            $header[$j++] = 'Is the administration of anesthesia/sedation consent form available in the health record of an applicable patient?';
            $header[$j++] = 'Is the risks, benefits, and alternatives of anesthesia, moderate sedation, or deep sedation explained and fully documented on administration of anesthesia consent form?';
            $header[$j++] = 'Is it ensured that No abbreviations are used on consent forms?';
            $header[$j++] = 'Is Planned care documented in the form of measurable progress (goals)?';
            $header[$j++] = 'Is Planned Care reviewed by other disciplines?';
            $header[$j++] = 'Is a pre-sedation assessment performed on an applicable patient?';
            $header[$j++] = 'Is an applicable patient monitored during sedation?';
            $header[$j++] = 'Is a Patient post sedation status monitored until reach recovery criteria?';
            $header[$j++] = 'Is Procedure Note / Report documented?';


            $header[$j++] = 'Additional comments';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['audit_type'] = $data['audit_type'];
                $dataexport[$i]['date'] = date('Y-m-d H:i', strtotime($row->datetime));
                $dataexport[$i]['audit_by'] = $data['audit_by'];

                $dataexport[$i]['mid_no'] = $data['mid_no'];
                $dataexport[$i]['patient_name'] = $data['patient_name'];
                $dataexport[$i]['patient_age'] = $data['patient_age'];
                $dataexport[$i]['patient_gender'] = $data['patient_gender'];
                $dataexport[$i]['location'] = $data['location'];
                $dataexport[$i]['department'] = $data['department'];
                $dataexport[$i]['attended_doctor'] = $data['attended_doctor'];
                $dataexport[$i]['initial_assessment_hr6'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr6']));
                $dataexport[$i]['discharge_date_time'] = date('Y-m-d H:i', strtotime($data['discharge_date_time']));

                $dataexport[$i]['identification_details'] = ucfirst($data['identification_details']) . "\r\nRemarks: " . $data['identification_details_text'];
                $dataexport[$i]['vital_signs'] = ucfirst($data['vital_signs']) . "\r\nRemarks: " . $data['vital_signs_text'];
                $dataexport[$i]['surgery'] = ucfirst($data['surgery']) . "\r\nRemarks: " . $data['surgery_text'];
                $dataexport[$i]['complaints_communicated'] = ucfirst($data['complaints_communicated']) . "\r\nRemarks: " . $data['complaints_communicated_text'];
                $dataexport[$i]['ensure'] = ucfirst($data['ensure']) . "\r\nRemarks: " . $data['ensure_text'];
                $dataexport[$i]['intake'] = ucfirst($data['intake']) . "\r\nRemarks: " . $data['intake_text'];
                $dataexport[$i]['output'] = ucfirst($data['output']) . "\r\nRemarks: " . $data['output_text'];
                $dataexport[$i]['focus'] = ucfirst($data['focus']) . "\r\nRemarks: " . $data['focus_text'];
                $dataexport[$i]['meti'] = ucfirst($data['meti']) . "\r\nRemarks: " . $data['meti_text'];
                $dataexport[$i]['diagnostic'] = ucfirst($data['diagnostic']) . "\r\nRemarks: " . $data['diagnostic_text'];
                $dataexport[$i]['lab_results'] = ucfirst($data['lab_results']) . "\r\nRemarks: " . $data['lab_results_text'];
                $dataexport[$i]['pending_investigation'] = ucfirst($data['pending_investigation']) . "\r\nRemarks: " . $data['pending_investigation_text'];


                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];


                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- Clinicians-Sedation (Closed) - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function overall_surgeons_active()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_ma_surgeons_active_mdc';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->audit_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Audit Name';
            $header[1] = 'Date & Time of Audit';
            $header[2] = 'Audit by';
            $header[3] = 'Patient MID';
            $header[4] = 'Patient Name';
            $header[5] = 'Patient Age';
            $header[6] = 'Patient Gender';

            $j = 7;

            $header[$j++] = 'Area';
            $header[$j++] = 'Department';
            $header[$j++] = 'Attended Doctor';
            $header[$j++] = 'Admission Date & Time';
            $header[$j++] = 'Discharge Date & Time';

            $header[$j++] = 'Is the general consent form available in the health record of an inpatient?';
            $header[$j++] = 'Is the general consent form complete?';
            $header[$j++] = 'Is the high-risk procedures and treatments consent form (includes surgical or invasive procedures) is available in the health record of an applicable patient?';
            $header[$j++] = 'Is the blood and blood products consent form available in the health record of an applicable patient?';
            $header[$j++] = 'Is the blood and blood products consent form complete?';
            $header[$j++] = 'Are No abbreviations used on consent forms?';
            $header[$j++] = 'Is The signature of patient or representative, witness, and individual obtaining consent obtained?';
            $header[$j++] = 'Is the initial medical assessment completed within the first 24 hours of admission?';
            $header[$j++] = 'Is the Chief complaints and history are documented in Initial assessment?';
            $header[$j++] = 'Is the medication history documented in initial assessment?';
            $header[$j++] = 'Is the physical findings and diagnosis documented in Initial assessment?';
            $header[$j++] = 'Is the Significant Data Sheet complete, (outpatient Profile)?';
            $header[$j++] = 'Is the patient\'s name and health record number correct?';
            $header[$j++] = 'Is the Blood Investigation section completed correctly, if applicable?';
            $header[$j++] = 'Is the Known Allergies section completed correctly?';
            $header[$j++] = 'Is the Medication section completed correctly?';
            $header[$j++] = 'Is the Immunization section completed correctly, if applicable?';
            $header[$j++] = 'Are there dates and initials or signature against all applicable entries?';
            $header[$j++] = 'Are Only approved abbreviations used?';
            $header[$j++] = 'Are Patient and Family Education section of the Physician\'s Admission History and Physical Assessment completed?';
            $header[$j++] = 'Is the Discharge Planning section of the Physician\'s Admission History and Physical Assessment completed?';
            $header[$j++] = 'Is the patient screened for nutritional status and referred as necessary?';
            $header[$j++] = 'Is the patient screened for functional status and referred as necessary?';
            $header[$j++] = 'Is the patient reassessed daily. (Progress Notes)?';
            $header[$j++] = 'Is the diagnosis documented in Progress Note?';
            $header[$j++] = 'Are the complaints and physical findings documented in Progress Note?';
            $header[$j++] = 'Are the patient status and special issues documented in Progress Note?';
            $header[$j++] = 'Is Planned care documented in the form of measurable progress (goals)?';
            $header[$j++] = 'Is Planned Care reviewed by other disciplines?';
            $header[$j++] = 'Is a list of medications taken prior to admission documented (or there is documentation of none taken)?';
            $header[$j++] = 'Are Medications ordered written in patient\'s record and complete?';
            $header[$j++] = 'Do PRN orders contain indications?';
            $header[$j++] = 'Are all physician orders including non-medication orders in a uniform location?';
            $header[$j++] = 'Are Verbal/ Telephone orders signed within the approved timeframe?';
            $header[$j++] = 'Is Diet order documented?';
            $header[$j++] = 'Is it ensured that During all phases of inpatient care, the individual responsible for the patient\'s care is identified in documentation related to the patient\'s plan of care?';
            $header[$j++] = 'Is the Department handover documented,if applicable?';
            $header[$j++] = 'Are the consultation request and Consultation Response documented in EMR?';

            $header[$j++] = 'Additional comments';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['audit_type'] = $data['audit_type'];
                $dataexport[$i]['date'] = date('Y-m-d H:i', strtotime($row->datetime));
                $dataexport[$i]['audit_by'] = $data['audit_by'];

                $dataexport[$i]['mid_no'] = $data['mid_no'];
                $dataexport[$i]['patient_name'] = $data['patient_name'];
                $dataexport[$i]['patient_age'] = $data['patient_age'];
                $dataexport[$i]['patient_gender'] = $data['patient_gender'];
                $dataexport[$i]['location'] = $data['location'];
                $dataexport[$i]['department'] = $data['department'];
                $dataexport[$i]['attended_doctor'] = $data['attended_doctor'];
                $dataexport[$i]['initial_assessment_hr6'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr6']));
                $dataexport[$i]['discharge_date_time'] = date('Y-m-d H:i', strtotime($data['discharge_date_time']));

                $dataexport[$i]['identification_details'] = ucfirst($data['identification_details']) . "\r\nRemarks: " . $data['identification_details_text'];
                $dataexport[$i]['vital_signs'] = ucfirst($data['vital_signs']) . "\r\nRemarks: " . $data['vital_signs_text'];
                $dataexport[$i]['surgery'] = ucfirst($data['surgery']) . "\r\nRemarks: " . $data['surgery_text'];
                $dataexport[$i]['complaints_communicated'] = ucfirst($data['complaints_communicated']) . "\r\nRemarks: " . $data['complaints_communicated_text'];
                $dataexport[$i]['ensure'] = ucfirst($data['ensure']) . "\r\nRemarks: " . $data['ensure_text'];
                $dataexport[$i]['intake'] = ucfirst($data['intake']) . "\r\nRemarks: " . $data['intake_text'];
                $dataexport[$i]['output'] = ucfirst($data['output']) . "\r\nRemarks: " . $data['output_text'];
                $dataexport[$i]['focus'] = ucfirst($data['focus']) . "\r\nRemarks: " . $data['focus_text'];
                $dataexport[$i]['meti'] = ucfirst($data['meti']) . "\r\nRemarks: " . $data['meti_text'];
                $dataexport[$i]['diagnostic'] = ucfirst($data['diagnostic']) . "\r\nRemarks: " . $data['diagnostic_text'];
                $dataexport[$i]['lab_results'] = ucfirst($data['lab_results']) . "\r\nRemarks: " . $data['lab_results_text'];
                $dataexport[$i]['pending_investigation'] = ucfirst($data['pending_investigation']) . "\r\nRemarks: " . $data['pending_investigation_text'];
                $dataexport[$i]['medicine_order'] = ucfirst($data['medicine_order']) . "\r\nRemarks: " . $data['medicine_order_text'];
                $dataexport[$i]['psychological'] = ucfirst($data['psychological']) . "\r\nRemarks: " . $data['psychological_text'];
                $dataexport[$i]['vulnerab'] = ucfirst($data['vulnerab']) . "\r\nRemarks: " . $data['vulnerab_text'];
                $dataexport[$i]['social'] = ucfirst($data['social']) . "\r\nRemarks: " . $data['social_text'];
                $dataexport[$i]['nutri'] = ucfirst($data['nutri']) . "\r\nRemarks: " . $data['nutri_text'];
                $dataexport[$i]['spiritual'] = ucfirst($data['spiritual']) . "\r\nRemarks: " . $data['spiritual_text'];
                $dataexport[$i]['suicide'] = ucfirst($data['suicide']) . "\r\nRemarks: " . $data['suicide_text'];
                $dataexport[$i]['risk'] = ucfirst($data['risk']) . "\r\nRemarks: " . $data['risk_text'];
                $dataexport[$i]['care'] = ucfirst($data['care']) . "\r\nRemarks: " . $data['care_text'];
                $dataexport[$i]['pfe'] = ucfirst($data['pfe']) . "\r\nRemarks: " . $data['pfe_text'];
                $dataexport[$i]['disch'] = ucfirst($data['disch']) . "\r\nRemarks: " . $data['disch_text'];
                $dataexport[$i]['facility_communicated'] = ucfirst($data['facility_communicated']) . "\r\nRemarks: " . $data['facility_communicated_text'];
                $dataexport[$i]['health_education'] = ucfirst($data['health_education']) . "\r\nRemarks: " . $data['health_education_text'];
                $dataexport[$i]['remarks1'] = ucfirst($data['remarks1']) . "\r\nRemarks: " . $data['remarks1_text'];
                $dataexport[$i]['urethral'] = ucfirst($data['urethral']) . "\r\nRemarks: " . $data['urethral_text'];
                $dataexport[$i]['urine_sample'] = ucfirst($data['urine_sample']) . "\r\nRemarks: " . $data['urine_sample_text'];
                $dataexport[$i]['bystander'] = ucfirst($data['bystander']) . "\r\nRemarks: " . $data['bystander_text'];
                $dataexport[$i]['instruments'] = ucfirst($data['instruments']) . "\r\nRemarks: " . $data['instruments_text'];
                $dataexport[$i]['sterile'] = ucfirst($data['sterile']) . "\r\nRemarks: " . $data['sterile_text'];
                $dataexport[$i]['antibiotics'] = ucfirst($data['antibiotics']) . "\r\nRemarks: " . $data['antibiotics_text'];
                $dataexport[$i]['surgical_site'] = ucfirst($data['surgical_site']) . "\r\nRemarks: " . $data['surgical_site_text'];
                $dataexport[$i]['wound'] = ucfirst($data['wound']) . "\r\nRemarks: " . $data['wound_text'];
                $dataexport[$i]['documented'] = ucfirst($data['documented']) . "\r\nRemarks: " . $data['documented_text'];
                $dataexport[$i]['adequate_facilities'] = ucfirst($data['adequate_facilities']) . "\r\nRemarks: " . $data['adequate_facilities_text'];
                $dataexport[$i]['sufficient_lighting'] = ucfirst($data['sufficient_lighting']) . "\r\nRemarks: " . $data['sufficient_lighting_text'];
                $dataexport[$i]['storage_facility_for_food'] = ucfirst($data['storage_facility_for_food']) . "\r\nRemarks: " . $data['storage_facility_for_food_text'];


                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];


                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- Clinicians-Surgeons (Active) - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function overall_surgeons_closed()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_ma_surgeons_closed_mdc';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->audit_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Audit Name';
            $header[1] = 'Date & Time of Audit';
            $header[2] = 'Audit by';
            $header[3] = 'Patient MID';
            $header[4] = 'Patient Name';
            $header[5] = 'Patient Age';
            $header[6] = 'Patient Gender';

            $j = 7;

            $header[$j++] = 'Area';
            $header[$j++] = 'Department';
            $header[$j++] = 'Attended Doctor';
            $header[$j++] = 'Admission Date & Time';
            $header[$j++] = 'Discharge Date & Time';

            $header[$j++] = 'Is the informed consent for surgery obtained?';
            $header[$j++] = 'Is the date , time and signature of surgeon documented in informed consent for surgery ?';
            $header[$j++] = 'Is the high-risk procedures and treatments consent form available in the health record of an applicable patient?';
            $header[$j++] = 'Are the risks, benefits, potential complications and alternatives to surgery explained and fully documented on informed consent form?';
            $header[$j++] = 'Is the blood and blood products consent form available in the health record of an applicable patient?';
            $header[$j++] = 'Is the blood and blood products consent form complete?';
            $header[$j++] = 'Is the signature of patient or representative, witness, and individual obtaining consent obtained?';
            $header[$j++] = 'Are No abbreviations used on consent forms';
            $header[$j++] = 'Is the medical assessment documented prior to surgery?';
            $header[$j++] = 'Is the Patient and Family Education section completed?';
            $header[$j++] = 'Is planned care documented in the form of measurable progress (goals)?';
            $header[$j++] = 'Are the time recovery started and time recovery ended recorded?';
            $header[$j++] = 'Is the operation record recorded before the patient is transferred to the next level of care?';
            $header[$j++] = 'Is a post-operative report available before the patient leaves the post-anesthesia recovery area?';
            $header[$j++] = 'Are the surgical procedure and findings described?';
            $header[$j++] = 'Is a postoperative diagnosis noted?';
            $header[$j++] = 'Are the names of the surgeon and surgical assistants noted?';
            $header[$j++] = 'Are Any surgical specimens sent for examination fully documented, if applicable?';
            $header[$j++] = 'Are Amount of blood loss described in ml?';
            $header[$j++] = 'Is Amount of blood transfused or no blood transfusion described?';
            $header[$j++] = 'Are complications or the absence of complications during the procedure noted?';
            $header[$j++] = 'Are Date, time, and signature of the responsible surgeon noted?';
            $header[$j++] = 'Is the medical post-surgical plan documented?';
            $header[$j++] = 'Is the patient reassessed daily. (Progress Notes)?';
            $header[$j++] = 'Is the diagnosis documented in Progress Note?';
            $header[$j++] = 'Are the complaints and physical findings documented in Progress Note?';
            $header[$j++] = 'Are the patient status and special issues documented in Progress Note?';
            $header[$j++] = 'Is Planned care documented in the form of measurable progress (goals)?';
            $header[$j++] = 'Is Planned Care reviewed by other disciplines?';
            $header[$j++] = 'Is a list of medications taken prior to admission documented (or there is documentation of none taken)?';
            $header[$j++] = 'Are Medications ordered written in patient\'s record and complete?';
            $header[$j++] = 'Do PRN orders contain indications?';
            $header[$j++] = 'Are all physician orders including non-medication orders in a uniform location?';
            $header[$j++] = 'Are Verbal/ Telephone orders signed within the approved timeframe?';
            $header[$j++] = 'Is Diet order documented?';
            $header[$j++] = 'Is it ensured that During all phases of inpatient care, the individual responsible for the patients care is identified in documentation related to the patient\'s plan of care?';
            $header[$j++] = 'Is the Department handover documented,if applicable?';
            $header[$j++] = 'Are the consultation request and Consultation Response documented in EMR?';


            $header[$j++] = 'Additional comments';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['audit_type'] = $data['audit_type'];
                $dataexport[$i]['date'] = date('Y-m-d H:i', strtotime($row->datetime));
                $dataexport[$i]['audit_by'] = $data['audit_by'];

                $dataexport[$i]['mid_no'] = $data['mid_no'];
                $dataexport[$i]['patient_name'] = $data['patient_name'];
                $dataexport[$i]['patient_age'] = $data['patient_age'];
                $dataexport[$i]['patient_gender'] = $data['patient_gender'];
                $dataexport[$i]['location'] = $data['location'];
                $dataexport[$i]['department'] = $data['department'];
                $dataexport[$i]['attended_doctor'] = $data['attended_doctor'];
                $dataexport[$i]['initial_assessment_hr6'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr6']));
                $dataexport[$i]['discharge_date_time'] = date('Y-m-d H:i', strtotime($data['discharge_date_time']));

                $dataexport[$i]['identification_details'] = ucfirst($data['identification_details']) . "\r\nRemarks: " . $data['identification_details_text'];
                $dataexport[$i]['vital_signs'] = ucfirst($data['vital_signs']) . "\r\nRemarks: " . $data['vital_signs_text'];
                $dataexport[$i]['surgery'] = ucfirst($data['surgery']) . "\r\nRemarks: " . $data['surgery_text'];
                $dataexport[$i]['complaints_communicated'] = ucfirst($data['complaints_communicated']) . "\r\nRemarks: " . $data['complaints_communicated_text'];
                $dataexport[$i]['ensure'] = ucfirst($data['ensure']) . "\r\nRemarks: " . $data['ensure_text'];
                $dataexport[$i]['intake'] = ucfirst($data['intake']) . "\r\nRemarks: " . $data['intake_text'];
                $dataexport[$i]['output'] = ucfirst($data['output']) . "\r\nRemarks: " . $data['output_text'];
                $dataexport[$i]['focus'] = ucfirst($data['focus']) . "\r\nRemarks: " . $data['focus_text'];
                $dataexport[$i]['meti'] = ucfirst($data['meti']) . "\r\nRemarks: " . $data['meti_text'];
                $dataexport[$i]['diagnostic'] = ucfirst($data['diagnostic']) . "\r\nRemarks: " . $data['diagnostic_text'];
                $dataexport[$i]['lab_results'] = ucfirst($data['lab_results']) . "\r\nRemarks: " . $data['lab_results_text'];
                $dataexport[$i]['pending_investigation'] = ucfirst($data['pending_investigation']) . "\r\nRemarks: " . $data['pending_investigation_text'];
                $dataexport[$i]['medicine_order'] = ucfirst($data['medicine_order']) . "\r\nRemarks: " . $data['medicine_order_text'];
                $dataexport[$i]['psychological'] = ucfirst($data['psychological']) . "\r\nRemarks: " . $data['psychological_text'];
                $dataexport[$i]['vulnerab'] = ucfirst($data['vulnerab']) . "\r\nRemarks: " . $data['vulnerab_text'];
                $dataexport[$i]['social'] = ucfirst($data['social']) . "\r\nRemarks: " . $data['social_text'];
                $dataexport[$i]['nutri'] = ucfirst($data['nutri']) . "\r\nRemarks: " . $data['nutri_text'];
                $dataexport[$i]['spiritual'] = ucfirst($data['spiritual']) . "\r\nRemarks: " . $data['spiritual_text'];
                $dataexport[$i]['suicide'] = ucfirst($data['suicide']) . "\r\nRemarks: " . $data['suicide_text'];
                $dataexport[$i]['risk'] = ucfirst($data['risk']) . "\r\nRemarks: " . $data['risk_text'];
                $dataexport[$i]['care'] = ucfirst($data['care']) . "\r\nRemarks: " . $data['care_text'];
                $dataexport[$i]['pfe'] = ucfirst($data['pfe']) . "\r\nRemarks: " . $data['pfe_text'];
                $dataexport[$i]['disch'] = ucfirst($data['disch']) . "\r\nRemarks: " . $data['disch_text'];
                $dataexport[$i]['facility_communicated'] = ucfirst($data['facility_communicated']) . "\r\nRemarks: " . $data['facility_communicated_text'];
                $dataexport[$i]['health_education'] = ucfirst($data['health_education']) . "\r\nRemarks: " . $data['health_education_text'];
                $dataexport[$i]['remarks1'] = ucfirst($data['remarks1']) . "\r\nRemarks: " . $data['remarks1_text'];
                $dataexport[$i]['urethral'] = ucfirst($data['urethral']) . "\r\nRemarks: " . $data['urethral_text'];
                $dataexport[$i]['urine_sample'] = ucfirst($data['urine_sample']) . "\r\nRemarks: " . $data['urine_sample_text'];
                $dataexport[$i]['bystander'] = ucfirst($data['bystander']) . "\r\nRemarks: " . $data['bystander_text'];
                $dataexport[$i]['instruments'] = ucfirst($data['instruments']) . "\r\nRemarks: " . $data['instruments_text'];
                $dataexport[$i]['sterile'] = ucfirst($data['sterile']) . "\r\nRemarks: " . $data['sterile_text'];
                $dataexport[$i]['antibiotics'] = ucfirst($data['antibiotics']) . "\r\nRemarks: " . $data['antibiotics_text'];
                $dataexport[$i]['surgical_site'] = ucfirst($data['surgical_site']) . "\r\nRemarks: " . $data['surgical_site_text'];
                $dataexport[$i]['wound'] = ucfirst($data['wound']) . "\r\nRemarks: " . $data['wound_text'];
                $dataexport[$i]['documented'] = ucfirst($data['documented']) . "\r\nRemarks: " . $data['documented_text'];
                $dataexport[$i]['adequate_facilities'] = ucfirst($data['adequate_facilities']) . "\r\nRemarks: " . $data['adequate_facilities_text'];
                $dataexport[$i]['sufficient_lighting'] = ucfirst($data['sufficient_lighting']) . "\r\nRemarks: " . $data['sufficient_lighting_text'];
                $dataexport[$i]['storage_facility_for_food'] = ucfirst($data['storage_facility_for_food']) . "\r\nRemarks: " . $data['storage_facility_for_food_text'];


                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];


                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- Clinicians-Surgeons (Closed) - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function overall_diet_consultation_op()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_ma_dietconsultation_op_mdc';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->audit_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Audit Name';
            $header[1] = 'Date & Time of Audit';
            $header[2] = 'Audit by';
            $header[3] = 'Patient MID';
            $header[4] = 'Patient Name';
            $header[5] = 'Patient Age';
            $header[6] = 'Patient Gender';

            $j = 7;

            $header[$j++] = 'Area';
            $header[$j++] = 'Department';
            $header[$j++] = 'Attended Doctor';
            $header[$j++] = 'Admission Date & Time';
            $header[$j++] = 'Discharge Date & Time';

            $header[$j++] = 'Is Diagnosis recorded?';
            $header[$j++] = 'Are food allergies recorded?';
            $header[$j++] = 'Are food preferences recorded?';
            $header[$j++] = 'Are all columns of food intake filled?';
            $header[$j++] = 'Is the Dieticians Name, Signature, Date & Time filled?';
            $header[$j++] = 'Is Nutritional Risk Assessment filled?';
            $header[$j++] = 'Is Dietician comment entered?';


            $header[$j++] = 'Additional comments';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['audit_type'] = $data['audit_type'];
                $dataexport[$i]['date'] = date('Y-m-d H:i', strtotime($row->datetime));
                $dataexport[$i]['audit_by'] = $data['audit_by'];

                $dataexport[$i]['mid_no'] = $data['mid_no'];
                $dataexport[$i]['patient_name'] = $data['patient_name'];
                $dataexport[$i]['patient_age'] = $data['patient_age'];
                $dataexport[$i]['patient_gender'] = $data['patient_gender'];
                $dataexport[$i]['location'] = $data['location'];
                $dataexport[$i]['department'] = $data['department'];
                $dataexport[$i]['attended_doctor'] = $data['attended_doctor'];
                $dataexport[$i]['initial_assessment_hr6'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr6']));
                $dataexport[$i]['discharge_date_time'] = date('Y-m-d H:i', strtotime($data['discharge_date_time']));

                $dataexport[$i]['identification_details'] = ucfirst($data['identification_details']) . "\r\nRemarks: " . $data['identification_details_text'];
                $dataexport[$i]['vital_signs'] = ucfirst($data['vital_signs']) . "\r\nRemarks: " . $data['vital_signs_text'];
                $dataexport[$i]['surgery'] = ucfirst($data['surgery']) . "\r\nRemarks: " . $data['surgery_text'];
                $dataexport[$i]['complaints_communicated'] = ucfirst($data['complaints_communicated']) . "\r\nRemarks: " . $data['complaints_communicated_text'];
                $dataexport[$i]['intake'] = ucfirst($data['intake']) . "\r\nRemarks: " . $data['intake_text'];
                $dataexport[$i]['output'] = ucfirst($data['output']) . "\r\nRemarks: " . $data['output_text'];
                $dataexport[$i]['focus'] = ucfirst($data['focus']) . "\r\nRemarks: " . $data['focus_text'];


                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];


                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- Diet Consultation (OP) - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function overall_physiotherapy_closed()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_ma_physiotherapy_closed_mdc';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->audit_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Audit Name';
            $header[1] = 'Date & Time of Audit';
            $header[2] = 'Audit by';
            $header[3] = 'Patient MID';
            $header[4] = 'Patient Name';
            $header[5] = 'Patient Age';
            $header[6] = 'Patient Gender';

            $j = 7;

            $header[$j++] = 'Area';
            $header[$j++] = 'Department';
            $header[$j++] = 'Attended Doctor';
            $header[$j++] = 'Admission Date & Time';
            $header[$j++] = 'Discharge Date & Time';

            $header[$j++] = 'Is Reason for referral available?';
            $header[$j++] = 'Is Patient complaint noted?';
            $header[$j++] = 'Is Range of Motion and Muscle power recorded/assessed?';
            $header[$j++] = 'Is the Goal plan available?';
            $header[$j++] = 'Is Patient Education imparted?';
            $header[$j++] = 'Are Progress Notes maintained?';
            $header[$j++] = 'Is Pain Assessment periodically done and recorded?';
            $header[$j++] = 'Is Fall risk Assessment periodically done and recorded?';


            $header[$j++] = 'Additional comments';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['audit_type'] = $data['audit_type'];
                $dataexport[$i]['date'] = date('Y-m-d H:i', strtotime($row->datetime));
                $dataexport[$i]['audit_by'] = $data['audit_by'];

                $dataexport[$i]['mid_no'] = $data['mid_no'];
                $dataexport[$i]['patient_name'] = $data['patient_name'];
                $dataexport[$i]['patient_age'] = $data['patient_age'];
                $dataexport[$i]['patient_gender'] = $data['patient_gender'];
                $dataexport[$i]['location'] = $data['location'];
                $dataexport[$i]['department'] = $data['department'];
                $dataexport[$i]['attended_doctor'] = $data['attended_doctor'];
                $dataexport[$i]['initial_assessment_hr6'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr6']));
                $dataexport[$i]['discharge_date_time'] = date('Y-m-d H:i', strtotime($data['discharge_date_time']));

                $dataexport[$i]['identification_details'] = ucfirst($data['identification_details']) . "\r\nRemarks: " . $data['identification_details_text'];
                $dataexport[$i]['vital_signs'] = ucfirst($data['vital_signs']) . "\r\nRemarks: " . $data['vital_signs_text'];
                $dataexport[$i]['surgery'] = ucfirst($data['surgery']) . "\r\nRemarks: " . $data['surgery_text'];
                $dataexport[$i]['complaints_communicated'] = ucfirst($data['complaints_communicated']) . "\r\nRemarks: " . $data['complaints_communicated_text'];
                $dataexport[$i]['intake'] = ucfirst($data['intake']) . "\r\nRemarks: " . $data['intake_text'];
                $dataexport[$i]['output'] = ucfirst($data['output']) . "\r\nRemarks: " . $data['output_text'];
                $dataexport[$i]['focus'] = ucfirst($data['focus']) . "\r\nRemarks: " . $data['focus_text'];
                $dataexport[$i]['meti'] = ucfirst($data['meti']) . "\r\nRemarks: " . $data['meti_text'];


                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];


                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- Physiotherapy- (Closed) - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function overall_physiotherapy_op()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_ma_physiotherapy_op_mdc';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->audit_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Audit Name';
            $header[1] = 'Date & Time of Audit';
            $header[2] = 'Audit by';
            $header[3] = 'Patient MID';
            $header[4] = 'Patient Name';
            $header[5] = 'Patient Age';
            $header[6] = 'Patient Gender';

            $j = 7;

            $header[$j++] = 'Area';
            $header[$j++] = 'Department';
            $header[$j++] = 'Attended Doctor';
            $header[$j++] = 'Admission Date & Time';
            $header[$j++] = 'Discharge Date & Time';

            $header[$j++] = 'Is Reason for referral available?';
            $header[$j++] = 'Is Patient complaint noted?';
            $header[$j++] = 'Is Range of Motion and Muscle power recorded/assessed?';
            $header[$j++] = 'Is the Goal plan available?';
            $header[$j++] = 'Is Patient Education imparted?';
            $header[$j++] = 'Are Progress Notes maintained?';
            $header[$j++] = 'Is Pain Assessment periodically done and recorded?';
            $header[$j++] = 'Is Fall risk Assessment periodically done and recorded?';


            $header[$j++] = 'Additional comments';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['audit_type'] = $data['audit_type'];
                $dataexport[$i]['date'] = date('Y-m-d H:i', strtotime($row->datetime));
                $dataexport[$i]['audit_by'] = $data['audit_by'];

                $dataexport[$i]['mid_no'] = $data['mid_no'];
                $dataexport[$i]['patient_name'] = $data['patient_name'];
                $dataexport[$i]['patient_age'] = $data['patient_age'];
                $dataexport[$i]['patient_gender'] = $data['patient_gender'];
                $dataexport[$i]['location'] = $data['location'];
                $dataexport[$i]['department'] = $data['department'];
                $dataexport[$i]['attended_doctor'] = $data['attended_doctor'];
                $dataexport[$i]['initial_assessment_hr6'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr6']));
                $dataexport[$i]['discharge_date_time'] = date('Y-m-d H:i', strtotime($data['discharge_date_time']));

                $dataexport[$i]['identification_details'] = ucfirst($data['identification_details']) . "\r\nRemarks: " . $data['identification_details_text'];
                $dataexport[$i]['vital_signs'] = ucfirst($data['vital_signs']) . "\r\nRemarks: " . $data['vital_signs_text'];
                $dataexport[$i]['surgery'] = ucfirst($data['surgery']) . "\r\nRemarks: " . $data['surgery_text'];
                $dataexport[$i]['complaints_communicated'] = ucfirst($data['complaints_communicated']) . "\r\nRemarks: " . $data['complaints_communicated_text'];
                $dataexport[$i]['intake'] = ucfirst($data['intake']) . "\r\nRemarks: " . $data['intake_text'];
                $dataexport[$i]['output'] = ucfirst($data['output']) . "\r\nRemarks: " . $data['output_text'];
                $dataexport[$i]['focus'] = ucfirst($data['focus']) . "\r\nRemarks: " . $data['focus_text'];
                $dataexport[$i]['meti'] = ucfirst($data['meti']) . "\r\nRemarks: " . $data['meti_text'];


                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];


                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- Physiotherapy- (OP) - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function overall_physiotherapy_open()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_ma_physiotherapy_open_mdc';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->audit_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Audit Name';
            $header[1] = 'Date & Time of Audit';
            $header[2] = 'Audit by';
            $header[3] = 'Patient MID';
            $header[4] = 'Patient Name';
            $header[5] = 'Patient Age';
            $header[6] = 'Patient Gender';

            $j = 7;

            $header[$j++] = 'Area';
            $header[$j++] = 'Department';
            $header[$j++] = 'Attended Doctor';
            $header[$j++] = 'Admission Date & Time';
            $header[$j++] = 'Discharge Date & Time';

            $header[$j++] = 'Is Reason for referral available?';
            $header[$j++] = 'Is Patient complaint noted?';
            $header[$j++] = 'Is Range of Motion and Muscle power recorded/assessed?';
            $header[$j++] = 'Is the Goal plan available?';
            $header[$j++] = 'Is Patient Education imparted?';
            $header[$j++] = 'Are Progress Notes maintained?';
            $header[$j++] = 'Is Pain Assessment periodically done and recorded?';
            $header[$j++] = 'Is Fall risk Assessment periodically done and recorded?';


            $header[$j++] = 'Additional comments';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['audit_type'] = $data['audit_type'];
                $dataexport[$i]['date'] = date('Y-m-d H:i', strtotime($row->datetime));
                $dataexport[$i]['audit_by'] = $data['audit_by'];

                $dataexport[$i]['mid_no'] = $data['mid_no'];
                $dataexport[$i]['patient_name'] = $data['patient_name'];
                $dataexport[$i]['patient_age'] = $data['patient_age'];
                $dataexport[$i]['patient_gender'] = $data['patient_gender'];
                $dataexport[$i]['location'] = $data['location'];
                $dataexport[$i]['department'] = $data['department'];
                $dataexport[$i]['attended_doctor'] = $data['attended_doctor'];
                $dataexport[$i]['initial_assessment_hr6'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr6']));
                $dataexport[$i]['discharge_date_time'] = date('Y-m-d H:i', strtotime($data['discharge_date_time']));

                $dataexport[$i]['identification_details'] = ucfirst($data['identification_details']) . "\r\nRemarks: " . $data['identification_details_text'];
                $dataexport[$i]['vital_signs'] = ucfirst($data['vital_signs']) . "\r\nRemarks: " . $data['vital_signs_text'];
                $dataexport[$i]['surgery'] = ucfirst($data['surgery']) . "\r\nRemarks: " . $data['surgery_text'];
                $dataexport[$i]['complaints_communicated'] = ucfirst($data['complaints_communicated']) . "\r\nRemarks: " . $data['complaints_communicated_text'];
                $dataexport[$i]['intake'] = ucfirst($data['intake']) . "\r\nRemarks: " . $data['intake_text'];
                $dataexport[$i]['output'] = ucfirst($data['output']) . "\r\nRemarks: " . $data['output_text'];
                $dataexport[$i]['focus'] = ucfirst($data['focus']) . "\r\nRemarks: " . $data['focus_text'];
                $dataexport[$i]['meti'] = ucfirst($data['meti']) . "\r\nRemarks: " . $data['meti_text'];


                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];


                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- Physiotherapy- (Open) - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function overall_mrd_ed()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_ma_mrd_ed_audit';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->audit_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Audit Name';
            $header[1] = 'Date & Time of Audit';
            $header[2] = 'Audit by';
            $header[3] = 'Patient MID';
            $header[4] = 'Patient Name';
            $header[5] = 'Patient Age';
            $header[6] = 'Patient Gender';

            $j = 7;

            $header[$j++] = 'Area';
            $header[$j++] = 'Department';
            $header[$j++] = 'Attended Doctor';
            $header[$j++] = 'Admission Date & Time';
            $header[$j++] = 'Discharge Date & Time';

            $header[$j++] = 'Is diagnosis recorded?';
            $header[$j++] = 'Is admitting complaint recorded?';
            $header[$j++] = 'Is history recorded?';
            $header[$j++] = 'Are Vital Signs recorded in ED summary?';
            $header[$j++] = 'Are physical findings recorded?';
            $header[$j++] = 'Is arrival and discharge time recorded?';
            $header[$j++] = 'Are allergy details recorded?';
            $header[$j++] = 'Is Pain assessment completed?';


            $header[$j++] = 'Additional comments';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['audit_type'] = $data['audit_type'];
                $dataexport[$i]['date'] = date('Y-m-d H:i', strtotime($row->datetime));
                $dataexport[$i]['audit_by'] = $data['audit_by'];

                $dataexport[$i]['mid_no'] = $data['mid_no'];
                $dataexport[$i]['patient_name'] = $data['patient_name'];
                $dataexport[$i]['patient_age'] = $data['patient_age'];
                $dataexport[$i]['patient_gender'] = $data['patient_gender'];
                $dataexport[$i]['location'] = $data['location'];
                $dataexport[$i]['department'] = $data['department'];
                $dataexport[$i]['attended_doctor'] = $data['attended_doctor'];
                $dataexport[$i]['initial_assessment_hr6'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr6']));
                $dataexport[$i]['discharge_date_time'] = date('Y-m-d H:i', strtotime($data['discharge_date_time']));

                $dataexport[$i]['identification_details'] = ucfirst($data['identification_details']) . "\r\nRemarks: " . $data['identification_details_text'];
                $dataexport[$i]['vital_signs'] = ucfirst($data['vital_signs']) . "\r\nRemarks: " . $data['vital_signs_text'];
                $dataexport[$i]['surgery'] = ucfirst($data['surgery']) . "\r\nRemarks: " . $data['surgery_text'];
                $dataexport[$i]['complaints_communicated'] = ucfirst($data['complaints_communicated']) . "\r\nRemarks: " . $data['complaints_communicated_text'];
                $dataexport[$i]['intake'] = ucfirst($data['intake']) . "\r\nRemarks: " . $data['intake_text'];
                $dataexport[$i]['output'] = ucfirst($data['output']) . "\r\nRemarks: " . $data['output_text'];
                $dataexport[$i]['focus'] = ucfirst($data['focus']) . "\r\nRemarks: " . $data['focus_text'];
                $dataexport[$i]['meti'] = ucfirst($data['meti']) . "\r\nRemarks: " . $data['meti_text'];


                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];


                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- MRD Audit- ED - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function overall_mrd_lama()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_ma_mrd_lama_audit';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->audit_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Audit Name';
            $header[1] = 'Date & Time of Audit';
            $header[2] = 'Audit by';
            $header[3] = 'Patient MID';
            $header[4] = 'Patient Name';
            $header[5] = 'Patient Age';
            $header[6] = 'Patient Gender';

            $j = 7;

            $header[$j++] = 'Area';
            $header[$j++] = 'Department';
            $header[$j++] = 'Attended Doctor';
            $header[$j++] = 'Admission Date & Time';
            $header[$j++] = 'Discharge Date & Time';

            $header[$j++] = 'Is Time of Arrival recorded?';
            $header[$j++] = 'Is specialist consultation recorded?';
            $header[$j++] = 'Is reasons for visit and diagnosis recorded in EMR?';
            $header[$j++] = 'Is reason of LAMA recorded?';
            $header[$j++] = 'Is Patient identification properly recorded?';
            $header[$j++] = 'Is Patient/companions signature recorded?';
            $header[$j++] = 'Is witness signature recorded?';
            $header[$j++] = 'Is Doctors sign present?';



            $header[$j++] = 'Additional comments';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['audit_type'] = $data['audit_type'];
                $dataexport[$i]['date'] = date('Y-m-d H:i', strtotime($row->datetime));
                $dataexport[$i]['audit_by'] = $data['audit_by'];

                $dataexport[$i]['mid_no'] = $data['mid_no'];
                $dataexport[$i]['patient_name'] = $data['patient_name'];
                $dataexport[$i]['patient_age'] = $data['patient_age'];
                $dataexport[$i]['patient_gender'] = $data['patient_gender'];
                $dataexport[$i]['location'] = $data['location'];
                $dataexport[$i]['department'] = $data['department'];
                $dataexport[$i]['attended_doctor'] = $data['attended_doctor'];
                $dataexport[$i]['initial_assessment_hr6'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr6']));
                $dataexport[$i]['discharge_date_time'] = date('Y-m-d H:i', strtotime($data['discharge_date_time']));

                $dataexport[$i]['identification_details'] = ucfirst($data['identification_details']) . "\r\nRemarks: " . $data['identification_details_text'];
                $dataexport[$i]['vital_signs'] = ucfirst($data['vital_signs']) . "\r\nRemarks: " . $data['vital_signs_text'];
                $dataexport[$i]['surgery'] = ucfirst($data['surgery']) . "\r\nRemarks: " . $data['surgery_text'];
                $dataexport[$i]['complaints_communicated'] = ucfirst($data['complaints_communicated']) . "\r\nRemarks: " . $data['complaints_communicated_text'];
                $dataexport[$i]['intake'] = ucfirst($data['intake']) . "\r\nRemarks: " . $data['intake_text'];
                $dataexport[$i]['output'] = ucfirst($data['output']) . "\r\nRemarks: " . $data['output_text'];
                $dataexport[$i]['focus'] = ucfirst($data['focus']) . "\r\nRemarks: " . $data['focus_text'];
                $dataexport[$i]['meti'] = ucfirst($data['meti']) . "\r\nRemarks: " . $data['meti_text'];


                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];


                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- MRD Audit- LAMA - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function overall_mrd_op()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_ma_mrd_op_audit';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->audit_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Audit Name';
            $header[1] = 'Date & Time of Audit';
            $header[2] = 'Audit by';
            $header[3] = 'Patient MID';
            $header[4] = 'Patient Name';
            $header[5] = 'Patient Age';
            $header[6] = 'Patient Gender';

            $j = 7;

            $header[$j++] = 'Area';
            $header[$j++] = 'Department';
            $header[$j++] = 'Attended Doctor';
            $header[$j++] = 'Admission Date & Time';
            $header[$j++] = 'Discharge Date & Time';

            $header[$j++] = 'Is the patients history documented?';
            $header[$j++] = 'Is the admitting complaint recorded?';
            $header[$j++] = 'Are the vitals recorded during OP assessment?';
            $header[$j++] = 'Are the physical findings documented?';
            $header[$j++] = 'Is the diagnosis recorded?';
            $header[$j++] = 'Is the treatment plan documented?';
            $header[$j++] = 'Is the medicine prescription recorded?';
            $header[$j++] = 'Is follow-up advice documented?';
            $header[$j++] = 'Is patient and family education (PFE) documented?';
            $header[$j++] = 'Is the medication history recorded?';
            $header[$j++] = 'Is the practice of copy and paste avoided?';
            $header[$j++] = 'Are abbreviations avoided in documentation?';


            $header[$j++] = 'Additional comments';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['audit_type'] = $data['audit_type'];
                $dataexport[$i]['date'] = date('Y-m-d H:i', strtotime($row->datetime));
                $dataexport[$i]['audit_by'] = $data['audit_by'];

                $dataexport[$i]['mid_no'] = $data['mid_no'];
                $dataexport[$i]['patient_name'] = $data['patient_name'];
                $dataexport[$i]['patient_age'] = $data['patient_age'];
                $dataexport[$i]['patient_gender'] = $data['patient_gender'];
                $dataexport[$i]['location'] = $data['location'];
                $dataexport[$i]['department'] = $data['department'];
                $dataexport[$i]['attended_doctor'] = $data['attended_doctor'];
                $dataexport[$i]['initial_assessment_hr6'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr6']));
                $dataexport[$i]['discharge_date_time'] = date('Y-m-d H:i', strtotime($data['discharge_date_time']));

                $dataexport[$i]['identification_details'] = ucfirst($data['identification_details']) . "\r\nRemarks: " . $data['identification_details_text'];
                $dataexport[$i]['vital_signs'] = ucfirst($data['vital_signs']) . "\r\nRemarks: " . $data['vital_signs_text'];
                $dataexport[$i]['surgery'] = ucfirst($data['surgery']) . "\r\nRemarks: " . $data['surgery_text'];
                $dataexport[$i]['complaints_communicated'] = ucfirst($data['complaints_communicated']) . "\r\nRemarks: " . $data['complaints_communicated_text'];
                $dataexport[$i]['intake'] = ucfirst($data['intake']) . "\r\nRemarks: " . $data['intake_text'];
                $dataexport[$i]['output'] = ucfirst($data['output']) . "\r\nRemarks: " . $data['output_text'];
                $dataexport[$i]['focus'] = ucfirst($data['focus']) . "\r\nRemarks: " . $data['focus_text'];
                $dataexport[$i]['meti'] = ucfirst($data['meti']) . "\r\nRemarks: " . $data['meti_text'];
                $dataexport[$i]['diagnostic'] = ucfirst($data['diagnostic']) . "\r\nRemarks: " . $data['diagnostic_text'];
                $dataexport[$i]['lab_results'] = ucfirst($data['lab_results']) . "\r\nRemarks: " . $data['lab_results_text'];
                $dataexport[$i]['pending_investigation'] = ucfirst($data['pending_investigation']) . "\r\nRemarks: " . $data['pending_investigation_text'];
                $dataexport[$i]['medicine_order'] = ucfirst($data['medicine_order']) . "\r\nRemarks: " . $data['medicine_order_text'];


                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];


                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- MRD Audit- OP - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }




    public function overall_accidental_delining()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_ma_accidental_delining_audit';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->audit_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Audit Name';
            $header[1] = 'Date & Time of Audit';
            $header[2] = 'Audit by';
            $header[3] = 'Patient MID';
            $header[4] = 'Patient Name';
            $header[5] = 'Patient Age';
            $header[6] = 'Patient Gender';

            $j = 7;

            $header[$j++] = 'Area';
            $header[$j++] = 'Department';
            $header[$j++] = 'Attended Doctor';
            $header[$j++] = 'Admission Date & Time';
            $header[$j++] = 'Discharge Date & Time';

            $header[$j++] = 'Date & Time of Insertion';
            $header[$j++] = 'Site of Insertion';
            $header[$j++] = 'Date & Time of Delining';


            $header[$j++] = 'Was the line secured with appropriate dressing/ tape?';

            $header[$j++] = 'Type of line - Central venous catheter (CVC)';
            $header[$j++] = 'Type of line - Peripherally inserted central catheter (PICC)';
            $header[$j++] = 'Type of line - NG tube';
            $header[$j++] = 'Type of line - Drain tube';
            $header[$j++] = 'Type of line - Other (specify)';

            $header[$j++] = 'Causative factor - Restlessness or agitation';
            $header[$j++] = 'Causative factor - Frequent movement or ambulation';
            $header[$j++] = 'Causative factor - Inadequate monitoring of the line';
            $header[$j++] = 'Causative factor - Poor adherence to securing techniques';
            $header[$j++] = 'Causative factor - Lapse in following line-care protocols';
            $header[$j++] = 'Causative factor - Crowded or cluttered patient area';
            $header[$j++] = 'Causative factor - Line caught on bed rails or equipment';
            $header[$j++] = 'Causative factor - Patient factors (Excessive sweating)';


            $header[$j++] = 'Additional comments';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['audit_type'] = $data['audit_type'];
                $dataexport[$i]['date'] = date('Y-m-d H:i', strtotime($row->datetime));
                $dataexport[$i]['audit_by'] = $data['audit_by'];

                $dataexport[$i]['mid_no'] = $data['mid_no'];
                $dataexport[$i]['patient_name'] = $data['patient_name'];
                $dataexport[$i]['patient_age'] = $data['patient_age'];
                $dataexport[$i]['patient_gender'] = $data['patient_gender'];
                $dataexport[$i]['location'] = $data['location'];
                $dataexport[$i]['department'] = $data['department'];
                $dataexport[$i]['attended_doctor'] = $data['attended_doctor'];
                $dataexport[$i]['initial_assessment_hr6'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr6']));
                $dataexport[$i]['discharge_date_time'] = date('Y-m-d H:i', strtotime($data['discharge_date_time']));


                $dataexport[$i]['initial_assessment_hr5'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr5']));

                $dataexport[$i]['vital_signs'] = $data['vital_signs'];

                $dataexport[$i]['initial_assessment_hr3'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr3']));


                $dataexport[$i]['complaints_communicated'] = ucfirst($data['complaints_communicated']) . "\r\nRemarks: " . $data['complaints_communicated_text'];
                $dataexport[$i]['intake'] = ucfirst($data['intake']) . "\r\nRemarks: " . $data['intake_text'];
                $dataexport[$i]['output'] = ucfirst($data['output']) . "\r\nRemarks: " . $data['output_text'];
                $dataexport[$i]['diagnostic'] = ucfirst($data['diagnostic']) . "\r\nRemarks: " . $data['diagnostic_text'];
                $dataexport[$i]['lab_results'] = ucfirst($data['lab_results']) . "\r\nRemarks: " . $data['lab_results_text'];

                $dataexport[$i]['pending_investigation'] = ucfirst($data['pending_investigation']);

                $dataexport[$i]['medicine_order'] = ucfirst($data['medicine_order']) . "\r\nRemarks: " . $data['medicine_order_text'];
                $dataexport[$i]['psychological'] = ucfirst($data['psychological']) . "\r\nRemarks: " . $data['psychological_text'];
                $dataexport[$i]['vulnerab'] = ucfirst($data['vulnerab']) . "\r\nRemarks: " . $data['vulnerab_text'];
                $dataexport[$i]['social'] = ucfirst($data['social']) . "\r\nRemarks: " . $data['social_text'];
                $dataexport[$i]['nutri'] = ucfirst($data['nutri']) . "\r\nRemarks: " . $data['nutri_text'];
                $dataexport[$i]['spiritual'] = ucfirst($data['spiritual']) . "\r\nRemarks: " . $data['spiritual_text'];
                $dataexport[$i]['suicide'] = ucfirst($data['suicide']) . "\r\nRemarks: " . $data['suicide_text'];
                $dataexport[$i]['risk'] = ucfirst($data['risk']) . "\r\nRemarks: " . $data['risk_text'];


                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];


                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- Accidental Delining Audit - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function overall_admission_holding_area()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_ma_admission_area_audit';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->audit_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Audit Name';
            $header[1] = 'Date & Time of Audit';
            $header[2] = 'Audit by';
            $header[3] = 'Patient MID';
            $header[4] = 'Patient Name';
            $header[5] = 'Patient Age';
            $header[6] = 'Patient Gender';

            $j = 7;

            $header[$j++] = 'Area';
            $header[$j++] = 'Department';
            $header[$j++] = 'Attended Doctor';
            $header[$j++] = 'Admission Date & Time';
            $header[$j++] = 'Discharge Date & Time';

            $header[$j++] = 'Does planned patient care affected in anyway due to holding?';
            $header[$j++] = 'Whether intended drugs proposed in admission were started at holding?';
            $header[$j++] = 'Able to provide intended level of care including ICU level if applicable?';
            $header[$j++] = 'Does continuity of care and documentation is maintained during holding?';
            $header[$j++] = 'Competency of staff at holding were matching to the level of care required?';
            $header[$j++] = 'Any reported adverse event during holding?';


            $header[$j++] = 'Additional comments';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['audit_type'] = $data['audit_type'];
                $dataexport[$i]['date'] = date('Y-m-d H:i', strtotime($row->datetime));
                $dataexport[$i]['audit_by'] = $data['audit_by'];

                $dataexport[$i]['mid_no'] = $data['mid_no'];
                $dataexport[$i]['patient_name'] = $data['patient_name'];
                $dataexport[$i]['patient_age'] = $data['patient_age'];
                $dataexport[$i]['patient_gender'] = $data['patient_gender'];
                $dataexport[$i]['location'] = $data['location'];
                $dataexport[$i]['department'] = $data['department'];
                $dataexport[$i]['attended_doctor'] = $data['attended_doctor'];
                $dataexport[$i]['initial_assessment_hr6'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr6']));
                $dataexport[$i]['discharge_date_time'] = date('Y-m-d H:i', strtotime($data['discharge_date_time']));

                $dataexport[$i]['identification_details'] = ucfirst($data['identification_details']) . "\r\nRemarks: " . $data['identification_details_text'];
                $dataexport[$i]['vital_signs'] = ucfirst($data['vital_signs']) . "\r\nRemarks: " . $data['vital_signs_text'];
                $dataexport[$i]['surgery'] = ucfirst($data['surgery']) . "\r\nRemarks: " . $data['surgery_text'];
                $dataexport[$i]['complaints_communicated'] = ucfirst($data['complaints_communicated']) . "\r\nRemarks: " . $data['complaints_communicated_text'];
                $dataexport[$i]['intake'] = ucfirst($data['intake']) . "\r\nRemarks: " . $data['intake_text'];
                $dataexport[$i]['output'] = ucfirst($data['output']) . "\r\nRemarks: " . $data['output_text'];

                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];


                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- Admission Holding Area Audit - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function overall_cardio_pulmonary()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_ma_cardio_pulmonary_audit';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->audit_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Audit Name';
            $header[1] = 'Date & Time of Audit';
            $header[2] = 'Audit by';
            $header[3] = 'Patient MID';
            $header[4] = 'Patient Name';
            $header[5] = 'Patient Age';
            $header[6] = 'Patient Gender';

            $j = 7;

            $header[$j++] = 'Area';
            $header[$j++] = 'Department';
            $header[$j++] = 'Attended Doctor';
            $header[$j++] = 'Admission Date & Time';
            $header[$j++] = 'Discharge Date & Time';

            $header[$j++] = 'Was there a clearly documented physiological monitoring plan indicating the type and frequency of observations in the 24 hours before the arrest?';
            $header[$j++] = 'Were the patients Early Warning Scores recorded in the 12 hours preceding the arrest?';
            $header[$j++] = 'Was the Rapid Response Team (RRT) called appropriately?';
            $header[$j++] = 'If there were other reasons for escalation, was the correct escalation procedure followed?';
            $header[$j++] = 'Did the patient receive appropriate assessment and/or treatment in response to a clearly identified reason for escalation?';
            $header[$j++] = 'If treatment was provided, did the patients condition improve in response?';
            $header[$j++] = 'If the patient did not improve, was escalation to a more senior level performed in a timely manner? Was there documentation and discussion of ceilings of care, including resuscitation status?';
            $header[$j++] = 'Did the review identify any other deficiencies (e.g., missing equipment or drugs, equipment failures, or problems with team performance or communication)?';
            $header[$j++] = 'Was there a need to immediately call the CPR committee?';


            $header[$j++] = 'Additional comments';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['audit_type'] = $data['audit_type'];
                $dataexport[$i]['date'] = date('Y-m-d H:i', strtotime($row->datetime));
                $dataexport[$i]['audit_by'] = $data['audit_by'];

                $dataexport[$i]['mid_no'] = $data['mid_no'];
                $dataexport[$i]['patient_name'] = $data['patient_name'];
                $dataexport[$i]['patient_age'] = $data['patient_age'];
                $dataexport[$i]['patient_gender'] = $data['patient_gender'];
                $dataexport[$i]['location'] = $data['location'];
                $dataexport[$i]['department'] = $data['department'];
                $dataexport[$i]['attended_doctor'] = $data['attended_doctor'];
                $dataexport[$i]['initial_assessment_hr6'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr6']));
                $dataexport[$i]['discharge_date_time'] = date('Y-m-d H:i', strtotime($data['discharge_date_time']));

                $dataexport[$i]['identification_details'] = ucfirst($data['identification_details']) . "\r\nRemarks: " . $data['identification_details_text'];
                $dataexport[$i]['vital_signs'] = ucfirst($data['vital_signs']) . "\r\nRemarks: " . $data['vital_signs_text'];
                $dataexport[$i]['surgery'] = ucfirst($data['surgery']) . "\r\nRemarks: " . $data['surgery_text'];
                $dataexport[$i]['intake'] = ucfirst($data['intake']) . "\r\nRemarks: " . $data['intake_text'];
                $dataexport[$i]['output'] = ucfirst($data['output']) . "\r\nRemarks: " . $data['output_text'];
                $dataexport[$i]['allergies'] = ucfirst($data['allergies']) . "\r\nRemarks: " . $data['allergies_text'];

                $dataexport[$i]['medication'] = ucfirst($data['medication']) . "\r\nRemarks: " . $data['medication_text'];
                $dataexport[$i]['diagnostic'] = ucfirst($data['diagnostic']) . "\r\nRemarks: " . $data['diagnostic_text'];
                $dataexport[$i]['pending_investigation'] = ucfirst($data['pending_investigation']) . "\r\nRemarks: " . $data['pending_investigation_text'];


                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];


                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- CPR Analysis Record - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function overall_extravasation_audit()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_ma_extravasation_audit';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->audit_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Audit Name';
            $header[1] = 'Date & Time of Audit';
            $header[2] = 'Audit by';
            $header[3] = 'Patient MID';
            $header[4] = 'Patient Name';
            $header[5] = 'Patient Age';
            $header[6] = 'Patient Gender';

            $j = 7;

            $header[$j++] = 'Area';
            $header[$j++] = 'Department';
            $header[$j++] = 'Attended Doctor';
            $header[$j++] = 'Admission Date & Time';
            $header[$j++] = 'Discharge Date & Time';

            $header[$j++] = 'IV Cannula Insert Date & Time';


            $header[$j++] = 'What type of IV device was used? (e.g., peripheral cannula, central venous catheter)';
            $header[$j++] = 'What was the site of insertion?';
            $header[$j++] = 'How long was the IV cannula in place before extravasation occurred?';
            $header[$j++] = 'What is the name and classification of the drug administered? (e.g., vesicant, irritant)';
            $header[$j++] = 'What was the drug concentration and total volume infused?';
            $header[$j++] = 'What was the duration and rate of infusion?';
            $header[$j++] = 'What method of infusion was used? (e.g., manual bolus, pump-driven)';

            $header[$j++] = 'Was swelling observed at the insertion site?';
            $header[$j++] = 'Was the patient experiencing pain?';
            $header[$j++] = 'Was redness present at the site?';
            $header[$j++] = 'Was there any discoloration noted?';

            $header[$j++] = 'Was the infusion stopped immediately after detection?';
            $header[$j++] = 'Was the cannula removed after extravasation?';
            $header[$j++] = 'Was aspiration of the extravasated drug attempted?';
            $header[$j++] = 'Was the affected limb elevated?';
            $header[$j++] = 'Were cold or warm compresses applied as per the drug protocol?';
            $header[$j++] = 'Were antidotes administered (if applicable)?';
            $header[$j++] = 'Was the incident documented in the patients medical record?';
            $header[$j++] = 'Was the incident reported to the appropriate healthcare team?';
            $header[$j++] = 'Was the patient referred to specialized care (e.g., plastic surgery, wound care)?';
            $header[$j++] = 'Were any long-term complications observed (e.g., tissue necrosis, scarring)?';


            $header[$j++] = 'Additional comments';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['audit_type'] = $data['audit_type'];
                $dataexport[$i]['date'] = date('Y-m-d H:i', strtotime($row->datetime));
                $dataexport[$i]['audit_by'] = $data['audit_by'];

                $dataexport[$i]['mid_no'] = $data['mid_no'];
                $dataexport[$i]['patient_name'] = $data['patient_name'];
                $dataexport[$i]['patient_age'] = $data['patient_age'];
                $dataexport[$i]['patient_gender'] = $data['patient_gender'];
                $dataexport[$i]['location'] = $data['location'];
                $dataexport[$i]['department'] = $data['department'];
                $dataexport[$i]['attended_doctor'] = $data['attended_doctor'];
                $dataexport[$i]['initial_assessment_hr6'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr6']));
                $dataexport[$i]['discharge_date_time'] = date('Y-m-d H:i', strtotime($data['discharge_date_time']));

                $dataexport[$i]['identification_details_text'] = date('Y-m-d H:i', strtotime($data['identification_details_text']));

                $dataexport[$i]['vital_signs'] = ucfirst($data['vital_signs']) . "\r\nRemarks: " . $data['vital_signs_text'];
                $dataexport[$i]['surgery'] = ucfirst($data['surgery']) . "\r\nRemarks: " . $data['surgery_text'];
                $dataexport[$i]['intake'] = ucfirst($data['intake']) . "\r\nRemarks: " . $data['intake_text'];
                $dataexport[$i]['output'] = ucfirst($data['output']) . "\r\nRemarks: " . $data['output_text'];
                $dataexport[$i]['allergies'] = ucfirst($data['allergies']) . "\r\nRemarks: " . $data['allergies_text'];

                $dataexport[$i]['medication'] = ucfirst($data['medication']) . "\r\nRemarks: " . $data['medication_text'];
                $dataexport[$i]['diagnostic'] = ucfirst($data['diagnostic']) . "\r\nRemarks: " . $data['diagnostic_text'];
                $dataexport[$i]['lab_results'] = ucfirst($data['lab_results']) . "\r\nRemarks: " . $data['lab_results_text'];
                $dataexport[$i]['pending_investigation'] = ucfirst($data['pending_investigation']) . "\r\nRemarks: " . $data['pending_investigation_text'];
                $dataexport[$i]['medicine_order'] = ucfirst($data['medicine_order']) . "\r\nRemarks: " . $data['medicine_order_text'];
                $dataexport[$i]['facility_communicated'] = ucfirst($data['facility_communicated']) . "\r\nRemarks: " . $data['facility_communicated_text'];
                $dataexport[$i]['health_education'] = ucfirst($data['health_education']) . "\r\nRemarks: " . $data['health_education_text'];
                $dataexport[$i]['risk_assessment'] = ucfirst($data['risk_assessment']) . "\r\nRemarks: " . $data['risk_assessment_text'];
                $dataexport[$i]['urethral'] = ucfirst($data['urethral']) . "\r\nRemarks: " . $data['urethral_text'];
                $dataexport[$i]['urine_sample'] = ucfirst($data['urine_sample']) . "\r\nRemarks: " . $data['urine_sample_text'];
                $dataexport[$i]['bystander'] = ucfirst($data['bystander']) . "\r\nRemarks: " . $data['bystander_text'];
                $dataexport[$i]['instruments'] = ucfirst($data['instruments']) . "\r\nRemarks: " . $data['instruments_text'];
                $dataexport[$i]['sterile'] = ucfirst($data['sterile']) . "\r\nRemarks: " . $data['sterile_text'];
                $dataexport[$i]['antibiotics'] = ucfirst($data['antibiotics']) . "\r\nRemarks: " . $data['antibiotics_text'];
                $dataexport[$i]['surgical_site'] = ucfirst($data['surgical_site']) . "\r\nRemarks: " . $data['surgical_site_text'];
                $dataexport[$i]['wound'] = ucfirst($data['wound']) . "\r\nRemarks: " . $data['wound_remarks'];


                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];


                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- Extravasation Audit - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function overall_hapu_audit()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_ma_hapu_audit';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->audit_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Audit Name';
            $header[1] = 'Date & Time of Audit';
            $header[2] = 'Audit by';
            $header[3] = 'Patient MID';
            $header[4] = 'Patient Name';
            $header[5] = 'Patient Age';
            $header[6] = 'Patient Gender';

            $j = 7;

            $header[$j++] = 'Area';
            $header[$j++] = 'Department';
            $header[$j++] = 'Attended Doctor';
            $header[$j++] = 'Admission Date & Time';
            $header[$j++] = 'Discharge Date & Time';

            // $header[$j++] = 'Was there a clearly documented physiological monitoring plan indicating the type and frequency of observations in the 24 hours before the arrest?';
            // $header[$j++] = 'Were the patients Early Warning Scores recorded in the 12 hours preceding the arrest?';
            // $header[$j++] = 'Was the Rapid Response Team (RRT) called appropriately?';
            // $header[$j++] = 'If there were other reasons for escalation, was the correct escalation procedure followed?';
            // $header[$j++] = 'Did the patient receive appropriate assessment and/or treatment in response to a clearly identified reason for escalation?';
            // $header[$j++] = 'If treatment was provided, did the patients condition improve in response?';
            // $header[$j++] = 'If the patient did not improve, was escalation to a more senior level performed in a timely manner? Was there documentation and discussion of ceilings of care, including resuscitation status?';
            // $header[$j++] = 'Did the review identify any other deficiencies (e.g., missing equipment or drugs, equipment failures, or problems with team performance or communication)?';
            // $header[$j++] = 'Was there a need to immediately call the CPR committee?';


            $header[$j++] = 'Additional comments';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['audit_type'] = $data['audit_type'];
                $dataexport[$i]['date'] = date('Y-m-d H:i', strtotime($row->datetime));
                $dataexport[$i]['audit_by'] = $data['audit_by'];

                $dataexport[$i]['mid_no'] = $data['mid_no'];
                $dataexport[$i]['patient_name'] = $data['patient_name'];
                $dataexport[$i]['patient_age'] = $data['patient_age'];
                $dataexport[$i]['patient_gender'] = $data['patient_gender'];
                $dataexport[$i]['location'] = $data['location'];
                $dataexport[$i]['department'] = $data['department'];
                $dataexport[$i]['attended_doctor'] = $data['attended_doctor'];
                $dataexport[$i]['initial_assessment_hr6'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr6']));
                $dataexport[$i]['discharge_date_time'] = date('Y-m-d H:i', strtotime($data['discharge_date_time']));

                // $dataexport[$i]['identification_details'] = ucfirst($data['identification_details']) . "\r\nRemarks: " . $data['identification_details_text'];
                // $dataexport[$i]['vital_signs'] = ucfirst($data['vital_signs']) . "\r\nRemarks: " . $data['vital_signs_text'];
                // $dataexport[$i]['surgery'] = ucfirst($data['surgery']) . "\r\nRemarks: " . $data['surgery_text'];
                // $dataexport[$i]['intake'] = ucfirst($data['intake']) . "\r\nRemarks: " . $data['intake_text'];
                // $dataexport[$i]['output'] = ucfirst($data['output']) . "\r\nRemarks: " . $data['output_text'];
                // $dataexport[$i]['allergies'] = ucfirst($data['allergies']) . "\r\nRemarks: " . $data['allergies_text'];

                // $dataexport[$i]['medication'] = ucfirst($data['medication']) . "\r\nRemarks: " . $data['medication_text'];
                // $dataexport[$i]['diagnostic'] = ucfirst($data['diagnostic']) . "\r\nRemarks: " . $data['diagnostic_text'];
                // $dataexport[$i]['pending_investigation'] = ucfirst($data['pending_investigation']) . "\r\nRemarks: " . $data['pending_investigation_text'];


                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];


                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- Hospital Acquired Pressure Ulcers (HAPU) Audit - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function overall_initial_assessment_ae()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_ma_assessment_ae';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->audit_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Audit Name';
            $header[1] = 'Date & Time of Audit';
            $header[2] = 'Audit by';
            $header[3] = 'Patient MID';
            $header[4] = 'Patient Name';
            $header[5] = 'Patient Age';
            $header[6] = 'Patient Gender';

            $j = 7;

            $header[$j++] = 'Area';
            $header[$j++] = 'Department';
            $header[$j++] = 'Attended Doctor';
            $header[$j++] = 'Admission Date & Time';
            $header[$j++] = 'Discharge Date & Time';

            $header[$j++] = 'Is General Information documented?';
            $header[$j++] = 'Are Allergies noted?';
            $header[$j++] = 'Is Vulnerability documented?';
            $header[$j++] = 'Is Pain assessment completed?';
            $header[$j++] = 'Is Fall risk assessment completed?';
            $header[$j++] = 'Are Vital signs recorded?';
            $header[$j++] = 'Are Modified Morse Scale completed?';


            $header[$j++] = 'Additional comments';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['audit_type'] = $data['audit_type'];
                $dataexport[$i]['date'] = date('Y-m-d H:i', strtotime($row->datetime));
                $dataexport[$i]['audit_by'] = $data['audit_by'];

                $dataexport[$i]['mid_no'] = $data['mid_no'];
                $dataexport[$i]['patient_name'] = $data['patient_name'];
                $dataexport[$i]['patient_age'] = $data['patient_age'];
                $dataexport[$i]['patient_gender'] = $data['patient_gender'];
                $dataexport[$i]['location'] = $data['location'];
                $dataexport[$i]['department'] = $data['department'];
                $dataexport[$i]['attended_doctor'] = $data['attended_doctor'];
                $dataexport[$i]['initial_assessment_hr6'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr6']));
                $dataexport[$i]['discharge_date_time'] = date('Y-m-d H:i', strtotime($data['discharge_date_time']));

                $dataexport[$i]['identification_details'] = ucfirst($data['identification_details']) . "\r\nRemarks: " . $data['identification_details_identification_remarks'];
                $dataexport[$i]['vital_signs'] = ucfirst($data['vital_signs']) . "\r\nRemarks: " . $data['vital_signs_text'];
                $dataexport[$i]['surgery'] = ucfirst($data['surgery']) . "\r\nRemarks: " . $data['surgery_text'];
                $dataexport[$i]['complaints_communicated'] = ucfirst($data['complaints_communicated']) . "\r\nRemarks: " . $data['complaints_communicated_text'];
                $dataexport[$i]['intake'] = ucfirst($data['intake']) . "\r\nRemarks: " . $data['intake_text'];

                $dataexport[$i]['output'] = ucfirst($data['output']) . "\r\nRemarks: " . $data['output_text'];
                $dataexport[$i]['allergies'] = ucfirst($data['allergies']) . "\r\nRemarks: " . $data['allergies_text'];


                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];


                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- Initial Assessment Accident and Emergency (A&E) - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function overall_initial_assessment_ipd()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_ma_assessment_ipd';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->audit_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Audit Name';
            $header[1] = 'Date & Time of Audit';
            $header[2] = 'Audit by';
            $header[3] = 'Patient MID';
            $header[4] = 'Patient Name';
            $header[5] = 'Patient Age';
            $header[6] = 'Patient Gender';

            $j = 7;

            $header[$j++] = 'Area';
            $header[$j++] = 'Department';
            $header[$j++] = 'Attended Doctor';
            $header[$j++] = 'Admission Date & Time';
            $header[$j++] = 'Discharge Date & Time';

            $header[$j++] = 'Is initial admission assessment completed - day care?';
            $header[$j++] = 'Is initial assessment started within defined TAT?';
            $header[$j++] = 'Are vital signs recorded?';
            $header[$j++] = 'Is orientation given to patient about environment?';
            $header[$j++] = 'Is the vulnerability status ascertained?';
            $header[$j++] = 'Is pain assessment completed?';
            $header[$j++] = 'Is ability to perform activities of daily living assessed?';
            $header[$j++] = 'Is psychological status assessed?';
            $header[$j++] = 'Is skin status assessed?';
            $header[$j++] = 'Is fall risk assessment completed?';
            $header[$j++] = 'Is braden scale completed?';
            $header[$j++] = 'Is current medication ascertained?';
            $header[$j++] = 'Is nursing care plan available?';
            $header[$j++] = 'Are special instructions documents included?';
            $header[$j++] = 'Is discharge note completed?';


            $header[$j++] = 'Additional comments';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['audit_type'] = $data['audit_type'];
                $dataexport[$i]['date'] = date('Y-m-d H:i', strtotime($row->datetime));
                $dataexport[$i]['audit_by'] = $data['audit_by'];

                $dataexport[$i]['mid_no'] = $data['mid_no'];
                $dataexport[$i]['patient_name'] = $data['patient_name'];
                $dataexport[$i]['patient_age'] = $data['patient_age'];
                $dataexport[$i]['patient_gender'] = $data['patient_gender'];
                $dataexport[$i]['location'] = $data['location'];
                $dataexport[$i]['department'] = $data['department'];
                $dataexport[$i]['attended_doctor'] = $data['attended_doctor'];
                $dataexport[$i]['initial_assessment_hr6'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr6']));
                $dataexport[$i]['discharge_date_time'] = date('Y-m-d H:i', strtotime($data['discharge_date_time']));

                $dataexport[$i]['identification_details'] = ucfirst($data['identification_details']) . "\r\nRemarks: " . $data['identification_details_text'];
                $dataexport[$i]['vital_signs'] = ucfirst($data['vital_signs']) . "\r\nRemarks: " . $data['vital_signs_text'];
                $dataexport[$i]['surgery'] = ucfirst($data['surgery']) . "\r\nRemarks: " . $data['surgery_text'];
                $dataexport[$i]['complaints_communicated'] = ucfirst($data['complaints_communicated']) . "\r\nRemarks: " . $data['complaints_communicated_text'];
                $dataexport[$i]['intake'] = ucfirst($data['intake']) . "\r\nRemarks: " . $data['intake_text'];
                $dataexport[$i]['output'] = ucfirst($data['output']) . "\r\nRemarks: " . $data['output_text'];
                $dataexport[$i]['allergies'] = ucfirst($data['allergies']) . "\r\nRemarks: " . $data['allergies_text'];
                $dataexport[$i]['medication'] = ucfirst($data['medication']) . "\r\nRemarks: " . $data['medication_text'];


                $dataexport[$i]['diagnostic'] = ucfirst($data['diagnostic']) . "\r\nRemarks: " . $data['diagnostic_text'];
                $dataexport[$i]['lab_results'] = ucfirst($data['lab_results']) . "\r\nRemarks: " . $data['lab_results_text'];
                $dataexport[$i]['pending_investigation'] = ucfirst($data['pending_investigation']) . "\r\nRemarks: " . $data['pending_investigation_text'];
                $dataexport[$i]['medicine_order'] = ucfirst($data['medicine_order']) . "\r\nRemarks: " . $data['medicine_order_text'];
                $dataexport[$i]['facility_communicated'] = ucfirst($data['facility_communicated']) . "\r\nRemarks: " . $data['facility_communicated_text'];
                $dataexport[$i]['health_education'] = ucfirst($data['health_education']) . "\r\nRemarks: " . $data['health_education_text'];
                $dataexport[$i]['risk_assessment'] = ucfirst($data['risk_assessment']) . "\r\nRemarks: " . $data['risk_assessment_text'];


                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];


                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- Initial Assessment IPD - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function overall_initial_assessment_opd()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_ma_assessment_opd';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->audit_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Audit Name';
            $header[1] = 'Date & Time of Audit';
            $header[2] = 'Audit by';
            $header[3] = 'Patient MID';
            $header[4] = 'Patient Name';
            $header[5] = 'Patient Age';
            $header[6] = 'Patient Gender';

            $j = 7;

            $header[$j++] = 'Area';
            $header[$j++] = 'Department';
            $header[$j++] = 'Attended Doctor';
            $header[$j++] = 'Admission Date & Time';
            $header[$j++] = 'Discharge Date & Time';

            $header[$j++] = 'Is physical examination finding recorded?';
            $header[$j++] = 'Is neurological examination recorded?';
            $header[$j++] = 'Initial assessment done by';

            $header[$j++] = 'Is initial admission assessment completed OPD ?';
            $header[$j++] = 'Is assessment done in defined TAT?';
            $header[$j++] = 'Are vital signs recorded?';
            $header[$j++] = 'Are allergies recorded?';
            $header[$j++] = 'Is pain assessment completed?';
            $header[$j++] = 'Is vulnerability status recorded?';
            $header[$j++] = 'Are fall risk assessment completed?';
            $header[$j++] = 'Is general information recorded?';
            $header[$j++] = 'Is current medication ascertained?';
            $header[$j++] = 'Is nursing care plan available?';
            $header[$j++] = 'Are special instructions documents included?';
            $header[$j++] = 'Is discharge note completed?';


            $header[$j++] = 'Additional comments';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['audit_type'] = $data['audit_type'];
                $dataexport[$i]['date'] = date('Y-m-d H:i', strtotime($row->datetime));
                $dataexport[$i]['audit_by'] = $data['audit_by'];

                $dataexport[$i]['mid_no'] = $data['mid_no'];
                $dataexport[$i]['patient_name'] = $data['patient_name'];
                $dataexport[$i]['patient_age'] = $data['patient_age'];
                $dataexport[$i]['patient_gender'] = $data['patient_gender'];
                $dataexport[$i]['location'] = $data['location'];
                $dataexport[$i]['department'] = $data['department'];
                $dataexport[$i]['attended_doctor'] = $data['attended_doctor'];
                $dataexport[$i]['initial_assessment_hr6'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr6']));
                $dataexport[$i]['discharge_date_time'] = date('Y-m-d H:i', strtotime($data['discharge_date_time']));

                $dataexport[$i]['identification_details'] = ucfirst($data['identification_details']) . "\r\nRemarks: " . $data['identification_details_text'];
                $dataexport[$i]['vital_signs'] = ucfirst($data['vital_signs']) . "\r\nRemarks: " . $data['vital_signs_text'];
                $dataexport[$i]['surgery'] = ucfirst($data['surgery']);
                $dataexport[$i]['complaints_communicated'] = ucfirst($data['complaints_communicated']) . "\r\nRemarks: " . $data['complaints_communicated_text'];
                $dataexport[$i]['intake'] = ucfirst($data['intake']) . "\r\nRemarks: " . $data['intake_text'];
                $dataexport[$i]['output'] = ucfirst($data['output']) . "\r\nRemarks: " . $data['output_text'];
                $dataexport[$i]['allergies'] = ucfirst($data['allergies']) . "\r\nRemarks: " . $data['allergies_text'];
                $dataexport[$i]['medication'] = ucfirst($data['medication']) . "\r\nRemarks: " . $data['medication_text'];


                $dataexport[$i]['diagnostic'] = ucfirst($data['diagnostic']) . "\r\nRemarks: " . $data['diagnostic_text'];
                $dataexport[$i]['lab_results'] = ucfirst($data['lab_results']) . "\r\nRemarks: " . $data['lab_results_text'];
                $dataexport[$i]['pending_investigation'] = ucfirst($data['pending_investigation']) . "\r\nRemarks: " . $data['pending_investigation_text'];
                $dataexport[$i]['medicine_order'] = ucfirst($data['medicine_order']) . "\r\nRemarks: " . $data['medicine_order_text'];
                $dataexport[$i]['facility_communicated'] = ucfirst($data['facility_communicated']) . "\r\nRemarks: " . $data['facility_communicated_text'];
                $dataexport[$i]['health_education'] = ucfirst($data['health_education']) . "\r\nRemarks: " . $data['health_education_text'];
                $dataexport[$i]['risk_assessment'] = ucfirst($data['risk_assessment']) . "\r\nRemarks: " . $data['risk_assessment_text'];


                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];


                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- Initial Assessment OPD - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function overall_ipsg1()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_ma_ipsg1_audit';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->audit_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Audit Name';
            $header[1] = 'Date & Time of Audit';
            $header[2] = 'Audit by';
            $header[3] = 'Patient MID';
            $header[4] = 'Patient Name';
            $header[5] = 'Patient Age';
            $header[6] = 'Patient Gender';

            $j = 7;

            $header[$j++] = 'Area';
            $header[$j++] = 'Department';
            $header[$j++] = 'Attended Doctor';
            $header[$j++] = 'Admission Date & Time';
            $header[$j++] = 'Discharge Date & Time';

            $header[$j++] = 'Is the patient ID band clear and readable?';
            $header[$j++] = 'Is the patient’s identity confirmed before administering high-alert medications?';
            $header[$j++] = 'Are two identifiers consistently checked before administering medication, diagnostic tests, or procedures?';
            $header[$j++] = 'Is family or caregiver confirmation obtained if the patient is unconscious, pediatric, or unable to respond?';
            $header[$j++] = 'Is a new ID band provided immediately if the previous one is lost or damaged?';


            $header[$j++] = 'Additional comments';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['audit_type'] = $data['audit_type'];
                $dataexport[$i]['date'] = date('Y-m-d H:i', strtotime($row->datetime));
                $dataexport[$i]['audit_by'] = $data['audit_by'];

                $dataexport[$i]['mid_no'] = $data['mid_no'];
                $dataexport[$i]['patient_name'] = $data['patient_name'];
                $dataexport[$i]['patient_age'] = $data['patient_age'];
                $dataexport[$i]['patient_gender'] = $data['patient_gender'];
                $dataexport[$i]['location'] = $data['location'];
                $dataexport[$i]['department'] = $data['department'];
                $dataexport[$i]['attended_doctor'] = $data['attended_doctor'];
                $dataexport[$i]['initial_assessment_hr6'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr6']));
                $dataexport[$i]['discharge_date_time'] = date('Y-m-d H:i', strtotime($data['discharge_date_time']));

                $dataexport[$i]['identification_details'] = ucfirst($data['identification_details']) . "\r\nRemarks: " . $data['identification_details_text'];
                $dataexport[$i]['vital_signs'] = ucfirst($data['vital_signs']) . "\r\nRemarks: " . $data['vital_signs_text'];
                $dataexport[$i]['surgery'] = ucfirst($data['surgery']) . "\r\nRemarks: " . $data['surgery_text'];
                $dataexport[$i]['complaints_communicated'] = ucfirst($data['complaints_communicated']) . "\r\nRemarks: " . $data['complaints_communicated_text'];
                $dataexport[$i]['intake'] = ucfirst($data['intake']) . "\r\nRemarks: " . $data['intake_text'];


                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];


                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- IPSG-1 - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function overall_ipsg2_er()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_ma_ipsg2_er';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->audit_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Audit Name';
            $header[1] = 'Date & Time of Audit';
            $header[2] = 'Audit by';
            $header[3] = 'Patient MID';
            $header[4] = 'Patient Name';
            $header[5] = 'Patient Age';
            $header[6] = 'Patient Gender';

            $j = 7;

            $header[$j++] = 'Area';
            $header[$j++] = 'Department';
            $header[$j++] = 'Attended Doctor';
            $header[$j++] = 'Admission Date & Time';
            $header[$j++] = 'Discharge Date & Time';

            $header[$j++] = 'Is ISBAR format used during handover between staff/units?';
            $header[$j++] = 'Are interdepartmental transfers (ED → Ward/ICU/OT) documented using a transfer checklist?';
            $header[$j++] = 'Are critical content of hand over, investigation and pending procedures clearly mentioned during hand over?';
            $header[$j++] = 'Is medication handover complete (time, dose, high-alert drugs, infusions, etc.)?';
            $header[$j++] = 'Is family/patient education documented (diagnosis, plan, transfer, safety measures)?';
            $header[$j++] = 'Are shift handovers done at bedside with active participation of incoming team?';


            $header[$j++] = 'Additional comments';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['audit_type'] = $data['audit_type'];
                $dataexport[$i]['date'] = date('Y-m-d H:i', strtotime($row->datetime));
                $dataexport[$i]['audit_by'] = $data['audit_by'];

                $dataexport[$i]['mid_no'] = $data['mid_no'];
                $dataexport[$i]['patient_name'] = $data['patient_name'];
                $dataexport[$i]['patient_age'] = $data['patient_age'];
                $dataexport[$i]['patient_gender'] = $data['patient_gender'];
                $dataexport[$i]['location'] = $data['location'];
                $dataexport[$i]['department'] = $data['department'];
                $dataexport[$i]['attended_doctor'] = $data['attended_doctor'];
                $dataexport[$i]['initial_assessment_hr6'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr6']));
                $dataexport[$i]['discharge_date_time'] = date('Y-m-d H:i', strtotime($data['discharge_date_time']));

                $dataexport[$i]['identification_details'] = ucfirst($data['identification_details']) . "\r\nRemarks: " . $data['identification_details_text'];
                $dataexport[$i]['vital_signs'] = ucfirst($data['vital_signs']) . "\r\nRemarks: " . $data['vital_signs_text'];
                $dataexport[$i]['surgery'] = ucfirst($data['surgery']) . "\r\nRemarks: " . $data['surgery_text'];
                $dataexport[$i]['complaints_communicated'] = ucfirst($data['complaints_communicated']) . "\r\nRemarks: " . $data['complaints_communicated_text'];
                $dataexport[$i]['intake'] = ucfirst($data['intake']) . "\r\nRemarks: " . $data['intake_text'];
                $dataexport[$i]['output'] = ucfirst($data['output']) . "\r\nRemarks: " . $data['output_text'];


                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];


                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- IPSG-2-ER - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function overall_ipsg2_ae()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_ma_ipsg2_ae';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->audit_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Audit Name';
            $header[1] = 'Date & Time of Audit';
            $header[2] = 'Audit by';
            $header[3] = 'Patient MID';
            $header[4] = 'Patient Name';
            $header[5] = 'Patient Age';
            $header[6] = 'Patient Gender';

            $j = 7;

            $header[$j++] = 'Area';
            $header[$j++] = 'Department';
            $header[$j++] = 'Attended Doctor';
            $header[$j++] = 'Admission Date & Time';
            $header[$j++] = 'Discharge Date & Time';

            $header[$j++] = 'Is the patient correctly identified using two identifiers (full name & MID)?';
            $header[$j++] = 'Is the transfer order verified and documented properly?';
            $header[$j++] = 'Is the patient properly introduced to the incoming staff?';
            $header[$j++] = 'Is the handover performed correctly using ISBAR format? Are MLC cases handed over as per protocol?';
            $header[$j++] = 'Are pre-procedure/surgery preparations completed, including site marking, consent, medications, and investigations?';
            $header[$j++] = 'Is handover of investigations, valuables, and diagnostic measures done appropriately for the patient (in/out)?';
            $header[$j++] = 'Is the handover of medication administration accurate and complete?';
            $header[$j++] = 'Are staff knowledgeable and compliant with the handover process and workflow?';



            $header[$j++] = 'Additional comments';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['audit_type'] = $data['audit_type'];
                $dataexport[$i]['date'] = date('Y-m-d H:i', strtotime($row->datetime));
                $dataexport[$i]['audit_by'] = $data['audit_by'];

                $dataexport[$i]['mid_no'] = $data['mid_no'];
                $dataexport[$i]['patient_name'] = $data['patient_name'];
                $dataexport[$i]['patient_age'] = $data['patient_age'];
                $dataexport[$i]['patient_gender'] = $data['patient_gender'];
                $dataexport[$i]['location'] = $data['location'];
                $dataexport[$i]['department'] = $data['department'];
                $dataexport[$i]['attended_doctor'] = $data['attended_doctor'];
                $dataexport[$i]['initial_assessment_hr6'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr6']));
                $dataexport[$i]['discharge_date_time'] = date('Y-m-d H:i', strtotime($data['discharge_date_time']));

                $dataexport[$i]['identification_details'] = ucfirst($data['identification_details']) . "\r\nRemarks: " . $data['identification_details_text'];
                $dataexport[$i]['vital_signs'] = ucfirst($data['vital_signs']) . "\r\nRemarks: " . $data['vital_signs_text'];
                $dataexport[$i]['surgery'] = ucfirst($data['surgery']) . "\r\nRemarks: " . $data['surgery_text'];
                $dataexport[$i]['complaints_communicated'] = ucfirst($data['complaints_communicated']) . "\r\nRemarks: " . $data['complaints_communicated_text'];
                $dataexport[$i]['intake'] = ucfirst($data['intake']) . "\r\nRemarks: " . $data['intake_text'];
                $dataexport[$i]['output'] = ucfirst($data['output']) . "\r\nRemarks: " . $data['output_text'];

                $dataexport[$i]['allergies'] = ucfirst($data['allergies']) . "\r\nRemarks: " . $data['allergies_text'];
                $dataexport[$i]['medication'] = ucfirst($data['medication']) . "\r\nRemarks: " . $data['medication_text'];


                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];


                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- IPSG2- A&E - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function overall_ipsg2_ipd()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_ma_ipsg2_ipd';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->audit_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Audit Name';
            $header[1] = 'Date & Time of Audit';
            $header[2] = 'Audit by';
            $header[3] = 'Patient MID';
            $header[4] = 'Patient Name';
            $header[5] = 'Patient Age';
            $header[6] = 'Patient Gender';

            $j = 7;

            $header[$j++] = 'Area';
            $header[$j++] = 'Department';
            $header[$j++] = 'Attended Doctor';
            $header[$j++] = 'Admission Date & Time';
            $header[$j++] = 'Discharge Date & Time';

            $header[$j++] = 'Is the handover conducted face to face at the bedside or designated area?';
            $header[$j++] = 'Are critical findings, NEWS score, and pain status communicated along with the management plan?';
            $header[$j++] = 'Are conditions of skin integrity, restraint site, and fall risk status communicated during handover?';
            $header[$j++] = 'Is information documented appropriately in the handover notes?';
            $header[$j++] = 'Is the staff able to summarize the patient’s condition without referring back to records?';
            $header[$j++] = 'Was the handover completed within a reasonable time, without interruptions such as phone calls, distractions, or multitasking?';
            $header[$j++] = 'Is the transfer order verified and documented in the transfer form?';



            $header[$j++] = 'Additional comments';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['audit_type'] = $data['audit_type'];
                $dataexport[$i]['date'] = date('Y-m-d H:i', strtotime($row->datetime));
                $dataexport[$i]['audit_by'] = $data['audit_by'];

                $dataexport[$i]['mid_no'] = $data['mid_no'];
                $dataexport[$i]['patient_name'] = $data['patient_name'];
                $dataexport[$i]['patient_age'] = $data['patient_age'];
                $dataexport[$i]['patient_gender'] = $data['patient_gender'];
                $dataexport[$i]['location'] = $data['location'];
                $dataexport[$i]['department'] = $data['department'];
                $dataexport[$i]['attended_doctor'] = $data['attended_doctor'];
                $dataexport[$i]['initial_assessment_hr6'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr6']));
                $dataexport[$i]['discharge_date_time'] = date('Y-m-d H:i', strtotime($data['discharge_date_time']));

                $dataexport[$i]['identification_details'] = ucfirst($data['identification_details']) . "\r\nRemarks: " . $data['identification_details_text'];
                $dataexport[$i]['vital_signs'] = ucfirst($data['vital_signs']) . "\r\nRemarks: " . $data['vital_signs_text'];
                $dataexport[$i]['surgery'] = ucfirst($data['surgery']) . "\r\nRemarks: " . $data['surgery_text'];
                $dataexport[$i]['complaints_communicated'] = ucfirst($data['complaints_communicated']) . "\r\nRemarks: " . $data['complaints_communicated_text'];
                $dataexport[$i]['intake'] = ucfirst($data['intake']) . "\r\nRemarks: " . $data['intake_text'];
                $dataexport[$i]['output'] = ucfirst($data['output']) . "\r\nRemarks: " . $data['output_text'];
                $dataexport[$i]['allergies'] = ucfirst($data['allergies']) . "\r\nRemarks: " . $data['allergies_text'];


                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];


                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- IPSG2- IPD - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function overall_ipsg4_timeout()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_ma_ipsg4_timeout';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->audit_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Audit Name';
            $header[1] = 'Date & Time of Audit';
            $header[2] = 'Audit by';
            $header[3] = 'Patient MID';
            $header[4] = 'Patient Name';
            $header[5] = 'Patient Age';
            $header[6] = 'Patient Gender';

            $j = 7;

            $header[$j++] = 'Area';
            $header[$j++] = 'Department';
            $header[$j++] = 'Attended Doctor';
            $header[$j++] = 'Admission Date & Time';
            $header[$j++] = 'Discharge Date & Time';

            $header[$j++] = 'Name of Procedure';
            $header[$j++] = 'Date and Time of Procedure';


            $header[$j++] = 'Is the procedure name confirmed against the consent form and physician order?';
            $header[$j++] = 'Are emergency drugs, resuscitation equipment, and oxygen available at the bedside?';
            $header[$j++] = 'Are the required equipment, implants, and instruments checked and ready before the procedure?';
            $header[$j++] = 'Is a “time-out” pause performed with the full team to confirm the correct patient, procedure, site, and consent?';
            $header[$j++] = 'Does the “sign-out” record include the procedure performed, specimens sent, and any complications?';



            $header[$j++] = 'Additional comments';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['audit_type'] = $data['audit_type'];
                $dataexport[$i]['date'] = date('Y-m-d H:i', strtotime($row->datetime));
                $dataexport[$i]['audit_by'] = $data['audit_by'];

                $dataexport[$i]['mid_no'] = $data['mid_no'];
                $dataexport[$i]['patient_name'] = $data['patient_name'];
                $dataexport[$i]['patient_age'] = $data['patient_age'];
                $dataexport[$i]['patient_gender'] = $data['patient_gender'];
                $dataexport[$i]['location'] = $data['location'];
                $dataexport[$i]['department'] = $data['department'];
                $dataexport[$i]['attended_doctor'] = $data['attended_doctor'];
                $dataexport[$i]['initial_assessment_hr6'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr6']));
                $dataexport[$i]['discharge_date_time'] = date('Y-m-d H:i', strtotime($data['discharge_date_time']));

                $dataexport[$i]['identification_details'] = $data['identification_details'];

                $dataexport[$i]['vital_signs'] = date('Y-m-d H:i', strtotime($data['vital_signs']));


                $dataexport[$i]['surgery'] = ucfirst($data['surgery']) . "\r\nRemarks: " . $data['surgery_text'];
                $dataexport[$i]['complaints_communicated'] = ucfirst($data['complaints_communicated']) . "\r\nRemarks: " . $data['complaints_communicated_text'];
                $dataexport[$i]['intake'] = ucfirst($data['intake']) . "\r\nRemarks: " . $data['intake_text'];
                $dataexport[$i]['output'] = ucfirst($data['output']) . "\r\nRemarks: " . $data['output_text'];
                $dataexport[$i]['allergies'] = ucfirst($data['allergies']) . "\r\nRemarks: " . $data['allergies_text'];


                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];


                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- IPSG4-Timeout- Outside OT Audit - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function overall_ipsg6_ip()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_ma_ipsg6_ip';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->audit_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Audit Name';
            $header[1] = 'Date & Time of Audit';
            $header[2] = 'Audit by';
            $header[3] = 'Patient MID';
            $header[4] = 'Patient Name';
            $header[5] = 'Patient Age';
            $header[6] = 'Patient Gender';

            $j = 7;

            $header[$j++] = 'Area';
            $header[$j++] = 'Department';
            $header[$j++] = 'Attended Doctor';
            $header[$j++] = 'Admission Date & Time';
            $header[$j++] = 'Discharge Date & Time';


            $header[$j++] = 'Are adequate lighting maintained?';
            $header[$j++] = 'Is it ensured that No tangling tubes and phone cords are present in the patient room?';
            $header[$j++] = 'Are nurse call bell placed within the patients reach?';
            $header[$j++] = 'Are floors maintained wet free and no tripping hazards in the room?';
            $header[$j++] = 'Are fall prevention screening completed?';
            $header[$j++] = 'Are patients aware of fall risk and precautions?';
            $header[$j++] = 'Is fall risk status communicated in shift handover report?';
            $header[$j++] = 'Are furnishings well maintained (bed locked, walker/commode with rubber caps available)?';
            $header[$j++] = 'Is correctness of fall risk score verified?';
            $header[$j++] = 'Is cognitive impairment identified?';
            $header[$j++] = 'Is physical impairment identified?';
            $header[$j++] = 'Are safety interventions implemented (side rails)?';
            $header[$j++] = 'Is patient accompanied by staff / attenders to rest rooms / side of the bed?';
            $header[$j++] = 'Is the awareness of fall prevention protocol adequate?';


            $header[$j++] = 'Additional comments';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['audit_type'] = $data['audit_type'];
                $dataexport[$i]['date'] = date('Y-m-d H:i', strtotime($row->datetime));
                $dataexport[$i]['audit_by'] = $data['audit_by'];

                $dataexport[$i]['mid_no'] = $data['mid_no'];
                $dataexport[$i]['patient_name'] = $data['patient_name'];
                $dataexport[$i]['patient_age'] = $data['patient_age'];
                $dataexport[$i]['patient_gender'] = $data['patient_gender'];
                $dataexport[$i]['location'] = $data['location'];
                $dataexport[$i]['department'] = $data['department'];
                $dataexport[$i]['attended_doctor'] = $data['attended_doctor'];
                $dataexport[$i]['initial_assessment_hr6'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr6']));
                $dataexport[$i]['discharge_date_time'] = date('Y-m-d H:i', strtotime($data['discharge_date_time']));



                $dataexport[$i]['identification_details'] = ucfirst($data['identification_details']) . "\r\nRemarks: " . $data['identification_details_text'];
                $dataexport[$i]['vital_signs'] = ucfirst($data['vital_signs']) . "\r\nRemarks: " . $data['vital_signs_text'];
                $dataexport[$i]['surgery'] = ucfirst($data['surgery']) . "\r\nRemarks: " . $data['surgery_text'];
                $dataexport[$i]['complaints_communicated'] = ucfirst($data['complaints_communicated']) . "\r\nRemarks: " . $data['complaints_communicated_text'];
                $dataexport[$i]['intake'] = ucfirst($data['intake']) . "\r\nRemarks: " . $data['intake_text'];
                $dataexport[$i]['output'] = ucfirst($data['output']) . "\r\nRemarks: " . $data['output_text'];

                $dataexport[$i]['allergies'] = ucfirst($data['allergies']) . "\r\nRemarks: " . $data['allergies_text'];
                $dataexport[$i]['medication'] = ucfirst($data['medication']) . "\r\nRemarks: " . $data['medication_text'];
                $dataexport[$i]['diagnostic'] = ucfirst($data['diagnostic']) . "\r\nRemarks: " . $data['diagnostic_text'];

                $dataexport[$i]['lab_results'] = ucfirst($data['lab_results']) . "\r\nRemarks: " . $data['lab_results_text'];
                $dataexport[$i]['pending_investigation'] = ucfirst($data['pending_investigation']) . "\r\nRemarks: " . $data['pending_investigation_text'];
                $dataexport[$i]['medicine_order'] = ucfirst($data['medicine_order']) . "\r\nRemarks: " . $data['medicine_order_text'];
                $dataexport[$i]['facility_communicated'] = ucfirst($data['facility_communicated']) . "\r\nRemarks: " . $data['facility_communicated_text'];
                $dataexport[$i]['health_education'] = ucfirst($data['health_education']) . "\r\nRemarks: " . $data['health_education_text'];



                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];


                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- IPSG6- IP - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function overall_ipsg6_opd()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_ma_ipsg6_opd';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->audit_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Audit Name';
            $header[1] = 'Date & Time of Audit';
            $header[2] = 'Audit by';
            $header[3] = 'Patient MID';
            $header[4] = 'Patient Name';
            $header[5] = 'Patient Age';
            $header[6] = 'Patient Gender';

            $j = 7;

            $header[$j++] = 'Area';
            $header[$j++] = 'Department';
            $header[$j++] = 'Attended Doctor';
            $header[$j++] = 'Admission Date & Time';
            $header[$j++] = 'Discharge Date & Time';


            $header[$j++] = 'Is there evidence of patient and family education?';
            $header[$j++] = 'Is the escort able to identify patients vulnerable to falls?';
            $header[$j++] = 'Is fall risk screening documented in EMAR?';
            $header[$j++] = 'Is the patient area safe and free of hazards?';
            $header[$j++] = 'Is the current situation assessed for fall risks?';
            $header[$j++] = 'Are other fall risk situations identified, if any?';
            $header[$j++] = 'Are preventive measures taken for incoming patients?';
            $header[$j++] = 'Is adequate lighting provided in the area?';
            $header[$j++] = 'Is the floor clean and dry?';
            $header[$j++] = 'Is the patient accompanied and supported by a companion?';
            $header[$j++] = 'Is the seat belt fastened securely?';
            $header[$j++] = 'Are the patients feet rested on the footplate?';
            $header[$j++] = 'Are the wheels locked or brakes applied?';
            $header[$j++] = 'Are the side rails raised for safety?';
            $header[$j++] = 'Is the trolley height adjusted to the minimum level?';
            $header[$j++] = 'Are the wheels properly locked?';
            $header[$j++] = 'Is the escort aware of fall risk prevention measures?';



            $header[$j++] = 'Additional comments';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['audit_type'] = $data['audit_type'];
                $dataexport[$i]['date'] = date('Y-m-d H:i', strtotime($row->datetime));
                $dataexport[$i]['audit_by'] = $data['audit_by'];

                $dataexport[$i]['mid_no'] = $data['mid_no'];
                $dataexport[$i]['patient_name'] = $data['patient_name'];
                $dataexport[$i]['patient_age'] = $data['patient_age'];
                $dataexport[$i]['patient_gender'] = $data['patient_gender'];
                $dataexport[$i]['location'] = $data['location'];
                $dataexport[$i]['department'] = $data['department'];
                $dataexport[$i]['attended_doctor'] = $data['attended_doctor'];
                $dataexport[$i]['initial_assessment_hr6'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr6']));
                $dataexport[$i]['discharge_date_time'] = date('Y-m-d H:i', strtotime($data['discharge_date_time']));



                $dataexport[$i]['identification_details'] = ucfirst($data['identification_details']) . "\r\nRemarks: " . $data['identification_details_text'];
                $dataexport[$i]['vital_signs'] = ucfirst($data['vital_signs']) . "\r\nRemarks: " . $data['vital_signs_text'];
                $dataexport[$i]['surgery'] = ucfirst($data['surgery']) . "\r\nRemarks: " . $data['surgery_text'];
                $dataexport[$i]['complaints_communicated'] = ucfirst($data['complaints_communicated']) . "\r\nRemarks: " . $data['complaints_communicated_text'];
                $dataexport[$i]['intake'] = ucfirst($data['intake']) . "\r\nRemarks: " . $data['intake_text'];
                $dataexport[$i]['output'] = ucfirst($data['output']) . "\r\nRemarks: " . $data['output_text'];

                $dataexport[$i]['allergies'] = ucfirst($data['allergies']) . "\r\nRemarks: " . $data['allergies_text'];
                $dataexport[$i]['medication'] = ucfirst($data['medication']) . "\r\nRemarks: " . $data['medication_text'];
                $dataexport[$i]['diagnostic'] = ucfirst($data['diagnostic']) . "\r\nRemarks: " . $data['diagnostic_text'];

                $dataexport[$i]['lab_results'] = ucfirst($data['lab_results']) . "\r\nRemarks: " . $data['lab_results_text'];
                $dataexport[$i]['pending_investigation'] = ucfirst($data['pending_investigation']) . "\r\nRemarks: " . $data['pending_investigation_text'];
                $dataexport[$i]['medicine_order'] = ucfirst($data['medicine_order']) . "\r\nRemarks: " . $data['medicine_order_text'];
                $dataexport[$i]['facility_communicated'] = ucfirst($data['facility_communicated']) . "\r\nRemarks: " . $data['facility_communicated_text'];
                $dataexport[$i]['health_education'] = ucfirst($data['health_education']) . "\r\nRemarks: " . $data['health_education_text'];

                $dataexport[$i]['risk_assessment'] = ucfirst($data['risk_assessment']) . "\r\nRemarks: " . $data['risk_assessment_text'];
                $dataexport[$i]['urethral'] = ucfirst($data['urethral']) . "\r\nRemarks: " . $data['urethral_text'];
                $dataexport[$i]['urine_sample'] = ucfirst($data['urine_sample']) . "\r\nRemarks: " . $data['urine_sample_text'];



                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];


                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- IPSG6- OPD - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function overall_point_prevelance()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_ma_point_prevlance_audit';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->audit_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Audit Name';
            $header[1] = 'Date & Time of Audit';
            $header[2] = 'Audit by';
            $header[3] = 'Patient MID';
            $header[4] = 'Patient Name';
            $header[5] = 'Patient Age';
            $header[6] = 'Patient Gender';

            $j = 7;

            $header[$j++] = 'Area';
            $header[$j++] = 'Department';
            $header[$j++] = 'Attended Doctor';
            $header[$j++] = 'Admission Date & Time';
            $header[$j++] = 'Discharge Date & Time';


            // $header[$j++] = 'Is the patient’s skin intact?';
            // $header[$j++] = 'Is the escort able to identify patients vulnerable to falls?';
            // $header[$j++] = 'Is fall risk screening documented in EMAR?';
            // $header[$j++] = 'Is the patient area safe and free of hazards?';
            // $header[$j++] = 'Is the current situation assessed for fall risks?';
            // $header[$j++] = 'Are other fall risk situations identified, if any?';
            // $header[$j++] = 'Are preventive measures taken for incoming patients?';
            // $header[$j++] = 'Is adequate lighting provided in the area?';
            // $header[$j++] = 'Is the floor clean and dry?';
            // $header[$j++] = 'Is the patient accompanied and supported by a companion?';
            // $header[$j++] = 'Is the seat belt fastened securely?';
            // $header[$j++] = 'Are the patients feet rested on the footplate?';
            // $header[$j++] = 'Are the wheels locked or brakes applied?';
            // $header[$j++] = 'Are the side rails raised for safety?';
            // $header[$j++] = 'Is the trolley height adjusted to the minimum level?';
            // $header[$j++] = 'Are the wheels properly locked?';
            // $header[$j++] = 'Is the escort aware of fall risk prevention measures?';



            $header[$j++] = 'Additional comments';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['audit_type'] = $data['audit_type'];
                $dataexport[$i]['date'] = date('Y-m-d H:i', strtotime($row->datetime));
                $dataexport[$i]['audit_by'] = $data['audit_by'];

                $dataexport[$i]['mid_no'] = $data['mid_no'];
                $dataexport[$i]['patient_name'] = $data['patient_name'];
                $dataexport[$i]['patient_age'] = $data['patient_age'];
                $dataexport[$i]['patient_gender'] = $data['patient_gender'];
                $dataexport[$i]['location'] = $data['location'];
                $dataexport[$i]['department'] = $data['department'];
                $dataexport[$i]['attended_doctor'] = $data['attended_doctor'];
                $dataexport[$i]['initial_assessment_hr6'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr6']));
                $dataexport[$i]['discharge_date_time'] = date('Y-m-d H:i', strtotime($data['discharge_date_time']));



                // $dataexport[$i]['identification_details'] = ucfirst($data['identification_details']) . "\r\nRemarks: " . $data['identification_details_text'];
                // $dataexport[$i]['vital_signs'] = ucfirst($data['vital_signs']) . "\r\nRemarks: " . $data['vital_signs_text'];
                // $dataexport[$i]['surgery'] = ucfirst($data['surgery']) . "\r\nRemarks: " . $data['surgery_text'];
                // $dataexport[$i]['complaints_communicated'] = ucfirst($data['complaints_communicated']) . "\r\nRemarks: " . $data['complaints_communicated_text'];
                // $dataexport[$i]['intake'] = ucfirst($data['intake']) . "\r\nRemarks: " . $data['intake_text'];
                // $dataexport[$i]['output'] = ucfirst($data['output']) . "\r\nRemarks: " . $data['output_text'];

                // $dataexport[$i]['allergies'] = ucfirst($data['allergies']) . "\r\nRemarks: " . $data['allergies_text'];
                // $dataexport[$i]['medication'] = ucfirst($data['medication']) . "\r\nRemarks: " . $data['medication_text'];
                // $dataexport[$i]['diagnostic'] = ucfirst($data['diagnostic']) . "\r\nRemarks: " . $data['diagnostic_text'];

                // $dataexport[$i]['lab_results'] = ucfirst($data['lab_results']) . "\r\nRemarks: " . $data['lab_results_text'];
                // $dataexport[$i]['pending_investigation'] = ucfirst($data['pending_investigation']) . "\r\nRemarks: " . $data['pending_investigation_text'];
                // $dataexport[$i]['medicine_order'] = ucfirst($data['medicine_order']) . "\r\nRemarks: " . $data['medicine_order_text'];
                // $dataexport[$i]['facility_communicated'] = ucfirst($data['facility_communicated']) . "\r\nRemarks: " . $data['facility_communicated_text'];
                // $dataexport[$i]['health_education'] = ucfirst($data['health_education']) . "\r\nRemarks: " . $data['health_education_text'];

                // $dataexport[$i]['risk_assessment'] = ucfirst($data['risk_assessment']) . "\r\nRemarks: " . $data['risk_assessment_text'];
                // $dataexport[$i]['urethral'] = ucfirst($data['urethral']) . "\r\nRemarks: " . $data['urethral_text'];
                // $dataexport[$i]['urine_sample'] = ucfirst($data['urine_sample']) . "\r\nRemarks: " . $data['urine_sample_text'];



                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];


                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- Point Prevalence Audit - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }


    // Clinical outcome
    public function overall_clinical_audit_acl()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_ma_clinicaloutcome_audit_acl';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->audit_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Audit Name';
            $header[1] = 'Date & Time of Audit';
            $header[2] = 'Audit by';
            $header[3] = 'Patient MID';
            $header[4] = 'Patient Name';
            $header[5] = 'Patient Age';
            $header[6] = 'Patient Gender';

            $j = 7;

            $header[$j++] = 'Area';
            $header[$j++] = 'Department';
            $header[$j++] = 'Attended Doctor';
            $header[$j++] = 'Admission Date & Time';
            $header[$j++] = 'Discharge Date & Time';

            $header[$j++] = 'How many days after admission did the patient get discharged?';
            $header[$j++] = 'Was there any other structure involved – (Meniscus, LM, MCL, LCL, PCL)?';
            $header[$j++] = 'Did this patient get re admitted within 30 days after surgery?';
            $header[$j++] = 'Did this patient have any post operative complication, other than infection?';
            $header[$j++] = 'Did this patient require any revision surgery during admission?';
            $header[$j++] = 'Did this patient come for a review 30 days after surgery?';



            $header[$j++] = 'Additional comments';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['audit_type'] = $data['audit_type'];
                $dataexport[$i]['date'] = date('Y-m-d H:i', strtotime($row->datetime));
                $dataexport[$i]['audit_by'] = $data['audit_by'];

                $dataexport[$i]['mid_no'] = $data['mid_no'];
                $dataexport[$i]['patient_name'] = $data['patient_name'];
                $dataexport[$i]['patient_age'] = $data['patient_age'];
                $dataexport[$i]['patient_gender'] = $data['patient_gender'];
                $dataexport[$i]['location'] = $data['location'];
                $dataexport[$i]['department'] = $data['department'];
                $dataexport[$i]['attended_doctor'] = $data['attended_doctor'];
                $dataexport[$i]['initial_assessment_hr6'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr6']));
                $dataexport[$i]['discharge_date_time'] = date('Y-m-d H:i', strtotime($data['discharge_date_time']));

                $dataexport[$i]['identification_details'] = ucfirst($data['identification_details']);
                $dataexport[$i]['vital_signs'] = ucfirst($data['vital_signs']);
                $dataexport[$i]['surgery'] = ucfirst($data['surgery']) . "\r\nRemarks: " . $data['surgery_text'];
                $dataexport[$i]['complaints_communicated'] = ucfirst($data['complaints_communicated']) . "\r\nRemarks: " . $data['complaints_communicated_text'];
                $dataexport[$i]['intake'] = ucfirst($data['intake']) . "\r\nRemarks: " . $data['intake_remarks'];
                $dataexport[$i]['output'] = ucfirst($data['output']) . "\r\nRemarks: " . $data['output_remarks'];


                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];


                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- ACL - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function overall_clinical_allogenic_bone_marrow()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_ma_clinicaloutcome_allogenic_bone_marrow';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->audit_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Audit Name';
            $header[1] = 'Date & Time of Audit';
            $header[2] = 'Audit by';
            $header[3] = 'Patient MID';
            $header[4] = 'Patient Name';
            $header[5] = 'Patient Age';
            $header[6] = 'Patient Gender';

            $j = 7;

            $header[$j++] = 'Area';
            $header[$j++] = 'Department';
            $header[$j++] = 'Attended Doctor';
            $header[$j++] = 'Admission Date & Time';
            $header[$j++] = 'Discharge Date & Time';

            $header[$j++] = 'Was there mortality after 30 days of bone marrow transplant?';
            $header[$j++] = 'Was there mortality after 100 days of bone marrow transplant?';
            $header[$j++] = 'Did the patient undergo engraftment post-transplant?';


            $header[$j++] = 'Additional comments';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['audit_type'] = $data['audit_type'];
                $dataexport[$i]['date'] = date('Y-m-d H:i', strtotime($row->datetime));
                $dataexport[$i]['audit_by'] = $data['audit_by'];

                $dataexport[$i]['mid_no'] = $data['mid_no'];
                $dataexport[$i]['patient_name'] = $data['patient_name'];
                $dataexport[$i]['patient_age'] = $data['patient_age'];
                $dataexport[$i]['patient_gender'] = $data['patient_gender'];
                $dataexport[$i]['location'] = $data['location'];
                $dataexport[$i]['department'] = $data['department'];
                $dataexport[$i]['attended_doctor'] = $data['attended_doctor'];
                $dataexport[$i]['initial_assessment_hr6'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr6']));
                $dataexport[$i]['discharge_date_time'] = date('Y-m-d H:i', strtotime($data['discharge_date_time']));

                $dataexport[$i]['identification_details'] = ucfirst($data['identification_details']) . "\r\nRemarks: " . $data['identification_details_text'];
                $dataexport[$i]['vital_signs'] = ucfirst($data['vital_signs']) . "\r\nRemarks: " . $data['vital_signs_text'];
                $dataexport[$i]['surgery'] = ucfirst($data['surgery']) . "\r\nRemarks: " . $data['surgery_remarks'];

                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];


                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- Allogenic Bone Marrow Transplantation - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function overall_clinical_aortic_value_replacement()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_ma_clinicaloutcome_aortic_value_replacement';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->audit_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Audit Name';
            $header[1] = 'Date & Time of Audit';
            $header[2] = 'Audit by';
            $header[3] = 'Patient MID';
            $header[4] = 'Patient Name';
            $header[5] = 'Patient Age';
            $header[6] = 'Patient Gender';

            $j = 7;

            $header[$j++] = 'Area';
            $header[$j++] = 'Department';
            $header[$j++] = 'Attended Doctor';
            $header[$j++] = 'Admission Date & Time';
            $header[$j++] = 'Discharge Date & Time';

            $header[$j++] = 'How many days after admission did the patient get discharged?';
            $header[$j++] = 'Did this patient have any post operative infection?';
            $header[$j++] = 'Did this patient require pacemaker implantation following AVR?';
            $header[$j++] = 'Did this patient get readmitted anytime for a related condition within 30 days?';


            $header[$j++] = 'Additional comments';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['audit_type'] = $data['audit_type'];
                $dataexport[$i]['date'] = date('Y-m-d H:i', strtotime($row->datetime));
                $dataexport[$i]['audit_by'] = $data['audit_by'];

                $dataexport[$i]['mid_no'] = $data['mid_no'];
                $dataexport[$i]['patient_name'] = $data['patient_name'];
                $dataexport[$i]['patient_age'] = $data['patient_age'];
                $dataexport[$i]['patient_gender'] = $data['patient_gender'];
                $dataexport[$i]['location'] = $data['location'];
                $dataexport[$i]['department'] = $data['department'];
                $dataexport[$i]['attended_doctor'] = $data['attended_doctor'];
                $dataexport[$i]['initial_assessment_hr6'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr6']));
                $dataexport[$i]['discharge_date_time'] = date('Y-m-d H:i', strtotime($data['discharge_date_time']));

                $dataexport[$i]['identification_details'] = ucfirst($data['identification_details']);

                $dataexport[$i]['vital_signs'] = ucfirst($data['vital_signs']) . "\r\nRemarks: " . $data['vital_signs_text'];
                $dataexport[$i]['surgery'] = ucfirst($data['surgery']) . "\r\nRemarks: " . $data['surgery_text'];
                $dataexport[$i]['complaints_communicated'] = ucfirst($data['complaints_communicated']) . "\r\nRemarks: " . $data['complaints_communicated_remarks'];


                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];


                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- Aortic Valve Replacement (AVR) - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function overall_clinical_autologous_bone()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_ma_clinicaloutcome_autologous_bone';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->audit_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Audit Name';
            $header[1] = 'Date & Time of Audit';
            $header[2] = 'Audit by';
            $header[3] = 'Patient MID';
            $header[4] = 'Patient Name';
            $header[5] = 'Patient Age';
            $header[6] = 'Patient Gender';

            $j = 7;

            $header[$j++] = 'Area';
            $header[$j++] = 'Department';
            $header[$j++] = 'Attended Doctor';
            $header[$j++] = 'Admission Date & Time';
            $header[$j++] = 'Discharge Date & Time';

            $header[$j++] = 'Did the patient undergo engraftment post-transplant?';
            $header[$j++] = 'Was there mortality after 30 days of bone marrow transplant?';
            $header[$j++] = 'Was there mortality after 100 days of bone marrow transplant?';


            $header[$j++] = 'Additional comments';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['audit_type'] = $data['audit_type'];
                $dataexport[$i]['date'] = date('Y-m-d H:i', strtotime($row->datetime));
                $dataexport[$i]['audit_by'] = $data['audit_by'];

                $dataexport[$i]['mid_no'] = $data['mid_no'];
                $dataexport[$i]['patient_name'] = $data['patient_name'];
                $dataexport[$i]['patient_age'] = $data['patient_age'];
                $dataexport[$i]['patient_gender'] = $data['patient_gender'];
                $dataexport[$i]['location'] = $data['location'];
                $dataexport[$i]['department'] = $data['department'];
                $dataexport[$i]['attended_doctor'] = $data['attended_doctor'];
                $dataexport[$i]['initial_assessment_hr6'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr6']));
                $dataexport[$i]['discharge_date_time'] = date('Y-m-d H:i', strtotime($data['discharge_date_time']));

                $dataexport[$i]['identification_details'] = ucfirst($data['identification_details']) . "\r\nRemarks: " . $data['identification_details_text'];
                $dataexport[$i]['vital_signs'] = ucfirst($data['vital_signs']) . "\r\nRemarks: " . $data['vital_signs_text'];
                $dataexport[$i]['surgery'] = ucfirst($data['surgery']) . "\r\nRemarks: " . $data['surgery_remarks'];

                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];


                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- Autologous Bone Marrow Transplantation - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function overall_clinical_brain_tumour()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_ma_clinicaloutcome_brain_tumour';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->audit_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Audit Name';
            $header[1] = 'Date & Time of Audit';
            $header[2] = 'Audit by';
            $header[3] = 'Patient MID';
            $header[4] = 'Patient Name';
            $header[5] = 'Patient Age';
            $header[6] = 'Patient Gender';

            $j = 7;

            $header[$j++] = 'Area';
            $header[$j++] = 'Department';
            $header[$j++] = 'Attended Doctor';
            $header[$j++] = 'Admission Date & Time';
            $header[$j++] = 'Discharge Date & Time';

            $header[$j++] = 'Did this patient have any post operative infection?';
            $header[$j++] = 'Did this patient have any post operative complication, other than infection? If yes, please specify';
            $header[$j++] = 'Did this patient have to undergo a revision surgery?';
            $header[$j++] = 'How many days after admission did the patient get discharged?';
            $header[$j++] = 'Did this patient get readmitted anytime for a condition related to surgery?';
            $header[$j++] = 'Part B (filled 30 days after procedure) Did this patient come for a review 30 days after surgery?';
            $header[$j++] = 'Did this patient come for a review 180 days after surgery?';


            $header[$j++] = 'Additional comments';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['audit_type'] = $data['audit_type'];
                $dataexport[$i]['date'] = date('Y-m-d H:i', strtotime($row->datetime));
                $dataexport[$i]['audit_by'] = $data['audit_by'];

                $dataexport[$i]['mid_no'] = $data['mid_no'];
                $dataexport[$i]['patient_name'] = $data['patient_name'];
                $dataexport[$i]['patient_age'] = $data['patient_age'];
                $dataexport[$i]['patient_gender'] = $data['patient_gender'];
                $dataexport[$i]['location'] = $data['location'];
                $dataexport[$i]['department'] = $data['department'];
                $dataexport[$i]['attended_doctor'] = $data['attended_doctor'];
                $dataexport[$i]['initial_assessment_hr6'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr6']));
                $dataexport[$i]['discharge_date_time'] = date('Y-m-d H:i', strtotime($data['discharge_date_time']));

                $dataexport[$i]['identification_details'] = ucfirst($data['identification_details']) . "\r\nRemarks: " . $data['identification_details_text'];
                $dataexport[$i]['vital_signs'] = ucfirst($data['vital_signs']) . "\r\nRemarks: " . $data['vital_signs_text'];
                $dataexport[$i]['surgery'] = ucfirst($data['surgery']) . "\r\nRemarks: " . $data['surgery_text'];

                $dataexport[$i]['complaints_communicated'] = ucfirst($data['complaints_communicated']) . "\r\nRemarks: " . $data['complaints_communicated_text'];
                $dataexport[$i]['intake'] = ucfirst($data['intake']) . "\r\nRemarks: " . $data['intake_text'];
                $dataexport[$i]['output'] = ucfirst($data['output']) . "\r\nRemarks: " . $data['output_text'];
                $dataexport[$i]['allergies'] = ucfirst($data['allergies']) . "\r\nRemarks: " . $data['allergies_text'];


                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];


                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- Brain Tumour Surgery - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function overall_clinical_cabg()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_ma_clinicaloutcome_cabg';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->audit_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Audit Name';
            $header[1] = 'Date & Time of Audit';
            $header[2] = 'Audit by';
            $header[3] = 'Patient MID';
            $header[4] = 'Patient Name';
            $header[5] = 'Patient Age';
            $header[6] = 'Patient Gender';

            $j = 7;

            $header[$j++] = 'Area';
            $header[$j++] = 'Department';
            $header[$j++] = 'Attended Doctor';
            $header[$j++] = 'Admission Date & Time';
            $header[$j++] = 'Discharge Date & Time';

            $header[$j++] = 'Did the patient undergo open CABG?';
            $header[$j++] = 'Did this patient undergo minimally invasive surgery (CABG)?';
            $header[$j++] = 'Was the graft taken from the left internal mammary artery?';
            $header[$j++] = 'Was bail out intra-aortic balloon pump needed for the patient?';
            $header[$j++] = 'Did this patient have a perioperative myocardial infarction?';
            $header[$j++] = 'Did this patient have a perioperative stroke?';
            $header[$j++] = 'Did this patient need a surgical re exploration?';
            $header[$j++] = 'Did this patient develop a deep sternal wound infection?';
            $header[$j++] = 'Did this patient have any other post operative complication? If yes, please specify';
            $header[$j++] = 'Has the patient had a repeat admission within 30 days of discharge after CABG?';
            $header[$j++] = 'If the patient did not survive, was the mortality predicted?';
            $header[$j++] = 'How many days after admission did the patient get discharged?';
            $header[$j++] = 'Did the patient come for a review 30 days after surgery?';
            $header[$j++] = 'In case of Re- Exploration did this patient undergo CABG from our hospital during last 1 month?';



            $header[$j++] = 'Additional comments';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['audit_type'] = $data['audit_type'];
                $dataexport[$i]['date'] = date('Y-m-d H:i', strtotime($row->datetime));
                $dataexport[$i]['audit_by'] = $data['audit_by'];

                $dataexport[$i]['mid_no'] = $data['mid_no'];
                $dataexport[$i]['patient_name'] = $data['patient_name'];
                $dataexport[$i]['patient_age'] = $data['patient_age'];
                $dataexport[$i]['patient_gender'] = $data['patient_gender'];
                $dataexport[$i]['location'] = $data['location'];
                $dataexport[$i]['department'] = $data['department'];
                $dataexport[$i]['attended_doctor'] = $data['attended_doctor'];
                $dataexport[$i]['initial_assessment_hr6'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr6']));
                $dataexport[$i]['discharge_date_time'] = date('Y-m-d H:i', strtotime($data['discharge_date_time']));

                $dataexport[$i]['identification_details'] = ucfirst($data['identification_details']);
                $dataexport[$i]['vital_signs'] = ucfirst($data['vital_signs']) . "\r\nRemarks: " . $data['vital_signs_text'];
                $dataexport[$i]['surgery'] = ucfirst($data['surgery']) . "\r\nRemarks: " . $data['surgery_text'];

                $dataexport[$i]['complaints_communicated'] = ucfirst($data['complaints_communicated']) . "\r\nRemarks: " . $data['complaints_communicated_remarks'];
                $dataexport[$i]['intake'] = ucfirst($data['intake']) . "\r\nRemarks: " . $data['intake_remarks'];
                $dataexport[$i]['output'] = ucfirst($data['output']) . "\r\nRemarks: " . $data['output_remarks'];
                $dataexport[$i]['allergies'] = ucfirst($data['allergies']) . "\r\nRemarks: " . $data['allergies_remarks'];
                $dataexport[$i]['medication'] = ucfirst($data['medication']) . "\r\nRemarks: " . $data['medication_remarks'];
                $dataexport[$i]['diagnostic'] = ucfirst($data['diagnostic']) . "\r\nRemarks: " . $data['diagnostic_remarks'];
                $dataexport[$i]['lab_results'] = ucfirst($data['lab_results']) . "\r\nRemarks: " . $data['lab_results_remarks'];
                $dataexport[$i]['pending_investigation'] = ucfirst($data['pending_investigation']) . "\r\nRemarks: " . $data['pending_investigation_remarks'];
                $dataexport[$i]['medicine_order'] = ucfirst($data['medicine_order']) . "\r\nRemarks: " . $data['medicine_order_remarks'];
                $dataexport[$i]['facility_communicated'] = ucfirst($data['facility_communicated']) . "\r\nRemarks: " . $data['facility_communicated_remarks'];
                $dataexport[$i]['health_education'] = ucfirst($data['health_education']) . "\r\nRemarks: " . $data['health_education_remarks'];


                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];


                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- CABG - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function overall_clinical_carotid_stenting()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_ma_clinicaloutcome_carotid_stenting';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->audit_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Audit Name';
            $header[1] = 'Date & Time of Audit';
            $header[2] = 'Audit by';
            $header[3] = 'Patient MID';
            $header[4] = 'Patient Name';
            $header[5] = 'Patient Age';
            $header[6] = 'Patient Gender';

            $j = 7;

            $header[$j++] = 'Area';
            $header[$j++] = 'Department';
            $header[$j++] = 'Attended Doctor';
            $header[$j++] = 'Admission Date & Time';
            $header[$j++] = 'Discharge Date & Time';

            $header[$j++] = 'Did the patient have hyperperfusion after stenting?';
            $header[$j++] = 'Was there a stroke in the patient after stenting?';
            $header[$j++] = 'Was there IC bleed in the patient after stenting?';
            $header[$j++] = 'How many days after admission did the patient get discharged?';
            $header[$j++] = 'Did this patient come for a review 30 days after Stenting?';
            $header[$j++] = 'Did the patient have a repeat admission within 30 days after initial discharge?';


            $header[$j++] = 'Additional comments';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['audit_type'] = $data['audit_type'];
                $dataexport[$i]['date'] = date('Y-m-d H:i', strtotime($row->datetime));
                $dataexport[$i]['audit_by'] = $data['audit_by'];

                $dataexport[$i]['mid_no'] = $data['mid_no'];
                $dataexport[$i]['patient_name'] = $data['patient_name'];
                $dataexport[$i]['patient_age'] = $data['patient_age'];
                $dataexport[$i]['patient_gender'] = $data['patient_gender'];
                $dataexport[$i]['location'] = $data['location'];
                $dataexport[$i]['department'] = $data['department'];
                $dataexport[$i]['attended_doctor'] = $data['attended_doctor'];
                $dataexport[$i]['initial_assessment_hr6'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr6']));
                $dataexport[$i]['discharge_date_time'] = date('Y-m-d H:i', strtotime($data['discharge_date_time']));


                $dataexport[$i]['identification_details'] = ucfirst($data['identification_details']) . "\r\nRemarks: " . $data['identification_details_remarks'];
                $dataexport[$i]['vital_signs'] = ucfirst($data['vital_signs']) . "\r\nRemarks: " . $data['vital_signs_text'];
                $dataexport[$i]['surgery'] = ucfirst($data['surgery']) . "\r\nRemarks: " . $data['surgery_text'];

                $dataexport[$i]['complaints_communicated'] = ucfirst($data['complaints_communicated']);
                $dataexport[$i]['intake'] = ucfirst($data['intake']) . "\r\nRemarks: " . $data['intake_remarks'];
                $dataexport[$i]['output'] = ucfirst($data['output']) . "\r\nRemarks: " . $data['output_remarks'];

                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];


                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- Carotid Stenting - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function overall_clinical_chemotherapy()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_ma_clinicaloutcome_chemotherapy';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->audit_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Audit Name';
            $header[1] = 'Date & Time of Audit';
            $header[2] = 'Audit by';
            $header[3] = 'Patient MID';
            $header[4] = 'Patient Name';
            $header[5] = 'Patient Age';
            $header[6] = 'Patient Gender';

            $j = 7;

            $header[$j++] = 'Area';
            $header[$j++] = 'Department';
            $header[$j++] = 'Attended Doctor';
            $header[$j++] = 'Admission Date & Time';
            $header[$j++] = 'Discharge Date & Time';

            $header[$j++] = 'Did this patient have any chemotherapy related complications?';
            $header[$j++] = 'Did the patient require a re admission any time for chemotherapy related indication?';
            $header[$j++] = 'Did this patient came for review on the proposed follow up date?';

            $header[$j++] = 'Additional comments';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['audit_type'] = $data['audit_type'];
                $dataexport[$i]['date'] = date('Y-m-d H:i', strtotime($row->datetime));
                $dataexport[$i]['audit_by'] = $data['audit_by'];

                $dataexport[$i]['mid_no'] = $data['mid_no'];
                $dataexport[$i]['patient_name'] = $data['patient_name'];
                $dataexport[$i]['patient_age'] = $data['patient_age'];
                $dataexport[$i]['patient_gender'] = $data['patient_gender'];
                $dataexport[$i]['location'] = $data['location'];
                $dataexport[$i]['department'] = $data['department'];
                $dataexport[$i]['attended_doctor'] = $data['attended_doctor'];
                $dataexport[$i]['initial_assessment_hr6'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr6']));
                $dataexport[$i]['discharge_date_time'] = date('Y-m-d H:i', strtotime($data['discharge_date_time']));


                $dataexport[$i]['identification_details'] = ucfirst($data['identification_details']) . "\r\nRemarks: " . $data['identification_details_text'];
                $dataexport[$i]['vital_signs'] = ucfirst($data['vital_signs']) . "\r\nRemarks: " . $data['vital_signs_text'];
                $dataexport[$i]['surgery'] = ucfirst($data['surgery']) . "\r\nRemarks: " . $data['surgery_remarks'];

                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];


                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- Chemotherapy (Medical Oncology) - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function overall_clinical_colo_rectal()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_ma_clinicaloutcome_colo_rectal';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->audit_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Audit Name';
            $header[1] = 'Date & Time of Audit';
            $header[2] = 'Audit by';
            $header[3] = 'Patient MID';
            $header[4] = 'Patient Name';
            $header[5] = 'Patient Age';
            $header[6] = 'Patient Gender';

            $j = 7;

            $header[$j++] = 'Area';
            $header[$j++] = 'Department';
            $header[$j++] = 'Attended Doctor';
            $header[$j++] = 'Admission Date & Time';
            $header[$j++] = 'Discharge Date & Time';

            $header[$j++] = 'How many days after admission did the patient get discharged?';
            $header[$j++] = 'Did the patient develop a Anastomotic leak after surgery?';
            $header[$j++] = 'Did this patient develop chest pneumonia post-operatively?';
            $header[$j++] = 'Did this patient have any post operative infection?';
            $header[$j++] = 'Did this patient get readmitted anytime for a condition related to surgery within 30 days?';


            $header[$j++] = 'Additional comments';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['audit_type'] = $data['audit_type'];
                $dataexport[$i]['date'] = date('Y-m-d H:i', strtotime($row->datetime));
                $dataexport[$i]['audit_by'] = $data['audit_by'];

                $dataexport[$i]['mid_no'] = $data['mid_no'];
                $dataexport[$i]['patient_name'] = $data['patient_name'];
                $dataexport[$i]['patient_age'] = $data['patient_age'];
                $dataexport[$i]['patient_gender'] = $data['patient_gender'];
                $dataexport[$i]['location'] = $data['location'];
                $dataexport[$i]['department'] = $data['department'];
                $dataexport[$i]['attended_doctor'] = $data['attended_doctor'];
                $dataexport[$i]['initial_assessment_hr6'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr6']));
                $dataexport[$i]['discharge_date_time'] = date('Y-m-d H:i', strtotime($data['discharge_date_time']));


                $dataexport[$i]['identification_details'] = ucfirst($data['identification_details']);
                $dataexport[$i]['vital_signs'] = ucfirst($data['vital_signs']) . "\r\nRemarks: " . $data['vital_signs_text'];
                $dataexport[$i]['surgery'] = ucfirst($data['surgery']) . "\r\nRemarks: " . $data['surgery_text'];
                $dataexport[$i]['complaints_communicated'] = ucfirst($data['complaints_communicated']) . "\r\nRemarks: " . $data['complaints_communicated_remarks'];
                $dataexport[$i]['intake'] = ucfirst($data['intake']) . "\r\nRemarks: " . $data['intake_remarks'];

                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];


                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- Colo-Rectal Surgeries - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function overall_clinical_endoscopy()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_ma_clinicaloutcome_endoscopy';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->audit_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Audit Name';
            $header[1] = 'Date & Time of Audit';
            $header[2] = 'Audit by';
            $header[3] = 'Patient MID';
            $header[4] = 'Patient Name';
            $header[5] = 'Patient Age';
            $header[6] = 'Patient Gender';

            $j = 7;

            $header[$j++] = 'Area';
            $header[$j++] = 'Department';
            $header[$j++] = 'Attended Doctor';
            $header[$j++] = 'Admission Date & Time';
            $header[$j++] = 'Discharge Date & Time';

            $header[$j++] = 'Did this patient have any procedure related complication?';

            $header[$j++] = 'Additional comments';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['audit_type'] = $data['audit_type'];
                $dataexport[$i]['date'] = date('Y-m-d H:i', strtotime($row->datetime));
                $dataexport[$i]['audit_by'] = $data['audit_by'];

                $dataexport[$i]['mid_no'] = $data['mid_no'];
                $dataexport[$i]['patient_name'] = $data['patient_name'];
                $dataexport[$i]['patient_age'] = $data['patient_age'];
                $dataexport[$i]['patient_gender'] = $data['patient_gender'];
                $dataexport[$i]['location'] = $data['location'];
                $dataexport[$i]['department'] = $data['department'];
                $dataexport[$i]['attended_doctor'] = $data['attended_doctor'];
                $dataexport[$i]['initial_assessment_hr6'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr6']));
                $dataexport[$i]['discharge_date_time'] = date('Y-m-d H:i', strtotime($data['discharge_date_time']));


                $dataexport[$i]['identification_details'] = ucfirst($data['identification_details']) . "\r\nRemarks: " . $data['identification_details_text'];

                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];


                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- Endoscopy - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function overall_clinical_epilepsy()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_ma_clinicaloutcome_epilepsy';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->audit_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Audit Name';
            $header[1] = 'Date & Time of Audit';
            $header[2] = 'Audit by';
            $header[3] = 'Patient MID';
            $header[4] = 'Patient Name';
            $header[5] = 'Patient Age';
            $header[6] = 'Patient Gender';

            $j = 7;

            $header[$j++] = 'Area';
            $header[$j++] = 'Department';
            $header[$j++] = 'Attended Doctor';
            $header[$j++] = 'Admission Date & Time';
            $header[$j++] = 'Discharge Date & Time';

            $header[$j++] = 'Did this patient have generalized seizure?';
            $header[$j++] = 'Did this patient have focal seizure?';
            $header[$j++] = 'What was the frequency of seizures- before surgery?';
            $header[$j++] = 'Did this patient have any post operative infection?';
            $header[$j++] = 'Did this patient have any post operative complications?';
            $header[$j++] = 'What was the frequency of seizures – after 3 months of surgery (Class I – Seizure free, Class II – Rare Seizures, Class III – Worthwhile improvement, Class IV – No worthwhile improvement)';
            $header[$j++] = 'How many days after surgery did this patient get discharged?';
            $header[$j++] = 'Did this patient get re admitted within 30 days after surgery?';
            $header[$j++] = 'Did this patient come for a review 30 days after surgery?';


            $header[$j++] = 'Additional comments';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['audit_type'] = $data['audit_type'];
                $dataexport[$i]['date'] = date('Y-m-d H:i', strtotime($row->datetime));
                $dataexport[$i]['audit_by'] = $data['audit_by'];

                $dataexport[$i]['mid_no'] = $data['mid_no'];
                $dataexport[$i]['patient_name'] = $data['patient_name'];
                $dataexport[$i]['patient_age'] = $data['patient_age'];
                $dataexport[$i]['patient_gender'] = $data['patient_gender'];
                $dataexport[$i]['location'] = $data['location'];
                $dataexport[$i]['department'] = $data['department'];
                $dataexport[$i]['attended_doctor'] = $data['attended_doctor'];
                $dataexport[$i]['initial_assessment_hr6'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr6']));
                $dataexport[$i]['discharge_date_time'] = date('Y-m-d H:i', strtotime($data['discharge_date_time']));


                $dataexport[$i]['identification_details'] = ucfirst($data['identification_details']) . "\r\nRemarks: " . $data['identification_details_text'];
                $dataexport[$i]['vital_signs'] = ucfirst($data['vital_signs']) . "\r\nRemarks: " . $data['vital_signs_text'];
                $dataexport[$i]['surgery'] = ucfirst($data['surgery']);

                $dataexport[$i]['complaints_communicated'] = ucfirst($data['complaints_communicated']) . "\r\nRemarks: " . $data['complaints_communicated_remarks'];

                $dataexport[$i]['intake'] = ucfirst($data['intake']) . "\r\nRemarks: " . $data['intake_remarks'];
                $dataexport[$i]['output'] = ucfirst($data['output']);

                $dataexport[$i]['medication'] = ucfirst($data['medication']) . "\r\nRemarks: " . $data['medication_remarks'];
                $dataexport[$i]['diagnostic'] = ucfirst($data['diagnostic']) . "\r\nRemarks: " . $data['diagnostic_remarks'];


                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];


                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- Epilepsy - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function overall_clinical_herniorrhaphy()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_ma_clinicaloutcome_herniorrhaphy';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->audit_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Audit Name';
            $header[1] = 'Date & Time of Audit';
            $header[2] = 'Audit by';
            $header[3] = 'Patient MID';
            $header[4] = 'Patient Name';
            $header[5] = 'Patient Age';
            $header[6] = 'Patient Gender';

            $j = 7;

            $header[$j++] = 'Area';
            $header[$j++] = 'Department';
            $header[$j++] = 'Attended Doctor';
            $header[$j++] = 'Admission Date & Time';
            $header[$j++] = 'Discharge Date & Time';

            $header[$j++] = 'How many days after admission did the patient get discharged?';
            $header[$j++] = 'Did the patient visit the ED any time during the first 30 days following surgery? If yes how many times';
            $header[$j++] = 'Did this patient require any revision surgery during the first 30 days following surgery?';
            $header[$j++] = 'Did this patient get readmitted anytime for a condition related to surgery within 30 days?';
            $header[$j++] = 'Did this patient come for a review 30 days after surgery?';
            $header[$j++] = 'Did this patient have any post procedure complications?';


            $header[$j++] = 'Additional comments';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['audit_type'] = $data['audit_type'];
                $dataexport[$i]['date'] = date('Y-m-d H:i', strtotime($row->datetime));
                $dataexport[$i]['audit_by'] = $data['audit_by'];

                $dataexport[$i]['mid_no'] = $data['mid_no'];
                $dataexport[$i]['patient_name'] = $data['patient_name'];
                $dataexport[$i]['patient_age'] = $data['patient_age'];
                $dataexport[$i]['patient_gender'] = $data['patient_gender'];
                $dataexport[$i]['location'] = $data['location'];
                $dataexport[$i]['department'] = $data['department'];
                $dataexport[$i]['attended_doctor'] = $data['attended_doctor'];
                $dataexport[$i]['initial_assessment_hr6'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr6']));
                $dataexport[$i]['discharge_date_time'] = date('Y-m-d H:i', strtotime($data['discharge_date_time']));


                $dataexport[$i]['identification_details'] = ucfirst($data['identification_details']) . "\r\nRemarks: " . $data['identification_details_text'];
                $dataexport[$i]['vital_signs'] = ucfirst($data['vital_signs']) . "\r\nRemarks: " . $data['vital_signs_text'];
                $dataexport[$i]['surgery'] = ucfirst($data['surgery']) . "\r\nRemarks: " . $data['surgery_text'];

                $dataexport[$i]['complaints_communicated'] = ucfirst($data['complaints_communicated']) . "\r\nRemarks: " . $data['complaints_communicated_text'];

                $dataexport[$i]['intake'] = ucfirst($data['intake']) . "\r\nRemarks: " . $data['intake_text'];
                $dataexport[$i]['output'] = ucfirst($data['output']) . "\r\nRemarks: " . $data['output_text'];

                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];


                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- Herniorrhaphy - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function overall_clinical_holep()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_ma_clinicaloutcome_holep';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->audit_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Audit Name';
            $header[1] = 'Date & Time of Audit';
            $header[2] = 'Audit by';
            $header[3] = 'Patient MID';
            $header[4] = 'Patient Name';
            $header[5] = 'Patient Age';
            $header[6] = 'Patient Gender';

            $j = 7;

            $header[$j++] = 'Area';
            $header[$j++] = 'Department';
            $header[$j++] = 'Attended Doctor';
            $header[$j++] = 'Admission Date & Time';
            $header[$j++] = 'Discharge Date & Time';

            $header[$j++] = 'How many days after admission did the patient get discharged?';
            $header[$j++] = 'Did this patient require any revision surgery during admission?';
            $header[$j++] = 'For how many days after surgery was this patient kept NPO/ on NGT?';
            $header[$j++] = 'Did this patient have any post operative complications?';
            $header[$j++] = 'Did this patient come for a review 30 days after surgery?';
            $header[$j++] = 'Did this patient get readmitted anytime for a condition related to surgery within 30 days?';


            $header[$j++] = 'Additional comments';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['audit_type'] = $data['audit_type'];
                $dataexport[$i]['date'] = date('Y-m-d H:i', strtotime($row->datetime));
                $dataexport[$i]['audit_by'] = $data['audit_by'];

                $dataexport[$i]['mid_no'] = $data['mid_no'];
                $dataexport[$i]['patient_name'] = $data['patient_name'];
                $dataexport[$i]['patient_age'] = $data['patient_age'];
                $dataexport[$i]['patient_gender'] = $data['patient_gender'];
                $dataexport[$i]['location'] = $data['location'];
                $dataexport[$i]['department'] = $data['department'];
                $dataexport[$i]['attended_doctor'] = $data['attended_doctor'];
                $dataexport[$i]['initial_assessment_hr6'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr6']));
                $dataexport[$i]['discharge_date_time'] = date('Y-m-d H:i', strtotime($data['discharge_date_time']));


                $dataexport[$i]['identification_details'] = ucfirst($data['identification_details']);
                $dataexport[$i]['vital_signs'] = ucfirst($data['vital_signs']) . "\r\nRemarks: " . $data['vital_signs_text'];
                $dataexport[$i]['surgery'] = ucfirst($data['surgery']) . "\r\nRemarks: " . $data['surgery_text'];

                $dataexport[$i]['complaints_communicated'] = ucfirst($data['complaints_communicated']) . "\r\nRemarks: " . $data['complaints_communicated_remarks'];

                $dataexport[$i]['intake'] = ucfirst($data['intake']) . "\r\nRemarks: " . $data['intake_text'];
                $dataexport[$i]['output'] = ucfirst($data['output']) . "\r\nRemarks: " . $data['output_remarks'];

                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];


                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- HoLEP - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function overall_clinical_laparoscopic()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_ma_clinicaloutcome_laparoscopic_appendicectomy';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->audit_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Audit Name';
            $header[1] = 'Date & Time of Audit';
            $header[2] = 'Audit by';
            $header[3] = 'Patient MID';
            $header[4] = 'Patient Name';
            $header[5] = 'Patient Age';
            $header[6] = 'Patient Gender';

            $j = 7;

            $header[$j++] = 'Area';
            $header[$j++] = 'Department';
            $header[$j++] = 'Attended Doctor';
            $header[$j++] = 'Admission Date & Time';
            $header[$j++] = 'Discharge Date & Time';

            $header[$j++] = 'Was it an emergency appendicectomy?';
            $header[$j++] = 'Did the surgery get converted to open surgery?';
            $header[$j++] = 'Did this patient have any bowel injury?';
            $header[$j++] = 'Did this patient have any post operative complication other than bowel injury?';
            $header[$j++] = 'How many days after admission did the patient get discharged?';
            $header[$j++] = 'Did this patient come for a review 30 days after surgery?';
            $header[$j++] = 'Did this patient develop an intra-abdominal abscess during the first 30 days after surgery?';
            $header[$j++] = 'Did this patient get readmitted anytime for a condition related to surgery within 30 days?';
            $header[$j++] = 'Did this patient require any procedural re intervention after surgery?';



            $header[$j++] = 'Additional comments';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['audit_type'] = $data['audit_type'];
                $dataexport[$i]['date'] = date('Y-m-d H:i', strtotime($row->datetime));
                $dataexport[$i]['audit_by'] = $data['audit_by'];

                $dataexport[$i]['mid_no'] = $data['mid_no'];
                $dataexport[$i]['patient_name'] = $data['patient_name'];
                $dataexport[$i]['patient_age'] = $data['patient_age'];
                $dataexport[$i]['patient_gender'] = $data['patient_gender'];
                $dataexport[$i]['location'] = $data['location'];
                $dataexport[$i]['department'] = $data['department'];
                $dataexport[$i]['attended_doctor'] = $data['attended_doctor'];
                $dataexport[$i]['initial_assessment_hr6'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr6']));
                $dataexport[$i]['discharge_date_time'] = date('Y-m-d H:i', strtotime($data['discharge_date_time']));


                $dataexport[$i]['identification_details'] = ucfirst($data['identification_details']) . "\r\nRemarks: " . $data['identification_details_remarks'];
                $dataexport[$i]['vital_signs'] = ucfirst($data['vital_signs']) . "\r\nRemarks: " . $data['vital_signs_text'];


                $dataexport[$i]['surgery'] = ucfirst($data['surgery']) . "\r\nRemarks: " . $data['surgery_text'];
                $dataexport[$i]['complaints_communicated'] = ucfirst($data['complaints_communicated']) . "\r\nRemarks: " . $data['complaints_communicated_remarks'];
                $dataexport[$i]['intake'] = ucfirst($data['intake']); // no remarks field given
                $dataexport[$i]['output'] = ucfirst($data['output']) . "\r\nRemarks: " . $data['output_remarks'];
                $dataexport[$i]['allergies'] = ucfirst($data['allergies']) . "\r\nRemarks: " . $data['allergies_remarks'];
                $dataexport[$i]['medication'] = ucfirst($data['medication']) . "\r\nRemarks: " . $data['medication_remarks'];
                $dataexport[$i]['diagnostic'] = ucfirst($data['diagnostic']) . "\r\nRemarks: " . $data['diagnostic_remarks'];


                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];


                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- Laparoscopic Appendicectomy - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function overall_clinical_mechanical_thrombectomy()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_ma_clinicaloutcome_mechanical_thrombectomy';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->audit_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Audit Name';
            $header[1] = 'Date & Time of Audit';
            $header[2] = 'Audit by';
            $header[3] = 'Patient MID';
            $header[4] = 'Patient Name';
            $header[5] = 'Patient Age';
            $header[6] = 'Patient Gender';

            $j = 7;

            $header[$j++] = 'Area';
            $header[$j++] = 'Department';
            $header[$j++] = 'Attended Doctor';
            $header[$j++] = 'Admission Date & Time';
            $header[$j++] = 'Discharge Date & Time';

            $header[$j++] = 'Did the patient experience Wire perforation after MT?';
            $header[$j++] = 'Did the patient had an embolization in a new or distal territory during the MT?';
            $header[$j++] = 'Was the Arterial dissection detected after thrombectomy?';
            $header[$j++] = 'How many days after admission did the patient get discharged?';
            $header[$j++] = 'Did this patient come for a review 30 days after MT ?';
            $header[$j++] = 'Did the patient have a repeat admission within 30 days after MT?';


            $header[$j++] = 'Additional comments';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['audit_type'] = $data['audit_type'];
                $dataexport[$i]['date'] = date('Y-m-d H:i', strtotime($row->datetime));
                $dataexport[$i]['audit_by'] = $data['audit_by'];

                $dataexport[$i]['mid_no'] = $data['mid_no'];
                $dataexport[$i]['patient_name'] = $data['patient_name'];
                $dataexport[$i]['patient_age'] = $data['patient_age'];
                $dataexport[$i]['patient_gender'] = $data['patient_gender'];
                $dataexport[$i]['location'] = $data['location'];
                $dataexport[$i]['department'] = $data['department'];
                $dataexport[$i]['attended_doctor'] = $data['attended_doctor'];
                $dataexport[$i]['initial_assessment_hr6'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr6']));
                $dataexport[$i]['discharge_date_time'] = date('Y-m-d H:i', strtotime($data['discharge_date_time']));


                $dataexport[$i]['identification_details'] = ucfirst($data['identification_details']) . "\r\nRemarks: " . $data['identification_details_remarks'];
                $dataexport[$i]['vital_signs'] = ucfirst($data['vital_signs']) . "\r\nRemarks: " . $data['vital_signs_text'];

                $dataexport[$i]['surgery'] = ucfirst($data['surgery']) . "\r\nRemarks: " . $data['surgery_text'];
                $dataexport[$i]['complaints_communicated'] = ucfirst($data['complaints_communicated']) . "\r\nRemarks: " . $data['complaints_communicated_remarks'];
                $dataexport[$i]['intake'] = ucfirst($data['intake']) . "\r\nRemarks: " . $data['intake_remarks'];
                $dataexport[$i]['output'] = ucfirst($data['output']) . "\r\nRemarks: " . $data['output_remarks'];

                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];


                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- Mechanical Thrombectomy - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function overall_clinical_mvr()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_ma_clinicaloutcome_mvr';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->audit_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Audit Name';
            $header[1] = 'Date & Time of Audit';
            $header[2] = 'Audit by';
            $header[3] = 'Patient MID';
            $header[4] = 'Patient Name';
            $header[5] = 'Patient Age';
            $header[6] = 'Patient Gender';

            $j = 7;

            $header[$j++] = 'Area';
            $header[$j++] = 'Department';
            $header[$j++] = 'Attended Doctor';
            $header[$j++] = 'Admission Date & Time';
            $header[$j++] = 'Discharge Date & Time';

            $header[$j++] = 'Did this patient have any post operative complications?';
            $header[$j++] = 'How many days after admission did the patient get discharged?';
            $header[$j++] = 'Did this patient get re admitted within 30 days after surgery?';
            $header[$j++] = 'Did this patient come for a review 30 days after surgery?';

            $header[$j++] = 'Additional comments';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['audit_type'] = $data['audit_type'];
                $dataexport[$i]['date'] = date('Y-m-d H:i', strtotime($row->datetime));
                $dataexport[$i]['audit_by'] = $data['audit_by'];

                $dataexport[$i]['mid_no'] = $data['mid_no'];
                $dataexport[$i]['patient_name'] = $data['patient_name'];
                $dataexport[$i]['patient_age'] = $data['patient_age'];
                $dataexport[$i]['patient_gender'] = $data['patient_gender'];
                $dataexport[$i]['location'] = $data['location'];
                $dataexport[$i]['department'] = $data['department'];
                $dataexport[$i]['attended_doctor'] = $data['attended_doctor'];
                $dataexport[$i]['initial_assessment_hr6'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr6']));
                $dataexport[$i]['discharge_date_time'] = date('Y-m-d H:i', strtotime($data['discharge_date_time']));


                $dataexport[$i]['identification_details'] = ucfirst($data['identification_details']) . "\r\nRemarks: " . $data['identification_details_text'];
                $dataexport[$i]['vital_signs'] = ucfirst($data['vital_signs']) . "\r\nRemarks: " . $data['vital_signs_text'];


                $dataexport[$i]['surgery'] = ucfirst($data['surgery']) . "\r\nRemarks: " . $data['surgery_remarks'];
                $dataexport[$i]['complaints_communicated'] = ucfirst($data['complaints_communicated']) . "\r\nRemarks: " . $data['complaints_communicated_remarks'];


                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];


                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- MVR (Mitral Valve Replacement) - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function overall_clinical_ptca()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_ma_clinicaloutcome_ptca';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->audit_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Audit Name';
            $header[1] = 'Date & Time of Audit';
            $header[2] = 'Audit by';
            $header[3] = 'Patient MID';
            $header[4] = 'Patient Name';
            $header[5] = 'Patient Age';
            $header[6] = 'Patient Gender';

            $j = 7;

            $header[$j++] = 'Area';
            $header[$j++] = 'Department';
            $header[$j++] = 'Attended Doctor';
            $header[$j++] = 'Admission Date & Time';
            $header[$j++] = 'Discharge Date & Time';

            $header[$j++] = 'Where appropriate medications (Aspirin, Statins, Thienopyridines) administered prior to PTCA?';
            $header[$j++] = 'Was the door to balloon time in this patient </= 90 minutes?';
            $header[$j++] = 'Was the radial access used for PTCA in this patient?';
            $header[$j++] = 'Did this patient have an ISR (Instant Restenosis) requiring re intervention during admission?';
            $header[$j++] = 'Did this patient have a vascular complication beyond the requirement of single compression at the puncture site?';
            $header[$j++] = 'Did this patient have any bleeding event requiring transfusion/ intervention within 72 hours?';
            $header[$j++] = 'Did this patient develop stroke after PTCA?';
            $header[$j++] = 'Did this patient have to undergo an emergency CABG following a failed PTCA?';
            $header[$j++] = 'Did this patient have post procedure renal failure requiring haemodialysis?';
            $header[$j++] = 'Did this patient have any delayed complication at the puncture site?';
            $header[$j++] = 'Did this patient have any other procedure related complication?';
            $header[$j++] = 'Did this patient get discharged on the same day after PTCA';
            $header[$j++] = 'How many days after admission did the patient get discharged?';
            $header[$j++] = 'Was the patient\'s diagnosis STEMI?';
            $header[$j++] = 'Did the patient survive?';
            $header[$j++] = 'Did this patient come for a review after 30 days of PTCA?';
            $header[$j++] = 'Did the patient have an MI within 30 days after the PTCA?';
            $header[$j++] = 'Did the patient have a repeat admission within 30 days of the PTCA?';


            $header[$j++] = 'Additional comments';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['audit_type'] = $data['audit_type'];
                $dataexport[$i]['date'] = date('Y-m-d H:i', strtotime($row->datetime));
                $dataexport[$i]['audit_by'] = $data['audit_by'];

                $dataexport[$i]['mid_no'] = $data['mid_no'];
                $dataexport[$i]['patient_name'] = $data['patient_name'];
                $dataexport[$i]['patient_age'] = $data['patient_age'];
                $dataexport[$i]['patient_gender'] = $data['patient_gender'];
                $dataexport[$i]['location'] = $data['location'];
                $dataexport[$i]['department'] = $data['department'];
                $dataexport[$i]['attended_doctor'] = $data['attended_doctor'];
                $dataexport[$i]['initial_assessment_hr6'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr6']));
                $dataexport[$i]['discharge_date_time'] = date('Y-m-d H:i', strtotime($data['discharge_date_time']));


                $dataexport[$i]['identification_details'] = ucfirst($data['identification_details']) . "\r\nRemarks: " . $data['identification_details_remarks'];
                $dataexport[$i]['vital_signs'] = ucfirst($data['vital_signs']);
                $dataexport[$i]['surgery'] = ucfirst($data['surgery']) . "\r\nRemarks: " . $data['surgery_text'];
                $dataexport[$i]['complaints_communicated'] = ucfirst($data['complaints_communicated']) . "\r\nRemarks: " . $data['complaints_communicated_remarks'];
                $dataexport[$i]['intake'] = ucfirst($data['intake']) . "\r\nRemarks: " . $data['intake_remarks'];
                $dataexport[$i]['output'] = ucfirst($data['output']) . "\r\nRemarks: " . $data['output_remarks'];
                $dataexport[$i]['allergies'] = ucfirst($data['allergies']) . "\r\nRemarks: " . $data['allergies_remarks'];
                $dataexport[$i]['medication'] = ucfirst($data['medication']) . "\r\nRemarks: " . $data['medication_remarks'];
                $dataexport[$i]['diagnostic'] = ucfirst($data['diagnostic']) . "\r\nRemarks: " . $data['diagnostic_remarks'];
                $dataexport[$i]['lab_results'] = ucfirst($data['lab_results']) . "\r\nRemarks: " . $data['lab_results_remarks'];
                $dataexport[$i]['pending_investigation'] = ucfirst($data['pending_investigation']) . "\r\nRemarks: " . $data['pending_investigation_remarks'];
                $dataexport[$i]['medicine_order'] = ucfirst($data['medicine_order']) . "\r\nRemarks: " . $data['medicine_order_remarks'];
                $dataexport[$i]['facility_communicated'] = ucfirst($data['facility_communicated']);
                $dataexport[$i]['health_education'] = ucfirst($data['health_education']) . "\r\nRemarks: " . $data['health_education_remarks'];
                $dataexport[$i]['risk_assessment'] = ucfirst($data['risk_assessment']) . "\r\nRemarks: " . $data['risk_assessment_remarks'];
                $dataexport[$i]['urethral'] = ucfirst($data['urethral']) . "\r\nRemarks: " . $data['urethral_remarks'];
                $dataexport[$i]['urine_sample'] = ucfirst($data['urine_sample']) . "\r\nRemarks: " . $data['urine_sample_remarks'];
                $dataexport[$i]['bystander'] = ucfirst($data['bystander']) . "\r\nRemarks: " . $data['bystander_remarks'];


                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];


                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- PTCA - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function overall_clinical_renal_transplantation()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_ma_clinicaloutcome_renal_transplantation';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->audit_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Audit Name';
            $header[1] = 'Date & Time of Audit';
            $header[2] = 'Audit by';
            $header[3] = 'Patient MID';
            $header[4] = 'Patient Name';
            $header[5] = 'Patient Age';
            $header[6] = 'Patient Gender';

            $j = 7;

            $header[$j++] = 'Area';
            $header[$j++] = 'Department';
            $header[$j++] = 'Attended Doctor';
            $header[$j++] = 'Admission Date & Time';
            $header[$j++] = 'Discharge Date & Time';

            $header[$j++] = 'Did this patient have any post transplantation complications?';
            $header[$j++] = 'Did the patient undergo a living donor kidney transplantation?';
            $header[$j++] = 'Is the graft surviving at the review after completion of the first year?';
            $header[$j++] = 'Is the graft surviving at the review after completion of the third year?';
            $header[$j++] = 'Did this patient come for a review 1 year after surgery?';
            $header[$j++] = 'Did this patient come for a review 3 year after surgery?';

            $header[$j++] = 'Additional comments';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['audit_type'] = $data['audit_type'];
                $dataexport[$i]['date'] = date('Y-m-d H:i', strtotime($row->datetime));
                $dataexport[$i]['audit_by'] = $data['audit_by'];

                $dataexport[$i]['mid_no'] = $data['mid_no'];
                $dataexport[$i]['patient_name'] = $data['patient_name'];
                $dataexport[$i]['patient_age'] = $data['patient_age'];
                $dataexport[$i]['patient_gender'] = $data['patient_gender'];
                $dataexport[$i]['location'] = $data['location'];
                $dataexport[$i]['department'] = $data['department'];
                $dataexport[$i]['attended_doctor'] = $data['attended_doctor'];
                $dataexport[$i]['initial_assessment_hr6'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr6']));
                $dataexport[$i]['discharge_date_time'] = date('Y-m-d H:i', strtotime($data['discharge_date_time']));


                $dataexport[$i]['identification_details'] = ucfirst($data['identification_details']) . "\r\nRemarks: " . $data['identification_details_text'];
                $dataexport[$i]['vital_signs'] = ucfirst($data['vital_signs']) . "\r\nRemarks: " . $data['vital_signs_text'];
                $dataexport[$i]['surgery'] = ucfirst($data['surgery']) . "\r\nRemarks: " . $data['surgery_text'];
                $dataexport[$i]['complaints_communicated'] = ucfirst($data['complaints_communicated']) . "\r\nRemarks: " . $data['complaints_communicated_text'];
                $dataexport[$i]['intake'] = ucfirst($data['intake']) . "\r\nRemarks: " . $data['intake_text'];
                $dataexport[$i]['output'] = ucfirst($data['output']) . "\r\nRemarks: " . $data['output_text'];



                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];


                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- Renal Transplantation - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function overall_clinical_scoliosis_correction()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_ma_clinicaloutcome_scoliosis_correction';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->audit_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Audit Name';
            $header[1] = 'Date & Time of Audit';
            $header[2] = 'Audit by';
            $header[3] = 'Patient MID';
            $header[4] = 'Patient Name';
            $header[5] = 'Patient Age';
            $header[6] = 'Patient Gender';

            $j = 7;

            $header[$j++] = 'Area';
            $header[$j++] = 'Department';
            $header[$j++] = 'Attended Doctor';
            $header[$j++] = 'Admission Date & Time';
            $header[$j++] = 'Discharge Date & Time';

            $header[$j++] = 'How many days after admission did the patient get discharged?';
            $header[$j++] = 'Did this patient have any post operative infection?';
            $header[$j++] = 'Did this patient have any post operative complication, other than infection?';
            $header[$j++] = 'Did this patient require any revision surgery during admission?';
            $header[$j++] = 'Did this patient get re admitted within 30 days after surgery?';
            $header[$j++] = 'Did this patient come for a review 30 days after surgery?';


            $header[$j++] = 'Additional comments';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['audit_type'] = $data['audit_type'];
                $dataexport[$i]['date'] = date('Y-m-d H:i', strtotime($row->datetime));
                $dataexport[$i]['audit_by'] = $data['audit_by'];

                $dataexport[$i]['mid_no'] = $data['mid_no'];
                $dataexport[$i]['patient_name'] = $data['patient_name'];
                $dataexport[$i]['patient_age'] = $data['patient_age'];
                $dataexport[$i]['patient_gender'] = $data['patient_gender'];
                $dataexport[$i]['location'] = $data['location'];
                $dataexport[$i]['department'] = $data['department'];
                $dataexport[$i]['attended_doctor'] = $data['attended_doctor'];
                $dataexport[$i]['initial_assessment_hr6'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr6']));
                $dataexport[$i]['discharge_date_time'] = date('Y-m-d H:i', strtotime($data['discharge_date_time']));


                $dataexport[$i]['identification_details'] = ucfirst($data['identification_details']);
                $dataexport[$i]['vital_signs'] = ucfirst($data['vital_signs']) . "\r\nRemarks: " . $data['vital_signs_text'];
                $dataexport[$i]['surgery'] = ucfirst($data['surgery']) . "\r\nRemarks: " . $data['surgery_text'];
                $dataexport[$i]['complaints_communicated'] = ucfirst($data['complaints_communicated']) . "\r\nRemarks: " . $data['complaints_communicated_remarks'];
                $dataexport[$i]['intake'] = ucfirst($data['intake']) . "\r\nRemarks: " . $data['intake_remarks'];
                $dataexport[$i]['output'] = ucfirst($data['output']) . "\r\nRemarks: " . $data['output_remarks'];


                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];


                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- Scoliosis Correction Surgery - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function overall_clinical_spinal_dysraphism()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_ma_clinicaloutcome_spinal_dysraphism';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->audit_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Audit Name';
            $header[1] = 'Date & Time of Audit';
            $header[2] = 'Audit by';
            $header[3] = 'Patient MID';
            $header[4] = 'Patient Name';
            $header[5] = 'Patient Age';
            $header[6] = 'Patient Gender';

            $j = 7;

            $header[$j++] = 'Area';
            $header[$j++] = 'Department';
            $header[$j++] = 'Attended Doctor';
            $header[$j++] = 'Admission Date & Time';
            $header[$j++] = 'Discharge Date & Time';

            $header[$j++] = 'How many days after admission did the patient get discharged?';
            $header[$j++] = 'Did the patient experience limb weakness after spinal dysraphism?';
            $header[$j++] = 'Did the patient experience Bowel/Bladder incontinence after spinal dysraphism?';
            $header[$j++] = 'Did this patient have any post operative infection?';
            $header[$j++] = 'Did this patient require a revision surgery?';
            $header[$j++] = 'Did this patient get readmitted anytime for a condition related to surgery within 30 days?';
            $header[$j++] = 'Did this patient come for a review 30 days after surgery?';



            $header[$j++] = 'Additional comments';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['audit_type'] = $data['audit_type'];
                $dataexport[$i]['date'] = date('Y-m-d H:i', strtotime($row->datetime));
                $dataexport[$i]['audit_by'] = $data['audit_by'];

                $dataexport[$i]['mid_no'] = $data['mid_no'];
                $dataexport[$i]['patient_name'] = $data['patient_name'];
                $dataexport[$i]['patient_age'] = $data['patient_age'];
                $dataexport[$i]['patient_gender'] = $data['patient_gender'];
                $dataexport[$i]['location'] = $data['location'];
                $dataexport[$i]['department'] = $data['department'];
                $dataexport[$i]['attended_doctor'] = $data['attended_doctor'];
                $dataexport[$i]['initial_assessment_hr6'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr6']));
                $dataexport[$i]['discharge_date_time'] = date('Y-m-d H:i', strtotime($data['discharge_date_time']));


                $dataexport[$i]['identification_details'] = ucfirst($data['identification_details']);
                $dataexport[$i]['vital_signs'] = ucfirst($data['vital_signs']) . "\r\nRemarks: " . $data['vital_signs_text'];
                $dataexport[$i]['surgery'] = ucfirst($data['surgery']) . "\r\nRemarks: " . $data['surgery_text'];
                $dataexport[$i]['complaints_communicated'] = ucfirst($data['complaints_communicated']) . "\r\nRemarks: " . $data['complaints_communicated_remarks'];
                $dataexport[$i]['intake'] = ucfirst($data['intake']) . "\r\nRemarks: " . $data['intake_remarks'];
                $dataexport[$i]['output'] = ucfirst($data['output']) . "\r\nRemarks: " . $data['output_remarks'];
                $dataexport[$i]['allergies'] = ucfirst($data['allergies']) . "\r\nRemarks: " . $data['allergies_remarks'];



                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];


                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- Spinal Dysraphism - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function overall_clinical_spine_disc_surgery()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_ma_clinicaloutcome_spine_disc_surgery';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->audit_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Audit Name';
            $header[1] = 'Date & Time of Audit';
            $header[2] = 'Audit by';
            $header[3] = 'Patient MID';
            $header[4] = 'Patient Name';
            $header[5] = 'Patient Age';
            $header[6] = 'Patient Gender';

            $j = 7;

            $header[$j++] = 'Area';
            $header[$j++] = 'Department';
            $header[$j++] = 'Attended Doctor';
            $header[$j++] = 'Admission Date & Time';
            $header[$j++] = 'Discharge Date & Time';

            $header[$j++] = 'Did this patient have any post operative complication?';
            $header[$j++] = 'How many days after admission did the patient get discharged?';
            $header[$j++] = 'Did this patient require any revision surgery during admission?';
            $header[$j++] = 'Did this patient get readmitted anytime for a condition related to surgery?';


            $header[$j++] = 'Additional comments';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['audit_type'] = $data['audit_type'];
                $dataexport[$i]['date'] = date('Y-m-d H:i', strtotime($row->datetime));
                $dataexport[$i]['audit_by'] = $data['audit_by'];

                $dataexport[$i]['mid_no'] = $data['mid_no'];
                $dataexport[$i]['patient_name'] = $data['patient_name'];
                $dataexport[$i]['patient_age'] = $data['patient_age'];
                $dataexport[$i]['patient_gender'] = $data['patient_gender'];
                $dataexport[$i]['location'] = $data['location'];
                $dataexport[$i]['department'] = $data['department'];
                $dataexport[$i]['attended_doctor'] = $data['attended_doctor'];
                $dataexport[$i]['initial_assessment_hr6'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr6']));
                $dataexport[$i]['discharge_date_time'] = date('Y-m-d H:i', strtotime($data['discharge_date_time']));


                $dataexport[$i]['identification_details'] = ucfirst($data['identification_details']) . "\r\nRemarks: " . $data['identification_details_text'];
                $dataexport[$i]['vital_signs'] = ucfirst($data['vital_signs']) . "\r\nRemarks: " . $data['vital_signs_text'];
                $dataexport[$i]['surgery'] = ucfirst($data['surgery']) . "\r\nRemarks: " . $data['surgery_remarks'];
                $dataexport[$i]['complaints_communicated'] = ucfirst($data['complaints_communicated']) . "\r\nRemarks: " . $data['complaints_communicated_remarks'];


                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];


                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- Spine & Disc Surgery-Fusion Procedures - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }



    public function overall_clinical_thoracotomy()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_ma_clinicaloutcome_thoracotomy';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->audit_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Audit Name';
            $header[1] = 'Date & Time of Audit';
            $header[2] = 'Audit by';
            $header[3] = 'Patient MID';
            $header[4] = 'Patient Name';
            $header[5] = 'Patient Age';
            $header[6] = 'Patient Gender';

            $j = 7;

            $header[$j++] = 'Area';
            $header[$j++] = 'Department';
            $header[$j++] = 'Attended Doctor';
            $header[$j++] = 'Admission Date & Time';
            $header[$j++] = 'Discharge Date & Time';

            $header[$j++] = 'Did this patient have any post operative complication?';
            $header[$j++] = 'How many days after admission did the patient get discharged?';
            $header[$j++] = 'Did this patient require any revision surgery during admission?';
            $header[$j++] = 'Did this patient get readmitted anytime for a condition related to surgery?';


            $header[$j++] = 'Additional comments';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['audit_type'] = $data['audit_type'];
                $dataexport[$i]['date'] = date('Y-m-d H:i', strtotime($row->datetime));
                $dataexport[$i]['audit_by'] = $data['audit_by'];

                $dataexport[$i]['mid_no'] = $data['mid_no'];
                $dataexport[$i]['patient_name'] = $data['patient_name'];
                $dataexport[$i]['patient_age'] = $data['patient_age'];
                $dataexport[$i]['patient_gender'] = $data['patient_gender'];
                $dataexport[$i]['location'] = $data['location'];
                $dataexport[$i]['department'] = $data['department'];
                $dataexport[$i]['attended_doctor'] = $data['attended_doctor'];
                $dataexport[$i]['initial_assessment_hr6'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr6']));
                $dataexport[$i]['discharge_date_time'] = date('Y-m-d H:i', strtotime($data['discharge_date_time']));


                $dataexport[$i]['identification_details'] = ucfirst($data['identification_details']);
                $dataexport[$i]['vital_signs'] = ucfirst($data['vital_signs']) . "\r\nRemarks: " . $data['vital_signs_text'];
                $dataexport[$i]['surgery'] = ucfirst($data['surgery']) . "\r\nRemarks: " . $data['surgery_text'];
                $dataexport[$i]['complaints_communicated'] = ucfirst($data['complaints_communicated']) . "\r\nRemarks: " . $data['complaints_communicated_remarks'];


                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];


                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- Thoracotomy - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function overall_clinical_tkr()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_ma_clinicaloutcome_tkr';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->audit_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Audit Name';
            $header[1] = 'Date & Time of Audit';
            $header[2] = 'Audit by';
            $header[3] = 'Patient MID';
            $header[4] = 'Patient Name';
            $header[5] = 'Patient Age';
            $header[6] = 'Patient Gender';

            $j = 7;

            $header[$j++] = 'Area';
            $header[$j++] = 'Department';
            $header[$j++] = 'Attended Doctor';
            $header[$j++] = 'Admission Date & Time';
            $header[$j++] = 'Discharge Date & Time';

            $header[$j++] = 'How many days after admission did the patient get discharged?';
            $header[$j++] = 'What was the type of surgery performed on this patient? (Robotic, Manual)';
            $header[$j++] = 'Did this patient have any post operative infection?';
            $header[$j++] = 'Did this patient have any post operative complication, other than infection?';
            $header[$j++] = 'What is this patient’s knee society score - before surgery?';
            $header[$j++] = 'What is this patient’s knee society score - after surgery?';
            $header[$j++] = 'Did this patient get re admitted within 30 days after surgery?';
            $header[$j++] = 'Did this patient require any revision surgery during admission?';
            $header[$j++] = 'Did this patient come for a review 30 days after surgery?';


            $header[$j++] = 'Additional comments';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['audit_type'] = $data['audit_type'];
                $dataexport[$i]['date'] = date('Y-m-d H:i', strtotime($row->datetime));
                $dataexport[$i]['audit_by'] = $data['audit_by'];

                $dataexport[$i]['mid_no'] = $data['mid_no'];
                $dataexport[$i]['patient_name'] = $data['patient_name'];
                $dataexport[$i]['patient_age'] = $data['patient_age'];
                $dataexport[$i]['patient_gender'] = $data['patient_gender'];
                $dataexport[$i]['location'] = $data['location'];
                $dataexport[$i]['department'] = $data['department'];
                $dataexport[$i]['attended_doctor'] = $data['attended_doctor'];
                $dataexport[$i]['initial_assessment_hr6'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr6']));
                $dataexport[$i]['discharge_date_time'] = date('Y-m-d H:i', strtotime($data['discharge_date_time']));


                $dataexport[$i]['identification_details'] = ucfirst($data['identification_details']);
                $dataexport[$i]['vital_signs'] = ucfirst($data['vital_signs']);
                $dataexport[$i]['surgery'] = ucfirst($data['surgery']) . "\r\nRemarks: " . $data['surgery_text'];
                $dataexport[$i]['complaints_communicated'] = ucfirst($data['complaints_communicated']) . "\r\nRemarks: " . $data['complaints_communicated_remarks'];
                $dataexport[$i]['intake'] = ucfirst($data['intake']);
                $dataexport[$i]['output'] = ucfirst($data['output']);
                $dataexport[$i]['allergies'] = ucfirst($data['allergies']) . "\r\nRemarks: " . $data['allergies_remarks'];
                $dataexport[$i]['medication'] = ucfirst($data['medication']) . "\r\nRemarks: " . $data['medication_remarks'];
                $dataexport[$i]['diagnostic'] = ucfirst($data['diagnostic']) . "\r\nRemarks: " . $data['diagnostic_remarks'];


                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];


                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- TKR - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function overall_clinical_uro_oncology()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_ma_clinicaloutcome_uro_oncology';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->audit_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Audit Name';
            $header[1] = 'Date & Time of Audit';
            $header[2] = 'Audit by';
            $header[3] = 'Patient MID';
            $header[4] = 'Patient Name';
            $header[5] = 'Patient Age';
            $header[6] = 'Patient Gender';

            $j = 7;

            $header[$j++] = 'Area';
            $header[$j++] = 'Department';
            $header[$j++] = 'Attended Doctor';
            $header[$j++] = 'Admission Date & Time';
            $header[$j++] = 'Discharge Date & Time';

            $header[$j++] = 'For how many days after surgery was this patient kept NPO/ on NGT?';
            $header[$j++] = 'Did this patient require ventilatory support for more than 48 hours after surgery?';
            $header[$j++] = 'Did this patient require any revision surgery during admission?';
            $header[$j++] = 'Did this patient have any post operative complications?';
            $header[$j++] = 'How many days after admission did the patient get discharged?';
            $header[$j++] = 'Did this patient get readmitted anytime for a condition related to surgery within 30 days?';
            $header[$j++] = 'Did this patient come for a review 30 days after surgery?';


            $header[$j++] = 'Additional comments';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['audit_type'] = $data['audit_type'];
                $dataexport[$i]['date'] = date('Y-m-d H:i', strtotime($row->datetime));
                $dataexport[$i]['audit_by'] = $data['audit_by'];

                $dataexport[$i]['mid_no'] = $data['mid_no'];
                $dataexport[$i]['patient_name'] = $data['patient_name'];
                $dataexport[$i]['patient_age'] = $data['patient_age'];
                $dataexport[$i]['patient_gender'] = $data['patient_gender'];
                $dataexport[$i]['location'] = $data['location'];
                $dataexport[$i]['department'] = $data['department'];
                $dataexport[$i]['attended_doctor'] = $data['attended_doctor'];
                $dataexport[$i]['initial_assessment_hr6'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr6']));
                $dataexport[$i]['discharge_date_time'] = date('Y-m-d H:i', strtotime($data['discharge_date_time']));


                $dataexport[$i]['identification_details'] = ucfirst($data['identification_details']);
                $dataexport[$i]['vital_signs'] = ucfirst($data['vital_signs']) . "\r\nRemarks: " . $data['vital_signs_text'];
                $dataexport[$i]['surgery'] = ucfirst($data['surgery']) . "\r\nRemarks: " . $data['surgery_text'];
                $dataexport[$i]['complaints_communicated'] = ucfirst($data['complaints_communicated']) . "\r\nRemarks: " . $data['complaints_communicated_remarks'];
                $dataexport[$i]['intake'] = ucfirst($data['intake']);
                $dataexport[$i]['output'] = ucfirst($data['output']) . "\r\nRemarks: " . $data['output_remarks'];
                $dataexport[$i]['allergies'] = ucfirst($data['allergies']) . "\r\nRemarks: " . $data['allergies_remarks'];

                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];


                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- Uro-oncology Procedures - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function overall_clinical_whipples_surgery()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_ma_clinicaloutcome_whipples_surgery';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->audit_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Audit Name';
            $header[1] = 'Date & Time of Audit';
            $header[2] = 'Audit by';
            $header[3] = 'Patient MID';
            $header[4] = 'Patient Name';
            $header[5] = 'Patient Age';
            $header[6] = 'Patient Gender';

            $j = 7;

            $header[$j++] = 'Area';
            $header[$j++] = 'Department';
            $header[$j++] = 'Attended Doctor';
            $header[$j++] = 'Admission Date & Time';
            $header[$j++] = 'Discharge Date & Time';

            $header[$j++] = 'How many days after admission did the patient get discharged?';
            $header[$j++] = 'Did this patient experience Delayed Gastric Emptying after the procedure?';
            $header[$j++] = 'Did this patient have any post operative infection?';
            $header[$j++] = 'Did the patient have bile leak following the procedure?';
            $header[$j++] = 'Did this patient get readmitted anytime for a condition related to surgery within 30 days?';


            $header[$j++] = 'Additional comments';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['audit_type'] = $data['audit_type'];
                $dataexport[$i]['date'] = date('Y-m-d H:i', strtotime($row->datetime));
                $dataexport[$i]['audit_by'] = $data['audit_by'];

                $dataexport[$i]['mid_no'] = $data['mid_no'];
                $dataexport[$i]['patient_name'] = $data['patient_name'];
                $dataexport[$i]['patient_age'] = $data['patient_age'];
                $dataexport[$i]['patient_gender'] = $data['patient_gender'];
                $dataexport[$i]['location'] = $data['location'];
                $dataexport[$i]['department'] = $data['department'];
                $dataexport[$i]['attended_doctor'] = $data['attended_doctor'];
                $dataexport[$i]['initial_assessment_hr6'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr6']));
                $dataexport[$i]['discharge_date_time'] = date('Y-m-d H:i', strtotime($data['discharge_date_time']));


                $dataexport[$i]['identification_details'] = ucfirst($data['identification_details']);
                $dataexport[$i]['vital_signs'] = ucfirst($data['vital_signs']) . "\r\nRemarks: " . $data['vital_signs_text'];
                $dataexport[$i]['surgery'] = ucfirst($data['surgery']) . "\r\nRemarks: " . $data['surgery_text'];
                $dataexport[$i]['complaints_communicated'] = ucfirst($data['complaints_communicated']) . "\r\nRemarks: " . $data['complaints_communicated_remarks'];
                $dataexport[$i]['intake'] = ucfirst($data['intake']) . "\r\nRemarks: " . $data['intake_remarks'];

                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];


                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- Whipples Surgery - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function overall_clinical_laparoscopic_cholecystectomy()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_ma_clinicaloutcome_laparoscopic_cholecystectomy';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->audit_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Audit Name';
            $header[1] = 'Date & Time of Audit';
            $header[2] = 'Audit by';
            $header[3] = 'Patient MID';
            $header[4] = 'Patient Name';
            $header[5] = 'Patient Age';
            $header[6] = 'Patient Gender';

            $j = 7;

            $header[$j++] = 'Area';
            $header[$j++] = 'Department';
            $header[$j++] = 'Attended Doctor';
            $header[$j++] = 'Admission Date & Time';
            $header[$j++] = 'Discharge Date & Time';

            $header[$j++] = 'Was it an emergency cholecystectomy?';
            $header[$j++] = 'Did the surgery get converted to open surgery?';
            $header[$j++] = 'Did the patient have a bile duct injury?';
            $header[$j++] = 'Did this patient have a bile leak post operatively?';
            $header[$j++] = 'Did this patient have any post operative infection?';
            $header[$j++] = 'Did this patient have any post operative complication, other than infection and bile duct injury?';
            $header[$j++] = 'Did this patient require any procedural re intervention after surgery?';
            $header[$j++] = 'How many days after admission did the patient get discharged?';
            $header[$j++] = 'Did this patient get readmitted anytime for a condition related to surgery within 30 days?';
            $header[$j++] = 'Did this patient come for a review 30 days after surgery?';


            $header[$j++] = 'Additional comments';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['audit_type'] = $data['audit_type'];
                $dataexport[$i]['date'] = date('Y-m-d H:i', strtotime($row->datetime));
                $dataexport[$i]['audit_by'] = $data['audit_by'];

                $dataexport[$i]['mid_no'] = $data['mid_no'];
                $dataexport[$i]['patient_name'] = $data['patient_name'];
                $dataexport[$i]['patient_age'] = $data['patient_age'];
                $dataexport[$i]['patient_gender'] = $data['patient_gender'];
                $dataexport[$i]['location'] = $data['location'];
                $dataexport[$i]['department'] = $data['department'];
                $dataexport[$i]['attended_doctor'] = $data['attended_doctor'];
                $dataexport[$i]['initial_assessment_hr6'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr6']));
                $dataexport[$i]['discharge_date_time'] = date('Y-m-d H:i', strtotime($data['discharge_date_time']));


                $dataexport[$i]['identification_details'] = ucfirst($data['identification_details']) . "\r\nRemarks: " . $data['identification_details_remarks'];
                $dataexport[$i]['vital_signs'] = ucfirst($data['vital_signs']) . "\r\nRemarks: " . $data['vital_signs_remarks'];
                $dataexport[$i]['surgery'] = ucfirst($data['surgery']) . "\r\nRemarks: " . $data['surgery_text'];
                $dataexport[$i]['complaints_communicated'] = ucfirst($data['complaints_communicated']) . "\r\nRemarks: " . $data['complaints_communicated_remarks'];
                $dataexport[$i]['intake'] = ucfirst($data['intake']);
                $dataexport[$i]['output'] = ucfirst($data['output']) . "\r\nRemarks: " . $data['output_remarks'];
                $dataexport[$i]['allergies'] = ucfirst($data['allergies']) . "\r\nRemarks: " . $data['allergies_remarks'];

                $dataexport[$i]['intake'] = ucfirst($data['intake']) . "\r\nRemarks: " . $data['intake_remarks'];
                $dataexport[$i]['output'] = ucfirst($data['output']) . "\r\nRemarks: " . $data['output_remarks'];
                $dataexport[$i]['allergies'] = ucfirst($data['allergies']) . "\r\nRemarks: " . $data['allergies_remarks'];
                $dataexport[$i]['medication'] = ucfirst($data['medication']); // no remarks field provided
                $dataexport[$i]['diagnostic'] = ucfirst($data['diagnostic']) . "\r\nRemarks: " . $data['diagnostic_remarks'];
                $dataexport[$i]['lab_results'] = ucfirst($data['lab_results']) . "\r\nRemarks: " . $data['lab_results_remarks'];


                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];


                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- Laparoscopic Cholecystectomy - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function overall_clinicalkpi_bronchodilators()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_ma_clinicalkpi_bronchodilators_audit';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->audit_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Audit Name';
            $header[1] = 'Date & Time of Audit';
            $header[2] = 'Audit by';
            $header[3] = 'Patient MID';
            $header[4] = 'Patient Name';
            $header[5] = 'Patient Age';
            $header[6] = 'Patient Gender';

            $j = 7;

            $header[$j++] = 'Area';
            $header[$j++] = 'Department';
            $header[$j++] = 'Attended Doctor';
            $header[$j++] = 'Admission Date & Time';
            $header[$j++] = 'Discharge Date & Time';

            $header[$j++] = 'Treated with Antimicrobials?';
            $header[$j++] = 'Treated with bronchodilators?';
            $header[$j++] = 'Appropriateness of Treatment?';


            $header[$j++] = 'Additional comments';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['audit_type'] = $data['audit_type'];
                $dataexport[$i]['date'] = date('Y-m-d H:i', strtotime($row->datetime));
                $dataexport[$i]['audit_by'] = $data['audit_by'];

                $dataexport[$i]['mid_no'] = $data['mid_no'];
                $dataexport[$i]['patient_name'] = $data['patient_name'];
                $dataexport[$i]['patient_age'] = $data['patient_age'];
                $dataexport[$i]['patient_gender'] = $data['patient_gender'];
                $dataexport[$i]['location'] = $data['location'];
                $dataexport[$i]['department'] = $data['department'];
                $dataexport[$i]['attended_doctor'] = $data['attended_doctor'];
                $dataexport[$i]['initial_assessment_hr6'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr6']));
                $dataexport[$i]['discharge_date_time'] = date('Y-m-d H:i', strtotime($data['discharge_date_time']));


                $dataexport[$i]['identification_details'] = ucfirst($data['identification_details']) . "\r\nRemarks: " . $data['identification_details_remarks'];
                $dataexport[$i]['vital_signs'] = ucfirst($data['vital_signs']) . "\r\nRemarks: " . $data['vital_signs_remarks'];
                $dataexport[$i]['surgery'] = ucfirst($data['surgery']) . "\r\nRemarks: " . $data['surgery_remarks'];

                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];


                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- Bronchodilators Audit - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function overall_clinicalkpi_copd_protocol()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_ma_clinicalkpi_copd_protocol_audit';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->audit_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Audit Name';
            $header[1] = 'Date & Time of Audit';
            $header[2] = 'Audit by';
            $header[3] = 'Patient MID';
            $header[4] = 'Patient Name';
            $header[5] = 'Patient Age';
            $header[6] = 'Patient Gender';

            $j = 7;

            $header[$j++] = 'Area';
            $header[$j++] = 'Department';
            $header[$j++] = 'Attended Doctor';
            $header[$j++] = 'Admission Date & Time';
            $header[$j++] = 'Discharge Date & Time';

            $header[$j++] = 'Evaluate ability to cope in his/her usual environment?';
            $header[$j++] = 'Re-assessment of inhaler technique?';
            $header[$j++] = 'Enrolment in Pulmonary rehabilitation?';
            $header[$j++] = 'Re-assess need for long term Oxygen / Home BIPAP support?';
            $header[$j++] = 'PFT – If not done already';
            $header[$j++] = 'Vaccination';
            $header[$j++] = 'Smoking Cessation';


            $header[$j++] = 'Additional comments';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['audit_type'] = $data['audit_type'];
                $dataexport[$i]['date'] = date('Y-m-d H:i', strtotime($row->datetime));
                $dataexport[$i]['audit_by'] = $data['audit_by'];

                $dataexport[$i]['mid_no'] = $data['mid_no'];
                $dataexport[$i]['patient_name'] = $data['patient_name'];
                $dataexport[$i]['patient_age'] = $data['patient_age'];
                $dataexport[$i]['patient_gender'] = $data['patient_gender'];
                $dataexport[$i]['location'] = $data['location'];
                $dataexport[$i]['department'] = $data['department'];
                $dataexport[$i]['attended_doctor'] = $data['attended_doctor'];
                $dataexport[$i]['initial_assessment_hr6'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr6']));
                $dataexport[$i]['discharge_date_time'] = date('Y-m-d H:i', strtotime($data['discharge_date_time']));


                $dataexport[$i]['identification_details'] = ucfirst($data['identification_details']) . "\r\nRemarks: " . $data['identification_details_text'];
                $dataexport[$i]['vital_signs'] = ucfirst($data['vital_signs']) . "\r\nRemarks: " . $data['vital_signs_text'];
                $dataexport[$i]['surgery'] = ucfirst($data['surgery']) . "\r\nRemarks: " . $data['surgery_text'];
                $dataexport[$i]['complaints_communicated'] = ucfirst($data['complaints_communicated']) . "\r\nRemarks: " . $data['complaints_communicated_text'];
                $dataexport[$i]['intake'] = ucfirst($data['intake']) . "\r\nRemarks: " . $data['intake_text'];
                $dataexport[$i]['output'] = ucfirst($data['output']) . "\r\nRemarks: " . $data['output_text'];
                $dataexport[$i]['allergies'] = ucfirst($data['allergies']) . "\r\nRemarks: " . $data['allergies_text'];


                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];


                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- COPD Protocol Audit - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function overall_infection_control_biomedical_waste()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_ma_infection_control_biomedical_waste';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->audit_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Audit Name';
            $header[1] = 'Date & Time of Audit';
            $header[2] = 'Audit by';
            $header[3] = 'Patient MID';
            $header[4] = 'Patient Name';
            $header[5] = 'Patient Age';
            $header[6] = 'Patient Gender';

            $j = 7;

            $header[$j++] = 'Area';
            $header[$j++] = 'Department';
            $header[$j++] = 'Attended Doctor';
            $header[$j++] = 'Admission Date & Time';
            $header[$j++] = 'Discharge Date & Time';

            $header[$j++] = 'Are Sharp items (Needles, Scalpels, blades) disposed in Puncture proof sharps Container?';
            $header[$j++] = 'Are Autoclavable waste (Plastic items, tubing\'s, catheters, syringes without needles, gloves & hand care) discarded in RED COVER?';
            $header[$j++] = 'Are Incinerator wastes (Cotton, gauze, diaper, mask, cap, lab waste, placenta, cytotoxic drugs, anatomical body parts) discarded in YELLOW COVER?';
            $header[$j++] = 'Are Glass ware (ampoules, Vials, Glass bottles, nails, discarded metallic Body implants) discarded in BLUE CONTAINER?';
            $header[$j++] = 'Collection of waste by housekeeping staff- Is the segregation maintained during the collection process & transported in closed containers?';
            $header[$j++] = 'Are House-keeping staff wearing appropriate PPE (Hard gloves, Mask, Cap, shoes) while handling the biomedical waste, bags or containers?';



            $header[$j++] = 'Additional comments';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['audit_type'] = $data['audit_type'];
                $dataexport[$i]['date'] = date('Y-m-d H:i', strtotime($row->datetime));
                $dataexport[$i]['audit_by'] = $data['audit_by'];

                $dataexport[$i]['mid_no'] = $data['mid_no'];
                $dataexport[$i]['patient_name'] = $data['patient_name'];
                $dataexport[$i]['patient_age'] = $data['patient_age'];
                $dataexport[$i]['patient_gender'] = $data['patient_gender'];
                $dataexport[$i]['location'] = $data['location'];
                $dataexport[$i]['department'] = $data['department'];
                $dataexport[$i]['attended_doctor'] = $data['attended_doctor'];
                $dataexport[$i]['initial_assessment_hr6'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr6']));
                $dataexport[$i]['discharge_date_time'] = date('Y-m-d H:i', strtotime($data['discharge_date_time']));


                $dataexport[$i]['identification_details'] = ucfirst($data['identification_details']) . "\r\nRemarks: " . $data['identification_details_text'];
                $dataexport[$i]['vital_signs'] = ucfirst($data['vital_signs']) . "\r\nRemarks: " . $data['vital_signs_text'];
                $dataexport[$i]['surgery'] = ucfirst($data['surgery']) . "\r\nRemarks: " . $data['surgery_text'];
                $dataexport[$i]['complaints_communicated'] = ucfirst($data['complaints_communicated']) . "\r\nRemarks: " . $data['complaints_communicated_text'];
                $dataexport[$i]['intake'] = ucfirst($data['intake']) . "\r\nRemarks: " . $data['intake_text'];
                $dataexport[$i]['output'] = ucfirst($data['output']) . "\r\nRemarks: " . $data['output_text'];

                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];


                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- Biomedical Waste Management Audit - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function overall_infection_control_canteen_audit()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_ma_infection_control_canteen_audit';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->audit_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Audit Name';
            $header[1] = 'Date & Time of Audit';
            $header[2] = 'Audit by';
            $header[3] = 'Patient MID';
            $header[4] = 'Patient Name';
            $header[5] = 'Patient Age';
            $header[6] = 'Patient Gender';

            $j = 7;

            $header[$j++] = 'Area';
            $header[$j++] = 'Department';
            $header[$j++] = 'Attended Doctor';
            $header[$j++] = 'Admission Date & Time';
            $header[$j++] = 'Discharge Date & Time';

            $header[$j++] = 'Are personal grooming of the staff satisfactory - hairs, nails cut short, clean uniforms?';
            $header[$j++] = 'Are all staffs are wearing PPEs while handling food items, (cap, mask, hand care gloves)?';
            $header[$j++] = 'Is it verified that no staffs are suffering from gastrointestinal disorders such as diarrhea etc?';
            $header[$j++] = 'Is the daily cleaning of the kitchen done adequately?';
            $header[$j++] = 'Is the cooking area kept clean?';
            $header[$j++] = 'Is the fridge temperature maintained at 0-5 degree c?';
            $header[$j++] = 'Are all food items that are stored kept closed?';
            $header[$j++] = 'Is cooked food is kept above 65 Degree c?';
            $header[$j++] = 'Is the freezer temperature kept below -3 degree C?';



            $header[$j++] = 'Additional comments';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['audit_type'] = $data['audit_type'];
                $dataexport[$i]['date'] = date('Y-m-d H:i', strtotime($row->datetime));
                $dataexport[$i]['audit_by'] = $data['audit_by'];

                $dataexport[$i]['mid_no'] = $data['mid_no'];
                $dataexport[$i]['patient_name'] = $data['patient_name'];
                $dataexport[$i]['patient_age'] = $data['patient_age'];
                $dataexport[$i]['patient_gender'] = $data['patient_gender'];
                $dataexport[$i]['location'] = $data['location'];
                $dataexport[$i]['department'] = $data['department'];
                $dataexport[$i]['attended_doctor'] = $data['attended_doctor'];
                $dataexport[$i]['initial_assessment_hr6'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr6']));
                $dataexport[$i]['discharge_date_time'] = date('Y-m-d H:i', strtotime($data['discharge_date_time']));


                $dataexport[$i]['identification_details'] = ucfirst($data['identification_details']) . "\r\nRemarks: " . $data['identification_details_text'];
                $dataexport[$i]['vital_signs'] = ucfirst($data['vital_signs']) . "\r\nRemarks: " . $data['vital_signs_text'];
                $dataexport[$i]['surgery'] = ucfirst($data['surgery']) . "\r\nRemarks: " . $data['surgery_text'];
                $dataexport[$i]['complaints_communicated'] = ucfirst($data['complaints_communicated']) . "\r\nRemarks: " . $data['complaints_communicated_text'];
                $dataexport[$i]['intake'] = ucfirst($data['intake']) . "\r\nRemarks: " . $data['intake_text'];
                $dataexport[$i]['output'] = ucfirst($data['output']) . "\r\nRemarks: " . $data['output_text'];
                $dataexport[$i]['allergies'] = ucfirst($data['allergies']) . "\r\nRemarks: " . $data['allergies_text'];
                $dataexport[$i]['medication'] = ucfirst($data['medication']) . "\r\nRemarks: " . $data['medication_text'];
                $dataexport[$i]['diagnostic'] = ucfirst($data['diagnostic']) . "\r\nRemarks: " . $data['diagnostic_text'];


                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];


                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- Canteen Audit - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function overall_infection_control_cssd_audit()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_ma_infection_control_cssd_audit';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->audit_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Audit Name';
            $header[1] = 'Date & Time of Audit';
            $header[2] = 'Audit by';
            $header[3] = 'Patient MID';
            $header[4] = 'Patient Name';
            $header[5] = 'Patient Age';
            $header[6] = 'Patient Gender';

            $j = 7;

            $header[$j++] = 'Area';
            $header[$j++] = 'Department';
            $header[$j++] = 'Attended Doctor';
            $header[$j++] = 'Admission Date & Time';
            $header[$j++] = 'Discharge Date & Time';

            $header[$j++] = 'Is Recall Register Maintained and Updated?';
            $header[$j++] = 'Are all the Machines cleaned with alcohol-based solution adequately?';
            $header[$j++] = 'Are Environmental cleaning of the CSSD with 1.5% Quaternary ammonium compound adequately performed?';
            $header[$j++] = 'Are Daily BDS test For Autoclave Machines adequately performed and documented?';
            $header[$j++] = 'Are BMS test for all Loads adequately performed and documented?';
            $header[$j++] = 'Are Staffs are wearing Proper PPE?';
            $header[$j++] = 'Are Daily Process records of ETO and Steam Autoclave Machine Maintained?';


            $header[$j++] = 'Additional comments';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['audit_type'] = $data['audit_type'];
                $dataexport[$i]['date'] = date('Y-m-d H:i', strtotime($row->datetime));
                $dataexport[$i]['audit_by'] = $data['audit_by'];

                $dataexport[$i]['mid_no'] = $data['mid_no'];
                $dataexport[$i]['patient_name'] = $data['patient_name'];
                $dataexport[$i]['patient_age'] = $data['patient_age'];
                $dataexport[$i]['patient_gender'] = $data['patient_gender'];
                $dataexport[$i]['location'] = $data['location'];
                $dataexport[$i]['department'] = $data['department'];
                $dataexport[$i]['attended_doctor'] = $data['attended_doctor'];
                $dataexport[$i]['initial_assessment_hr6'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr6']));
                $dataexport[$i]['discharge_date_time'] = date('Y-m-d H:i', strtotime($data['discharge_date_time']));


                $dataexport[$i]['identification_details'] = ucfirst($data['identification_details']) . "\r\nRemarks: " . $data['identification_details_text'];
                $dataexport[$i]['vital_signs'] = ucfirst($data['vital_signs']) . "\r\nRemarks: " . $data['vital_signs_text'];
                $dataexport[$i]['surgery'] = ucfirst($data['surgery']) . "\r\nRemarks: " . $data['surgery_text'];
                $dataexport[$i]['complaints_communicated'] = ucfirst($data['complaints_communicated']) . "\r\nRemarks: " . $data['complaints_communicated_text'];
                $dataexport[$i]['intake'] = ucfirst($data['intake']) . "\r\nRemarks: " . $data['intake_text'];
                $dataexport[$i]['output'] = ucfirst($data['output']) . "\r\nRemarks: " . $data['output_text'];
                $dataexport[$i]['allergies'] = ucfirst($data['allergies']) . "\r\nRemarks: " . $data['allergies_text'];


                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];


                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- CSSD Audit - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function overall_infection_control_hand_hygiene()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_ma_infection_control_hand_hygiene';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->audit_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Audit Name';
            $header[1] = 'Date & Time of Audit';
            $header[2] = 'Audit by';
            $header[3] = 'Patient MID';
            $header[4] = 'Patient Name';
            $header[5] = 'Patient Age';
            $header[6] = 'Patient Gender';

            $j = 7;

            $header[$j++] = 'Area';
            $header[$j++] = 'Department';
            $header[$j++] = 'Attended Doctor';
            $header[$j++] = 'Admission Date & Time';
            $header[$j++] = 'Discharge Date & Time';

            $header[$j++] = 'HH activities Before touching Patient';
            $header[$j++] = 'HH activities Before Aseptic Procedure';
            $header[$j++] = 'HH activities After Blood/Body fluid Exposure';
            $header[$j++] = 'HH activities After touching patient';
            $header[$j++] = 'HH activities After Touching patient Surroundings';
            $header[$j++] = 'Nurses HH activities Before touching Patient';
            $header[$j++] = 'Nurses HH activities Before Aseptic Procedure';
            $header[$j++] = 'Nurses HH activities After Blood/Body fluid Exposure';
            $header[$j++] = 'Nurses HH activities After touching patient';
            $header[$j++] = 'Nurses HH activities After Touching patient Surroundings';
            $header[$j++] = 'GDA HH activities Before touching Patient';
            $header[$j++] = 'GDA HH activities Before Aseptic Procedure';
            $header[$j++] = 'GDA HH activities After Blood/Body fluid Exposure';
            $header[$j++] = 'GDA HH activities After touching patient';
            $header[$j++] = 'GDA HH activities After Touching patient Surroundings';
            $header[$j++] = 'Technician HH activities Before touching Patient';
            $header[$j++] = 'Technician HH activities Before Aseptic Procedure';
            $header[$j++] = 'Technician HH activities After Blood/Body fluid Exposure';
            $header[$j++] = 'Technician HH activities After touching patient';
            $header[$j++] = 'Technician HH activities After Touching patient Surroundings';
            $header[$j++] = 'Housekeeping HH activities Before touching Patient';
            $header[$j++] = 'Housekeeping HH activities Before Aseptic Procedure';
            $header[$j++] = 'Housekeeping HH activities After touching patient';
            $header[$j++] = 'Housekeeping HH activities After Touching patient Surroundings';
            $header[$j++] = 'Physiotherapist HH activities Before touching Patient';
            $header[$j++] = 'Physiotherapist HH activities After Blood/Body fluid Exposure';
            $header[$j++] = 'Physiotherapist HH activities After touching patient';
            $header[$j++] = 'Physiotherapist HH activities After Touching patient Surroundings';
            $header[$j++] = 'Respiratory Therapist HH activities Before touching Patient';
            $header[$j++] = 'Respiratory Therapist HH activities Before Aseptic Procedure';
            $header[$j++] = 'Respiratory Therapist HH activities After Blood/Body fluid Exposure';
            $header[$j++] = 'Respiratory Therapist HH activities After touching patient';
            $header[$j++] = 'Respiratory Therapist HH activities After Touching patient Surroundings';
            $header[$j++] = 'Cardiac Physiotherapist HH activities Before touching Patient';
            $header[$j++] = 'Cardiac Physiotherapist HH activities Before Aseptic Procedure';
            $header[$j++] = 'Cardiac Physiotherapist HH activities After Blood/Body fluid Exposure';
            $header[$j++] = 'Cardiac Physiotherapist HH activities After touching patient';
            $header[$j++] = 'Cardiac Physiotherapist HH activities After Touching patient Surroundings';
            $header[$j++] = 'PCS HH activities Before touching Patient';
            $header[$j++] = 'PCS HH activities Before Aseptic Procedure';
            $header[$j++] = 'PCS HH activities After Blood/Body fluid Exposure';
            $header[$j++] = 'PCS HH activities After touching patient';
            $header[$j++] = 'PCS HH activities After Touching patient Surroundings';
            $header[$j++] = 'Laboratory HH activities Before touching Patient';
            $header[$j++] = 'Laboratory HH activities Before Aseptic Procedure';
            $header[$j++] = 'Laboratory HH activities After Blood/Body fluid Exposure';
            $header[$j++] = 'Laboratory HH activities After touching patient';
            $header[$j++] = 'Laboratory HH activities After Touching patient Surroundings';
            $header[$j++] = 'OPD Assistant HH activities Before touching Patient';
            $header[$j++] = 'OPD Assistant HH activities Before Aseptic Procedure';
            $header[$j++] = 'OPD Assistant HH activities After Blood/Body fluid Exposure';
            $header[$j++] = 'OPD Assistant HH activities After touching patient';
            $header[$j++] = 'OPD Assistant HH activities After Touching patient Surroundings';
            $header[$j++] = 'Doctors HH activities Before touching Patient';
            $header[$j++] = 'Doctors HH activities Before Aseptic Procedure';
            $header[$j++] = 'Doctors HH activities After Blood/Body fluid Exposure';
            $header[$j++] = 'Doctors HH activities After touching patient';
            $header[$j++] = 'Doctors HH activities After Touching patient Surroundings';



            $header[$j++] = 'Additional comments';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['audit_type'] = $data['audit_type'];
                $dataexport[$i]['date'] = date('Y-m-d H:i', strtotime($row->datetime));
                $dataexport[$i]['audit_by'] = $data['audit_by'];

                $dataexport[$i]['mid_no'] = $data['mid_no'];
                $dataexport[$i]['patient_name'] = $data['patient_name'];
                $dataexport[$i]['patient_age'] = $data['patient_age'];
                $dataexport[$i]['patient_gender'] = $data['patient_gender'];
                $dataexport[$i]['location'] = $data['location'];
                $dataexport[$i]['department'] = $data['department'];
                $dataexport[$i]['attended_doctor'] = $data['attended_doctor'];
                $dataexport[$i]['initial_assessment_hr6'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr6']));
                $dataexport[$i]['discharge_date_time'] = date('Y-m-d H:i', strtotime($data['discharge_date_time']));


                $dataexport[$i]['identification_details'] = ucfirst($data['identification_details']) . "\r\nRemarks: " . $data['identification_details_text'];
                $dataexport[$i]['vital_signs'] = ucfirst($data['vital_signs']) . "\r\nRemarks: " . $data['vital_signs_text'];
                $dataexport[$i]['surgery'] = ucfirst($data['surgery']) . "\r\nRemarks: " . $data['surgery_text'];
                $dataexport[$i]['complaints_communicated'] = ucfirst($data['complaints_communicated']) . "\r\nRemarks: " . $data['complaints_communicated_text'];
                $dataexport[$i]['intake'] = ucfirst($data['intake']) . "\r\nRemarks: " . $data['intake_text'];
                $dataexport[$i]['output'] = ucfirst($data['output']) . "\r\nRemarks: " . $data['output_text'];
                $dataexport[$i]['focus'] = ucfirst($data['focus']) . "\r\nRemarks: " . $data['focus_text'];
                $dataexport[$i]['meti'] = ucfirst($data['meti']) . "\r\nRemarks: " . $data['meti_text'];
                $dataexport[$i]['diagnostic'] = ucfirst($data['diagnostic']) . "\r\nRemarks: " . $data['diagnostic_text'];
                $dataexport[$i]['lab_results'] = ucfirst($data['lab_results']) . "\r\nRemarks: " . $data['lab_results_text'];
                $dataexport[$i]['pending_investigation'] = ucfirst($data['pending_investigation']) . "\r\nRemarks: " . $data['pending_investigation_text'];
                $dataexport[$i]['medicine_order'] = ucfirst($data['medicine_order']) . "\r\nRemarks: " . $data['medicine_order_text'];
                $dataexport[$i]['psychological'] = ucfirst($data['psychological']) . "\r\nRemarks: " . $data['psychological_text'];
                $dataexport[$i]['vulnerab'] = ucfirst($data['vulnerab']) . "\r\nRemarks: " . $data['vulnerab_text'];
                $dataexport[$i]['social'] = ucfirst($data['social']) . "\r\nRemarks: " . $data['social_text'];
                $dataexport[$i]['nutri'] = ucfirst($data['nutri']) . "\r\nRemarks: " . $data['nutri_text'];
                $dataexport[$i]['spiritual'] = ucfirst($data['spiritual']) . "\r\nRemarks: " . $data['spiritual_text'];
                $dataexport[$i]['suicide'] = ucfirst($data['suicide']) . "\r\nRemarks: " . $data['suicide_text'];
                $dataexport[$i]['risk'] = ucfirst($data['risk']) . "\r\nRemarks: " . $data['risk_text'];
                $dataexport[$i]['care'] = ucfirst($data['care']) . "\r\nRemarks: " . $data['care_text'];
                $dataexport[$i]['pfe'] = ucfirst($data['pfe']) . "\r\nRemarks: " . $data['pfe_text'];
                $dataexport[$i]['disch'] = ucfirst($data['disch']) . "\r\nRemarks: " . $data['disch_text'];
                $dataexport[$i]['facility_communicated'] = ucfirst($data['facility_communicated']) . "\r\nRemarks: " . $data['facility_communicated_text'];
                $dataexport[$i]['health_education'] = ucfirst($data['health_education']) . "\r\nRemarks: " . $data['health_education_text'];
                $dataexport[$i]['remarks1'] = ucfirst($data['remarks1']) . "\r\nRemarks: " . $data['remarks1_text'];
                $dataexport[$i]['urethral'] = ucfirst($data['urethral']) . "\r\nRemarks: " . $data['urethral_text'];
                $dataexport[$i]['urine_sample'] = ucfirst($data['urine_sample']) . "\r\nRemarks: " . $data['urine_sample_text'];
                $dataexport[$i]['bystander'] = ucfirst($data['bystander']) . "\r\nRemarks: " . $data['bystander_text'];
                $dataexport[$i]['instruments'] = ucfirst($data['instruments']) . "\r\nRemarks: " . $data['instruments_text'];
                $dataexport[$i]['sterile'] = ucfirst($data['sterile']) . "\r\nRemarks: " . $data['sterile_text'];
                $dataexport[$i]['antibiotics'] = ucfirst($data['antibiotics']) . "\r\nRemarks: " . $data['antibiotics_text'];
                $dataexport[$i]['surgical_site'] = ucfirst($data['surgical_site']) . "\r\nRemarks: " . $data['surgical_site_text'];
                $dataexport[$i]['wound'] = ucfirst($data['wound']) . "\r\nRemarks: " . $data['wound_text'];
                $dataexport[$i]['documented'] = ucfirst($data['documented']) . "\r\nRemarks: " . $data['documented_text'];
                $dataexport[$i]['adequate_facilities'] = ucfirst($data['adequate_facilities']) . "\r\nRemarks: " . $data['adequate_facilities_text'];
                $dataexport[$i]['sufficient_lighting'] = ucfirst($data['sufficient_lighting']) . "\r\nRemarks: " . $data['sufficient_lighting_text'];
                $dataexport[$i]['storage_facility_for_food'] = ucfirst($data['storage_facility_for_food']) . "\r\nRemarks: " . $data['storage_facility_for_food_text'];
                $dataexport[$i]['personnel_hygiene_facilities'] = ucfirst($data['personnel_hygiene_facilities']) . "\r\nRemarks: " . $data['personnel_hygiene_facilities_text'];
                $dataexport[$i]['food_material_testing'] = ucfirst($data['food_material_testing']) . "\r\nRemarks: " . $data['food_material_testing_text'];
                $dataexport[$i]['incoming_material'] = ucfirst($data['incoming_material']) . "\r\nRemarks: " . $data['incoming_material_text'];
                $dataexport[$i]['raw_materials_inspection'] = ucfirst($data['raw_materials_inspection']) . "\r\nRemarks: " . $data['raw_materials_inspection_text'];
                $dataexport[$i]['storage_of_materials'] = ucfirst($data['storage_of_materials']) . "\r\nRemarks: " . $data['storage_of_materials_text'];
                $dataexport[$i]['raw_materials_cleaning'] = ucfirst($data['raw_materials_cleaning']) . "\r\nRemarks: " . $data['raw_materials_cleaning_text'];
                $dataexport[$i]['equipment_sanitization'] = ucfirst($data['equipment_sanitization']) . "\r\nRemarks: " . $data['equipment_sanitization_text'];
                $dataexport[$i]['frozen_food_thawing'] = ucfirst($data['frozen_food_thawing']) . "\r\nRemarks: " . $data['frozen_food_thawing_text'];
                $dataexport[$i]['vegetarian_and_non_vegetarian'] = ucfirst($data['vegetarian_and_non_vegetarian']) . "\r\nRemarks: " . $data['vegetarian_and_non_vegetarian_text'];
                $dataexport[$i]['cooked_food_cooling'] = ucfirst($data['cooked_food_cooling']) . "\r\nRemarks: " . $data['cooked_food_cooling_text'];
                $dataexport[$i]['food_portioning'] = ucfirst($data['food_portioning']) . "\r\nRemarks: " . $data['food_portioning_text'];

                $dataexport[$i]['ab1'] = ucfirst($data['ab1']) . "\r\nRemarks: " . $data['ab1_text'];
                $dataexport[$i]['ab2'] = ucfirst($data['ab2']) . "\r\nRemarks: " . $data['ab2_text'];
                $dataexport[$i]['ab3'] = ucfirst($data['ab3']) . "\r\nRemarks: " . $data['ab3_text'];
                $dataexport[$i]['ab4'] = ucfirst($data['ab4']) . "\r\nRemarks: " . $data['ab4_text'];
                $dataexport[$i]['ab5'] = ucfirst($data['ab5']) . "\r\nRemarks: " . $data['ab5_text'];
                $dataexport[$i]['ab6'] = ucfirst($data['ab6']) . "\r\nRemarks: " . $data['ab6_text'];
                $dataexport[$i]['ab7'] = ucfirst($data['ab7']) . "\r\nRemarks: " . $data['ab7_text'];
                $dataexport[$i]['ab8'] = ucfirst($data['ab8']) . "\r\nRemarks: " . $data['ab8_text'];
                $dataexport[$i]['ab9'] = ucfirst($data['ab9']) . "\r\nRemarks: " . $data['ab9_text'];
                $dataexport[$i]['ab10'] = ucfirst($data['ab10']) . "\r\nRemarks: " . $data['ab10_text'];
                $dataexport[$i]['ab11'] = ucfirst($data['ab11']) . "\r\nRemarks: " . $data['ab11_text'];
                $dataexport[$i]['ab12'] = ucfirst($data['ab12']) . "\r\nRemarks: " . $data['ab12_text'];


                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];


                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- Hand Hygiene Audit - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function overall_infection_control_bundle_audit()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_ma_infection_control_bundle_audit';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->audit_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Audit Name';
            $header[1] = 'Date & Time of Audit';
            $header[2] = 'Audit by';
            $header[3] = 'Patient MID';
            $header[4] = 'Patient Name';
            $header[5] = 'Patient Age';
            $header[6] = 'Patient Gender';

            $j = 7;

            $header[$j++] = 'Area';
            $header[$j++] = 'Department';
            $header[$j++] = 'Attended Doctor';
            $header[$j++] = 'Admission Date & Time';
            $header[$j++] = 'Discharge Date & Time';

            $header[$j++] = 'CAUTI Adherence to aseptic technique while insertion';
            $header[$j++] = 'CAUTI Indwelling urinary catheter continuously connected to the drainage system';
            $header[$j++] = 'CAUTI Meatal hygiene performed at regular intervals';
            $header[$j++] = 'CAUTI Drainage bags emptied when 3/4th full';
            $header[$j++] = 'CAUTI Hand hygiene performed immediately prior to access or manipulation of the indwelling urinary catheter';
            $header[$j++] = 'CAUTI Urine drainage bag kept below the bladder level';
            $header[$j++] = 'CLABSI Aseptic practices adhered to while insertion of CVC';
            $header[$j++] = 'CLABSI Site of insertion cleaned with 2% CHG and transparent dressing changed when wet, soiled, or dislodged';
            $header[$j++] = 'CLABSI Any erythema at or near line insertion site immediately reported & CVC removed';
            $header[$j++] = 'CLABSI Access ports or hub cleaned with friction immediately prior to each use with 70% alcohol swab';
            $header[$j++] = 'CLABSI Infusion lines and 3 way connectors changed every 72 hrs';
            $header[$j++] = 'VAP/VAE Head end elevation of 30-45 degrees given';
            $header[$j++] = 'VAP/VAE Daily sedation free interval and daily assessment of readiness to extubate monitored & recorded';
            $header[$j++] = 'VAP/VAE Peptic ulcer prophylaxis monitored';
            $header[$j++] = 'VAP/VAE DVT prophylaxis monitored';
            $header[$j++] = 'VAP/VAE Chlorhexidine gluconate mouth wash at regular intervals performed';
            $header[$j++] = 'VAP/VAE Intermittent closed suctioning done';


            $header[$j++] = 'Additional comments';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['audit_type'] = $data['audit_type'];
                $dataexport[$i]['date'] = date('Y-m-d H:i', strtotime($row->datetime));
                $dataexport[$i]['audit_by'] = $data['audit_by'];

                $dataexport[$i]['mid_no'] = $data['mid_no'];
                $dataexport[$i]['patient_name'] = $data['patient_name'];
                $dataexport[$i]['patient_age'] = $data['patient_age'];
                $dataexport[$i]['patient_gender'] = $data['patient_gender'];
                $dataexport[$i]['location'] = $data['location'];
                $dataexport[$i]['department'] = $data['department'];
                $dataexport[$i]['attended_doctor'] = $data['attended_doctor'];
                $dataexport[$i]['initial_assessment_hr6'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr6']));
                $dataexport[$i]['discharge_date_time'] = date('Y-m-d H:i', strtotime($data['discharge_date_time']));


                $dataexport[$i]['identification_details'] = ucfirst($data['identification_details']) . "\r\nRemarks: " . $data['identification_details_text'];
                $dataexport[$i]['vital_signs'] = ucfirst($data['vital_signs']) . "\r\nRemarks: " . $data['vital_signs_text'];
                $dataexport[$i]['surgery'] = ucfirst($data['surgery']) . "\r\nRemarks: " . $data['surgery_text'];
                $dataexport[$i]['complaints_communicated'] = ucfirst($data['complaints_communicated']) . "\r\nRemarks: " . $data['complaints_communicated_text'];
                $dataexport[$i]['intake'] = ucfirst($data['intake']) . "\r\nRemarks: " . $data['intake_text'];
                $dataexport[$i]['output'] = ucfirst($data['output']) . "\r\nRemarks: " . $data['output_text'];
                $dataexport[$i]['focus'] = ucfirst($data['focus']) . "\r\nRemarks: " . $data['focus_text'];
                $dataexport[$i]['meti'] = ucfirst($data['meti']) . "\r\nRemarks: " . $data['meti_text'];
                $dataexport[$i]['diagnostic'] = ucfirst($data['diagnostic']) . "\r\nRemarks: " . $data['diagnostic_text'];
                $dataexport[$i]['lab_results'] = ucfirst($data['lab_results']) . "\r\nRemarks: " . $data['lab_results_text'];
                $dataexport[$i]['pending_investigation'] = ucfirst($data['pending_investigation']) . "\r\nRemarks: " . $data['pending_investigation_text'];
                $dataexport[$i]['medicine_order'] = ucfirst($data['medicine_order']) . "\r\nRemarks: " . $data['medicine_order_text'];
                $dataexport[$i]['psychological'] = ucfirst($data['psychological']) . "\r\nRemarks: " . $data['psychological_text'];
                $dataexport[$i]['vulnerab'] = ucfirst($data['vulnerab']) . "\r\nRemarks: " . $data['vulnerab_text'];
                $dataexport[$i]['social'] = ucfirst($data['social']) . "\r\nRemarks: " . $data['social_text'];
                $dataexport[$i]['nutri'] = ucfirst($data['nutri']) . "\r\nRemarks: " . $data['nutri_text'];
                $dataexport[$i]['spiritual'] = ucfirst($data['spiritual']) . "\r\nRemarks: " . $data['spiritual_text'];


                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];


                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- Infection Control Bundle Audit - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function overall_infection_control_ot_audit()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_ma_infection_control_ot_audit';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->audit_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Audit Name';
            $header[1] = 'Date & Time of Audit';
            $header[2] = 'Audit by';
            $header[3] = 'Patient MID';
            $header[4] = 'Patient Name';
            $header[5] = 'Patient Age';
            $header[6] = 'Patient Gender';

            $j = 7;

            $header[$j++] = 'Area';
            $header[$j++] = 'Department';
            $header[$j++] = 'Attended Doctor';
            $header[$j++] = 'Admission Date & Time';
            $header[$j++] = 'Discharge Date & Time';

            $header[$j++] = 'OT Floors clean';
            $header[$j++] = 'OT Equipment cleaned';
            $header[$j++] = 'OT Disinfection done according to protocol';
            $header[$j++] = 'OT Waste segregation done appropriately';
            $header[$j++] = 'OT Hand washing available';
            $header[$j++] = 'OT Posters displayed (surgical hand washing, BMW management)';
            $header[$j++] = 'OT Instruments disinfected/sterilized';
            $header[$j++] = 'OT CSSD items stored appropriately in sterile room';
            $header[$j++] = 'OT Checks for expiry dates of sterilized items done';
            $header[$j++] = 'OT Cleaning done after each utilization for 20 minutes';
            $header[$j++] = 'OT Temperature, Humidity and pressure monitored daily';
            $header[$j++] = 'OT Temperature & Humidity maintained at appropriate levels';
            $header[$j++] = 'OT Staff adhering to designated OT attire';
            $header[$j++] = 'OT PPEs used appropriately';
            $header[$j++] = 'OT Material flow inside OT appropriate';
            $header[$j++] = 'OT Number of people inside OT restricted to minimum required level';
            $header[$j++] = 'OT Operating room doors not opened during procedure except for emergencies';
            $header[$j++] = 'OT Safe injection and infusion practices followed';
            $header[$j++] = 'OT Good personal hygiene practiced';
            $header[$j++] = 'OT Spills kits adequate';
            $header[$j++] = 'OT Staff aware of infection control practices to be followed';


            $header[$j++] = 'Additional comments';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['audit_type'] = $data['audit_type'];
                $dataexport[$i]['date'] = date('Y-m-d H:i', strtotime($row->datetime));
                $dataexport[$i]['audit_by'] = $data['audit_by'];

                $dataexport[$i]['mid_no'] = $data['mid_no'];
                $dataexport[$i]['patient_name'] = $data['patient_name'];
                $dataexport[$i]['patient_age'] = $data['patient_age'];
                $dataexport[$i]['patient_gender'] = $data['patient_gender'];
                $dataexport[$i]['location'] = $data['location'];
                $dataexport[$i]['department'] = $data['department'];
                $dataexport[$i]['attended_doctor'] = $data['attended_doctor'];
                $dataexport[$i]['initial_assessment_hr6'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr6']));
                $dataexport[$i]['discharge_date_time'] = date('Y-m-d H:i', strtotime($data['discharge_date_time']));


                $dataexport[$i]['identification_details'] = ucfirst($data['identification_details']) . "\r\nRemarks: " . $data['identification_details_text'];
                $dataexport[$i]['vital_signs'] = ucfirst($data['vital_signs']) . "\r\nRemarks: " . $data['vital_signs_text'];
                $dataexport[$i]['surgery'] = ucfirst($data['surgery']) . "\r\nRemarks: " . $data['surgery_text'];
                $dataexport[$i]['complaints_communicated'] = ucfirst($data['complaints_communicated']) . "\r\nRemarks: " . $data['complaints_communicated_text'];
                $dataexport[$i]['intake'] = ucfirst($data['intake']) . "\r\nRemarks: " . $data['intake_text'];
                $dataexport[$i]['output'] = ucfirst($data['output']) . "\r\nRemarks: " . $data['output_text'];
                $dataexport[$i]['focus'] = ucfirst($data['focus']) . "\r\nRemarks: " . $data['focus_text'];
                $dataexport[$i]['meti'] = ucfirst($data['meti']) . "\r\nRemarks: " . $data['meti_text'];
                $dataexport[$i]['diagnostic'] = ucfirst($data['diagnostic']) . "\r\nRemarks: " . $data['diagnostic_text'];
                $dataexport[$i]['lab_results'] = ucfirst($data['lab_results']) . "\r\nRemarks: " . $data['lab_results_text'];
                $dataexport[$i]['pending_investigation'] = ucfirst($data['pending_investigation']) . "\r\nRemarks: " . $data['pending_investigation_text'];
                $dataexport[$i]['medicine_order'] = ucfirst($data['medicine_order']) . "\r\nRemarks: " . $data['medicine_order_text'];
                $dataexport[$i]['psychological'] = ucfirst($data['psychological']) . "\r\nRemarks: " . $data['psychological_text'];
                $dataexport[$i]['vulnerab'] = ucfirst($data['vulnerab']) . "\r\nRemarks: " . $data['vulnerab_text'];
                $dataexport[$i]['social'] = ucfirst($data['social']) . "\r\nRemarks: " . $data['social_text'];
                $dataexport[$i]['nutri'] = ucfirst($data['nutri']) . "\r\nRemarks: " . $data['nutri_text'];
                $dataexport[$i]['spiritual'] = ucfirst($data['spiritual']) . "\r\nRemarks: " . $data['spiritual_text'];
                $dataexport[$i]['suicide'] = ucfirst($data['suicide']) . "\r\nRemarks: " . $data['suicide_text'];
                $dataexport[$i]['risk'] = ucfirst($data['risk']) . "\r\nRemarks: " . $data['risk_text'];
                $dataexport[$i]['care'] = ucfirst($data['care']) . "\r\nRemarks: " . $data['care_text'];
                $dataexport[$i]['pfe'] = ucfirst($data['pfe']) . "\r\nRemarks: " . $data['pfe_text'];


                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];


                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- Infection Control OT audit - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function overall_infection_control_linen_audit()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_ma_infection_control_linen_audit';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->audit_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Audit Name';
            $header[1] = 'Date & Time of Audit';
            $header[2] = 'Audit by';
            $header[3] = 'Patient MID';
            $header[4] = 'Patient Name';
            $header[5] = 'Patient Age';
            $header[6] = 'Patient Gender';

            $j = 7;

            $header[$j++] = 'Area';
            $header[$j++] = 'Department';
            $header[$j++] = 'Attended Doctor';
            $header[$j++] = 'Admission Date & Time';
            $header[$j++] = 'Discharge Date & Time';

            $header[$j++] = 'Collection of linen & Handling adequately performed';
            $header[$j++] = 'Hygiene of containment area maintained adequately';
            $header[$j++] = 'Protective measures by linen personnel during segregation adequate';
            $header[$j++] = 'Segregation of linen of infected patients adequate';
            $header[$j++] = 'Transportation of linen in carts adequately performed';
            $header[$j++] = 'Storage of clean linen adequate';


            $header[$j++] = 'Additional comments';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['audit_type'] = $data['audit_type'];
                $dataexport[$i]['date'] = date('Y-m-d H:i', strtotime($row->datetime));
                $dataexport[$i]['audit_by'] = $data['audit_by'];

                $dataexport[$i]['mid_no'] = $data['mid_no'];
                $dataexport[$i]['patient_name'] = $data['patient_name'];
                $dataexport[$i]['patient_age'] = $data['patient_age'];
                $dataexport[$i]['patient_gender'] = $data['patient_gender'];
                $dataexport[$i]['location'] = $data['location'];
                $dataexport[$i]['department'] = $data['department'];
                $dataexport[$i]['attended_doctor'] = $data['attended_doctor'];
                $dataexport[$i]['initial_assessment_hr6'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr6']));
                $dataexport[$i]['discharge_date_time'] = date('Y-m-d H:i', strtotime($data['discharge_date_time']));


                $dataexport[$i]['identification_details'] = ucfirst($data['identification_details']) . "\r\nRemarks: " . $data['identification_details_text'];
                $dataexport[$i]['vital_signs'] = ucfirst($data['vital_signs']) . "\r\nRemarks: " . $data['vital_signs_text'];
                $dataexport[$i]['surgery'] = ucfirst($data['surgery']) . "\r\nRemarks: " . $data['surgery_text'];
                $dataexport[$i]['complaints_communicated'] = ucfirst($data['complaints_communicated']) . "\r\nRemarks: " . $data['complaints_communicated_text'];
                $dataexport[$i]['intake'] = ucfirst($data['intake']) . "\r\nRemarks: " . $data['intake_text'];
                $dataexport[$i]['output'] = ucfirst($data['output']) . "\r\nRemarks: " . $data['output_text'];

                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];


                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- Linen Audit - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function overall_infection_control_ambulance_audit()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_ma_infection_control_ambulance_audit';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->audit_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Audit Name';
            $header[1] = 'Date & Time of Audit';
            $header[2] = 'Audit by';
            $header[3] = 'Patient MID';
            $header[4] = 'Patient Name';
            $header[5] = 'Patient Age';
            $header[6] = 'Patient Gender';

            $j = 7;

            $header[$j++] = 'Area';
            $header[$j++] = 'Department';
            $header[$j++] = 'Attended Doctor';
            $header[$j++] = 'Admission Date & Time';
            $header[$j++] = 'Discharge Date & Time';

            $header[$j++] = 'Alcohol dispenser available and not empty';
            $header[$j++] = 'PPE available (gloves, masks, gowns, goggles, etc.)';
            $header[$j++] = 'All equipments and surfaces are cleaned and disinfected';
            $header[$j++] = 'Blood and body fluid spills immediately cleaned';
            $header[$j++] = 'Sharp containers available, not overfilled';
            $header[$j++] = 'Blood spill kits available with all its contents';
            $header[$j++] = 'Soiled linen properly collected and sent to laundry';
            $header[$j++] = 'Clean sheet placed on bed or stretcher';
            $header[$j++] = 'Air exhaust is properly functioning';


            $header[$j++] = 'Additional comments';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['audit_type'] = $data['audit_type'];
                $dataexport[$i]['date'] = date('Y-m-d H:i', strtotime($row->datetime));
                $dataexport[$i]['audit_by'] = $data['audit_by'];

                $dataexport[$i]['mid_no'] = $data['mid_no'];
                $dataexport[$i]['patient_name'] = $data['patient_name'];
                $dataexport[$i]['patient_age'] = $data['patient_age'];
                $dataexport[$i]['patient_gender'] = $data['patient_gender'];
                $dataexport[$i]['location'] = $data['location'];
                $dataexport[$i]['department'] = $data['department'];
                $dataexport[$i]['attended_doctor'] = $data['attended_doctor'];
                $dataexport[$i]['initial_assessment_hr6'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr6']));
                $dataexport[$i]['discharge_date_time'] = date('Y-m-d H:i', strtotime($data['discharge_date_time']));


                $dataexport[$i]['identification_details'] = ucfirst($data['identification_details']) . "\r\nRemarks: " . $data['identification_details_text'];
                $dataexport[$i]['vital_signs'] = ucfirst($data['vital_signs']) . "\r\nRemarks: " . $data['vital_signs_text'];
                $dataexport[$i]['surgery'] = ucfirst($data['surgery']) . "\r\nRemarks: " . $data['surgery_text'];
                $dataexport[$i]['complaints_communicated'] = ucfirst($data['complaints_communicated']) . "\r\nRemarks: " . $data['complaints_communicated_text'];
                $dataexport[$i]['intake'] = ucfirst($data['intake']) . "\r\nRemarks: " . $data['intake_text'];
                $dataexport[$i]['output'] = ucfirst($data['output']) . "\r\nRemarks: " . $data['output_text'];
                $dataexport[$i]['allergies'] = ucfirst($data['allergies']) . "\r\nRemarks: " . $data['allergies_text'];
                $dataexport[$i]['medication'] = ucfirst($data['medication']) . "\r\nRemarks: " . $data['medication_text'];
                $dataexport[$i]['diagnostic'] = ucfirst($data['diagnostic']) . "\r\nRemarks: " . $data['diagnostic_text'];


                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];


                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- Ambulance PCI Audit - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function overall_infection_control_coffee_audit()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_ma_infection_control_coffee_audit';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->audit_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Audit Name';
            $header[1] = 'Date & Time of Audit';
            $header[2] = 'Audit by';
            $header[3] = 'Patient MID';
            $header[4] = 'Patient Name';
            $header[5] = 'Patient Age';
            $header[6] = 'Patient Gender';

            $j = 7;

            $header[$j++] = 'Area';
            $header[$j++] = 'Department';
            $header[$j++] = 'Attended Doctor';
            $header[$j++] = 'Admission Date & Time';
            $header[$j++] = 'Discharge Date & Time';

            $header[$j++] = 'Staffs are wearing clean, appropriate uniform';
            $header[$j++] = 'Good personnel hygiene practiced';
            $header[$j++] = 'Fingernails are clean and trimmed';
            $header[$j++] = 'Protective clothing is used appropriately';
            $header[$j++] = 'Staff with respiratory, gastrointestinal, or skin infectious are restricted from handling food and sent for treatment';
            $header[$j++] = 'All food items are labeled with product name and expiry date';
            $header[$j++] = 'Prepared or ready eat food is covered and labeled with production date';
            $header[$j++] = 'No food is stored on the floor';
            $header[$j++] = 'Cleaning chemicals are stored separately from food items';
            $header[$j++] = 'All refrigerator temperature charts are checked regularly as per schedule';
            $header[$j++] = 'Equipment such as grinders, slicers, knives, mixers etc. are cleaned and sanitized between uses';
            $header[$j++] = 'All working surfaces are kept clean with no spill left';
            $header[$j++] = 'Hand hygiene is performed before starting duty and in between';
            $header[$j++] = 'Received food items are in good conditions';
            $header[$j++] = 'Food is served in clean paper dishes';
            $header[$j++] = 'Appropriate utensils are immediately refrigerated';
            $header[$j++] = 'Dining area is kept clean, spills immediately removed';
            $header[$j++] = 'Wiping with paper towel';
            $header[$j++] = 'Garbage receptacles are lined with plastic bags and covered';
            $header[$j++] = 'Coffee shop is kept clean and dry with no stagnant water spills';


            $header[$j++] = 'Additional comments';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['audit_type'] = $data['audit_type'];
                $dataexport[$i]['date'] = date('Y-m-d H:i', strtotime($row->datetime));
                $dataexport[$i]['audit_by'] = $data['audit_by'];

                $dataexport[$i]['mid_no'] = $data['mid_no'];
                $dataexport[$i]['patient_name'] = $data['patient_name'];
                $dataexport[$i]['patient_age'] = $data['patient_age'];
                $dataexport[$i]['patient_gender'] = $data['patient_gender'];
                $dataexport[$i]['location'] = $data['location'];
                $dataexport[$i]['department'] = $data['department'];
                $dataexport[$i]['attended_doctor'] = $data['attended_doctor'];
                $dataexport[$i]['initial_assessment_hr6'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr6']));
                $dataexport[$i]['discharge_date_time'] = date('Y-m-d H:i', strtotime($data['discharge_date_time']));


                $dataexport[$i]['identification_details'] = ucfirst($data['identification_details']) . "\r\nRemarks: " . $data['identification_details_text'];
                $dataexport[$i]['vital_signs'] = ucfirst($data['vital_signs']) . "\r\nRemarks: " . $data['vital_signs_text'];
                $dataexport[$i]['surgery'] = ucfirst($data['surgery']) . "\r\nRemarks: " . $data['surgery_text'];
                $dataexport[$i]['complaints_communicated'] = ucfirst($data['complaints_communicated']) . "\r\nRemarks: " . $data['complaints_communicated_text'];
                $dataexport[$i]['intake'] = ucfirst($data['intake']) . "\r\nRemarks: " . $data['intake_text'];
                $dataexport[$i]['output'] = ucfirst($data['output']) . "\r\nRemarks: " . $data['output_text'];
                $dataexport[$i]['focus'] = ucfirst($data['focus']) . "\r\nRemarks: " . $data['focus_text'];
                $dataexport[$i]['meti'] = ucfirst($data['meti']) . "\r\nRemarks: " . $data['meti_text'];
                $dataexport[$i]['diagnostic'] = ucfirst($data['diagnostic']) . "\r\nRemarks: " . $data['diagnostic_text'];
                $dataexport[$i]['lab_results'] = ucfirst($data['lab_results']) . "\r\nRemarks: " . $data['lab_results_text'];
                $dataexport[$i]['pending_investigation'] = ucfirst($data['pending_investigation']) . "\r\nRemarks: " . $data['pending_investigation_text'];
                $dataexport[$i]['medicine_order'] = ucfirst($data['medicine_order']) . "\r\nRemarks: " . $data['medicine_order_text'];
                $dataexport[$i]['psychological'] = ucfirst($data['psychological']) . "\r\nRemarks: " . $data['psychological_text'];
                $dataexport[$i]['vulnerab'] = ucfirst($data['vulnerab']) . "\r\nRemarks: " . $data['vulnerab_text'];
                $dataexport[$i]['social'] = ucfirst($data['social']) . "\r\nRemarks: " . $data['social_text'];
                $dataexport[$i]['nutri'] = ucfirst($data['nutri']) . "\r\nRemarks: " . $data['nutri_text'];
                $dataexport[$i]['spiritual'] = ucfirst($data['spiritual']) . "\r\nRemarks: " . $data['spiritual_text'];
                $dataexport[$i]['suicide'] = ucfirst($data['suicide']) . "\r\nRemarks: " . $data['suicide_text'];
                $dataexport[$i]['risk'] = ucfirst($data['risk']) . "\r\nRemarks: " . $data['risk_text'];
                $dataexport[$i]['care'] = ucfirst($data['care']) . "\r\nRemarks: " . $data['care_text'];


                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];


                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- Coffee Shop PCI Audit - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function overall_infection_control_laboratory_audit()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_ma_infection_control_laboratory_audit';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->audit_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Audit Name';
            $header[1] = 'Date & Time of Audit';
            $header[2] = 'Audit by';
            $header[3] = 'Patient MID';
            $header[4] = 'Patient Name';
            $header[5] = 'Patient Age';
            $header[6] = 'Patient Gender';

            $j = 7;

            $header[$j++] = 'Area';
            $header[$j++] = 'Department';
            $header[$j++] = 'Attended Doctor';
            $header[$j++] = 'Admission Date & Time';
            $header[$j++] = 'Discharge Date & Time';

            $header[$j++] = 'There is a cleaning schedule for the laboratory';
            $header[$j++] = 'All areas are clean and tidy';
            $header[$j++] = 'There are designated clean and dirty areas in the laboratory';
            $header[$j++] = 'Furniture/ counters are made of non-porous materials';
            $header[$j++] = 'All staff receives infection control education upon hire and on annual basis';
            $header[$j++] = 'Under sink areas are free from supplies';
            $header[$j++] = 'Eye wash stations and emergency showers are available and checked daily';
            $header[$j++] = 'There is no eating, drinking, and smoking in the laboratory';
            $header[$j++] = 'Refrigerators and freezers temperatures are monitored on regularly basis and records are kept';
            $header[$j++] = 'Chemicals are labeled and stored appropriately';
            $header[$j++] = 'A class type biological safety cabinet is available when working with highly infectious agents';
            $header[$j++] = 'There are adequate color – coded foot – operated waste bins for regular infectious waste. Bins are labeled';
            $header[$j++] = 'Waste bins are not over-filled';
            $header[$j++] = 'There is regular removal of waste';
            $header[$j++] = 'There are adequate leak- proof sharps containers available and replaced when three quarters full';
            $header[$j++] = 'There is proper storage and disposal of lab specimens';
            $header[$j++] = 'Staff is able to verbalize what to do following a needlestick / sharps injury';
            $header[$j++] = 'PPE are readily available';
            $header[$j++] = 'Staff wears proper PPE when appropriate';
            $header[$j++] = 'Lab coats/gowns are worn when collecting blood';
            $header[$j++] = 'Lab coats are clean';
            $header[$j++] = 'Staff is able to verbalize the meaning of standard precautions';
            $header[$j++] = 'All specimens of blood and body fluids are transported in leak-proof containers';
            $header[$j++] = 'Bio-hazard (zip-lock) bags are available and used for specimen transport';
            $header[$j++] = 'Personnel respiratory protection is used when handling Tuberculosis or Suspected TB specimens';
            $header[$j++] = 'TB lab negative pressure is controlled and maintained';
            $header[$j++] = 'There are adequate sinks available for handwashing';
            $header[$j++] = 'There is alcohol- based hand rub if sinks are not available';
            $header[$j++] = 'Staff members successfully demonstrate proper hand washing technique';
            $header[$j++] = 'There is adequate housekeeping storage';
            $header[$j++] = 'Blood spill kits are available';
            $header[$j++] = 'There are written policies and procedures for cleaning blood spills';
            $header[$j++] = 'Person responsible for blood spill cleanup has adequate training and proper PPE for procedures';
            $header[$j++] = 'Cleaners are aware of needles tick/ sharps injury protocol';
            $header[$j++] = 'Housekeeper is educated in cleaning techniques using separate cleaning supplies for regular cleaning, for bathrooms and for isolation rooms';


            $header[$j++] = 'Additional comments';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['audit_type'] = $data['audit_type'];
                $dataexport[$i]['date'] = date('Y-m-d H:i', strtotime($row->datetime));
                $dataexport[$i]['audit_by'] = $data['audit_by'];

                $dataexport[$i]['mid_no'] = $data['mid_no'];
                $dataexport[$i]['patient_name'] = $data['patient_name'];
                $dataexport[$i]['patient_age'] = $data['patient_age'];
                $dataexport[$i]['patient_gender'] = $data['patient_gender'];
                $dataexport[$i]['location'] = $data['location'];
                $dataexport[$i]['department'] = $data['department'];
                $dataexport[$i]['attended_doctor'] = $data['attended_doctor'];
                $dataexport[$i]['initial_assessment_hr6'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr6']));
                $dataexport[$i]['discharge_date_time'] = date('Y-m-d H:i', strtotime($data['discharge_date_time']));


                $dataexport[$i]['identification_details'] = ucfirst($data['identification_details']) . "\r\nRemarks: " . $data['identification_details_text'];
                $dataexport[$i]['vital_signs'] = ucfirst($data['vital_signs']) . "\r\nRemarks: " . $data['vital_signs_text'];
                $dataexport[$i]['surgery'] = ucfirst($data['surgery']) . "\r\nRemarks: " . $data['surgery_text'];
                $dataexport[$i]['complaints_communicated'] = ucfirst($data['complaints_communicated']) . "\r\nRemarks: " . $data['complaints_communicated_text'];
                $dataexport[$i]['intake'] = ucfirst($data['intake']) . "\r\nRemarks: " . $data['intake_text'];
                $dataexport[$i]['output'] = ucfirst($data['output']) . "\r\nRemarks: " . $data['output_text'];
                $dataexport[$i]['focus'] = ucfirst($data['focus']) . "\r\nRemarks: " . $data['focus_text'];
                $dataexport[$i]['meti'] = ucfirst($data['meti']) . "\r\nRemarks: " . $data['meti_text'];
                $dataexport[$i]['diagnostic'] = ucfirst($data['diagnostic']) . "\r\nRemarks: " . $data['diagnostic_text'];
                $dataexport[$i]['lab_results'] = ucfirst($data['lab_results']) . "\r\nRemarks: " . $data['lab_results_text'];
                $dataexport[$i]['pending_investigation'] = ucfirst($data['pending_investigation']) . "\r\nRemarks: " . $data['pending_investigation_text'];
                $dataexport[$i]['food'] = ucfirst($data['food']) . "\r\nRemarks: " . $data['food_text'];
                $dataexport[$i]['medicine_order'] = ucfirst($data['medicine_order']) . "\r\nRemarks: " . $data['medicine_order_text'];
                $dataexport[$i]['psychological'] = ucfirst($data['psychological']) . "\r\nRemarks: " . $data['psychological_text'];
                $dataexport[$i]['vulnerab'] = ucfirst($data['vulnerab']) . "\r\nRemarks: " . $data['vulnerab_text'];
                $dataexport[$i]['social'] = ucfirst($data['social']) . "\r\nRemarks: " . $data['social_text'];
                $dataexport[$i]['needle'] = ucfirst($data['needle']) . "\r\nRemarks: " . $data['needle_text'];
                $dataexport[$i]['nutri'] = ucfirst($data['nutri']) . "\r\nRemarks: " . $data['nutri_text'];
                $dataexport[$i]['spiritual'] = ucfirst($data['spiritual']) . "\r\nRemarks: " . $data['spiritual_text'];
                $dataexport[$i]['suicide'] = ucfirst($data['suicide']) . "\r\nRemarks: " . $data['suicide_text'];
                $dataexport[$i]['risk'] = ucfirst($data['risk']) . "\r\nRemarks: " . $data['risk_text'];
                $dataexport[$i]['care'] = ucfirst($data['care']) . "\r\nRemarks: " . $data['care_text'];
                $dataexport[$i]['pfe'] = ucfirst($data['pfe']) . "\r\nRemarks: " . $data['pfe_text'];
                $dataexport[$i]['disch'] = ucfirst($data['disch']) . "\r\nRemarks: " . $data['disch_text'];
                $dataexport[$i]['facility_communicated'] = ucfirst($data['facility_communicated']) . "\r\nRemarks: " . $data['facility_communicated_text'];
                $dataexport[$i]['health_education'] = ucfirst($data['health_education']) . "\r\nRemarks: " . $data['health_education_text'];
                $dataexport[$i]['remarks1'] = ucfirst($data['remarks1']) . "\r\nRemarks: " . $data['remarks1_text'];
                $dataexport[$i]['urethral'] = ucfirst($data['urethral']) . "\r\nRemarks: " . $data['urethral_text'];
                $dataexport[$i]['urine_sample'] = ucfirst($data['urine_sample']) . "\r\nRemarks: " . $data['urine_sample_text'];
                $dataexport[$i]['bystander'] = ucfirst($data['bystander']) . "\r\nRemarks: " . $data['bystander_text'];
                $dataexport[$i]['instruments'] = ucfirst($data['instruments']) . "\r\nRemarks: " . $data['instruments_text'];
                $dataexport[$i]['sterile'] = ucfirst($data['sterile']) . "\r\nRemarks: " . $data['sterile_text'];
                $dataexport[$i]['antibiotics'] = ucfirst($data['antibiotics']) . "\r\nRemarks: " . $data['antibiotics_text'];
                $dataexport[$i]['surgical_site'] = ucfirst($data['surgical_site']) . "\r\nRemarks: " . $data['surgical_site_text'];
                $dataexport[$i]['wound'] = ucfirst($data['wound']) . "\r\nRemarks: " . $data['wound_text'];
                $dataexport[$i]['documented'] = ucfirst($data['documented']) . "\r\nRemarks: " . $data['documented_text'];
                $dataexport[$i]['adequate_facilities'] = ucfirst($data['adequate_facilities']) . "\r\nRemarks: " . $data['adequate_facilities_text'];



                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];


                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- Laboratory PCI Audit - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function overall_infection_control_mortuary_audit()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_ma_infection_control_mortuary_audit';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->audit_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Audit Name';
            $header[1] = 'Date & Time of Audit';
            $header[2] = 'Audit by';
            $header[3] = 'Patient MID';
            $header[4] = 'Patient Name';
            $header[5] = 'Patient Age';
            $header[6] = 'Patient Gender';

            $j = 7;

            $header[$j++] = 'Area';
            $header[$j++] = 'Department';
            $header[$j++] = 'Attended Doctor';
            $header[$j++] = 'Admission Date & Time';
            $header[$j++] = 'Discharge Date & Time';

            $header[$j++] = 'Refrigerator temperature 2-8°C';
            $header[$j++] = 'Well ventilated room, designed so that cleaning is easily carried out and fly proofing is there';
            $header[$j++] = 'Mortuary staff is informed of patients who have died from and was suffering of communicable disease. Warning label is attached to them';
            $header[$j++] = 'Hand washing facility available with microbial soap and tissue paper dispensers';
            $header[$j++] = 'Mortuary staff should wear gloves, rubber boots and gown – when in contact with dead body. Hands to be washed after removing the gloves';
            $header[$j++] = 'If eyes are splashed, it should be thoroughly washed';
            $header[$j++] = 'Daily cleaning and periodic disinfection (using floor disinfectant and surface disinfectant)';
            $header[$j++] = 'There are adequate color-coded foot-operated waste bins for regular and infectious waste. Bins are labeled';
            $header[$j++] = 'There are adequate sinks available for hand washing';
            $header[$j++] = 'All PPE are readily available to use';


            $header[$j++] = 'Additional comments';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['audit_type'] = $data['audit_type'];
                $dataexport[$i]['date'] = date('Y-m-d H:i', strtotime($row->datetime));
                $dataexport[$i]['audit_by'] = $data['audit_by'];

                $dataexport[$i]['mid_no'] = $data['mid_no'];
                $dataexport[$i]['patient_name'] = $data['patient_name'];
                $dataexport[$i]['patient_age'] = $data['patient_age'];
                $dataexport[$i]['patient_gender'] = $data['patient_gender'];
                $dataexport[$i]['location'] = $data['location'];
                $dataexport[$i]['department'] = $data['department'];
                $dataexport[$i]['attended_doctor'] = $data['attended_doctor'];
                $dataexport[$i]['initial_assessment_hr6'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr6']));
                $dataexport[$i]['discharge_date_time'] = date('Y-m-d H:i', strtotime($data['discharge_date_time']));


                $dataexport[$i]['identification_details'] = ucfirst($data['identification_details']) . "\r\nRemarks: " . $data['identification_details_text'];
                $dataexport[$i]['vital_signs'] = ucfirst($data['vital_signs']) . "\r\nRemarks: " . $data['vital_signs_text'];
                $dataexport[$i]['surgery'] = ucfirst($data['surgery']) . "\r\nRemarks: " . $data['surgery_text'];
                $dataexport[$i]['complaints_communicated'] = ucfirst($data['complaints_communicated']) . "\r\nRemarks: " . $data['complaints_communicated_text'];
                $dataexport[$i]['intake'] = ucfirst($data['intake']) . "\r\nRemarks: " . $data['intake_text'];
                $dataexport[$i]['output'] = ucfirst($data['output']) . "\r\nRemarks: " . $data['output_text'];
                $dataexport[$i]['allergies'] = ucfirst($data['allergies']) . "\r\nRemarks: " . $data['allergies_text'];
                $dataexport[$i]['medication'] = ucfirst($data['medication']) . "\r\nRemarks: " . $data['medication_text'];
                $dataexport[$i]['diagnostic'] = ucfirst($data['diagnostic']) . "\r\nRemarks: " . $data['diagnostic_text'];
                $dataexport[$i]['lab_results'] = ucfirst($data['lab_results']) . "\r\nRemarks: " . $data['lab_results_text'];



                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];


                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- Mortuary PCI Audit - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function overall_infection_control_radiology_audit()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_ma_infection_control_radiology_audit';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->audit_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Audit Name';
            $header[1] = 'Date & Time of Audit';
            $header[2] = 'Audit by';
            $header[3] = 'Patient MID';
            $header[4] = 'Patient Name';
            $header[5] = 'Patient Age';
            $header[6] = 'Patient Gender';

            $j = 7;

            $header[$j++] = 'Area';
            $header[$j++] = 'Department';
            $header[$j++] = 'Attended Doctor';
            $header[$j++] = 'Admission Date & Time';
            $header[$j++] = 'Discharge Date & Time';

            $header[$j++] = 'Employees apply standard precautions when providing patient care';
            $header[$j++] = 'All areas are clean and tidy';
            $header[$j++] = 'All staffs receive infection control orientation when hired and on an annual basis';
            $header[$j++] = 'Furniture is made of cleanable material such as vinyl and is intact';
            $header[$j++] = 'Under sink areas are free from supplies';
            $header[$j++] = 'Eating and drinking is not allowed except in designated areas';
            $header[$j++] = 'Pillows and mattresses are covered with a cleanable material such as vinyl and are intact';
            $header[$j++] = 'There is adequate sinks available for hand washing, one in each X-ray room';
            $header[$j++] = 'There is approved alcohol-based hand rub if sink is not available';
            $header[$j++] = 'All personnel protective equipment is readily available to all staff';
            $header[$j++] = 'Staff is able to verbalize the meaning of standard precautions';
            $header[$j++] = 'Personal protective equipment is not worn outside patient areas';
            $header[$j++] = 'There is color-coded foot –operated waste bins for regular and infectious waste. Bins are labeled';
            $header[$j++] = 'Waste bins are not over-filled';
            $header[$j++] = 'There is regular removal of waste';
            $header[$j++] = 'There are adequate puncture resistant leak-proof sharp containers available. These should be wall mounted';
            $header[$j++] = 'Sharp containers are emptied when they are three quarters (3/4) full';
            $header[$j++] = 'Staff is able to verbalize what to do following a needle stick/sharps injury';
            $header[$j++] = 'There is a segregated area for clean/sterile supplies';
            $header[$j++] = 'There is a segregated area for dirty/soiled utility';
            $header[$j++] = 'Clean/sterile supplies are stored properly (no cardboard boxes)';
            $header[$j++] = 'Appropriate measures are taken if temperature in medication refrigerators/ freezers is out of range';
            $header[$j++] = 'Environmental surface are disinfected beginning and end of day and in between patients';
            $header[$j++] = 'Lead aprons and thyroid shields are clean and tidy';
            $header[$j++] = 'Ultrasound props are properly disinfected in between patients';
            $header[$j++] = 'There is adequate covered linen storage and disposal hampers';
            $header[$j++] = 'Bed linen is changed between patients';
            $header[$j++] = 'Infected is put in leak proof laundry bags';
            $header[$j++] = 'There is adequate housekeeping storage';
            $header[$j++] = 'Blood spill kit is available';
            $header[$j++] = 'There are written policies and procedures for cleaning blood spills';
            $header[$j++] = 'Person responsible for blood spill cleanup has adequate training and proper PPE for procedures';
            $header[$j++] = 'There is proper personnel protective equipment available for clean-up blood spill';
            $header[$j++] = 'Cleaners are aware of needles tick/ sharps injury protocol';



            $header[$j++] = 'Additional comments';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['audit_type'] = $data['audit_type'];
                $dataexport[$i]['date'] = date('Y-m-d H:i', strtotime($row->datetime));
                $dataexport[$i]['audit_by'] = $data['audit_by'];

                $dataexport[$i]['mid_no'] = $data['mid_no'];
                $dataexport[$i]['patient_name'] = $data['patient_name'];
                $dataexport[$i]['patient_age'] = $data['patient_age'];
                $dataexport[$i]['patient_gender'] = $data['patient_gender'];
                $dataexport[$i]['location'] = $data['location'];
                $dataexport[$i]['department'] = $data['department'];
                $dataexport[$i]['attended_doctor'] = $data['attended_doctor'];
                $dataexport[$i]['initial_assessment_hr6'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr6']));
                $dataexport[$i]['discharge_date_time'] = date('Y-m-d H:i', strtotime($data['discharge_date_time']));


                $dataexport[$i]['identification_details'] = ucfirst($data['identification_details']) . "\r\nRemarks: " . $data['identification_details_text'];
                $dataexport[$i]['vital_signs'] = ucfirst($data['vital_signs']) . "\r\nRemarks: " . $data['vital_signs_text'];
                $dataexport[$i]['surgery'] = ucfirst($data['surgery']) . "\r\nRemarks: " . $data['surgery_text'];
                $dataexport[$i]['complaints_communicated'] = ucfirst($data['complaints_communicated']) . "\r\nRemarks: " . $data['complaints_communicated_text'];
                $dataexport[$i]['intake'] = ucfirst($data['intake']) . "\r\nRemarks: " . $data['intake_text'];
                $dataexport[$i]['output'] = ucfirst($data['output']) . "\r\nRemarks: " . $data['output_text'];
                $dataexport[$i]['focus'] = ucfirst($data['focus']) . "\r\nRemarks: " . $data['focus_text'];
                $dataexport[$i]['meti'] = ucfirst($data['meti']) . "\r\nRemarks: " . $data['meti_text'];
                $dataexport[$i]['diagnostic'] = ucfirst($data['diagnostic']) . "\r\nRemarks: " . $data['diagnostic_text'];
                $dataexport[$i]['lab_results'] = ucfirst($data['lab_results']) . "\r\nRemarks: " . $data['lab_results_text'];
                $dataexport[$i]['pending_investigation'] = ucfirst($data['pending_investigation']) . "\r\nRemarks: " . $data['pending_investigation_text'];
                $dataexport[$i]['medicine_order'] = ucfirst($data['medicine_order']) . "\r\nRemarks: " . $data['medicine_order_text'];
                $dataexport[$i]['psychological'] = ucfirst($data['psychological']) . "\r\nRemarks: " . $data['psychological_text'];
                $dataexport[$i]['vulnerab'] = ucfirst($data['vulnerab']) . "\r\nRemarks: " . $data['vulnerab_text'];
                $dataexport[$i]['social'] = ucfirst($data['social']) . "\r\nRemarks: " . $data['social_text'];
                $dataexport[$i]['nutri'] = ucfirst($data['nutri']) . "\r\nRemarks: " . $data['nutri_text'];
                $dataexport[$i]['spiritual'] = ucfirst($data['spiritual']) . "\r\nRemarks: " . $data['spiritual_text'];
                $dataexport[$i]['suicide'] = ucfirst($data['suicide']) . "\r\nRemarks: " . $data['suicide_text'];
                $dataexport[$i]['risk'] = ucfirst($data['risk']) . "\r\nRemarks: " . $data['risk_text'];
                $dataexport[$i]['care'] = ucfirst($data['care']) . "\r\nRemarks: " . $data['care_text'];
                $dataexport[$i]['pfe'] = ucfirst($data['pfe']) . "\r\nRemarks: " . $data['pfe_text'];
                $dataexport[$i]['disch'] = ucfirst($data['disch']) . "\r\nRemarks: " . $data['disch_text'];
                $dataexport[$i]['facility_communicated'] = ucfirst($data['facility_communicated']) . "\r\nRemarks: " . $data['facility_communicated_text'];
                $dataexport[$i]['health_education'] = ucfirst($data['health_education']) . "\r\nRemarks: " . $data['health_education_text'];
                $dataexport[$i]['remarks1'] = ucfirst($data['remarks1']) . "\r\nRemarks: " . $data['remarks1_text'];
                $dataexport[$i]['urethral'] = ucfirst($data['urethral']) . "\r\nRemarks: " . $data['urethral_text'];
                $dataexport[$i]['urine_sample'] = ucfirst($data['urine_sample']) . "\r\nRemarks: " . $data['urine_sample_text'];
                $dataexport[$i]['bystander'] = ucfirst($data['bystander']) . "\r\nRemarks: " . $data['bystander_text'];
                $dataexport[$i]['instruments'] = ucfirst($data['instruments']) . "\r\nRemarks: " . $data['instruments_text'];
                $dataexport[$i]['sterile'] = ucfirst($data['sterile']) . "\r\nRemarks: " . $data['sterile_text'];
                $dataexport[$i]['antibiotics'] = ucfirst($data['antibiotics']) . "\r\nRemarks: " . $data['antibiotics_text'];
                $dataexport[$i]['surgical_site'] = ucfirst($data['surgical_site']) . "\r\nRemarks: " . $data['surgical_site_text'];
                $dataexport[$i]['wound'] = ucfirst($data['wound']) . "\r\nRemarks: " . $data['wound_text'];
                $dataexport[$i]['documented'] = ucfirst($data['documented']) . "\r\nRemarks: " . $data['documented_text'];

                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];


                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- Radiology PCI Audit - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function overall_infection_control_ssi_survelliance_audit()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_ma_infection_control_ssi_survelliance_audit';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->audit_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Audit Name';
            $header[1] = 'Date & Time of Audit';
            $header[2] = 'Audit by';
            $header[3] = 'Patient MID';
            $header[4] = 'Patient Name';
            $header[5] = 'Patient Age';
            $header[6] = 'Patient Gender';

            $j = 7;

            $header[$j++] = 'Area';
            $header[$j++] = 'Department';
            $header[$j++] = 'Attended Doctor';
            $header[$j++] = 'Admission Date & Time';
            $header[$j++] = 'Discharge Date & Time';

            $header[$j++] = 'Topical Chlorhexidine bath given';
            $header[$j++] = 'Applied Mupirocin ointment in topical areas';
            $header[$j++] = 'Blood sugar maintained pre-op < 180mg/dl';
            $header[$j++] = 'Evidence of pre-op infection : If yes to above, what is the site of infection';
            $header[$j++] = 'Time of skin incision';
            $header[$j++] = 'Class of surgery';
            $header[$j++] = 'Wound surveillance';
            $header[$j++] = 'Antibiotic prophylaxis';
            $header[$j++] = 'Has the ward staff educated patient/relatives on the care of the surgical wound';


            $header[$j++] = 'Additional comments';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['audit_type'] = $data['audit_type'];
                $dataexport[$i]['date'] = date('Y-m-d H:i', strtotime($row->datetime));
                $dataexport[$i]['audit_by'] = $data['audit_by'];

                $dataexport[$i]['mid_no'] = $data['mid_no'];
                $dataexport[$i]['patient_name'] = $data['patient_name'];
                $dataexport[$i]['patient_age'] = $data['patient_age'];
                $dataexport[$i]['patient_gender'] = $data['patient_gender'];
                $dataexport[$i]['location'] = $data['location'];
                $dataexport[$i]['department'] = $data['department'];
                $dataexport[$i]['attended_doctor'] = $data['attended_doctor'];
                $dataexport[$i]['initial_assessment_hr6'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr6']));
                $dataexport[$i]['discharge_date_time'] = date('Y-m-d H:i', strtotime($data['discharge_date_time']));


                $dataexport[$i]['identification_details'] = ucfirst($data['identification_details']) . "\r\nRemarks: " . $data['identification_details_text'];
                $dataexport[$i]['vital_signs'] = ucfirst($data['vital_signs']) . "\r\nRemarks: " . $data['vital_signs_text'];
                $dataexport[$i]['surgery'] = ucfirst($data['surgery']) . "\r\nRemarks: " . $data['surgery_text'];
                $dataexport[$i]['complaints_communicated'] = ucfirst($data['complaints_communicated']) . "\r\nRemarks: " . $data['complaints_communicated_text'];
                $dataexport[$i]['intake'] = ucfirst($data['intake']) . "\r\nRemarks: " . $data['intake_text'];
                $dataexport[$i]['output'] = ucfirst($data['output']) . "\r\nRemarks: " . $data['output_text'];
                $dataexport[$i]['allergies'] = ucfirst($data['allergies']) . "\r\nRemarks: " . $data['allergies_text'];
                $dataexport[$i]['medication'] = ucfirst($data['medication']) . "\r\nRemarks: " . $data['medication_text'];
                $dataexport[$i]['diagnostic'] = ucfirst($data['diagnostic']) . "\r\nRemarks: " . $data['diagnostic_text'];

                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];


                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- SSI Surveillance checklist - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function overall_infection_control_peripheralivline_audit()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_ma_infection_control_peripheralivline_audit';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->audit_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Audit Name';
            $header[1] = 'Date & Time of Audit';
            $header[2] = 'Audit by';
            $header[3] = 'Patient MID';
            $header[4] = 'Patient Name';
            $header[5] = 'Patient Age';
            $header[6] = 'Patient Gender';

            $j = 7;

            $header[$j++] = 'Area';
            $header[$j++] = 'Department';
            $header[$j++] = 'Attended Doctor';
            $header[$j++] = 'Admission Date & Time';
            $header[$j++] = 'Discharge Date & Time';

            $header[$j++] = 'Is the need of keeping the I.V. access site clean and dry explained';
            $header[$j++] = 'Are Signs of phlebitis monitored';
            $header[$j++] = 'Is Dressing secured properly';
            $header[$j++] = 'Dressings dry, intact and clean';
            $header[$j++] = 'Are Closed system principle applied';
            $header[$j++] = 'Is Line flushed in each shift for unused IV line & after each use';
            $header[$j++] = 'Are there No visible blood or blood stains in the extension';
            $header[$j++] = 'Are IV site assessment documented as per policy';
            $header[$j++] = 'Are Removal of IV recorded';
            $header[$j++] = 'Are No. of attempts for Cannulation documented';

            $header[$j++] = 'Additional comments';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['audit_type'] = $data['audit_type'];
                $dataexport[$i]['date'] = date('Y-m-d H:i', strtotime($row->datetime));
                $dataexport[$i]['audit_by'] = $data['audit_by'];

                $dataexport[$i]['mid_no'] = $data['mid_no'];
                $dataexport[$i]['patient_name'] = $data['patient_name'];
                $dataexport[$i]['patient_age'] = $data['patient_age'];
                $dataexport[$i]['patient_gender'] = $data['patient_gender'];
                $dataexport[$i]['location'] = $data['location'];
                $dataexport[$i]['department'] = $data['department'];
                $dataexport[$i]['attended_doctor'] = $data['attended_doctor'];
                $dataexport[$i]['initial_assessment_hr6'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr6']));
                $dataexport[$i]['discharge_date_time'] = date('Y-m-d H:i', strtotime($data['discharge_date_time']));


                $dataexport[$i]['identification_details'] = ucfirst($data['identification_details']) . "\r\nRemarks: " . $data['identification_details_text'];
                $dataexport[$i]['vital_signs'] = ucfirst($data['vital_signs']) . "\r\nRemarks: " . $data['vital_signs_text'];
                $dataexport[$i]['surgery'] = ucfirst($data['surgery']) . "\r\nRemarks: " . $data['surgery_text'];
                $dataexport[$i]['complaints_communicated'] = ucfirst($data['complaints_communicated']) . "\r\nRemarks: " . $data['complaints_communicated_text'];
                $dataexport[$i]['intake'] = ucfirst($data['intake']) . "\r\nRemarks: " . $data['intake_text'];
                $dataexport[$i]['output'] = ucfirst($data['output']) . "\r\nRemarks: " . $data['output_text'];
                $dataexport[$i]['allergies'] = ucfirst($data['allergies']) . "\r\nRemarks: " . $data['allergies_text'];
                $dataexport[$i]['medication'] = ucfirst($data['medication']) . "\r\nRemarks: " . $data['medication_text'];
                $dataexport[$i]['diagnostic'] = ucfirst($data['diagnostic']) . "\r\nRemarks: " . $data['diagnostic_text'];
                $dataexport[$i]['lab_results'] = ucfirst($data['lab_results']) . "\r\nRemarks: " . $data['lab_results_text'];

                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];


                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- IV Cannula Audit - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function overall_infection_control_personalprotective_audit()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_ma_infection_control_personalprotective_audit';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->audit_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Audit Name';
            $header[1] = 'Date & Time of Audit';
            $header[2] = 'Audit by';
            $header[3] = 'Patient MID';
            $header[4] = 'Patient Name';
            $header[5] = 'Patient Age';
            $header[6] = 'Patient Gender';

            $j = 7;

            $header[$j++] = 'Area';
            $header[$j++] = 'Department';
            $header[$j++] = 'Attended Doctor';
            $header[$j++] = 'Admission Date & Time';
            $header[$j++] = 'Discharge Date & Time';

            $header[$j++] = 'Are Nurses wearing appropriate PPE while doing & assisting for aseptic procedures (Cap, Mask, Apron, Gloves)';
            $header[$j++] = 'Are Doctors wearing appropriate PPE while doing aseptic procedures (Cap, Mask, Apron, Gloves)';
            $header[$j++] = 'Are Physiotherapists wearing appropriate PPE (Mask, Apron, Gloves) during the procedures';
            $header[$j++] = 'Are Technicians (X-ray, Echo) wearing appropriate PPE (Gloves, Mask, Apron) during the procedures';
            $header[$j++] = 'Are House-keeping staff wearing appropriate PPE while cleaning & removing BM (Hard Gloves, Mask, Cap, Shoes)';

            $header[$j++] = 'Additional comments';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['audit_type'] = $data['audit_type'];
                $dataexport[$i]['date'] = date('Y-m-d H:i', strtotime($row->datetime));
                $dataexport[$i]['audit_by'] = $data['audit_by'];

                $dataexport[$i]['mid_no'] = $data['mid_no'];
                $dataexport[$i]['patient_name'] = $data['patient_name'];
                $dataexport[$i]['patient_age'] = $data['patient_age'];
                $dataexport[$i]['patient_gender'] = $data['patient_gender'];
                $dataexport[$i]['location'] = $data['location'];
                $dataexport[$i]['department'] = $data['department'];
                $dataexport[$i]['attended_doctor'] = $data['attended_doctor'];
                $dataexport[$i]['initial_assessment_hr6'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr6']));
                $dataexport[$i]['discharge_date_time'] = date('Y-m-d H:i', strtotime($data['discharge_date_time']));


                $dataexport[$i]['identification_details'] = ucfirst($data['identification_details']) . "\r\nRemarks: " . $data['identification_details_text'];
                $dataexport[$i]['vital_signs'] = ucfirst($data['vital_signs']) . "\r\nRemarks: " . $data['vital_signs_text'];
                $dataexport[$i]['surgery'] = ucfirst($data['surgery']) . "\r\nRemarks: " . $data['surgery_text'];
                $dataexport[$i]['complaints_communicated'] = ucfirst($data['complaints_communicated']) . "\r\nRemarks: " . $data['complaints_communicated_text'];
                $dataexport[$i]['intake'] = ucfirst($data['intake']) . "\r\nRemarks: " . $data['intake_text'];
                $dataexport[$i]['output'] = ucfirst($data['output']) . "\r\nRemarks: " . $data['output_text'];

                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];


                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- Personal Protective Equipment Usage audit - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function overall_infection_control_safe_injection_audit()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_ma_infection_control_safe_injection_audit';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->audit_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Audit Name';
            $header[1] = 'Date & Time of Audit';
            $header[2] = 'Audit by';
            $header[3] = 'Patient MID';
            $header[4] = 'Patient Name';
            $header[5] = 'Patient Age';
            $header[6] = 'Patient Gender';

            $j = 7;

            $header[$j++] = 'Area';
            $header[$j++] = 'Department';
            $header[$j++] = 'Attended Doctor';
            $header[$j++] = 'Admission Date & Time';
            $header[$j++] = 'Discharge Date & Time';

            $header[$j++] = 'Is Hand hygiene performed (soap/water or hand sanitizer) prior to accessing supplies, handling vials and IV solutions, and preparing or administering medications';
            $header[$j++] = 'Are Disposable gloves worn according to Meitra policy/procedure';
            $header[$j++] = 'Are Medications and supplies stored and prepared in a clean area on a clean surface';
            $header[$j++] = 'Is it ensured that needles and syringes are stored in their original packaging/wrapper (not stored unwrapped)';
            $header[$j++] = 'Is the skin at the injection/insertion site prepared with appropriate antiseptic and allowed to dry';
            $header[$j++] = 'Is it ensured that the injection site is not touched after skin antisepsis';
            $header[$j++] = 'Are Sterile, single use syringes always used for any type of injection or infusion';
            $header[$j++] = 'Are Needles, cannulas and syringes always used as single use and never re-used on other patients or to access medications/solutions more than once';
            $header[$j++] = 'Are Medications never administered from the same syringe or needle to more than one patient';
            $header[$j++] = 'Is it ensured that the sterile needle/cannula and/or syringe is removed from the packaging just prior to use';
            $header[$j++] = 'Are Single-use or single-dose vials used whenever possible and discarded after one use';
            $header[$j++] = 'Is entry into a medication vial always done with a new needle or cannula and syringe';
            $header[$j++] = 'Are the rubber septum/diaphragm of medication vials always cleansed using friction with alcohol prior to each entry';
            $header[$j++] = 'Are Multi-dose vials dated when first opened and discarded within 28 days or according to manufacturer recommendations';
            $header[$j++] = 'Is it ensured that left over parenteral medications are never pooled or combined for later use';
            $header[$j++] = 'Is it ensured that needles and cannulas are never left inserted in any vial rubber septum for multiple withdrawals';
            $header[$j++] = 'Pre-drawing of medications';
            $header[$j++] = 'Are Medication vials inspected prior to use and discarded if sterility compromised';
            $header[$j++] = 'Is it ensured that bags/bottles of IV solutions are never used as common source supply for more than one patient';
            $header[$j++] = 'Is it ensured that infusion supplies such as needles, syringes, flush solutions, administration sets, IV fluids are never used for more than one patient';
            $header[$j++] = 'Is it ensured that there is restricted use of finger stick capillary blood sampling devices to individual patients';
            $header[$j++] = 'Are single-use lancets that permanently retract upon puncture used and never reused';
            $header[$j++] = 'Is it ensured that pen style devices with removable lancet are dedicated to one patient';
            $header[$j++] = 'Is it ensured that the exterior surface of glucometer are cleaned and disinfected after each use with EPA approved disinfectant';
            $header[$j++] = 'Are Needles/sharps disposed of at the point of use and containers conveniently located';
            $header[$j++] = 'Are Sharps disposal containers leak-proof, puncture-resistant and labeled with a biohazard label';
            $header[$j++] = 'Are Sharps containers emptied/replaced when 2/3 full or when the level is reached';
            $header[$j++] = 'Are sharps containers either wall mounted or otherwise stabilized so they will not tip over';
            $header[$j++] = 'Are sharps safety devices used where possible and activated immediately after use prior to disposal';


            $header[$j++] = 'Additional comments';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['audit_type'] = $data['audit_type'];
                $dataexport[$i]['date'] = date('Y-m-d H:i', strtotime($row->datetime));
                $dataexport[$i]['audit_by'] = $data['audit_by'];

                $dataexport[$i]['mid_no'] = $data['mid_no'];
                $dataexport[$i]['patient_name'] = $data['patient_name'];
                $dataexport[$i]['patient_age'] = $data['patient_age'];
                $dataexport[$i]['patient_gender'] = $data['patient_gender'];
                $dataexport[$i]['location'] = $data['location'];
                $dataexport[$i]['department'] = $data['department'];
                $dataexport[$i]['attended_doctor'] = $data['attended_doctor'];
                $dataexport[$i]['initial_assessment_hr6'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr6']));
                $dataexport[$i]['discharge_date_time'] = date('Y-m-d H:i', strtotime($data['discharge_date_time']));


                $dataexport[$i]['identification_details'] = ucfirst($data['identification_details']) . "\r\nRemarks: " . $data['identification_details_text'];
                $dataexport[$i]['vital_signs'] = ucfirst($data['vital_signs']) . "\r\nRemarks: " . $data['vital_signs_text'];
                $dataexport[$i]['surgery'] = ucfirst($data['surgery']) . "\r\nRemarks: " . $data['surgery_text'];
                $dataexport[$i]['complaints_communicated'] = ucfirst($data['complaints_communicated']) . "\r\nRemarks: " . $data['complaints_communicated_text'];
                $dataexport[$i]['intake'] = ucfirst($data['intake']) . "\r\nRemarks: " . $data['intake_text'];
                $dataexport[$i]['output'] = ucfirst($data['output']) . "\r\nRemarks: " . $data['output_text'];
                $dataexport[$i]['allergies'] = ucfirst($data['allergies']) . "\r\nRemarks: " . $data['allergies_text'];

                $dataexport[$i]['medication'] = ucfirst($data['medication']) . "\r\nRemarks: " . $data['medication_text'];
                $dataexport[$i]['diagnostic'] = ucfirst($data['diagnostic']) . "\r\nRemarks: " . $data['diagnostic_text'];
                $dataexport[$i]['lab_results'] = ucfirst($data['lab_results']) . "\r\nRemarks: " . $data['lab_results_text'];
                $dataexport[$i]['pending_investigation'] = ucfirst($data['pending_investigation']) . "\r\nRemarks: " . $data['pending_investigation_text'];
                $dataexport[$i]['medicine_order'] = ucfirst($data['medicine_order']) . "\r\nRemarks: " . $data['medicine_order_text'];
                $dataexport[$i]['facility_communicated'] = ucfirst($data['facility_communicated']) . "\r\nRemarks: " . $data['facility_communicatedr_text'];
                $dataexport[$i]['health_education'] = ucfirst($data['health_education']) . "\r\nRemarks: " . $data['health_education_text'];
                $dataexport[$i]['risk_assessment'] = ucfirst($data['risk_assessment']) . "\r\nRemarks: " . $data['risk_assessment_text'];
                $dataexport[$i]['urethral'] = ucfirst($data['urethral']) . "\r\nRemarks: " . $data['urethral_text'];
                $dataexport[$i]['urine_sample'] = ucfirst($data['urine_sample']) . "\r\nRemarks: " . $data['urine_sample_text'];
                $dataexport[$i]['bystander'] = ucfirst($data['bystander']) . "\r\nRemarks: " . $data['bystander_text'];
                $dataexport[$i]['instruments'] = ucfirst($data['instruments']) . "\r\nRemarks: " . $data['instruments_text'];
                $dataexport[$i]['sterile'] = ucfirst($data['sterile']) . "\r\nRemarks: " . $data['sterile_text'];
                $dataexport[$i]['antibiotics'] = ucfirst($data['antibiotics']) . "\r\nRemarks: " . $data['antibiotics_text'];
                $dataexport[$i]['surgical_site'] = ucfirst($data['surgical_site']) . "\r\nRemarks: " . $data['surgical_site_text'];
                $dataexport[$i]['wound'] = ucfirst($data['wound']) . "\r\nRemarks: " . $data['wound_text'];
                $dataexport[$i]['documented'] = ucfirst($data['documented']) . "\r\nRemarks: " . $data['documented_text'];
                $dataexport[$i]['adequate_facilities'] = ucfirst($data['adequate_facilities']) . "\r\nRemarks: " . $data['adequate_facilities_text'];
                $dataexport[$i]['sufficient_lighting'] = ucfirst($data['sufficient_lighting']) . "\r\nRemarks: " . $data['sufficient_lighting_text'];
                $dataexport[$i]['storage_facility_for_food'] = ucfirst($data['storage_facility_for_food']) . "\r\nRemarks: " . $data['storage_facility_for_food_text'];
                $dataexport[$i]['personnel_hygiene_facilities'] = ucfirst($data['personnel_hygiene_facilities']) . "\r\nRemarks: " . $data['personnel_hygiene_facilities_text'];
                $dataexport[$i]['food_material_testing'] = ucfirst($data['food_material_testing']) . "\r\nRemarks: " . $data['food_material_testing_text'];


                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];


                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- Safe Injection and Infusion Audit - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function overall_infection_control_surface_cleaning_audit()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_ma_infection_control_surface_cleaning_audit';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->audit_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Audit Name';
            $header[1] = 'Date & Time of Audit';
            $header[2] = 'Audit by';
            $header[3] = 'Patient MID';
            $header[4] = 'Patient Name';
            $header[5] = 'Patient Age';
            $header[6] = 'Patient Gender';

            $j = 7;

            $header[$j++] = 'Area';
            $header[$j++] = 'Department';
            $header[$j++] = 'Attended Doctor';
            $header[$j++] = 'Admission Date & Time';
            $header[$j++] = 'Discharge Date & Time';

            $header[$j++] = 'Are Housekeeping Staff Aware about disinfectant solution Dilution';
            $header[$j++] = 'Is the Effectiveness of cleaning & disinfection adequate';

            $header[$j++] = 'Additional comments';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['audit_type'] = $data['audit_type'];
                $dataexport[$i]['date'] = date('Y-m-d H:i', strtotime($row->datetime));
                $dataexport[$i]['audit_by'] = $data['audit_by'];

                $dataexport[$i]['mid_no'] = $data['mid_no'];
                $dataexport[$i]['patient_name'] = $data['patient_name'];
                $dataexport[$i]['patient_age'] = $data['patient_age'];
                $dataexport[$i]['patient_gender'] = $data['patient_gender'];
                $dataexport[$i]['location'] = $data['location'];
                $dataexport[$i]['department'] = $data['department'];
                $dataexport[$i]['attended_doctor'] = $data['attended_doctor'];
                $dataexport[$i]['initial_assessment_hr6'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr6']));
                $dataexport[$i]['discharge_date_time'] = date('Y-m-d H:i', strtotime($data['discharge_date_time']));


                $dataexport[$i]['identification_details'] = ucfirst($data['identification_details']) . "\r\nRemarks: " . $data['identification_details_text'];
                $dataexport[$i]['vital_signs'] = ucfirst($data['vital_signs']) . "\r\nRemarks: " . $data['vital_signs_text'];

                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];


                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- Surface cleaning & Disinfection effectiveness monitoring record - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function overall_clinical_pathway_arthroscopic_audit()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_ma_clinical_pathway_arthroscopic_audit';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->audit_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Audit Name';
            $header[1] = 'Date & Time of Audit';
            $header[2] = 'Audit by';
            $header[3] = 'Patient MID';
            $header[4] = 'Patient Name';
            $header[5] = 'Patient Age';
            $header[6] = 'Patient Gender';

            $j = 7;

            $header[$j++] = 'Area';
            $header[$j++] = 'Department';
            $header[$j++] = 'Attended Doctor';
            $header[$j++] = 'Admission Date & Time';
            $header[$j++] = 'Discharge Date & Time';

            $header[$j++] = 'Orthopaedic assessment';
            $header[$j++] = 'Admission protocol - Orthopaedic assessment';
            $header[$j++] = 'Nursing assessment';
            $header[$j++] = 'Radiology investigation like Knee X ray, Knee MRI, Chest X ray and ECG';
            $header[$j++] = 'Lab Investigations to be checked for (CBC, RBS, S.creatinine, HIV, HbsAg, HCV)';
            $header[$j++] = 'Patient educated on the procedure and associated Risks';
            $header[$j++] = 'Informed Consent for Surgery and/or invasive procedure';
            $header[$j++] = 'Pre- Anesthetic Checkup - Anesthesia planned';
            $header[$j++] = 'Patient Educated on the type of planned anesthesia and the risks associated';
            $header[$j++] = 'Informed Consent for anesthesia';
            $header[$j++] = 'Pre - operative Work Up - Limb preparation, Chlorhexidine scrub application';
            $header[$j++] = 'Inform the following personnel (OR In Charge, Anaesthetist)';
            $header[$j++] = 'OT Protocol - Compliance to Handover protocol to the OT nurse';
            $header[$j++] = 'Pre -op time in';
            $header[$j++] = 'Induction of Anesthesia';
            $header[$j++] = 'Pre op antibiotic (Cefuroxime 1.5gm iv 30 minutes before skin incision)';
            $header[$j++] = 'Intra - op Time out';
            $header[$j++] = 'Completion of surgical procedure';
            $header[$j++] = 'Patient shifted to Recovery';
            $header[$j++] = 'Post Operative - Continuous monitoring of vital signs';
            $header[$j++] = 'Pain Assessment';
            $header[$j++] = 'Analgesics administered as per Doctor’s advice';
            $header[$j++] = 'Documentation of OT notes and post-op notes';
            $header[$j++] = 'Adherence to Recovery shift out criteria';
            $header[$j++] = 'Instructions to shift patient out of recovery';
            $header[$j++] = 'Distal Neurovascular assessment';
            $header[$j++] = 'To Ward - Handover from OT nurse to Ward Nurse';
            $header[$j++] = 'Vital signs monitored four hourly and any abnormal findings reported';
            $header[$j++] = 'Patient checked for bleeding';
            $header[$j++] = 'Pain assessment';
            $header[$j++] = 'Patient advised on oral intake';
            $header[$j++] = 'Administration of medication as per doctor’s advice';
            $header[$j++] = 'Physiotherapy as per advice';
            $header[$j++] = 'Wound dressing checked for oozing and dressing changed after 24 hours';
            $header[$j++] = 'Discharge protocol - Explained when to obtain urgent care for patient';
            $header[$j++] = 'Discharge instructions explained to the patient including wound care and activities';
            $header[$j++] = 'All discharge medications and discharge summary provided to patient';
            $header[$j++] = 'All documents and material related to post surgery return to normal life handed over to patient (Including physiotherapy)';
            $header[$j++] = 'Post-surgery appointment advised';
            $header[$j++] = 'Follow up - Post Operative ROM achieved according to protocol at two week review';


            $header[$j++] = 'Additional comments';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['audit_type'] = $data['audit_type'];
                $dataexport[$i]['date'] = date('Y-m-d H:i', strtotime($row->datetime));
                $dataexport[$i]['audit_by'] = $data['audit_by'];

                $dataexport[$i]['mid_no'] = $data['mid_no'];
                $dataexport[$i]['patient_name'] = $data['patient_name'];
                $dataexport[$i]['patient_age'] = $data['patient_age'];
                $dataexport[$i]['patient_gender'] = $data['patient_gender'];
                $dataexport[$i]['location'] = $data['location'];
                $dataexport[$i]['department'] = $data['department'];
                $dataexport[$i]['attended_doctor'] = $data['attended_doctor'];
                $dataexport[$i]['initial_assessment_hr6'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr6']));
                $dataexport[$i]['discharge_date_time'] = date('Y-m-d H:i', strtotime($data['discharge_date_time']));


                $dataexport[$i]['identification_details'] = ucfirst($data['identification_details']) . "\r\nRemarks: " . $data['identification_details_text'];
                $dataexport[$i]['vital_signs'] = ucfirst($data['vital_signs']) . "\r\nRemarks: " . $data['vital_signs_text'];
                $dataexport[$i]['surgery'] = ucfirst($data['surgery']) . "\r\nRemarks: " . $data['surgery_text'];
                $dataexport[$i]['complaints_communicated'] = ucfirst($data['complaints_communicated']) . "\r\nRemarks: " . $data['complaints_communicated_text'];
                $dataexport[$i]['intake'] = ucfirst($data['intake']) . "\r\nRemarks: " . $data['intake_text'];
                $dataexport[$i]['output'] = ucfirst($data['output']) . "\r\nRemarks: " . $data['output_text'];
                $dataexport[$i]['focus'] = ucfirst($data['focus']) . "\r\nRemarks: " . $data['focus_text'];
                $dataexport[$i]['meti'] = ucfirst($data['meti']) . "\r\nRemarks: " . $data['meti_text'];
                $dataexport[$i]['diagnostic'] = ucfirst($data['diagnostic']) . "\r\nRemarks: " . $data['diagnostic_text'];
                $dataexport[$i]['lab_results'] = ucfirst($data['lab_results']) . "\r\nRemarks: " . $data['lab_results_text'];
                $dataexport[$i]['pending_investigation'] = ucfirst($data['pending_investigation']) . "\r\nRemarks: " . $data['pending_investigation_text'];
                $dataexport[$i]['medicine_order'] = ucfirst($data['medicine_order']) . "\r\nRemarks: " . $data['medicine_order_text'];
                $dataexport[$i]['psychological'] = ucfirst($data['psychological']) . "\r\nRemarks: " . $data['psychological_text'];
                $dataexport[$i]['vulnerab'] = ucfirst($data['vulnerab']) . "\r\nRemarks: " . $data['vulnerab_text'];
                $dataexport[$i]['social'] = ucfirst($data['social']) . "\r\nRemarks: " . $data['social_text'];
                $dataexport[$i]['nutri'] = ucfirst($data['nutri']) . "\r\nRemarks: " . $data['nutri_text'];
                $dataexport[$i]['spiritual'] = ucfirst($data['spiritual']) . "\r\nRemarks: " . $data['spiritual_text'];
                $dataexport[$i]['suicide'] = ucfirst($data['suicide']) . "\r\nRemarks: " . $data['suicide_text'];
                $dataexport[$i]['risk'] = ucfirst($data['risk']) . "\r\nRemarks: " . $data['risk_text'];
                $dataexport[$i]['care'] = ucfirst($data['care']) . "\r\nRemarks: " . $data['care_text'];
                $dataexport[$i]['pfe'] = ucfirst($data['pfe']) . "\r\nRemarks: " . $data['pfe_text'];
                $dataexport[$i]['disch'] = ucfirst($data['disch']) . "\r\nRemarks: " . $data['disch_text'];
                $dataexport[$i]['facility_communicated'] = ucfirst($data['facility_communicated']) . "\r\nRemarks: " . $data['facility_communicated_text'];
                $dataexport[$i]['health_education'] = ucfirst($data['health_education']) . "\r\nRemarks: " . $data['health_education_text'];
                $dataexport[$i]['remarks1'] = ucfirst($data['remarks1']) . "\r\nRemarks: " . $data['remarks1_text'];
                $dataexport[$i]['urethral'] = ucfirst($data['urethral']) . "\r\nRemarks: " . $data['urethral_text'];
                $dataexport[$i]['urine_sample'] = ucfirst($data['urine_sample']) . "\r\nRemarks: " . $data['urine_sample_text'];
                $dataexport[$i]['bystander'] = ucfirst($data['bystander']) . "\r\nRemarks: " . $data['bystander_text'];
                $dataexport[$i]['instruments'] = ucfirst($data['instruments']) . "\r\nRemarks: " . $data['instruments_text'];
                $dataexport[$i]['sterile'] = ucfirst($data['sterile']) . "\r\nRemarks: " . $data['sterile_text'];
                $dataexport[$i]['antibiotics'] = ucfirst($data['antibiotics']) . "\r\nRemarks: " . $data['antibiotics_text'];
                $dataexport[$i]['surgical_site'] = ucfirst($data['surgical_site']) . "\r\nRemarks: " . $data['surgical_site_text'];
                $dataexport[$i]['wound'] = ucfirst($data['wound']) . "\r\nRemarks: " . $data['wound_text'];
                $dataexport[$i]['documented'] = ucfirst($data['documented']) . "\r\nRemarks: " . $data['documented_text'];
                $dataexport[$i]['adequate_facilities'] = ucfirst($data['adequate_facilities']) . "\r\nRemarks: " . $data['adequate_facilities_text'];
                $dataexport[$i]['sufficient_lighting'] = ucfirst($data['sufficient_lighting']) . "\r\nRemarks: " . $data['sufficient_lighting_text'];
                $dataexport[$i]['storage_facility_for_food'] = ucfirst($data['storage_facility_for_food']) . "\r\nRemarks: " . $data['storage_facility_for_food_text'];
                $dataexport[$i]['personnel_hygiene_facilities'] = ucfirst($data['personnel_hygiene_facilities']) . "\r\nRemarks: " . $data['personnel_hygiene_facilities_text'];
                $dataexport[$i]['food_material_testing'] = ucfirst($data['food_material_testing']) . "\r\nRemarks: " . $data['food_material_testing_text'];
                $dataexport[$i]['incoming_material'] = ucfirst($data['incoming_material']) . "\r\nRemarks: " . $data['incoming_material_text'];



                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];


                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- Arthroscopic ACL Reconstruction Surgery - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function overall_clinical_pathway_breast_lump_audit()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_ma_clinical_pathway_breast_lump_audit';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->audit_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Audit Name';
            $header[1] = 'Date & Time of Audit';
            $header[2] = 'Audit by';
            $header[3] = 'Patient MID';
            $header[4] = 'Patient Name';
            $header[5] = 'Patient Age';
            $header[6] = 'Patient Gender';

            $j = 7;

            $header[$j++] = 'Area';
            $header[$j++] = 'Department';
            $header[$j++] = 'Attended Doctor';
            $header[$j++] = 'Admission Date & Time';
            $header[$j++] = 'Discharge Date & Time';

            $header[$j++] = 'Whether imaging is done prior to obtaining tissue for diagnosis';
            $header[$j++] = 'Whether BIRADS 3 patients were followed up with repeat imaging within 4 to 6 months';
            $header[$j++] = 'In BIRADS 4 and 5 patients whether all patients underwent prior tissue diagnosis before surgery';
            $header[$j++] = 'Whether all patients taken up for surgery with prior preoperative staging workup';


            $header[$j++] = 'Additional comments';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['audit_type'] = $data['audit_type'];
                $dataexport[$i]['date'] = date('Y-m-d H:i', strtotime($row->datetime));
                $dataexport[$i]['audit_by'] = $data['audit_by'];

                $dataexport[$i]['mid_no'] = $data['mid_no'];
                $dataexport[$i]['patient_name'] = $data['patient_name'];
                $dataexport[$i]['patient_age'] = $data['patient_age'];
                $dataexport[$i]['patient_gender'] = $data['patient_gender'];
                $dataexport[$i]['location'] = $data['location'];
                $dataexport[$i]['department'] = $data['department'];
                $dataexport[$i]['attended_doctor'] = $data['attended_doctor'];
                $dataexport[$i]['initial_assessment_hr6'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr6']));
                $dataexport[$i]['discharge_date_time'] = date('Y-m-d H:i', strtotime($data['discharge_date_time']));


                $dataexport[$i]['identification_details'] = ucfirst($data['identification_details']) . "\r\nRemarks: " . $data['identification_details_text'];
                $dataexport[$i]['vital_signs'] = ucfirst($data['vital_signs']) . "\r\nRemarks: " . $data['vital_signs_text'];
                $dataexport[$i]['surgery'] = ucfirst($data['surgery']) . "\r\nRemarks: " . $data['surgery_text'];
                $dataexport[$i]['complaints_communicated'] = ucfirst($data['complaints_communicated']) . "\r\nRemarks: " . $data['complaints_communicated_text'];


                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];


                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- Breast Lump Consensus Guidelines - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function overall_clinical_pathway_cardiac_arrest_audit()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_ma_clinical_pathway_cardiac_arrest_audit';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->audit_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Audit Name';
            $header[1] = 'Date & Time of Audit';
            $header[2] = 'Audit by';
            $header[3] = 'Patient MID';
            $header[4] = 'Patient Name';
            $header[5] = 'Patient Age';
            $header[6] = 'Patient Gender';

            $j = 7;

            $header[$j++] = 'Area';
            $header[$j++] = 'Department';
            $header[$j++] = 'Attended Doctor';
            $header[$j++] = 'Admission Date & Time';
            $header[$j++] = 'Discharge Date & Time';

            $header[$j++] = 'Whether 5 Hs and 5 Ts have been considered and documented during the cardiac arrest';
            $header[$j++] = 'Whether 12 Lead ECG was done within 10 minutes of attaining ROSC';
            $header[$j++] = 'Whether patient transferred to the Cath lab within 90 minutes of arrival to hospital (for STEMI and high risk NSTEMI)';
            $header[$j++] = 'Whether TTM has been initiated from Emergency department';
            $header[$j++] = 'Whether TTM is continued for 24 hrs in ICU';
            $header[$j++] = 'Whether examination findings of pupillary reflex, motor score and corneal reflex has been documented in day 1';
            $header[$j++] = 'Whether MRI brain has been done on day 3 (after 72 hrs)';
            $header[$j++] = 'Whether EEG has been done on day 3';


            $header[$j++] = 'Additional comments';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['audit_type'] = $data['audit_type'];
                $dataexport[$i]['date'] = date('Y-m-d H:i', strtotime($row->datetime));
                $dataexport[$i]['audit_by'] = $data['audit_by'];

                $dataexport[$i]['mid_no'] = $data['mid_no'];
                $dataexport[$i]['patient_name'] = $data['patient_name'];
                $dataexport[$i]['patient_age'] = $data['patient_age'];
                $dataexport[$i]['patient_gender'] = $data['patient_gender'];
                $dataexport[$i]['location'] = $data['location'];
                $dataexport[$i]['department'] = $data['department'];
                $dataexport[$i]['attended_doctor'] = $data['attended_doctor'];
                $dataexport[$i]['initial_assessment_hr6'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr6']));
                $dataexport[$i]['discharge_date_time'] = date('Y-m-d H:i', strtotime($data['discharge_date_time']));


                $dataexport[$i]['identification_details'] = ucfirst($data['identification_details']) . "\r\nRemarks: " . $data['identification_details_text'];
                $dataexport[$i]['vital_signs'] = ucfirst($data['vital_signs']) . "\r\nRemarks: " . $data['vital_signs_text'];
                $dataexport[$i]['surgery'] = ucfirst($data['surgery']) . "\r\nRemarks: " . $data['surgery_text'];
                $dataexport[$i]['complaints_communicated'] = ucfirst($data['complaints_communicated']) . "\r\nRemarks: " . $data['complaints_communicated_text'];
                $dataexport[$i]['intake'] = ucfirst($data['intake']) . "\r\nRemarks: " . $data['intake_text'];
                $dataexport[$i]['output'] = ucfirst($data['output']) . "\r\nRemarks: " . $data['output_text'];
                $dataexport[$i]['allergies'] = ucfirst($data['allergies']) . "\r\nRemarks: " . $data['allergies_text'];
                $dataexport[$i]['medication'] = ucfirst($data['medication']) . "\r\nRemarks: " . $data['medication_text'];



                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];


                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- Cardiac Arrest - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function overall_clinical_pathway_donor_hepatectomy_audit()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_ma_clinical_pathway_donor_hepatectomy_audit';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->audit_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Audit Name';
            $header[1] = 'Date & Time of Audit';
            $header[2] = 'Audit by';
            $header[3] = 'Patient MID';
            $header[4] = 'Patient Name';
            $header[5] = 'Patient Age';
            $header[6] = 'Patient Gender';

            $j = 7;

            $header[$j++] = 'Area';
            $header[$j++] = 'Department';
            $header[$j++] = 'Attended Doctor';
            $header[$j++] = 'Admission Date & Time';
            $header[$j++] = 'Discharge Date & Time';

            $header[$j++] = 'Was Pre- operative workup/assessment in outpatient department with Multi department consultants done';
            $header[$j++] = 'Was the consent taken by operating team';
            $header[$j++] = 'Was the patient given chlorhexidine bath & area prepared';
            $header[$j++] = 'Was the patient shifted to operation Theatre with surgical safety checklist';
            $header[$j++] = 'Was Prophylactic antibiotic given at the induction of anaesthesia';
            $header[$j++] = 'Was the patient shift to room from ICU on POD1';
            $header[$j++] = 'Was the Foleys catheter removed on POD 1';
            $header[$j++] = 'Was the wound inspected / dressing done on POD 2';
            $header[$j++] = 'Was the patient discharged on POD 5';
            $header[$j++] = 'Was the follow up instructions given';

            $header[$j++] = 'Additional comments';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['audit_type'] = $data['audit_type'];
                $dataexport[$i]['date'] = date('Y-m-d H:i', strtotime($row->datetime));
                $dataexport[$i]['audit_by'] = $data['audit_by'];

                $dataexport[$i]['mid_no'] = $data['mid_no'];
                $dataexport[$i]['patient_name'] = $data['patient_name'];
                $dataexport[$i]['patient_age'] = $data['patient_age'];
                $dataexport[$i]['patient_gender'] = $data['patient_gender'];
                $dataexport[$i]['location'] = $data['location'];
                $dataexport[$i]['department'] = $data['department'];
                $dataexport[$i]['attended_doctor'] = $data['attended_doctor'];
                $dataexport[$i]['initial_assessment_hr6'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr6']));
                $dataexport[$i]['discharge_date_time'] = date('Y-m-d H:i', strtotime($data['discharge_date_time']));


                $dataexport[$i]['identification_details'] = ucfirst($data['identification_details']) . "\r\nRemarks: " . $data['identification_details_text'];
                $dataexport[$i]['vital_signs'] = ucfirst($data['vital_signs']) . "\r\nRemarks: " . $data['vital_signs_text'];
                $dataexport[$i]['surgery'] = ucfirst($data['surgery']) . "\r\nRemarks: " . $data['surgery_text'];
                $dataexport[$i]['complaints_communicated'] = ucfirst($data['complaints_communicated']) . "\r\nRemarks: " . $data['complaints_communicated_text'];
                $dataexport[$i]['intake'] = ucfirst($data['intake']) . "\r\nRemarks: " . $data['intake_text'];
                $dataexport[$i]['output'] = ucfirst($data['output']) . "\r\nRemarks: " . $data['output_text'];
                $dataexport[$i]['allergies'] = ucfirst($data['allergies']) . "\r\nRemarks: " . $data['allergies_text'];
                $dataexport[$i]['medication'] = ucfirst($data['medication']) . "\r\nRemarks: " . $data['medication_text'];
                $dataexport[$i]['diagnostic'] = ucfirst($data['diagnostic']) . "\r\nRemarks: " . $data['diagnostic_text'];
                $dataexport[$i]['lab_results'] = ucfirst($data['lab_results']) . "\r\nRemarks: " . $data['lab_results_text'];



                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];


                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- Donor Hepatectomy - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function overall_clinical_pathway_febrile_seizure_audit()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_ma_clinical_pathway_febrile_seizure_audit';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->audit_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Audit Name';
            $header[1] = 'Date & Time of Audit';
            $header[2] = 'Audit by';
            $header[3] = 'Patient MID';
            $header[4] = 'Patient Name';
            $header[5] = 'Patient Age';
            $header[6] = 'Patient Gender';

            $j = 7;

            $header[$j++] = 'Area';
            $header[$j++] = 'Department';
            $header[$j++] = 'Attended Doctor';
            $header[$j++] = 'Admission Date & Time';
            $header[$j++] = 'Discharge Date & Time';

            $header[$j++] = 'Whether patient’s age, temperature and family history of febrile seizure documented';
            $header[$j++] = 'Whether red flag sighs like abnormal development, neurological deficit and signs of meningitis checked';
            $header[$j++] = 'Was seizure appropriately classified as Simple/ Complex febrile seizure';
            $header[$j++] = 'Whether blood tests like CBC, CRP, Glucose, Electrolytes were ordered in appropriate context';
            $header[$j++] = 'Whether 1st episode febrile seizure was advised admission';
            $header[$j++] = 'Whether the family was properly educated regarding febrile, when to seek emergency care and How to perform first aid';

            $header[$j++] = 'Additional comments';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['audit_type'] = $data['audit_type'];
                $dataexport[$i]['date'] = date('Y-m-d H:i', strtotime($row->datetime));
                $dataexport[$i]['audit_by'] = $data['audit_by'];

                $dataexport[$i]['mid_no'] = $data['mid_no'];
                $dataexport[$i]['patient_name'] = $data['patient_name'];
                $dataexport[$i]['patient_age'] = $data['patient_age'];
                $dataexport[$i]['patient_gender'] = $data['patient_gender'];
                $dataexport[$i]['location'] = $data['location'];
                $dataexport[$i]['department'] = $data['department'];
                $dataexport[$i]['attended_doctor'] = $data['attended_doctor'];
                $dataexport[$i]['initial_assessment_hr6'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr6']));
                $dataexport[$i]['discharge_date_time'] = date('Y-m-d H:i', strtotime($data['discharge_date_time']));


                $dataexport[$i]['identification_details'] = ucfirst($data['identification_details']) . "\r\nRemarks: " . $data['identification_details_text'];
                $dataexport[$i]['vital_signs'] = ucfirst($data['vital_signs']) . "\r\nRemarks: " . $data['vital_signs_text'];
                $dataexport[$i]['surgery'] = ucfirst($data['surgery']) . "\r\nRemarks: " . $data['surgery_text'];
                $dataexport[$i]['complaints_communicated'] = ucfirst($data['complaints_communicated']) . "\r\nRemarks: " . $data['complaints_communicated_text'];
                $dataexport[$i]['intake'] = ucfirst($data['intake']) . "\r\nRemarks: " . $data['intake_text'];
                $dataexport[$i]['output'] = ucfirst($data['output']) . "\r\nRemarks: " . $data['output_text'];

                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];


                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- Febrile Seizure - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function overall_clinical_pathway_heart_transplant_audit()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_ma_clinical_pathway_heart_transplant_audit';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->audit_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Audit Name';
            $header[1] = 'Date & Time of Audit';
            $header[2] = 'Audit by';
            $header[3] = 'Patient MID';
            $header[4] = 'Patient Name';
            $header[5] = 'Patient Age';
            $header[6] = 'Patient Gender';

            $j = 7;

            $header[$j++] = 'Area';
            $header[$j++] = 'Department';
            $header[$j++] = 'Attended Doctor';
            $header[$j++] = 'Admission Date & Time';
            $header[$j++] = 'Discharge Date & Time';

            $header[$j++] = 'Did the patient physical and psychological condition - fit for surgery';
            $header[$j++] = 'Inform the patient and relatives regarding the donors agree and came of the brain death';
            $header[$j++] = 'Inform the patient and relatives regarding organs health';
            $header[$j++] = 'Was pre-operative workup/ assessment in outpatient department with Multi department consultations done';
            $header[$j++] = 'Was the consent taken by Doctors and operation team';
            $header[$j++] = 'Was the patient shifted to operation Theatre with surgical safety checklist';
            $header[$j++] = 'Was Prophylactic antibiotic given at the induction of anaesthesia';
            $header[$j++] = 'Was the patient shift to room from ICU after stabilization';
            $header[$j++] = 'Was the Foleys catheter and lines inspected everyday';
            $header[$j++] = 'Was the wound inspected everyday';
            $header[$j++] = 'Was the patient discharged after stabilization and after getting consent from Cardiologist, Cardiac Surgeon, Infection control physician and Nephrologist';
            $header[$j++] = 'Was the patient get counselling from physiotherapist, Dietician, Social worker, Co-ordinator and Clinical Pharmacist';


            $header[$j++] = 'Additional comments';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['audit_type'] = $data['audit_type'];
                $dataexport[$i]['date'] = date('Y-m-d H:i', strtotime($row->datetime));
                $dataexport[$i]['audit_by'] = $data['audit_by'];

                $dataexport[$i]['mid_no'] = $data['mid_no'];
                $dataexport[$i]['patient_name'] = $data['patient_name'];
                $dataexport[$i]['patient_age'] = $data['patient_age'];
                $dataexport[$i]['patient_gender'] = $data['patient_gender'];
                $dataexport[$i]['location'] = $data['location'];
                $dataexport[$i]['department'] = $data['department'];
                $dataexport[$i]['attended_doctor'] = $data['attended_doctor'];
                $dataexport[$i]['initial_assessment_hr6'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr6']));
                $dataexport[$i]['discharge_date_time'] = date('Y-m-d H:i', strtotime($data['discharge_date_time']));


                $dataexport[$i]['identification_details'] = ucfirst($data['identification_details']) . "\r\nRemarks: " . $data['identification_details_text'];
                $dataexport[$i]['vital_signs'] = ucfirst($data['vital_signs']) . "\r\nRemarks: " . $data['vital_signs_text'];
                $dataexport[$i]['surgery'] = ucfirst($data['surgery']) . "\r\nRemarks: " . $data['surgery_text'];
                $dataexport[$i]['complaints_communicated'] = ucfirst($data['complaints_communicated']) . "\r\nRemarks: " . $data['complaints_communicated_text'];
                $dataexport[$i]['intake'] = ucfirst($data['intake']) . "\r\nRemarks: " . $data['intake_text'];
                $dataexport[$i]['allergies'] = ucfirst($data['allergies']) . "\r\nRemarks: " . $data['allergies_text'];
                $dataexport[$i]['medication'] = ucfirst($data['medication']) . "\r\nRemarks: " . $data['medication_text'];
                $dataexport[$i]['diagnostic'] = ucfirst($data['diagnostic']) . "\r\nRemarks: " . $data['diagnostic_text'];
                $dataexport[$i]['lab_results'] = ucfirst($data['lab_results']) . "\r\nRemarks: " . $data['lab_results_text'];
                $dataexport[$i]['pending_investigation'] = ucfirst($data['pending_investigation']) . "\r\nRemarks: " . $data['pending_investigation_text'];
                $dataexport[$i]['medicine_order'] = ucfirst($data['medicine_order']) . "\r\nRemarks: " . $data['medicine_order_text'];
                $dataexport[$i]['facility_communicated'] = ucfirst($data['facility_communicated']) . "\r\nRemarks: " . $data['facility_communicated_text'];


                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];


                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- Heart Transplant Recipient - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function overall_clinical_pathway_laproscopic_audit()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_ma_clinical_pathway_laproscopic_audit';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->audit_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Audit Name';
            $header[1] = 'Date & Time of Audit';
            $header[2] = 'Audit by';
            $header[3] = 'Patient MID';
            $header[4] = 'Patient Name';
            $header[5] = 'Patient Age';
            $header[6] = 'Patient Gender';

            $j = 7;

            $header[$j++] = 'Area';
            $header[$j++] = 'Department';
            $header[$j++] = 'Attended Doctor';
            $header[$j++] = 'Admission Date & Time';
            $header[$j++] = 'Discharge Date & Time';

            $header[$j++] = 'Was Pre- operative workup/assessment in outpatient department with Multi department consultants done';
            $header[$j++] = 'Was the consent taken by operating team';
            $header[$j++] = 'Was the site marked during Pre-operation';
            $header[$j++] = 'Was the patient given Chlorhexidine bath & area prepared';
            $header[$j++] = 'Was the patient shifted to operation Theatre with surgical safety checklist';
            $header[$j++] = 'Was Prophylactic antibiotic given at the induction of anaesthesia';
            $header[$j++] = 'Was the patient shift to room from ICU on POD1';
            $header[$j++] = 'Was the Foleys catheter removed on POD 1';
            $header[$j++] = 'Was the wound inspected / dressing done on POD 2';
            $header[$j++] = 'Was the patient discharged on POD 5';
            $header[$j++] = 'Was there a conversion from laparoscopic donor neprotomy to open donor neprectomy';


            $header[$j++] = 'Additional comments';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['audit_type'] = $data['audit_type'];
                $dataexport[$i]['date'] = date('Y-m-d H:i', strtotime($row->datetime));
                $dataexport[$i]['audit_by'] = $data['audit_by'];

                $dataexport[$i]['mid_no'] = $data['mid_no'];
                $dataexport[$i]['patient_name'] = $data['patient_name'];
                $dataexport[$i]['patient_age'] = $data['patient_age'];
                $dataexport[$i]['patient_gender'] = $data['patient_gender'];
                $dataexport[$i]['location'] = $data['location'];
                $dataexport[$i]['department'] = $data['department'];
                $dataexport[$i]['attended_doctor'] = $data['attended_doctor'];
                $dataexport[$i]['initial_assessment_hr6'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr6']));
                $dataexport[$i]['discharge_date_time'] = date('Y-m-d H:i', strtotime($data['discharge_date_time']));


                $dataexport[$i]['identification_details'] = ucfirst($data['identification_details']) . "\r\nRemarks: " . $data['identification_details_text'];
                $dataexport[$i]['vital_signs'] = ucfirst($data['vital_signs']) . "\r\nRemarks: " . $data['vital_signs_text'];
                $dataexport[$i]['surgery'] = ucfirst($data['surgery']) . "\r\nRemarks: " . $data['surgery_text'];
                $dataexport[$i]['complaints_communicated'] = ucfirst($data['complaints_communicated']) . "\r\nRemarks: " . $data['complaints_communicated_text'];
                $dataexport[$i]['intake'] = ucfirst($data['intake']) . "\r\nRemarks: " . $data['intake_text'];
                $dataexport[$i]['output'] = ucfirst($data['output']) . "\r\nRemarks: " . $data['output_text'];
                $dataexport[$i]['allergies'] = ucfirst($data['allergies']) . "\r\nRemarks: " . $data['allergies_text'];
                $dataexport[$i]['medication'] = ucfirst($data['medication']) . "\r\nRemarks: " . $data['medication_text'];
                $dataexport[$i]['diagnostic'] = ucfirst($data['diagnostic']) . "\r\nRemarks: " . $data['diagnostic_text'];
                $dataexport[$i]['lab_results'] = ucfirst($data['lab_results']) . "\r\nRemarks: " . $data['lab_results_text'];
                $dataexport[$i]['pending_investigation'] = ucfirst($data['pending_investigation']) . "\r\nRemarks: " . $data['pending_investigation_text'];



                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];


                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- Laparoscopic Donor Nephrectomy - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function overall_clinical_pathway_picc_line_audit()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_ma_clinical_pathway_picc_line_audit';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->audit_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Audit Name';
            $header[1] = 'Date & Time of Audit';
            $header[2] = 'Audit by';
            $header[3] = 'Patient MID';
            $header[4] = 'Patient Name';
            $header[5] = 'Patient Age';
            $header[6] = 'Patient Gender';

            $j = 7;

            $header[$j++] = 'Area';
            $header[$j++] = 'Department';
            $header[$j++] = 'Attended Doctor';
            $header[$j++] = 'Admission Date & Time';
            $header[$j++] = 'Discharge Date & Time';

            $header[$j++] = 'Patient Education and Informed Consent';
            $header[$j++] = 'Procedure safety checklist completed';
            $header[$j++] = 'Was the patient prepared using Chlorhexidine';
            $header[$j++] = 'Procedure done under sedation';
            $header[$j++] = 'Local Anaesthesia given';
            $header[$j++] = 'Insertion procedure done';
            $header[$j++] = 'Guidewire removed';
            $header[$j++] = 'Back flow of blood present';
            $header[$j++] = 'Securing catheter';
            $header[$j++] = 'Post-Insertion Confirmation done';
            $header[$j++] = 'Post procedure management and education';


            $header[$j++] = 'Additional comments';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['audit_type'] = $data['audit_type'];
                $dataexport[$i]['date'] = date('Y-m-d H:i', strtotime($row->datetime));
                $dataexport[$i]['audit_by'] = $data['audit_by'];

                $dataexport[$i]['mid_no'] = $data['mid_no'];
                $dataexport[$i]['patient_name'] = $data['patient_name'];
                $dataexport[$i]['patient_age'] = $data['patient_age'];
                $dataexport[$i]['patient_gender'] = $data['patient_gender'];
                $dataexport[$i]['location'] = $data['location'];
                $dataexport[$i]['department'] = $data['department'];
                $dataexport[$i]['attended_doctor'] = $data['attended_doctor'];
                $dataexport[$i]['initial_assessment_hr6'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr6']));
                $dataexport[$i]['discharge_date_time'] = date('Y-m-d H:i', strtotime($data['discharge_date_time']));


                $dataexport[$i]['identification_details'] = ucfirst($data['identification_details']) . "\r\nRemarks: " . $data['identification_details_text'];
                $dataexport[$i]['vital_signs'] = ucfirst($data['vital_signs']) . "\r\nRemarks: " . $data['vital_signs_text'];
                $dataexport[$i]['surgery'] = ucfirst($data['surgery']) . "\r\nRemarks: " . $data['surgery_text'];
                $dataexport[$i]['complaints_communicated'] = ucfirst($data['complaints_communicated']) . "\r\nRemarks: " . $data['complaints_communicated_text'];
                $dataexport[$i]['intake'] = ucfirst($data['intake']) . "\r\nRemarks: " . $data['intake_text'];
                $dataexport[$i]['output'] = ucfirst($data['output']) . "\r\nRemarks: " . $data['output_text'];
                $dataexport[$i]['allergies'] = ucfirst($data['allergies']) . "\r\nRemarks: " . $data['allergies_text'];

                $dataexport[$i]['medication'] = ucfirst($data['medication']) . "\r\nRemarks: " . $data['medication_text'];
                $dataexport[$i]['diagnostic'] = ucfirst($data['diagnostic']) . "\r\nRemarks: " . $data['diagnostic_text'];
                $dataexport[$i]['lab_results'] = ucfirst($data['lab_results']) . "\r\nRemarks: " . $data['lab_results_text'];
                $dataexport[$i]['pending_investigation'] = ucfirst($data['pending_investigation']) . "\r\nRemarks: " . $data['pending_investigation_text'];


                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];


                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- PICC LINE Insertion - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function overall_clinical_pathway_stroke_audit()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_ma_clinical_pathway_stroke_audit';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->audit_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Audit Name';
            $header[1] = 'Date & Time of Audit';
            $header[2] = 'Audit by';
            $header[3] = 'Patient MID';
            $header[4] = 'Patient Name';
            $header[5] = 'Patient Age';
            $header[6] = 'Patient Gender';

            $j = 7;

            $header[$j++] = 'Area';
            $header[$j++] = 'Department';
            $header[$j++] = 'Attended Doctor';
            $header[$j++] = 'Admission Date & Time';
            $header[$j++] = 'Discharge Date & Time';

            $header[$j++] = 'NIHSS on arrival';
            $header[$j++] = 'Door to CT time < 20min';
            $header[$j++] = 'CT+CTA';
            $header[$j++] = 'Imaging delay < 20 minutes';
            $header[$j++] = 'IV tPA checklist done';
            $header[$j++] = 'Door to needle time < 45min';
            $header[$j++] = 'Post IV tPA BP monitoring';
            $header[$j++] = 'Door to puncture within 60 minutes of arrival';


            $header[$j++] = 'Additional comments';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['audit_type'] = $data['audit_type'];
                $dataexport[$i]['date'] = date('Y-m-d H:i', strtotime($row->datetime));
                $dataexport[$i]['audit_by'] = $data['audit_by'];

                $dataexport[$i]['mid_no'] = $data['mid_no'];
                $dataexport[$i]['patient_name'] = $data['patient_name'];
                $dataexport[$i]['patient_age'] = $data['patient_age'];
                $dataexport[$i]['patient_gender'] = $data['patient_gender'];
                $dataexport[$i]['location'] = $data['location'];
                $dataexport[$i]['department'] = $data['department'];
                $dataexport[$i]['attended_doctor'] = $data['attended_doctor'];
                $dataexport[$i]['initial_assessment_hr6'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr6']));
                $dataexport[$i]['discharge_date_time'] = date('Y-m-d H:i', strtotime($data['discharge_date_time']));


                $dataexport[$i]['identification_details'] = ucfirst($data['identification_details']) . "\r\nRemarks: " . $data['identification_details_text'];
                $dataexport[$i]['vital_signs'] = ucfirst($data['vital_signs']) . "\r\nRemarks: " . $data['vital_signs_text'];
                $dataexport[$i]['surgery'] = ucfirst($data['surgery']) . "\r\nRemarks: " . $data['surgery_text'];
                $dataexport[$i]['complaints_communicated'] = ucfirst($data['complaints_communicated']) . "\r\nRemarks: " . $data['complaints_communicated_text'];
                $dataexport[$i]['intake'] = ucfirst($data['intake']) . "\r\nRemarks: " . $data['intake_text'];
                $dataexport[$i]['output'] = ucfirst($data['output']) . "\r\nRemarks: " . $data['output_text'];
                $dataexport[$i]['allergies'] = ucfirst($data['allergies']) . "\r\nRemarks: " . $data['allergies_text'];
                $dataexport[$i]['medication'] = ucfirst($data['medication']) . "\r\nRemarks: " . $data['medication_text'];



                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];


                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- Stroke - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function overall_clinical_pathway_urodynamics_audit()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_ma_clinical_pathway_urodynamics_audit';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->audit_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Audit Name';
            $header[1] = 'Date & Time of Audit';
            $header[2] = 'Audit by';
            $header[3] = 'Patient MID';
            $header[4] = 'Patient Name';
            $header[5] = 'Patient Age';
            $header[6] = 'Patient Gender';

            $j = 7;

            $header[$j++] = 'Area';
            $header[$j++] = 'Department';
            $header[$j++] = 'Attended Doctor';
            $header[$j++] = 'Admission Date & Time';
            $header[$j++] = 'Discharge Date & Time';

            $header[$j++] = 'Was the anticholinergic withheld 48 hours prior?';
            $header[$j++] = 'Was patient screened for UTI – Urine R/E and urine culture?';
            $header[$j++] = 'Was the Prophylactic antibiotic given as per the recommendation?';
            $header[$j++] = 'Was any post procedure infection identified?';


            $header[$j++] = 'Additional comments';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['audit_type'] = $data['audit_type'];
                $dataexport[$i]['date'] = date('Y-m-d H:i', strtotime($row->datetime));
                $dataexport[$i]['audit_by'] = $data['audit_by'];

                $dataexport[$i]['mid_no'] = $data['mid_no'];
                $dataexport[$i]['patient_name'] = $data['patient_name'];
                $dataexport[$i]['patient_age'] = $data['patient_age'];
                $dataexport[$i]['patient_gender'] = $data['patient_gender'];
                $dataexport[$i]['location'] = $data['location'];
                $dataexport[$i]['department'] = $data['department'];
                $dataexport[$i]['attended_doctor'] = $data['attended_doctor'];
                $dataexport[$i]['initial_assessment_hr6'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr6']));
                $dataexport[$i]['discharge_date_time'] = date('Y-m-d H:i', strtotime($data['discharge_date_time']));


                $dataexport[$i]['identification_details'] = ucfirst($data['identification_details']) . "\r\nRemarks: " . $data['identification_details_text'];
                $dataexport[$i]['vital_signs'] = ucfirst($data['vital_signs']) . "\r\nRemarks: " . $data['vital_signs_text'];
                $dataexport[$i]['surgery'] = ucfirst($data['surgery']) . "\r\nRemarks: " . $data['surgery_text'];
                $dataexport[$i]['complaints_communicated'] = ucfirst($data['complaints_communicated']) . "\r\nRemarks: " . $data['complaints_communicated_text'];


                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];


                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- Urodynamics - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function overall_clinical_pathway_stemi_audit()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_ma_clinical_pathway_stemi_audit';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->audit_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Audit Name';
            $header[1] = 'Date & Time of Audit';
            $header[2] = 'Audit by';
            $header[3] = 'Patient MID';
            $header[4] = 'Patient Name';
            $header[5] = 'Patient Age';
            $header[6] = 'Patient Gender';

            $j = 7;

            $header[$j++] = 'Area';
            $header[$j++] = 'Department';
            $header[$j++] = 'Attended Doctor';
            $header[$j++] = 'Admission Date & Time';
            $header[$j++] = 'Discharge Date & Time';

            $header[$j++] = 'ECG taken within 10 minutes of arrival';
            $header[$j++] = 'Loading dose of aspirin given';
            $header[$j++] = 'Loading dose of clopidogrel/ ticagrelor given';
            $header[$j++] = 'Cath lab team ready within 20 minutes of alerting';
            $header[$j++] = 'Pre-procedure counselling and consent';
            $header[$j++] = 'Patient preparation';
            $header[$j++] = 'Chest X ray';
            $header[$j++] = 'Administration of medication as per doctor’s advice';
            $header[$j++] = 'Handover from ED to Cath lab';
            $header[$j++] = 'Time out before procedure';
            $header[$j++] = 'Door to device time less than 90 minutes';
            $header[$j++] = 'Sign out after procedure';
            $header[$j++] = 'Hand over from Cath lab to CICU nurse';
            $header[$j++] = 'Administration of medication as per doctor’s advice (CICU)';
            $header[$j++] = 'Access site assessment';
            $header[$j++] = 'Handover from ICU to Ward Nurse';
            $header[$j++] = 'Vital signs monitored four hourly';
            $header[$j++] = 'Optimal Treatment as per doctor’s advice';
            $header[$j++] = 'Explained when to obtain urgent care for patient';
            $header[$j++] = 'Discharge instructions explained to the patient';
            $header[$j++] = 'All discharge medications, discharge summary and procedure related documents provided to patient';
            $header[$j++] = 'Diet counselling given';
            $header[$j++] = 'Pre discharge cardiac rehabilitation/physiotherapy advise given';
            $header[$j++] = 'Follow up appointment advised';
            $header[$j++] = 'In hospital mortality';
            $header[$j++] = 'Timi 3 flow?';

            $header[$j++] = 'Additional comments';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['audit_type'] = $data['audit_type'];
                $dataexport[$i]['date'] = date('Y-m-d H:i', strtotime($row->datetime));
                $dataexport[$i]['audit_by'] = $data['audit_by'];

                $dataexport[$i]['mid_no'] = $data['mid_no'];
                $dataexport[$i]['patient_name'] = $data['patient_name'];
                $dataexport[$i]['patient_age'] = $data['patient_age'];
                $dataexport[$i]['patient_gender'] = $data['patient_gender'];
                $dataexport[$i]['location'] = $data['location'];
                $dataexport[$i]['department'] = $data['department'];
                $dataexport[$i]['attended_doctor'] = $data['attended_doctor'];
                $dataexport[$i]['initial_assessment_hr6'] = date('Y-m-d H:i', strtotime($data['initial_assessment_hr6']));
                $dataexport[$i]['discharge_date_time'] = date('Y-m-d H:i', strtotime($data['discharge_date_time']));


                $dataexport[$i]['identification_details'] = ucfirst($data['identification_details']) . "\r\nRemarks: " . $data['identification_details_text'];
                $dataexport[$i]['vital_signs'] = ucfirst($data['vital_signs']) . "\r\nRemarks: " . $data['vital_signs_text'];
                $dataexport[$i]['surgery'] = ucfirst($data['surgery']) . "\r\nRemarks: " . $data['surgery_text'];
                $dataexport[$i]['complaints_communicated'] = ucfirst($data['complaints_communicated']) . "\r\nRemarks: " . $data['complaints_communicated_text'];
                $dataexport[$i]['intake'] = ucfirst($data['intake']) . "\r\nRemarks: " . $data['intake_text'];
                $dataexport[$i]['output'] = ucfirst($data['output']) . "\r\nRemarks: " . $data['output_text'];

                $dataexport[$i]['focus'] = ucfirst($data['focus']) . "\r\nRemarks: " . $data['focus_text'];
                $dataexport[$i]['meti'] = ucfirst($data['meti']) . "\r\nRemarks: " . $data['meti_text'];
                $dataexport[$i]['diagnostic'] = ucfirst($data['diagnostic']) . "\r\nRemarks: " . $data['diagnostic_text'];
                $dataexport[$i]['lab_results'] = ucfirst($data['lab_results']) . "\r\nRemarks: " . $data['lab_results_text'];
                $dataexport[$i]['pending_investigation'] = ucfirst($data['pending_investigation']) . "\r\nRemarks: " . $data['pending_investigation_text'];
                $dataexport[$i]['medicine_order'] = ucfirst($data['medicine_order']) . "\r\nRemarks: " . $data['medicine_order_text'];
                $dataexport[$i]['psychological'] = ucfirst($data['psychological']) . "\r\nRemarks: " . $data['psychological_text'];
                $dataexport[$i]['vulnerab'] = ucfirst($data['vulnerab']) . "\r\nRemarks: " . $data['vulnerab_text'];
                $dataexport[$i]['social'] = ucfirst($data['social']) . "\r\nRemarks: " . $data['social_text'];
                $dataexport[$i]['nutri'] = ucfirst($data['nutri']) . "\r\nRemarks: " . $data['nutri_text'];
                $dataexport[$i]['spiritual'] = ucfirst($data['spiritual']) . "\r\nRemarks: " . $data['spiritual_text'];
                $dataexport[$i]['suicide'] = ucfirst($data['suicide']) . "\r\nRemarks: " . $data['suicide_text'];
                $dataexport[$i]['risk'] = ucfirst($data['risk']) . "\r\nRemarks: " . $data['risk_text'];
                $dataexport[$i]['care'] = ucfirst($data['care']) . "\r\nRemarks: " . $data['care_text'];
                $dataexport[$i]['pfe'] = ucfirst($data['pfe']) . "\r\nRemarks: " . $data['pfe_text'];
                $dataexport[$i]['disch'] = ucfirst($data['disch']) . "\r\nRemarks: " . $data['disch_text'];
                $dataexport[$i]['facility_communicated'] = ucfirst($data['facility_communicated']) . "\r\nRemarks: " . $data['facility_communicated_text'];
                $dataexport[$i]['health_education'] = ucfirst($data['health_education']) . "\r\nRemarks: " . $data['health_education_text'];
                $dataexport[$i]['remarks1'] = ucfirst($data['remarks1']) . "\r\nRemarks: " . $data['remarks1_text'];
                $dataexport[$i]['urethral'] = ucfirst($data['urethral']) . "\r\nRemarks: " . $data['urethral_text'];


                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];


                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- STEMI-Primary PCI Clinical Pathway - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }
    //Download Reports for HouseKeeping audits
    public function overall_bmw_audit()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');

        if (ismodule_active('AUDIT') === true) {

            $table_feedback = 'bf_ma_bmw_audit'; // your feedback table
            $table_patients = 'bf_patients';
            $desc = 'desc';

            // Get audit feedback data
            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);

            // Define CSV Header
            $header = [
                'Audit Name',
                'Date & Time of Audit',
                'Audit By',
                'Department',
                'Area',
                'Staff MID',
                'Officer Name',
                'Supervisor Name',
                'Driver Name',
                'Picker Name',
                'No. of Yellow Bags',
                'No. of Red Bags',
                'No. of White Bags',
                'No. of Brownish Yellow Bags',
                'No. of Blue Bags',
                'Total Bags',
                'Total Bags Processed',
                'Total Quantity (Kg)',
                'Uploaded Files'
            ];

            // Prepare export data
            $dataexport = [];
            $i = 0;

            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                $dataexport[$i]['audit_type'] = isset($data['audit_type']) ? $data['audit_type'] : '';
                $dataexport[$i]['datetime'] = date('Y-m-d H:i', strtotime($row->datetime ?? ''));
                $dataexport[$i]['audit_by'] = isset($data['audit_by']) ? $data['audit_by'] : '';

                $dataexport[$i]['department'] = isset($data['department']) ? $data['department'] : '';
                $dataexport[$i]['location'] = isset($data['location']) ? $data['location'] : '';
                $dataexport[$i]['mid_no'] = isset($data['mid_no']) ? $data['mid_no'] : '';
                $dataexport[$i]['patient_name'] = isset($data['patient_name']) ? $data['patient_name'] : '';
                $dataexport[$i]['supervisor_name'] = isset($data['supervisor_name']) ? $data['supervisor_name'] : '';
                $dataexport[$i]['driver_name'] = isset($data['driver_name']) ? $data['driver_name'] : '';
                $dataexport[$i]['picker_name'] = isset($data['picker_name']) ? $data['picker_name'] : '';

                $dataexport[$i]['yellow_bags'] = isset($data['yellow_bags']) ? $data['yellow_bags'] : '';
                $dataexport[$i]['red_bags'] = isset($data['red_bags']) ? $data['red_bags'] : '';
                $dataexport[$i]['white_bags'] = isset($data['white_bags']) ? $data['white_bags'] : '';
                $dataexport[$i]['brownish_yellow_bags'] = isset($data['brownish_yellow_bags']) ? $data['brownish_yellow_bags'] : '';
                $dataexport[$i]['blue_bags'] = isset($data['blue_bags']) ? $data['blue_bags'] : '';
                $dataexport[$i]['total_bags'] = isset($data['total_bags']) ? $data['total_bags'] : '';
                $dataexport[$i]['total_bags_processed'] = isset($data['total_bags_processed']) ? $data['total_bags_processed'] : '';
                $dataexport[$i]['total_quantity'] = isset($data['total_quantity']) ? $data['total_quantity'] : '';

                // File list (comma separated)
                if (!empty($data['files_name']) && is_array($data['files_name'])) {
                    $fileNames = array_column($data['files_name'], 'name');
                    $dataexport[$i]['files'] = implode(', ', $fileNames);
                } else {
                    $dataexport[$i]['files'] = 'No Files';
                }

                $i++;
            }

            // Prepare CSV output
            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];

            ob_end_clean();
            $fileName = 'EF-Biomedical-Waste-Audit-' . $tdate . '-to-' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);

            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;

        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function overall_pest_control_audit()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');

        if (ismodule_active('AUDIT') === true) {

            $table_feedback = 'bf_ma_pest_control_audit'; // pest control feedback table
            $table_patients = 'bf_patients';
            $desc = 'desc';

            // Get audit feedback data
            $feedbacktaken = $this->audit_model->patient_and_feedback($table_patients, $table_feedback, $desc);

            // Define CSV Header
            $header = [
                'Audit Name',
                'Date & Time of Audit',
                'Audit By',
                'Department',
                'Location',
                'Is Pest Control Visit Planned/Scheduled?',
                'Planned Remarks',
                'Is Pest Control Visit Executed?',
                'Executed Remarks',
                'Files Uploaded'
            ];

            // Prepare export data
            $dataexport = [];
            $i = 0;

            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                $dataexport[$i]['audit_type'] = isset($data['audit_type']) ? $data['audit_type'] : '';
                $dataexport[$i]['datetime'] = date('Y-m-d H:i', strtotime($row->datetime ?? ''));
                $dataexport[$i]['audit_by'] = isset($data['audit_by']) ? $data['audit_by'] : '';
                $dataexport[$i]['department'] = isset($data['department']) ? $data['department'] : '';
                $dataexport[$i]['location'] = isset($data['location']) ? $data['location'] : '';



                // Visit details
                $dataexport[$i]['pest_planned'] = isset($data['pest_planned']) ? $data['pest_planned'] : '';
                $dataexport[$i]['pest_planned_remarks'] = isset($data['pest_planned_remarks']) ? $data['pest_planned_remarks'] : '';
                $dataexport[$i]['pest_executed'] = isset($data['pest_executed']) ? $data['pest_executed'] : '';
                $dataexport[$i]['pest_executed_remarks'] = isset($data['pest_executed_remarks']) ? $data['pest_executed_remarks'] : '';

                // Uploaded files
                if (!empty($data['files_name']) && is_array($data['files_name'])) {
                    $fileNames = array_column($data['files_name'], 'name');
                    $dataexport[$i]['files'] = implode(', ', $fileNames);
                } else {
                    $dataexport[$i]['files'] = 'No Files';
                }

                $i++;
            }

            // Prepare CSV output
            $fdate = $_SESSION['from_date'] ?? date('Y-m-d');
            $tdate = $_SESSION['to_date'] ?? date('Y-m-d');

            ob_end_clean();
            $fileName = 'EF-Pest-Control-Audit-' . $tdate . '-to-' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);

            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;

        } else {
            redirect('dashboard/noaccess');
        }
    }






    public function downloadcomments()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_feedback';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->ipd_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->ipd_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }

            $header[0] = 'Date';
            $header[1] = 'Patient Name';
            $header[2] = 'Patient ID';
            $header[3] = 'Floor/Ward';
            $header[4] = 'Room/Bed';
            $header[5] = 'Mobile Number';
            $j = 6;
            $header[$j++] = 'Average Rating';
            $header[$j++] = 'NPS Score';
            $header[$j++] = 'Comments';
            foreach ($setarray as $r) {
                $header[$j] = $r;
                $j++;
            }
            $dataexport = array();
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);
                $dataexport[$i]['date'] = date('d-m-Y', strtotime($row->datetime));
                $dataexport[$i]['name'] = $data['name'];
                $dataexport[$i]['patient_id'] = $data['patientid'];
                $dataexport[$i]['ward'] = $data['ward'];
                $dataexport[$i]['bedno'] = $data['bedno'];
                $dataexport[$i]['mobile'] = $data['contactnumber'];
                $dataexport[$i]['overallScore'] = $data['overallScore'];
                $dataexport[$i]['recommend1Score'] = ($data['recommend1Score']) * 2;

                $dataexport[$i]['suggestionText'] = $data['suggestionText'];
                foreach ($setarray as $key => $t) {
                    if ($data['comment'][$key] != '') {
                        $dataexport[$i][$key] = $data['comment'][$key];
                    } else {
                        $dataexport[$i][$key] = '';
                    }
                }
                $i++;
            }
            $newdataset = $dataexport;
            $d = array();
            $p = array();
            $n = array();
            $para = array();
            $for5 = array();
            $for4 = array();
            $for3 = array();
            $for2 = array();
            $for1 = array();
            foreach ($dataexport as $row) {
                foreach ($row as $k => $r) {
                    if ($r * 1 > 0) {
                        $d[$k] = $d[$k] + 1;
                        if ($r > 2) {
                            $p[$k] = $p[$k] + 1;
                        } else {
                            $n[$k] = $n[$k] + 1;
                        }
                        $para[$k] = $para[$k] + $r;
                        if ($k == 'overallScore') {
                            if ($r == 5) {
                                $for5[$k] = $for5[$k] + 1;
                            }
                            if ($r == 4) {
                                $for4[$k] = $for4[$k] + 1;
                            }
                            if ($r == 3) {
                                $for3[$k] = $for3[$k] + 1;
                            }
                            if ($r == 2) {
                                $for2[$k] = $for2[$k] + 1;
                            }
                            if ($r == 1) {
                                $for1[$k] = $for1[$k] + 1;
                            }
                        }
                    }
                }
            }

            ob_end_clean();
            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];

            $fileName = 'EF- IPD PATIENT COMMENTS - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }

    // IP DASHBOARD DOWNLOADS

    public function overall_excel_report()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $table_feedback = 'bf_feedback';
            $table_patients = 'bf_patients';
            $sorttime = 'asc';
            $setup = 'setup';
            $asc = 'asc';
            $desc = 'desc';
            $table_tickets = 'tickets';
            $open = 'Open';
            $closed = 'Closed';
            $addressed = 'Addressed';
            $type = 'inpatient';

            $ip_feedbacks_count = $this->ipd_model->patient_and_feedback($table_patients, $table_feedback, $sorttime, $setup);
            $ticket_resolution_rate = $this->ipd_model->ticket_resolution_rate($table_tickets, $closed, $table_feedback);
            $ip_tickets_count = $this->tickets_model->alltickets();
            $ip_open_tickets = $this->tickets_model->read();
            $ip_closed_tickets = $this->tickets_model->read_close();
            $ip_addressed_tickets = $this->tickets_model->addressedtickets();

            $ip_nps = $this->ipd_model->nps_analytics($table_feedback, $asc, $setup);
            $ip_psat = $this->ipd_model->psat_analytics($table_patients, $table_feedback, $table_tickets, $sorttime);

            $dataexport = array();
            $i = 0;

            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];

            $dataexport[$i]['row1'] = 'IPD FEEDBACK OVERALL REPORT';
            $dataexport[$i]['row2'] = '';
            $dataexport[$i]['row3'] = '';
            $dataexport[$i]['row4'] = '';
            $i++;

            $dataexport[$i]['row1'] = 'FROM DATE';
            $dataexport[$i]['row2'] = $tdate;
            $dataexport[$i]['row3'] = '';
            $dataexport[$i]['row4'] = '';
            $i++;

            $dataexport[$i]['row1'] = 'TO DATE';
            $dataexport[$i]['row2'] = $fdate;
            $dataexport[$i]['row3'] = '';
            $dataexport[$i]['row4'] = '';
            $i++;

            $dataexport[$i]['row1'] = 'TOTAL FEEDBACKS SUBMITTED';
            $dataexport[$i]['row2'] = count($ip_feedbacks_count);
            $dataexport[$i]['row3'] = '';
            $dataexport[$i]['row4'] = '';
            $i++;

            $dataexport[$i]['row1'] = '';
            $dataexport[$i]['row2'] = '';
            $dataexport[$i]['row3'] = '';
            $dataexport[$i]['row4'] = '';
            $i++;


            $dataexport[$i]['row1'] = 'SATISFACTION INDEX';
            $dataexport[$i]['row2'] = $ip_psat['psat_score'] . '%';
            $dataexport[$i]['row3'] = '';
            $dataexport[$i]['row4'] = '';
            $i++;

            $dataexport[$i]['row1'] = 'SATISFIED PATIENTS';
            $dataexport[$i]['row2'] = $ip_psat['satisfied_count'];
            $dataexport[$i]['row3'] = '';
            $dataexport[$i]['row4'] = '';
            $i++;

            $dataexport[$i]['row1'] = 'UNSATISFIED PATIENTS';
            $dataexport[$i]['row2'] = $ip_psat['unsatisfied_count'];
            $dataexport[$i]['row3'] = '';
            $dataexport[$i]['row4'] = '';
            $i++;

            $dataexport[$i]['row1'] = '';
            $dataexport[$i]['row2'] = '';
            $dataexport[$i]['row3'] = '';
            $dataexport[$i]['row4'] = '';
            $i++;

            //add here
            $dataexport[$i]['row1'] = 'NET PROMOTER SCORE';
            $dataexport[$i]['row2'] = $ip_nps['nps_score'] . '%';
            $dataexport[$i]['row3'] = '';
            $dataexport[$i]['row4'] = '';
            $i++;

            $dataexport[$i]['row1'] = 'NO. OF PROMOTERS';
            $dataexport[$i]['row2'] = $ip_nps['promoters_count'];
            $dataexport[$i]['row3'] = '';
            $dataexport[$i]['row4'] = '';
            $i++;

            $dataexport[$i]['row1'] = 'NO. OF PASSIVES';
            $dataexport[$i]['row2'] = $ip_nps['passives_count'];
            $dataexport[$i]['row3'] = '';
            $dataexport[$i]['row4'] = '';
            $i++;

            $dataexport[$i]['row1'] = 'NO. OF DETRACTORS';
            $dataexport[$i]['row2'] = $ip_nps['detractors_count'];
            $dataexport[$i]['row3'] = '';
            $dataexport[$i]['row4'] = '';
            $i++;


            $dataexport[$i]['row1'] = '';
            $dataexport[$i]['row2'] = '';
            $dataexport[$i]['row3'] = '';
            $dataexport[$i]['row4'] = '';
            $i++;


            $dataexport[$i]['row1'] = 'TICKETS REPORT';
            $dataexport[$i]['row2'] = '';
            $dataexport[$i]['row3'] = '';
            $dataexport[$i]['row4'] = '';
            $i++;

            $dataexport[$i]['row1'] = 'TOTAL TICKETS';
            $dataexport[$i]['row2'] = count($ip_tickets_count);
            $dataexport[$i]['row3'] = '';
            $dataexport[$i]['row4'] = '';
            $i++;

            $dataexport[$i]['row1'] = 'TICKET RESOLUTION RATE';
            $dataexport[$i]['row2'] = $ticket_resolution_rate . '%';
            $dataexport[$i]['row3'] = '';
            $dataexport[$i]['row4'] = '';
            $i++;
            $dataexport[$i]['row1'] = 'OPEN TICKETS';
            $dataexport[$i]['row2'] = count($ip_open_tickets);
            $dataexport[$i]['row3'] = '';
            $dataexport[$i]['row4'] = '';
            $i++;
            if (ticket_addressal('ip_addressal') === true) {
                $dataexport[$i]['row1'] = 'ADDRESSED TICKETS';
                $dataexport[$i]['row2'] = count($ip_addressed_tickets);
                $dataexport[$i]['row3'] = '';
                $dataexport[$i]['row4'] = '';
                $i++;
            }
            $dataexport[$i]['row1'] = 'CLOSED TICKETS';
            $dataexport[$i]['row2'] = count($ip_closed_tickets);
            $dataexport[$i]['row3'] = '';
            $dataexport[$i]['row4'] = '';
            $i++;

            $dataexport[$i]['row1'] = '';
            $dataexport[$i]['row2'] = '';
            $dataexport[$i]['row3'] = '';
            $dataexport[$i]['row4'] = '';
            $i++;



            $dataexport[$i]['row1'] = 'TICKETS RECEIVED BY DEPARTMENT';
            $dataexport[$i]['row2'] = 'PERCENTAGE';
            $dataexport[$i]['row3'] = 'COUNT';
            $dataexport[$i]['row4'] = 'OPEN';
            if (ticket_addressal('ip_addressal') === true) {

                $dataexport[$i]['row5'] = 'ADDRESSED';
            }
            $dataexport[$i]['row6'] = 'CLOSED';
            $dataexport[$i]['row7'] = 'RESOLUTION RATE';
            $dataexport[$i]['row8'] = 'RESOLUTION TIME';
            $dataexport[$i]['row9'] = '';
            $i++;

            $ticket = $this->ipd_model->tickets_recived_by_department($type, $table_feedback, $table_tickets);
            foreach ($ticket as $ps) {
                $time = secondsToTimeforreport($ps['res_time']);
                $dataexport[$i]['row1'] = $ps['department'];
                $dataexport[$i]['row2'] = $ps['percentage'] . '%';
                $dataexport[$i]['row3'] = $ps['count'];
                $dataexport[$i]['row4'] = $ps['open_tickets'];
                if (ticket_addressal('ip_addressal') === true) {

                    $dataexport[$i]['row5'] = $ps['addressed_tickets'];
                }
                $dataexport[$i]['row6'] = $ps['closed_tickets'];
                $dataexport[$i]['row6'] = $ps['closed_tickets'];
                $dataexport[$i]['row7'] = $ps['tr_rate'] . '%';
                $dataexport[$i]['row8'] = $time;
                $dataexport[$i]['row9'] = '';
                $i++;
            }

            $dataexport[$i]['row1'] = '';
            $dataexport[$i]['row2'] = '';
            $dataexport[$i]['row3'] = '';
            $dataexport[$i]['row4'] = '';
            $i++;


            $dataexport[$i]['row1'] = 'WHY PATIENTS CHOSE YOUR HOSPITAL';
            $dataexport[$i]['row2'] = '';
            $dataexport[$i]['row3'] = '';
            $dataexport[$i]['row4'] = '';
            $i++;

            $dataexport[$i]['row1'] = 'REASON';
            $dataexport[$i]['row2'] = 'PERCENTAGE';
            $dataexport[$i]['row3'] = 'COUNT';
            $dataexport[$i]['row4'] = '';
            $i++;


            $choice_of_hospitals = $this->ipd_model->reason_to_choose_hospital($table_feedback, $sorttime);

            foreach ($choice_of_hospitals as $key => $object) {

                $dataexport[$i]['row1'] = $object->title;
                $dataexport[$i]['row2'] = $object->percentage . '%';
                $dataexport[$i]['row3'] = $object->count;
                $dataexport[$i]['row4'] = '';
                $i++;
            }


            $dataexport[$i]['row1'] = '';
            $dataexport[$i]['row2'] = '';
            $dataexport[$i]['row3'] = '';
            $dataexport[$i]['row4'] = '';
            $i++;

            $dataexport[$i]['row1'] = '';
            $dataexport[$i]['row2'] = '';
            $dataexport[$i]['row3'] = '';
            $dataexport[$i]['row4'] = '';
            $i++;
            //echo '<pre>';
            //print_r($dataexport); exit; 
            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF - OVERALL IPD FEEDBACKS REPORT  - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                //fputcsv($fp, $header,',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function overall_patient_excel()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_feedback';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->ipd_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->ipd_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }

            $header[0] = 'Date';
            $header[1] = 'Patient Name';
            $header[2] = 'Patient ID';
            $header[3] = 'Floor/Ward ';
            $header[4] = 'Room/Bed';
            $header[5] = 'Mobile Number';
            $header[6] = 'Email id';
            $j = 7;
            foreach ($arraydata as $k => $r) {
                $header[$j] = $r;
                $j++;
            }
            $header[$j++] = 'Average Rating';
            $header[$j++] = 'NPS Score';
            $header[$j++] = 'Recommneded Staff';
            $header[$j++] = 'Comments';
            foreach ($setarray as $r) {
                $header[$j] = $r . ' comment';
                $j++;
            }
            $dataexport = array();
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);
                $dataexport[$i]['date'] = date('d-m-Y', strtotime($row->datetime));
                $dataexport[$i]['name'] = $data['name'];
                $dataexport[$i]['patient_id'] = $data['patientid'];
                $dataexport[$i]['ward'] = $data['ward'];
                $dataexport[$i]['bedno'] = $data['bedno'];
                $dataexport[$i]['mobile'] = $data['contactnumber'];
                $dataexport[$i]['email'] = $data['email'];
                foreach ($arraydata as $k => $r) {
                    $dataexport[$i][$k] = $data[$k];
                }
                $dataexport[$i]['overallScore'] = $data['overallScore'];
                $dataexport[$i]['recommend1Score'] = ($data['recommend1Score']) * 2;
                $dataexport[$i]['staffname'] = $data['staffname'];
                $dataexport[$i]['suggestionText'] = $data['suggestionText'];
                foreach ($setarray as $key => $t) {
                    if ($data['comment'][$key] != '') {
                        $dataexport[$i][$key] = $data['comment'][$key];
                    } else {
                        $dataexport[$i][$key] = '';
                    }
                }
                $i++;
            }
            $newdataset = $dataexport;
            $d = array();
            $p = array();
            $n = array();
            $para = array();
            $for5 = array();
            $for4 = array();
            $for3 = array();
            $for2 = array();
            $for1 = array();
            foreach ($dataexport as $row) {
                foreach ($row as $k => $r) {
                    if ($r * 1 > 0) {
                        $d[$k] = $d[$k] + 1;
                        if ($r > 2) {
                            $p[$k] = $p[$k] + 1;
                        } else {
                            $n[$k] = $n[$k] + 1;
                        }
                        $para[$k] = $para[$k] + $r;
                        if ($k == 'overallScore') {
                            if ($r == 5) {
                                $for5[$k] = $for5[$k] + 1;
                            }
                            if ($r == 4) {
                                $for4[$k] = $for4[$k] + 1;
                            }
                            if ($r == 3) {
                                $for3[$k] = $for3[$k] + 1;
                            }
                            if ($r == 2) {
                                $for2[$k] = $for2[$k] + 1;
                            }
                            if ($r == 1) {
                                $for1[$k] = $for1[$k] + 1;
                            }
                        }
                    }
                }
            }

            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- IPD PATIENT WISE FEEDBACK REPORT - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function download_promoter_list()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_feedback';
            $desc = 'desc';
            $setup = 'setup';

            $ip_nps = $this->ipd_model->nps_analytics($table_feedback, $desc, $setup);
            $feedback = $ip_nps['promoters_feedbacks'];



            $header[0] = 'Patient Name';
            $header[1] = 'Patient ID';
            $header[2] = 'Floor/Ward';
            $header[3] = 'Room/Bed';
            $header[4] = 'Mobile Number';
            $header[5] = 'Email id';
            $header[6] = 'NPS score';
            $header[7] = 'Average rating';
            $header[8] = 'General comment';

            $dataexport = array();
            $i = 0;
            foreach ($feedback as $row) {


                $dataexport[$i]['name'] = $row->name;
                $dataexport[$i]['patient_id'] = $row->patientid;
                $dataexport[$i]['ward'] = $row->ward;
                $dataexport[$i]['bedno'] = $row->bedno;
                $dataexport[$i]['mobile'] = $row->contactnumber;
                $dataexport[$i]['email'] = $row->email;
                $dataexport[$i]['nps_score'] = ($row->recommend1Score) * 2;
                $dataexport[$i]['overallScore'] = $row->overallScore;
                $dataexport[$i]['suggestionText'] = $row->suggestionText;

                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'IPD PROMOTERS LIST - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function download_passive_list()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_feedback';
            $desc = 'desc';
            $setup = 'setup';

            $ip_nps = $this->ipd_model->nps_analytics($table_feedback, $desc, $setup);
            $feedback = $ip_nps['passives_feedback'];



            $header[0] = 'Patient Name';
            $header[1] = 'Patient ID';
            $header[2] = 'Floor/Ward';
            $header[3] = 'Room/Bed';
            $header[4] = 'Mobile Number';
            $header[5] = 'Email id';
            $header[6] = 'NPS score';
            $header[7] = 'Average rating';
            $header[8] = 'General comment';

            $dataexport = array();
            $i = 0;
            foreach ($feedback as $row) {


                $dataexport[$i]['name'] = $row->name;
                $dataexport[$i]['patient_id'] = $row->patientid;
                $dataexport[$i]['ward'] = $row->ward;
                $dataexport[$i]['bedno'] = $row->bedno;
                $dataexport[$i]['mobile'] = $row->contactnumber;
                $dataexport[$i]['email'] = $row->email;
                $dataexport[$i]['nps_score'] = ($row->recommend1Score) * 2;
                $dataexport[$i]['overallScore'] = $row->overallScore;
                $dataexport[$i]['suggestionText'] = $row->suggestionText;

                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'IPD PASSIVES LIST - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function download_detractor_list()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_feedback';
            $desc = 'desc';
            $setup = 'setup';

            $ip_nps = $this->ipd_model->nps_analytics($table_feedback, $desc, $setup);
            $feedback = $ip_nps['detractors_feedback'];



            $header[0] = 'Patient Name';
            $header[1] = 'Patient ID';
            $header[2] = 'Floor/Ward';
            $header[3] = 'Room/Bed';
            $header[4] = 'Mobile Number';
            $header[5] = 'Email id';
            $header[6] = 'NPS score';
            $header[7] = 'Average rating';
            $header[8] = 'General comment';

            $dataexport = array();
            $i = 0;
            foreach ($feedback as $row) {


                $dataexport[$i]['name'] = $row->name;
                $dataexport[$i]['patient_id'] = $row->patientid;
                $dataexport[$i]['ward'] = $row->ward;
                $dataexport[$i]['bedno'] = $row->bedno;
                $dataexport[$i]['mobile'] = $row->contactnumber;
                $dataexport[$i]['email'] = $row->email;
                $dataexport[$i]['nps_score'] = ($row->recommend1Score) * 2;
                $dataexport[$i]['overallScore'] = $row->overallScore;
                $dataexport[$i]['suggestionText'] = $row->suggestionText;

                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'IPD DETRACTORS LIST - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function download_staff_list()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_feedback';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $all_feedback = $this->ipd_model->patient_and_feedback($table_patients, $table_feedback, $desc, $setup);
            $feedback = $all_feedback;


            $header[0] = 'Patient Name';
            $header[1] = 'Patient ID';
            $header[2] = 'Floor/Ward';
            $header[3] = 'Room/Bed';
            $header[4] = 'Mobile Number';
            $header[5] = 'Staff name';


            $dataexport = array();
            $i = 0;
            foreach ($feedback as $row) {
                $param = json_decode($row->dataset);
                if ($param->staffname) {
                    $dataexport[$i]['name'] = $param->name;
                    $dataexport[$i]['patient_id'] = $param->patientid;
                    $dataexport[$i]['ward'] = $param->ward;
                    $dataexport[$i]['bedno'] = $param->bedno;
                    $dataexport[$i]['mobile'] = $param->contactnumber;
                    $dataexport[$i]['staffname'] = $param->staffname;


                    $i++;
                }
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'IPD STAFF LIST - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function download_satisfied_list()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_feedback';
            $table_patients = 'bf_patients';
            $table_tickets = 'tickets';
            $desc = 'desc';
            $setup = 'setup';

            $ip_psat = $this->ipd_model->psat_analytics($table_patients, $table_feedback, $table_tickets, $desc);
            $feedback = $ip_psat['satisfied_feedback'];

            $header[0] = 'Patient Name';
            $header[1] = 'Patient ID';
            $header[2] = 'Floor/Ward';
            $header[3] = 'Room/Bed';
            $header[4] = 'Mobile Number';
            $header[5] = 'Email id';
            $header[6] = 'Average rating';
            $header[7] = 'General comment';

            $dataexport = array();
            $i = 0;
            foreach ($feedback as $row) {


                $dataexport[$i]['name'] = $row->name;
                $dataexport[$i]['patient_id'] = $row->patientid;
                $dataexport[$i]['ward'] = $row->ward;
                $dataexport[$i]['bedno'] = $row->bedno;
                $dataexport[$i]['mobile'] = $row->contactnumber;
                $dataexport[$i]['email'] = $row->email;
                $dataexport[$i]['overallScore'] = $row->overallScore;
                $dataexport[$i]['suggestionText'] = $row->suggestionText;

                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'IPD SATISFIED LIST - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function download_unsatisfied_list()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $table_feedback = 'bf_feedback';
            $table_patients = 'bf_patients';
            $table_tickets = 'tickets';
            $desc = 'desc';
            $setup = 'setup';

            $ip_psat = $this->ipd_model->psat_analytics($table_patients, $table_feedback, $table_tickets, $desc);
            $feedback = $ip_psat['unsatisfied_feedback'];

            $sresult = $this->ipd_model->setup_result($setup);

            foreach ($sresult as $r) {
                $questionarray[$r->shortkey] = $r->shortkey;
                $titles[$r->shortkey] = $r->title;
            }

            $rresult = $this->ipd_model->setup_sub_result($setup);
            foreach ($rresult as $r) {
                // $setarray[$r->type] = $r->title;
                $setarray[$r->shortkey] = $r->shortkey;
                $titles[$r->shortkey] = $r->title;
                $shortname[$r->shortkey] = $r->shortname;
            }


            $header[0] = 'Patient Name';
            $header[1] = 'Patient ID';
            $header[2] = 'Floor/Ward';
            $header[3] = 'Room/Bed';
            $header[4] = 'Mobile Number';
            $header[5] = 'Email id';
            $header[6] = 'Average rating';
            $header[7] = 'NPS score';
            $header[8] = 'Departments';
            $header[9] = 'Concern';

            $dataexport = array();
            $i = 0;
            foreach ($feedback as $row) {


                $dataexport[$i]['name'] = $row->name;
                $dataexport[$i]['patient_id'] = $row->patientid;
                $dataexport[$i]['ward'] = $row->ward;
                $dataexport[$i]['bedno'] = $row->bedno;
                $dataexport[$i]['mobile'] = $row->contactnumber;
                $dataexport[$i]['email'] = $row->email;
                $dataexport[$i]['overallScore'] = $row->overallScore;
                $dataexport[$i]['nps_score'] = ($row->recommend1Score) * 2;
                foreach ($questionarray as $key) {
                    if (isset($row->$key) && $row->$key <= 3) {
                        $result->$key = $row->$key;
                        if ($result->$key) {
                            $dataexport[$i]['department'] = $titles[$key] . ' ';
                        }
                    }
                }

                foreach ($setarray as $key2) {
                    if (isset($row->reason->$key2) && $row->reason->$key2) {
                        $rzn->$key2 = $row->reason->$key2;
                        if ($rzn->$key2) {
                            $dataexport[$i]['concern'] = $shortname[$key2] . ' ';
                        }
                    }
                }

                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'IPD UNSATISFIED LIST - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }




    public function overall_department_excel()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $dataexport = array();
            $i = 0;
            $table_feedback = 'bf_feedback';
            $table_patients = 'bf_patients';
            $sorttime = 'asc';
            $setup = 'setup';
            $asc = 'asc';
            $desc = 'desc';
            $table_tickets = 'tickets';
            $open = 'Open';
            $closed = 'Closed';
            $addressed = 'Addressed';
            $type = 'inpatient';

            $ip_tickets_count = $this->tickets_model->alltickets();
            $ip_open_tickets = $this->tickets_model->read();
            $ip_closed_tickets = $this->tickets_model->read_close();
            $ip_addressed_tickets = $this->tickets_model->addressedtickets();
            $ip_feedbacks_count = $this->ipd_model->patient_and_feedback($table_patients, $table_feedback, $sorttime, $setup);

            $ticket_resolution_rate = $this->ipd_model->ticket_resolution_rate($table_tickets, $closed, $table_feedback);

            $sresult = $this->ipd_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();

            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];

            $dataexport[$i]['row1'] = 'TICKETS REPORT';
            $dataexport[$i]['row2'] = '';
            $dataexport[$i]['row3'] = '';
            $dataexport[$i]['row4'] = '';
            $i++;


            $dataexport[$i]['row1'] = 'FROM DATE';
            $dataexport[$i]['row2'] = $tdate;
            $dataexport[$i]['row3'] = '';
            $dataexport[$i]['row4'] = '';
            $i++;

            $dataexport[$i]['row1'] = 'TO DATE';
            $dataexport[$i]['row2'] = $fdate;
            $dataexport[$i]['row3'] = '';
            $dataexport[$i]['row4'] = '';
            $i++;

            $dataexport[$i]['row1'] = 'TOTAL FEEDBACKS SUBMITTED';
            $dataexport[$i]['row2'] = count($ip_feedbacks_count);
            $dataexport[$i]['row3'] = '';
            $dataexport[$i]['row4'] = '';
            $i++;

            $dataexport[$i]['row1'] = '';
            $dataexport[$i]['row2'] = '';
            $dataexport[$i]['row3'] = '';
            $dataexport[$i]['row4'] = '';
            $i++;


            $dataexport[$i]['row1'] = 'TOTAL TICKETS';
            $dataexport[$i]['row2'] = count($ip_tickets_count);
            $dataexport[$i]['row3'] = '';
            $dataexport[$i]['row4'] = '';
            $i++;

            $dataexport[$i]['row1'] = 'TICKET RESOLUTION RATE';
            $dataexport[$i]['row2'] = $ticket_resolution_rate . '%';
            $dataexport[$i]['row3'] = '';
            $dataexport[$i]['row4'] = '';
            $i++;

            $dataexport[$i]['row1'] = 'OPEN TICKETS';
            $dataexport[$i]['row2'] = count($ip_open_tickets);
            $dataexport[$i]['row3'] = '';
            $dataexport[$i]['row4'] = '';
            $i++;


            if (ticket_addressal('ip_addressal') === true) {
                $dataexport[$i]['row1'] = 'ADDRESSED TICKETS';
                $dataexport[$i]['row2'] = count($ip_addressed_tickets);
                $dataexport[$i]['row3'] = '';
                $dataexport[$i]['row4'] = '';
                $i++;
            }

            $dataexport[$i]['row1'] = 'CLOSED TICKETS';
            $dataexport[$i]['row2'] = count($ip_closed_tickets);
            $dataexport[$i]['row3'] = '';
            $dataexport[$i]['row4'] = '';
            $i++;

            $dataexport[$i]['row1'] = '';
            $dataexport[$i]['row2'] = '';
            $dataexport[$i]['row3'] = '';
            $dataexport[$i]['row4'] = '';
            $i++;


            $dataexport[$i]['row1'] = 'TICKETS RECEIVED BY DEPARTMENT';
            $dataexport[$i]['row2'] = 'PERCENTAGE';
            $dataexport[$i]['row3'] = 'COUNT';
            $dataexport[$i]['row4'] = 'OPEN';
            if (ticket_addressal('ip_addressal') === true) {
                $dataexport[$i]['row5'] = 'ADDRESSED';
            }
            $dataexport[$i]['row6'] = 'CLOSED';
            $dataexport[$i]['row7'] = 'RESOLUTION RATE';
            $dataexport[$i]['row8'] = 'RESOLUTION TIME';
            $dataexport[$i]['row9'] = '';
            $i++;

            $ticket = $this->ipd_model->tickets_recived_by_department($type, $table_feedback, $table_tickets);
            foreach ($ticket as $ps) {
                $time = secondsToTimeforreport($ps['res_time']);
                $dataexport[$i]['row1'] = $ps['department'];
                $dataexport[$i]['row2'] = $ps['percentage'] . '%';
                $dataexport[$i]['row3'] = $ps['count'];
                $dataexport[$i]['row4'] = $ps['open_tickets'];
                if (ticket_addressal('ip_addressal') === true) {
                    $dataexport[$i]['row5'] = $ps['addressed_tickets'];
                }
                $dataexport[$i]['row6'] = $ps['closed_tickets'];
                $dataexport[$i]['row7'] = $ps['tr_rate'] . '%';
                $dataexport[$i]['row8'] = $time;
                $dataexport[$i]['row9'] = '';
                $i++;
            }


            $dataexport[$i]['row1'] = '';
            $dataexport[$i]['row2'] = '';
            $dataexport[$i]['row3'] = '';
            $dataexport[$i]['row4'] = '';
            $i++;


            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }

            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();

            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $dataexport[$i]['row1'] = 'DEPARTMENT WISE FEEDBACK REPORT';
            $dataexport[$i]['row2'] = '';
            $dataexport[$i]['row3'] = '';
            $dataexport[$i]['row4'] = '';
            $i++;

            $k = 2;
            $dataexport[$i]['name'] = 'TITLE';
            foreach ($arraydata as $k => $r) {
                $dataexport[$i][$k] = $r;
                $k++;
            }
            $i++;



            $d = array();
            $p = array();
            $n = array();
            $para = array();
            $for5 = array();
            $for4 = array();
            $for3 = array();
            $for2 = array();
            $for1 = array();

            foreach ($ip_feedbacks_count as $row) {
                $data = json_decode($row->dataset, true);
                $dataexportt[$i]['name'] = $data['name'];
                $dataexportt[$i]['patient_id'] = $data['patientid'];
                $dataexportt[$i]['mobile'] = $data['mobile'];
                $dataexportt[$i]['email'] = $data['email'];
                foreach ($arraydata as $k => $r) {
                    $dataexportt[$i][$k] = $data[$k];
                }
                $dataexportt[$i]['overallScore'] = $data['overallScore'];
                $i++;
            }
            $i++;

            foreach ($dataexportt as $row) {
                foreach ($row as $k => $r) {
                    if ($r * 1 > 0) {
                        $d[$k] = $d[$k] + 1;
                        if ($r > 2) {
                            $p[$k] = $p[$k] + 1;
                        } else {
                            $n[$k] = $n[$k] + 1;
                        }
                        $para[$k] = $para[$k] + $r;
                        if ($k == 'overallScore') {
                            if ($r == 5) {
                                $for5[$k] = $for5[$k] + 1;
                            }
                            if ($r == 4) {
                                $for4[$k] = $for4[$k] + 1;
                            }
                            if ($r == 3) {
                                $for3[$k] = $for3[$k] + 1;
                            }
                            if ($r == 2) {
                                $for2[$k] = $for2[$k] + 1;
                            }
                            if ($r == 1) {
                                $for1[$k] = $for1[$k] + 1;
                            }
                        }
                    }
                }
            }

            $dataexport[$i]['name'] = 'RELATIVE PERFORMANCE';
            foreach ($arraydata as $k => $r) {
                if ($d[$k] * 5 != 0) {
                    $dataexport[$i][$k] = round(($para[$k] / ($d[$k] * 5)) * 100) . '%';
                } else {
                    $dataexport[$i][$k] = '-';  // or some other value that indicates undefined or not applicable
                }
            }
            $i++;

            $dataexport[$i]['name'] = 'MAXIMUM SCORE';
            foreach ($arraydata as $k => $r) {
                $dataexport[$i][$k] = $d[$k] * 5;
            }
            $i++;

            $dataexport[$i]['name'] = 'PARAMETER SCORE';
            foreach ($arraydata as $k => $r) {
                $dataexport[$i][$k] = $para[$k];
            }
            $i++;

            $dataexport[$i]['name'] = 'POSITIVE RATINGS RECIEVED';
            foreach ($arraydata as $k => $r) {
                $dataexport[$i][$k] = $p[$k];
            }
            $i++;

            $dataexport[$i]['name'] = 'NEGATIVE RATINGS RECIEVED';
            foreach ($arraydata as $k => $r) {
                $dataexport[$i][$k] = $n[$k];
            }
            $i++;


            $dataexport[$i]['name'] = 'TOTAL RESPONSES';
            foreach ($arraydata as $k => $r) {
                $dataexport[$i][$k] = $d[$k];
            }
            $i++;


            $dataexport[$i]['row1'] = '';
            $dataexport[$i]['row2'] = '';
            $dataexport[$i]['row3'] = '';
            $dataexport[$i]['row4'] = '';
            $i++;

            // $header1='sdgf';
            ob_end_clean();
            $fileName = 'EF- IPD DEPARTMENT WISE TICKET REPORT - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function overall_pdf_report()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            redirect('pdfreport/ip_pdf_report?fdate=' . $tdate . '&tdate=' . $fdate);
            // redirect('report/ip_capa_report');

        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function download_capa_report()
    {
        if (ismodule_active('AUDIT') === true) {






            $fdate = $_SESSION['from_date'];

            $tdate = $_SESSION['to_date'];

            $this->db->select("*");

            $this->db->from('setup');

            //$this->db->where('parent', 0);

            $query = $this->db->get();

            $reasons = $query->result();

            foreach ($reasons as $row) {

                $keys[$row->shortkey] = $row->shortkey;

                $res[$row->shortkey] = $row->shortname;

                $titles[$row->shortkey] = $row->title;
            }



            $dataexport = array();

            $i = 0;

            $departments = $this->tickets_model->read_close();



            $dataexport[$i]['row1'] = 'SL No.';

            $dataexport[$i]['row2'] = 'TICKET ID';

            $dataexport[$i]['row3'] = 'CREATED ON';

            $dataexport[$i]['row4'] = 'PATIENT DETAILS';

            $dataexport[$i]['row5'] = 'CONCERN';

            $dataexport[$i]['row6'] = 'DEPARTMENT';

            $dataexport[$i]['row7'] = 'ASSIGNEE';

            $dataexport[$i]['row8'] = 'RCA';

            $dataexport[$i]['row9'] = 'CAPA';

            $dataexport[$i]['row10'] = 'RESOLVED ON';

            $dataexport[$i]['row11'] = 'TURN AROUND TIME';

            // $dataexport[$i]['row12'] = 'TAT STATUS';

            $i++;



            if (!empty($departments)) {

                $sl = 1;

                foreach ($departments as $department) {
                    // changes here sooraj
                    if ($department->status == 'Closed') {
                        if ($department->departmentid_trasfered != 0) {
                            $issue = NULL;
                        } else {
                            foreach ($department->feed->reason as $key => $value) {
                                if ($key) {
                                    if ($titles[$key] == $department->department->description) {
                                        if (in_array($key, $keys)) {
                                            $issue = $res[$key];
                                        }
                                    }
                                }
                            }
                        }

                        $root = [];
                        $corrective = [];
                        foreach ($department->replymessage as $r) {
                            if ($r->rootcause != NULL) {
                                $root[] = $r->rootcause;
                            }

                            if ($r->corrective != NULL) {
                                $corrective[] = $r->corrective;
                            }
                        }

                        $createdOn = strtotime($department->created_on);

                        $lastModified = strtotime($department->last_modified);

                        $timeDifferenceInSeconds = $lastModified - $createdOn;

                        $value = $this->ipd_model->convertSecondsToTime($timeDifferenceInSeconds);

                        $timetaken = '';

                        if ($value['days'] != 0) {

                            $timetaken .= $value['days'] . ' days, ';
                        }

                        if ($value['hours'] != 0) {

                            $timetaken .= $value['hours'] . ' hrs, ';
                        }

                        if ($value['minutes'] != 0) {

                            $timetaken .= $value['minutes'] . ' mins.';
                        }

                        if ($timeDifferenceInSeconds <= 60) {

                            $timetaken .= 'less than a minute';
                        }
                        $assignee = $department->department->pname;
                        $dataexport[$i]['row1'] = $sl;

                        $dataexport[$i]['row2'] = 'IPDT- ' . $department->id;

                        $dataexport[$i]['row3'] = date('g:i a, d-m-y', strtotime($department->created_on));

                        $dataexport[$i]['row4'] = $department->feed->name . '(' . $department->feed->patientid . ')';
                        if ($issue) {

                            $dataexport[$i]['row5'] = $issue;
                        } else {
                            $dataexport[$i]['row5'] = 'Ticket was transferred';
                        }

                        $dataexport[$i]['row6'] = $department->department->description;
                        if ($assignee) {
                            $dataexport[$i]['row7'] = $assignee;
                        } else {
                            $dataexport[$i]['row7'] = 'NA';
                        }
                        // changes here sooraj

                        $dataexport[$i]['row8'] = implode(", ", $root);

                        $dataexport[$i]['row9'] = implode(", ", $corrective);

                        $dataexport[$i]['row10'] = date('g:i a, d-m-y', strtotime($department->last_modified));

                        $dataexport[$i]['row11'] = $timetaken;


                        $i++;

                        $sl++;
                    }
                }
            }



            ob_end_clean();

            $fileName = 'EF- IPD CAPA REPORT - ' . $tdate . ' to ' . $fdate . '.csv';

            header('Pragma: public');

            header('Expires: 0');

            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');

            header('Cache-Control: private', false);

            header('Content-Type: text/csv');

            header('Content-Disposition: attachment;filename=' . $fileName);

            if (isset($dataexport[0])) {

                $fp = fopen('php://output', 'w');

                //print_r($header);

                fputcsv($fp, $header, ',');

                foreach ($dataexport as $values) {

                    //print_r($values); exit;

                    fputcsv($fp, $values, ',');
                }

                fclose($fp);
            }

            ob_flush();

            exit;
        }
    }

    public function download_alltickets()
    {
        if (ismodule_active('AUDIT') === true) {




            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            $this->db->select("*");
            $this->db->from('setup');
            $query = $this->db->get();
            $reasons = $query->result();
            foreach ($reasons as $row) {
                $keys[$row->shortkey] = $row->shortkey;
                $res[$row->shortkey] = $row->shortname;
                $titles[$row->shortkey] = $row->title;
            }
            $dataexport = array();
            $i = 0;
            $departments = $this->tickets_model->alltickets();
            $dataexport[$i]['row1'] = 'SL No.';
            $dataexport[$i]['row2'] = 'TICKET ID';
            $dataexport[$i]['row3'] = 'CREATED ON';
            $dataexport[$i]['row4'] = 'PATIENT NAME';
            $dataexport[$i]['row5'] = 'PATIENT ID';
            $dataexport[$i]['row6'] = 'PHONE NUMBER';
            $dataexport[$i]['row7'] = 'FLOOR/WARD';
            $dataexport[$i]['row8'] = 'BED NUMBER';
            $dataexport[$i]['row9'] = 'CONCERN';
            $dataexport[$i]['row10'] = 'DEPARTMENT';
            $dataexport[$i]['row11'] = 'ASSIGNEE';
            $dataexport[$i]['row12'] = 'STATUS';
            $dataexport[$i]['row13'] = 'TRANSFERRED TO';
            $dataexport[$i]['row14'] = 'LAST MODIFIED';
            $i++;
            if (!empty($departments)) {
                $sl = 1;
                foreach ($departments as $department) {

                    foreach ($department->feed->reason as $key => $value) {
                        if ($titles[$key] == $department->department->description) {
                            if (in_array($key, $keys)) {
                                $issue = $res[$key];
                            }
                        }


                        if ($department->departmentid_trasfered !== NULL && $department->departmentid_trasfered !== '') {
                            $this->db->select("*");
                            $this->db->from('department');
                            $this->db->where('dprt_id', $department->departmentid_trasfered);
                            $query = $this->db->get();
                            $moved_to_arr = $query->result();
                        }
                        $transfer_dep_desc = $moved_to_arr[0]->description;
                        if (!empty($department)) {
                            $dataexport[$i]['row1'] = $sl;
                            $dataexport[$i]['row2'] = 'IPDT- ' . $department->id;
                            $dataexport[$i]['row3'] = date('g:i a, d-m-y', strtotime($department->created_on));
                            $dataexport[$i]['row4'] = $department->feed->name;
                            $dataexport[$i]['row5'] = $department->feed->patientid;
                            $dataexport[$i]['row6'] = $department->feed->contactnumber;
                            $dataexport[$i]['row7'] = $department->feed->ward;
                            $dataexport[$i]['row8'] = $department->feed->bedno;
                            if ($issue) {

                                $dataexport[$i]['row9'] = $issue;
                            } else {
                                $dataexport[$i]['row9'] = 'Ticket was transferred';
                            }

                            $dataexport[$i]['row10'] = $department->department->description;
                            if ($department->department->pname != '' && $department->department->pname != NULL) {
                                $dataexport[$i]['row11'] = $department->department->pname;
                            } else {
                                $dataexport[$i]['row11'] = 'NA';
                            }
                            $dataexport[$i]['row12'] = $department->status;
                            if ($transfer_dep_desc) {

                                $dataexport[$i]['row13'] = $transfer_dep_desc;
                            } else {
                                $dataexport[$i]['row13'] = 'NA';
                            }
                            $dataexport[$i]['row14'] = date('g:i a, d-m-y', strtotime($department->last_modified));
                        }
                    }
                    $i++;
                    $sl++;
                }
            }



            ob_end_clean();

            $fileName = 'EF- IPD ALL TICKETS REPORT - ' . $tdate . ' to ' . $fdate . '.csv';

            header('Pragma: public');

            header('Expires: 0');

            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');

            header('Cache-Control: private', false);

            header('Content-Type: text/csv');

            header('Content-Disposition: attachment;filename=' . $fileName);

            if (isset($dataexport[0])) {

                $fp = fopen('php://output', 'w');

                //print_r($header);

                fputcsv($fp, $header, ',');

                foreach ($dataexport as $values) {

                    //print_r($values); exit;

                    fputcsv($fp, $values, ',');
                }

                fclose($fp);
            }

            ob_flush();

            exit;
        } else {

            redirect('dashboard/noaccess');
        }
    }


    public function download_opentickets()
    {
        if (ismodule_active('AUDIT') === true) {




            $departments = $this->tickets_model->alltickets();
            if (!empty($departments)) {

                $fdate = $_SESSION['from_date'];
                $tdate = $_SESSION['to_date'];
                $this->db->select("*");
                $this->db->from('setup');
                $query = $this->db->get();
                $reasons = $query->result();
                foreach ($reasons as $row) {
                    $keys[$row->shortkey] = $row->shortkey;
                    $res[$row->shortkey] = $row->shortname;
                    $titles[$row->shortkey] = $row->title;
                }
                $dataexport = array();
                $i = 0;

                $dataexport[$i]['row1'] = 'SL No.';
                $dataexport[$i]['row2'] = 'TICKET ID';
                $dataexport[$i]['row3'] = 'CREATED ON';
                $dataexport[$i]['row4'] = 'PATIENT NAME';
                $dataexport[$i]['row5'] = 'PATIENT ID';
                $dataexport[$i]['row6'] = 'PHONE NUMBER';
                $dataexport[$i]['row7'] = 'FLOOR/WARD';
                $dataexport[$i]['row8'] = 'BED NUMBER';
                $dataexport[$i]['row9'] = 'CONCERN';
                $dataexport[$i]['row10'] = 'DEPARTMENT';
                $dataexport[$i]['row11'] = 'ASSIGNEE';
                $dataexport[$i]['row12'] = 'STATUS';
                $dataexport[$i]['row13'] = 'TRANSFERRED TO';
                $dataexport[$i]['row14'] = 'LAST MODIFIED';
                $i++;
            }
            if (!empty($departments)) {
                $sl = 1;
                foreach ($departments as $department) {
                    if ($department->status != 'Closed') {
                        foreach ($department->feed->reason as $key => $value) {
                            if ($titles[$key] == $department->department->description) {
                                if (in_array($key, $keys)) {
                                    $issue = $res[$key];
                                }
                            }
                        }


                        if ($department->departmentid_trasfered !== NULL && $department->departmentid_trasfered !== '') {
                            $this->db->select("*");
                            $this->db->from('department');
                            $this->db->where('dprt_id', $department->departmentid_trasfered);
                            $query = $this->db->get();
                            $moved_to_arr = $query->result();
                        }
                        $transfer_dep_desc = $moved_to_arr[0]->description;
                        if (!empty($department)) {

                            $dataexport[$i]['row1'] = $sl;
                            $dataexport[$i]['row2'] = 'IPDT- ' . $department->id;
                            $dataexport[$i]['row3'] = date('g:i a, d-m-y', strtotime($department->created_on));
                            $dataexport[$i]['row4'] = $department->feed->name;
                            $dataexport[$i]['row5'] = $department->feed->patientid;
                            $dataexport[$i]['row6'] = $department->feed->contactnumber;
                            $dataexport[$i]['row7'] = $department->feed->ward;
                            $dataexport[$i]['row8'] = $department->feed->bedno;

                            if ($issue) {

                                $dataexport[$i]['row9'] = $issue;
                            } else {
                                $dataexport[$i]['row9'] = 'Ticket was transferred';
                            }
                            $dataexport[$i]['row10'] = $department->department->description;
                            if ($department->department->pname != '' && $department->department->pname != NULL) {
                                $dataexport[$i]['row11'] = $department->department->pname;
                            } else {
                                $dataexport[$i]['row11'] = 'NA';
                            }
                            $dataexport[$i]['row12'] = $department->status;
                            if ($transfer_dep_desc) {

                                $dataexport[$i]['row13'] = $transfer_dep_desc;
                            } else {
                                $dataexport[$i]['row13'] = 'NA';
                            }
                            $dataexport[$i]['row14'] = date('g:i a, d-m-y', strtotime($department->last_modified));
                        }

                        $i++;
                        $sl++;
                    }
                }
            }



            ob_end_clean();

            $fileName = 'EF- IPD OPEN TICKETS REPORT - ' . $tdate . ' to ' . $fdate . '.csv';

            header('Pragma: public');

            header('Expires: 0');

            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');

            header('Cache-Control: private', false);

            header('Content-Type: text/csv');

            header('Content-Disposition: attachment;filename=' . $fileName);

            if (isset($dataexport[0])) {

                $fp = fopen('php://output', 'w');

                //print_r($header);

                fputcsv($fp, $header, ',');

                foreach ($dataexport as $values) {

                    //print_r($values); exit;

                    fputcsv($fp, $values, ',');
                }

                fclose($fp);
            }

            ob_flush();

            exit;
        } else {

            redirect('dashboard/noaccess');
        }
    }


    public function ticket_resolution_rate()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {

            $data['title'] = 'IP- TICKET RESOLUTION RATE';
            #------------------------------#
            $data['content'] = $this->load->view('auditmodules/ticket_analisys_page', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function average_resolution_time()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('AUDIT') === true) {


            $data['title'] = 'IP- AVERAGE RESOLUTION TIME';
            #------------------------------#
            $data['content'] = $this->load->view('auditmodules/ticket_analisys_page', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
}
