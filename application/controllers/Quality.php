<?php
defined('BASEPATH') or exit('No direct script access allowed');

class Quality extends CI_Controller
{
    private $module;

    public function __construct()
    {
        parent::__construct();
        $this->load->library('session');

        if ($this->session->userdata('isLogIn') === false && $this->uri->segment(2) != 'track')
            redirect('login');

        $this->load->model(
            array(
                'dashboard_model',
                'efeedor_model',
                'tickets_model',
                'quality_model',
                'setting_model',
                'departmenthead_model',
            )
        );

        $dates = get_from_to_date();
        if (isset($_SESSION['from_date']) && isset($_SESSION['to_date'])) {
            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
        } else {
            $fdate = date('Y-m-d', time());
            $tdate = date('Y-m-d', strtotime('-365 days'));
            $_SESSION['from_date'] = $fdate;
            $_SESSION['to_date'] = $tdate;
        }

        $this->module = 'inpatient_modules';

        $this->session->set_userdata([
            'active_menu' => array('ip_dashboard', 'ip_ticket', 'ip_reports', 'ip_patients', 'ip_settings', 'ip_dep', 'ip_analysis'),
        ]);

        if (ismodule_active('QUALITY') === false && $this->uri->segment(2) != 'track')
            redirect('dashboard/noaccess');
    }

    // RESERVED FOR DEVELOPER OR COMPANY ACCESS
    public function index()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');

        if (ismodule_active('QUALITY') === true) {

            $data['title'] = 'IP MODULE CONFIGURATION';
            $data['content'] = $this->load->view('qualitymodules/developer', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }



    // SUPER ADMIN AND ADMIN LOGIN
    public function quality_welcome_page()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
		
		
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $data['title'] = 'QUALITY INDICATOR MANAGER DASHBOARD';
            #------------------------------#
            $data['content'] = $this->load->view('quality_welcome_page', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function delete_kpi($id)
    {
        $table = $this->input->get('table');

        if (empty($table)) {
            $this->session->set_flashdata('error', 'No table specified for deletion.');
            redirect($_SERVER['HTTP_REFERER']);
            return;
        }

        $tables = [
            // CQI3a
            'bf_feedback_CQI3a1',
            'bf_feedback_CQI3a2',
            'bf_feedback_CQI3a3',
            'bf_feedback_CQI3a4',
            'bf_feedback_CQI3a5',
            'bf_feedback_CQI3a6',
            'bf_feedback_CQI3a7',
            'bf_feedback_CQI3a8',
            'bf_feedback_CQI3a9',
            'bf_feedback_CQI3a10',
            'bf_feedback_CQI3a11',
            'bf_feedback_CQI3a12',
            'bf_feedback_CQI3a13',
            'bf_feedback_CQI3a14',
            'bf_feedback_CQI3a15',
            'bf_feedback_CQI3a16',
            'bf_feedback_CQI3a17',
            'bf_feedback_CQI3a18',
            'bf_feedback_CQI3a19',
            'bf_feedback_CQI3a20',
            'bf_feedback_CQI3a21',
            'bf_feedback_CQI3a22',

            // CQI3b
            'bf_feedback_CQI3b1',
            'bf_feedback_CQI3b2',
            'bf_feedback_CQI3b3',
            'bf_feedback_CQI3b4',
            'bf_feedback_CQI3b5',
            'bf_feedback_CQI3b6',
            'bf_feedback_CQI3b7',
            'bf_feedback_CQI3b8',
            'bf_feedback_CQI3b9',
            'bf_feedback_CQI3b10',
            'bf_feedback_CQI3b11',
            'bf_feedback_CQI3b12',
            'bf_feedback_CQI3b13',

            // CQI3c
            'bf_feedback_CQI3c1',
            'bf_feedback_CQI3c2',
            'bf_feedback_CQI3c3',
            'bf_feedback_CQI3c4',
            'bf_feedback_CQI3c5',
            'bf_feedback_CQI3c6',
            'bf_feedback_CQI3c7',
            'bf_feedback_CQI3c8',
            'bf_feedback_CQI3c9',
            'bf_feedback_CQI3c10',
            'bf_feedback_CQI3c11',
            'bf_feedback_CQI3c12',
            'bf_feedback_CQI3c13',
            'bf_feedback_CQI3c14',

            // CQI3d
            'bf_feedback_CQI3d1',
            'bf_feedback_CQI3d2',
            'bf_feedback_CQI3d3',
            'bf_feedback_CQI3d4',
            'bf_feedback_CQI3d5',

            // CQI3e
            'bf_feedback_CQI3e1',
            'bf_feedback_CQI3e2',
            'bf_feedback_CQI3e3',
            'bf_feedback_CQI3e4',
            'bf_feedback_CQI3e5',
            'bf_feedback_CQI3e6',
            'bf_feedback_CQI3e7',
            'bf_feedback_CQI3e8',
            'bf_feedback_CQI3e9',

            // CQI3f
            'bf_feedback_CQI3f1',
            'bf_feedback_CQI3f2',
            'bf_feedback_CQI3f3',
            'bf_feedback_CQI3f4',
            'bf_feedback_CQI3f5',
            'bf_feedback_CQI3f6',
            'bf_feedback_CQI3f7',
            'bf_feedback_CQI3f8',
            'bf_feedback_CQI3f9',
            'bf_feedback_CQI3f10',

            // CQI3g
            'bf_feedback_CQI3g1',
            'bf_feedback_CQI3g2',
            'bf_feedback_CQI3g3',
            'bf_feedback_CQI3g4',
            'bf_feedback_CQI3g5',
            'bf_feedback_CQI3g6',

            // CQI3h
            'bf_feedback_CQI3h1',
            'bf_feedback_CQI3h2',
            'bf_feedback_CQI3h3',
            'bf_feedback_CQI3h4',
            'bf_feedback_CQI3h5',
            'bf_feedback_CQI3h6',
            'bf_feedback_CQI3h7',
            'bf_feedback_CQI3h8',
            'bf_feedback_CQI3h9',

            // CQI3j
            'bf_feedback_CQI3j1',
            'bf_feedback_CQI3j2',
            'bf_feedback_CQI3j3',
            'bf_feedback_CQI3j4',
            'bf_feedback_CQI3j5',
            'bf_feedback_CQI3j6',
            'bf_feedback_CQI3j7',
            'bf_feedback_CQI3j8',
            'bf_feedback_CQI3j9',
            'bf_feedback_CQI3j10',
            'bf_feedback_CQI3j11',
            'bf_feedback_CQI3j12',
            'bf_feedback_CQI3j13',
            'bf_feedback_CQI3j14',
            'bf_feedback_CQI3j15',
            'bf_feedback_CQI3j16',
            'bf_feedback_CQI3j17',
            'bf_feedback_CQI3j18',
            'bf_feedback_CQI3j19',
            'bf_feedback_CQI3j20',
            'bf_feedback_CQI3j21',
            'bf_feedback_CQI3j22',
            'bf_feedback_CQI3j23',
            'bf_feedback_CQI3j24',
            'bf_feedback_CQI3j25',
            'bf_feedback_CQI3j26',
            'bf_feedback_CQI3j27',
            'bf_feedback_CQI3j28',
            'bf_feedback_CQI3j29',
            'bf_feedback_CQI3j30',
            'bf_feedback_CQI3j31',
            'bf_feedback_CQI3j32',
            'bf_feedback_CQI3j33',
            'bf_feedback_CQI3j34',

            // CQI4a
            'bf_feedback_CQI4a1',
            'bf_feedback_CQI4a2',
            'bf_feedback_CQI4a3',
            'bf_feedback_CQI4a4',
            'bf_feedback_CQI4a5',

            // CQI4b
            'bf_feedback_CQI4b1',
            'bf_feedback_CQI4b2',
            'bf_feedback_CQI4b3',
            'bf_feedback_CQI4b4',
            'bf_feedback_CQI4b5',
            'bf_feedback_CQI4b6',
            'bf_feedback_CQI4b7',
            'bf_feedback_CQI4b8',

            // CQI4c
            'bf_feedback_CQI4c1',
            'bf_feedback_CQI4c2',
            'bf_feedback_CQI4c3',
            'bf_feedback_CQI4c4',
            'bf_feedback_CQI4c5',
            'bf_feedback_CQI4c6',
            'bf_feedback_CQI4c7',
            'bf_feedback_CQI4c8',
            'bf_feedback_CQI4c9',
            'bf_feedback_CQI4c10',
            'bf_feedback_CQI4c11',
            'bf_feedback_CQI4c12',
            'bf_feedback_CQI4c13',
            'bf_feedback_CQI4c14',

            // CQI4d
            'bf_feedback_CQI4d1',
            'bf_feedback_CQI4d2',
            'bf_feedback_CQI4d3',
            'bf_feedback_CQI4d4',
            'bf_feedback_CQI4d5',
            'bf_feedback_CQI4d6',
            'bf_feedback_CQI4d7',
            'bf_feedback_CQI4d8',
            'bf_feedback_CQI4d9',
            'bf_feedback_CQI4d10',
            'bf_feedback_CQI4d11',

            // CQI4e
            'bf_feedback_CQI4e1',
            'bf_feedback_CQI4e2',
            'bf_feedback_CQI4e3',
            'bf_feedback_CQI4e4',
            'bf_feedback_CQI4e5',
            'bf_feedback_CQI4e6',
            'bf_feedback_CQI4e7',
            'bf_feedback_CQI4e8',

            // CQI4f
            'bf_feedback_CQI4f1',
            'bf_feedback_CQI4f2',
            'bf_feedback_CQI4f3',
            'bf_feedback_CQI4f4',
            'bf_feedback_CQI4f5',
            'bf_feedback_CQI4f6',
            'bf_feedback_CQI4f7',

            // CQI4g
            'bf_feedback_CQI4g1',
            'bf_feedback_CQI4g2',
            'bf_feedback_CQI4g3',
            'bf_feedback_CQI4g4',
            'bf_feedback_CQI4g5',
            'bf_feedback_CQI4g6',

            // CQI3k
            'bf_feedback_CQI3k1',
            'bf_feedback_CQI3k2',
            'bf_feedback_CQI3k3',
            'bf_feedback_CQI3k4',
            'bf_feedback_CQI3k5',
            'bf_feedback_CQI3k6',
            'bf_feedback_CQI3k7',
            'bf_feedback_CQI3k8',
            'bf_feedback_CQI3k9',
            'bf_feedback_CQI3k10',
            'bf_feedback_CQI3k11',
            'bf_feedback_CQI3k12',
            'bf_feedback_CQI3k13',
            'bf_feedback_CQI3k14',
            'bf_feedback_CQI3k15',
            'bf_feedback_CQI3k16',
            'bf_feedback_CQI3k17',
            'bf_feedback_CQI3k18',
            'bf_feedback_CQI3k19',
            'bf_feedback_CQI3k20',
            'bf_feedback_CQI3k21',
            'bf_feedback_CQI3k22',
            'bf_feedback_CQI3k23',
            'bf_feedback_CQI3k24',
            'bf_feedback_CQI3k25',
            'bf_feedback_CQI3k26',
            'bf_feedback_CQI3k27',
            'bf_feedback_CQI3k28',
            'bf_feedback_CQI3k29',
            'bf_feedback_CQI3k30',
            'bf_feedback_CQI3k31',
            'bf_feedback_CQI3k32',
            'bf_feedback_CQI3k33',
            'bf_feedback_CQI3k34',
            'bf_feedback_CQI3k35',
            'bf_feedback_CQI3k36',
            'bf_feedback_CQI3k37',
            'bf_feedback_CQI3k38',
            'bf_feedback_CQI3k39',
            'bf_feedback_CQI3k40',
            'bf_feedback_CQI3k41',
            'bf_feedback_CQI3k42',
            'bf_feedback_CQI3k43',
            'bf_feedback_CQI3k44',
            'bf_feedback_CQI3k45',
            'bf_feedback_CQI3k46',
            'bf_feedback_CQI3k47',
            'bf_feedback_CQI3k48',
            'bf_feedback_CQI3k49',
            'bf_feedback_CQI3k50',
            'bf_feedback_CQI3k51',
            'bf_feedback_CQI3k52',
            'bf_feedback_CQI3k53',
            'bf_feedback_CQI3k54',
            'bf_feedback_CQI3k55',
            'bf_feedback_CQI3k56',
            'bf_feedback_CQI3k57',
            'bf_feedback_CQI3k58',
            'bf_feedback_CQI3k59',
            'bf_feedback_CQI3k60',
            'bf_feedback_CQI3k61',
            'bf_feedback_CQI3k62',
            'bf_feedback_CQI3k63',
            'bf_feedback_CQI3k64',
            'bf_feedback_CQI3k65',
            'bf_feedback_CQI3k66',



            
            // CQI4h
            'bf_feedback_CQI4h1',
            'bf_feedback_CQI4h2',
            'bf_feedback_CQI4h3',
            'bf_feedback_CQI4h4',
            'bf_feedback_CQI4h5',
            'bf_feedback_CQI4h6',
            'bf_feedback_CQI4h7',
            'bf_feedback_CQI4h8',
            'bf_feedback_CQI4h9',
            'bf_feedback_CQI4h10',
            'bf_feedback_CQI4h11',
            'bf_feedback_CQI4h12',
            'bf_feedback_CQI4h13',
            'bf_feedback_CQI4h14',
            'bf_feedback_CQI4h15',
            'bf_feedback_CQI4h16',
            'bf_feedback_CQI4h17',
            'bf_feedback_CQI4h18',
            'bf_feedback_CQI4h19',
            'bf_feedback_CQI4h20',
            'bf_feedback_CQI4h21',
            'bf_feedback_CQI4h22',
            'bf_feedback_CQI4h23',
            'bf_feedback_CQI4h24',
            'bf_feedback_CQI4h25',
            'bf_feedback_CQI4h26',
            'bf_feedback_CQI4h27',
            'bf_feedback_CQI4h28',
            'bf_feedback_CQI4h29',
            'bf_feedback_CQI4h30',
            'bf_feedback_CQI4h31',
            'bf_feedback_CQI4h32',
            'bf_feedback_CQI4h33',
            'bf_feedback_CQI4h34',
            'bf_feedback_CQI4h35',
            'bf_feedback_CQI4h36',
            'bf_feedback_CQI4h37',
            'bf_feedback_CQI4h38',
            'bf_feedback_CQI4h39',
            'bf_feedback_CQI4h40',
            'bf_feedback_CQI4h41',
            'bf_feedback_CQI4h42',
            'bf_feedback_CQI4h43',
            'bf_feedback_CQI4h44',
            'bf_feedback_CQI4h45',
            'bf_feedback_CQI4h46',
            'bf_feedback_CQI4h47',
            'bf_feedback_CQI4h48',
            'bf_feedback_CQI4h49',
            'bf_feedback_CQI4h50',
            'bf_feedback_CQI4h51',
            'bf_feedback_CQI4h52',
            'bf_feedback_CQI4h53',
            'bf_feedback_CQI4h54',
            'bf_feedback_CQI4h55',
            'bf_feedback_CQI4h56',

            // CLOTCM
            'bf_feedback_CLOTCM1',
            'bf_feedback_CLOTCM2',
            'bf_feedback_CLOTCM3',
            'bf_feedback_CLOTCM4',
            'bf_feedback_CLOTCM5',
            'bf_feedback_CLOTCM6',
            'bf_feedback_CLOTCM7',
            'bf_feedback_CLOTCM8',
            'bf_feedback_CLOTCM9',
            'bf_feedback_CLOTCM10',
            'bf_feedback_CLOTCM11',
            'bf_feedback_CLOTCM12',
            'bf_feedback_CLOTCM13',
            'bf_feedback_CLOTCM14',
            'bf_feedback_CLOTCM15',
            'bf_feedback_CLOTCM16',
            'bf_feedback_CLOTCM17',
            'bf_feedback_CLOTCM18',
            'bf_feedback_CLOTCM19',
            'bf_feedback_CLOTCM20',
            'bf_feedback_CLOTCM21',
            'bf_feedback_CLOTCM22',
            'bf_feedback_CLOTCM23',
            'bf_feedback_CLOTCM24',
            'bf_feedback_CLOTCM25',
            'bf_feedback_CLOTCM26',
            'bf_feedback_CLOTCM27',
            'bf_feedback_CLOTCM28',
            'bf_feedback_CLOTCM29',
            'bf_feedback_CLOTCM30',

            // CQI4i
            'bf_feedback_CQI4i1',
            'bf_feedback_CQI4i2',
            'bf_feedback_CQI4i3',
            'bf_feedback_CQI4i4',
            'bf_feedback_CQI4i5',
            'bf_feedback_CQI4i6',
            'bf_feedback_CQI4i7',
            'bf_feedback_CQI4i8',
            'bf_feedback_CQI4i9',
            'bf_feedback_CQI4i10',
            'bf_feedback_CQI4i11',
            'bf_feedback_CQI4i12',
            'bf_feedback_CQI4i13',
            'bf_feedback_CQI4i14',

            // CQI4j
            'bf_feedback_CQI4j1',
            'bf_feedback_CQI4j2',
            'bf_feedback_CQI4j3',
            'bf_feedback_CQI4j4',
            'bf_feedback_CQI4j5',
            'bf_feedback_CQI4j6',
            'bf_feedback_CQI4j7',
            'bf_feedback_CQI4j8',
            'bf_feedback_CQI4j9',
            'bf_feedback_CQI4j10',
            'bf_feedback_CQI4j11',
            'bf_feedback_CQI4j12',
            'bf_feedback_CQI4j13',
            'bf_feedback_CQI4j14',
            'bf_feedback_CQI4j15',
            'bf_feedback_CQI4j16',
            'bf_feedback_CQI4j17',
            'bf_feedback_CQI4j18',
            'bf_feedback_CQI4j19',
            'bf_feedback_CQI4j20',
            'bf_feedback_CQI4j21',
            'bf_feedback_CQI4j22'
        ];

        if (!in_array($table, $tables)) {
            $this->session->set_flashdata('error', 'Invalid table specified for deletion.');
            redirect($_SERVER['HTTP_REFERER']);
            return;
        }

        // Prepare action log text
        $fullname = $this->session->userdata('fullname');
        $designation = $this->session->userdata('designation');
        $action_text = 'KPI Deleted by ' . $fullname . ' (' . $designation . ')';

        // âœ… Soft delete instead of actual delete
        $this->db->where('id', $id);
        $updated = $this->db->update($table, [
            'status' => 'Deleted',
            'action' => $action_text
        ]);

        if ($updated) {
            $this->session->set_flashdata('message', 'KPI record marked as deleted successfully.');
        } else {
            $this->session->set_flashdata('error', 'Unable to mark the record as deleted.');
        }

        redirect($_SERVER['HTTP_REFERER']); // back to same KPI page
    }



    //main page for all KPI
    public function feedbacks_report_CQI3a1()
    {
        		
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {

            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'Average Time for initial assessment of in-patients in MRD (ICU)';
            $data['content']  = $this->load->view('qualitymodules/feedbacks_report_CQI3a1', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');

        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function feedbacks_report_CQI3a2()
    {
        

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {

            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'Average Time for initial assessment of in-patients (Doctors)- (MRI WARD)';
            $data['content']  = $this->load->view('qualitymodules/feedbacks_report_CQI3a2', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');

        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function feedbacks_report_CQI3a3()
    {
        

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {

            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'Average Time for initial assessment of emergency patients (Doctors)';
            $data['content']  = $this->load->view('qualitymodules/feedbacks_report_CQI3a3', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');

        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function feedbacks_report_CQI3a4()
    {
        

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {

            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'Percentage of Care-plan is documented for inpatients';
            $data['content']  = $this->load->view('qualitymodules/feedbacks_report_CQI3a4', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');

        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function feedbacks_report_CQI3a5()
    {
        

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {

            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'Percentage of Nutritional assessment is documented for inpatients';
            $data['content']  = $this->load->view('qualitymodules/feedbacks_report_CQI3a5', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');

        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function feedbacks_report_CQI3a6()
    {
        

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {

            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'Percentage of Nursing care is documented for inpatients';
            $data['content']  = $this->load->view('qualitymodules/feedbacks_report_CQI3a6', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');

        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function feedbacks_report_CQI3a7()
    {
        

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {

            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'Average Time for initial assessment of Emergency patients';
            $data['content']  = $this->load->view('qualitymodules/feedbacks_report_CQI3a7', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');

        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function feedbacks_report_CQI3a8()
    {
        

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {

            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'Average Time for initial assessment of in-patients (Nurses)-(Nursing-ICU) ';
            $data['content']  = $this->load->view('qualitymodules/feedbacks_report_CQI3a8', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');

        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function feedbacks_report_CQI3a9()
    {
        

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {

            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'Average Time for initial assessment of in-patients (Nurses)-(Nursing-Ward)';
            $data['content']  = $this->load->view('qualitymodules/feedbacks_report_CQI3a9', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');

        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function feedbacks_report_CQI3a10()
    {
        

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {

            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'Percentage of Blood culture contamination rate(Lab Service)';
            $data['content']  = $this->load->view('qualitymodules/feedbacks_report_CQI3a10', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');

        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function feedbacks_report_CQI3a11()
    {
        

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {

            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = ' Percentage of Beta-blocker prescriptions with a diagnosis of CHF with reduced EF (Cardiology - Emergency Department)';
            $data['content']  = $this->load->view('qualitymodules/feedbacks_report_CQI3a11', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');

        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function feedbacks_report_CQI3a12()
    {
        

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {

            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = ' Percentage of Hospitalized patients with hypoglycemia who achieved targeted blood glucose level (Endocrinology and Diabetes - Emergency Department)';
            $data['content']  = $this->load->view('qualitymodules/feedbacks_report_CQI3a12', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');

        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function feedbacks_report_CQI3a13()
    {
        

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {

            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'Percentage of Spontaneous perineal Tear Rate';
            $data['content']  = $this->load->view('qualitymodules/feedbacks_report_CQI3a13', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');

        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function feedbacks_report_CQI3a14()
    {
        

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {

            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'Percentage of sepsis patients who receive care as per the HOUR-1 sepsis bundle (Critical Care Medicine - Medical records)';
            $data['content']  = $this->load->view('qualitymodules/feedbacks_report_CQI3a14', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');

        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function feedbacks_report_CQI3a15()
    {
        

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {

            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'Percentage of COPD patients receiving COPD Action plan at the time of discharge (Pulmonary Medicine)';
            $data['content']  = $this->load->view('qualitymodules/feedbacks_report_CQI3a15', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');

        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function feedbacks_report_CQI3a16()
    {
        

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {

            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'Percentage of bronchiolitis patients treated inappropriately (Pediatrics) ';
            $data['content']  = $this->load->view('qualitymodules/feedbacks_report_CQI3a16', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');

        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function feedbacks_report_CQI3a17()
    {
        

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {

            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = ' Percentage of oncology patients who had treatment initiated following multidisciplinary meeting(Tumour board)-(Oncology - Gastro surgery)  ';
            $data['content']  = $this->load->view('qualitymodules/feedbacks_report_CQI3a17', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');

        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function feedbacks_report_CQI3a18()
    {
        

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {

            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'Percentage of Intravenous Contrast Media Extravasation (Radiology)';
            $data['content']  = $this->load->view('qualitymodules/feedbacks_report_CQI3a18', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');

        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function feedbacks_report_CQI3a19()
    {
        

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {

            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'Average Time taken for triage(Emergency Department)';
            $data['content']  = $this->load->view('qualitymodules/feedbacks_report_CQI3a19', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');

        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function feedbacks_report_CQI3a20()
    {
        

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {

            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'Percentage of patients undergoing dialysis who are able to achieve target hemoglobin levels(Nephrology) ';
            $data['content']  = $this->load->view('qualitymodules/feedbacks_report_CQI3a20', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');

        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function feedbacks_report_CQI3a21()
    {
        

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {

            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";

            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }

            $data['title'] = 'Percentage of Compliance rate of timeliness of physician responding to the reported critical results (JCI8-IPSG 2.0)-(Medical Administration)  ';
            $data['content']  = $this->load->view('qualitymodules/feedbacks_report_CQI3a21', $data, true);
            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/feedbacks_report');

        } else {
            redirect('dashboard/noaccess');
        }
    }
                public function feedbacks_report_CQI3a22()
            {
                $fdate = date('Y-m-d');
                $tdate = date('Y-m-01');
                $_SESSION['from_date'] = $fdate;
                $_SESSION['to_date'] = $tdate;
                if ($this->session->userdata('isLogIn') == false)
                    redirect('login');
                if (ismodule_active('QUALITY') === true) {
                    $dateInfo = get_from_to_date();
                    $pagetitle = $dateInfo['pagetitle'];
                    $titleSuffix = "";
            
                    if ($pagetitle === "Current Month") {
                        $titleSuffix = strtoupper(date('F Y'));
                    } elseif ($pagetitle === "Previous Month") {
                        $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
                    } elseif ($pagetitle === "Last 365 Days") {
                        $titleSuffix = "LAST 365 DAYS";
                    } elseif ($pagetitle === "Last 30 Days") {
                        $titleSuffix = "LAST 30 DAYS";
                    } elseif ($pagetitle === "Custom") {
                        $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
                    } elseif ($pagetitle === "Last 24 Hours") {
                        $titleSuffix = "LAST 24 HOURS";
                    } elseif ($pagetitle === "Quaterly") {
                        $titleSuffix = "LAST 90 DAYS";
                    } else {
                        $titleSuffix = $pagetitle;
                    }
            
                    $data['title'] = 'Percentage of compliance to Holding area care (ACC2-JCI8)-(Nursing)';
                    $data['content']  = $this->load->view('qualitymodules/feedbacks_report_CQI3a22', $data, true);
                    $this->load->view('layout/main_wrapper', $data);
                } else {
                    redirect('dashboard/noaccess');
                }
            }
            
            public function feedbacks_report_CQI3b1()
            {
                $fdate = date('Y-m-d');
                $tdate = date('Y-m-01');
                $_SESSION['from_date'] = $fdate;
                $_SESSION['to_date'] = $tdate;
                if ($this->session->userdata('isLogIn') == false)
                    redirect('login');
                if (ismodule_active('QUALITY') === true) {
                    $dateInfo = get_from_to_date();
                    $pagetitle = $dateInfo['pagetitle'];
                    $titleSuffix = "";
            
                    if ($pagetitle === "Current Month") {
                        $titleSuffix = strtoupper(date('F Y'));
                    } elseif ($pagetitle === "Previous Month") {
                        $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
                    } elseif ($pagetitle === "Last 365 Days") {
                        $titleSuffix = "LAST 365 DAYS";
                    } elseif ($pagetitle === "Last 30 Days") {
                        $titleSuffix = "LAST 30 DAYS";
                    } elseif ($pagetitle === "Custom") {
                        $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
                    } elseif ($pagetitle === "Last 24 Hours") {
                        $titleSuffix = "LAST 24 HOURS";
                    } elseif ($pagetitle === "Quaterly") {
                        $titleSuffix = "LAST 90 DAYS";
                    } else {
                        $titleSuffix = $pagetitle;
                    }
            
                    $data['title'] = 'Number of reporting errors per 1000 investigations (Lab)-(Lab Services)';
                    $data['content']  = $this->load->view('qualitymodules/feedbacks_report_CQI3b1', $data, true);
                    $this->load->view('layout/main_wrapper', $data);
                } else {
                    redirect('dashboard/noaccess');
                }
            }
            
            public function feedbacks_report_CQI3b2()
            {
                $fdate = date('Y-m-d');
                $tdate = date('Y-m-01');
                $_SESSION['from_date'] = $fdate;
                $_SESSION['to_date'] = $tdate;
                if ($this->session->userdata('isLogIn') == false)
                    redirect('login');
                if (ismodule_active('QUALITY') === true) {
                    $dateInfo = get_from_to_date();
                    $pagetitle = $dateInfo['pagetitle'];
                    $titleSuffix = "";
            
                    if ($pagetitle === "Current Month") {
                        $titleSuffix = strtoupper(date('F Y'));
                    } elseif ($pagetitle === "Previous Month") {
                        $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
                    } elseif ($pagetitle === "Last 365 Days") {
                        $titleSuffix = "LAST 365 DAYS";
                    } elseif ($pagetitle === "Last 30 Days") {
                        $titleSuffix = "LAST 30 DAYS";
                    } elseif ($pagetitle === "Custom") {
                        $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
                    } elseif ($pagetitle === "Last 24 Hours") {
                        $titleSuffix = "LAST 24 HOURS";
                    } elseif ($pagetitle === "Quaterly") {
                        $titleSuffix = "LAST 90 DAYS";
                    } else {
                        $titleSuffix = $pagetitle;
                    }
            
                    $data['title'] = 'Rate of redo in 1000 tests (Lab)-(Lab Services)';
                    $data['content']  = $this->load->view('qualitymodules/feedbacks_report_CQI3b2', $data, true);
                    $this->load->view('layout/main_wrapper', $data);
                } else {
                    redirect('dashboard/noaccess');
                }
            }
            
            public function feedbacks_report_CQI3b3()
            {
                $fdate = date('Y-m-d');
                $tdate = date('Y-m-01');
                $_SESSION['from_date'] = $fdate;
                $_SESSION['to_date'] = $tdate;
                if ($this->session->userdata('isLogIn') == false)
                    redirect('login');
                if (ismodule_active('QUALITY') === true) {
                    $dateInfo = get_from_to_date();
                    $pagetitle = $dateInfo['pagetitle'];
                    $titleSuffix = "";
            
                    if ($pagetitle === "Current Month") {
                        $titleSuffix = strtoupper(date('F Y'));
                    } elseif ($pagetitle === "Previous Month") {
                        $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
                    } elseif ($pagetitle === "Last 365 Days") {
                        $titleSuffix = "LAST 365 DAYS";
                    } elseif ($pagetitle === "Last 30 Days") {
                        $titleSuffix = "LAST 30 DAYS";
                    } elseif ($pagetitle === "Custom") {
                        $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
                    } elseif ($pagetitle === "Last 24 Hours") {
                        $titleSuffix = "LAST 24 HOURS";
                    } elseif ($pagetitle === "Quaterly") {
                        $titleSuffix = "LAST 90 DAYS";
                    } else {
                        $titleSuffix = $pagetitle;
                    }
            
                    $data['title'] = 'Percentage of reports correlating to clinical diagnosis (Lab)-(Lab Services)';
                    $data['content']  = $this->load->view('qualitymodules/feedbacks_report_CQI3b3', $data, true);
                    $this->load->view('layout/main_wrapper', $data);
                } else {
                    redirect('dashboard/noaccess');
                }
            }
            public function feedbacks_report_CQI3b4()
        {
            $fdate = date('Y-m-d');
            $tdate = date('Y-m-01');
            $_SESSION['from_date'] = $fdate;
            $_SESSION['to_date'] = $tdate;
        
            if ($this->session->userdata('isLogIn') == false)
                redirect('login');
            if (ismodule_active('QUALITY') === true) {
        
                $dateInfo = get_from_to_date();
                $pagetitle = $dateInfo['pagetitle'];
                $titleSuffix = "";
        
                if ($pagetitle === "Current Month") {
                    $titleSuffix = strtoupper(date('F Y'));
                } elseif ($pagetitle === "Previous Month") {
                    $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
                } elseif ($pagetitle === "Last 365 Days") {
                    $titleSuffix = "LAST 365 DAYS";
                } elseif ($pagetitle === "Last 30 Days") {
                    $titleSuffix = "LAST 30 DAYS";
                } elseif ($pagetitle === "Custom") {
                    $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
                } elseif ($pagetitle === "Last 24 Hours") {
                    $titleSuffix = "LAST 24 HOURS";
                } elseif ($pagetitle === "Quaterly") {
                    $titleSuffix = "LAST 90 DAYS";
                } else {
                    $titleSuffix = $pagetitle;
                }
        
                $data['title'] = 'Critical value reporting TAT (Lab)-(Lab Services)';
                $data['content']  = $this->load->view('qualitymodules/feedbacks_report_CQI3b4', $data, true);
                $this->load->view('layout/main_wrapper', $data);
        
            } else {
                redirect('dashboard/noaccess');
            }
        }
        
        public function feedbacks_report_CQI3b5()
        {
            $fdate = date('Y-m-d');
            $tdate = date('Y-m-01');
            $_SESSION['from_date'] = $fdate;
            $_SESSION['to_date'] = $tdate;
        
            if ($this->session->userdata('isLogIn') == false)
                redirect('login');
            if (ismodule_active('QUALITY') === true) {
        
                $dateInfo = get_from_to_date();
                $pagetitle = $dateInfo['pagetitle'];
                $titleSuffix = "";
        
                if ($pagetitle === "Current Month") {
                    $titleSuffix = strtoupper(date('F Y'));
                } elseif ($pagetitle === "Previous Month") {
                    $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
                } elseif ($pagetitle === "Last 365 Days") {
                    $titleSuffix = "LAST 365 DAYS";
                } elseif ($pagetitle === "Last 30 Days") {
                    $titleSuffix = "LAST 30 DAYS";
                } elseif ($pagetitle === "Custom") {
                    $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
                } elseif ($pagetitle === "Last 24 Hours") {
                    $titleSuffix = "LAST 24 HOURS";
                } elseif ($pagetitle === "Quaterly") {
                    $titleSuffix = "LAST 90 DAYS";
                } else {
                    $titleSuffix = $pagetitle;
                }
        
                $data['title'] = 'Sample Rejection Rate per 1000 samples (Lab)-(Lab Services)';
                $data['content']  = $this->load->view('qualitymodules/feedbacks_report_CQI3b5', $data, true);
                $this->load->view('layout/main_wrapper', $data);
        
            } else {
                redirect('dashboard/noaccess');
            }
        }
        public function feedbacks_report_CQI3b6()
    {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
    
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Number of reporting errors per 1000 investigations (Radiology)';
            $data['content']  = $this->load->view('qualitymodules/feedbacks_report_CQI3b6', $data, true);
            $this->load->view('layout/main_wrapper', $data);
    
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI3b7()
    {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
    
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Percentage of reports correlating to clinical diagnosis (Radiology)';
            $data['content']  = $this->load->view('qualitymodules/feedbacks_report_CQI3b7', $data, true);
            $this->load->view('layout/main_wrapper', $data);
    
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI3b8()
    {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
    
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Percentage of employees in diagnostics adhering to safety precautions (Radiology)';
            $data['content']  = $this->load->view('qualitymodules/feedbacks_report_CQI3b8', $data, true);
            $this->load->view('layout/main_wrapper', $data);
    
        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function feedbacks_report_CQI3b9()
    {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
    
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Percentage of employees in diagnostics adhering to safety precautions (Radiology)-(OT)';
            $data['content']  = $this->load->view('qualitymodules/feedbacks_report_CQI3b9', $data, true);
            $this->load->view('layout/main_wrapper', $data);
    
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI3b10()
    {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
    
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Percentage of employees in diagnostics adhering to safety precautions (Radiology)-(Nursing)';
            $data['content']  = $this->load->view('qualitymodules/feedbacks_report_CQI3b10', $data, true);
            $this->load->view('layout/main_wrapper', $data);
    
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI3b11()
    {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
    
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Number of reporting errors before dispatch (Lab)';
            $data['content']  = $this->load->view('qualitymodules/feedbacks_report_CQI3b11', $data, true);
            $this->load->view('layout/main_wrapper', $data);
    
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI3b12()
    {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
    
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Waiting time for Laboratory services';
            $data['content']  = $this->load->view('qualitymodules/feedbacks_report_CQI3b12', $data, true);
            $this->load->view('layout/main_wrapper', $data);
    
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI3b13()
    {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
    
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Patient safety events or errors related to pathology samples, such as biopsy or other tissue specimens (JCI8-QPS 3.04)-(Lab Services)';
            $data['content']  = $this->load->view('qualitymodules/feedbacks_report_CQI3b13', $data, true);
            $this->load->view('layout/main_wrapper', $data);
    
        } else {
            redirect('dashboard/noaccess');
        }
    }



        
        public function feedbacks_report_CQI3c1()
        {
            $fdate = date('Y-m-d');
            $tdate = date('Y-m-01');
            $_SESSION['from_date'] = $fdate;
            $_SESSION['to_date'] = $tdate;
        
            if ($this->session->userdata('isLogIn') == false)
                redirect('login');
            if (ismodule_active('QUALITY') === true) {
        
                $dateInfo = get_from_to_date();
                $pagetitle = $dateInfo['pagetitle'];
                $titleSuffix = "";
        
                if ($pagetitle === "Current Month") {
                    $titleSuffix = strtoupper(date('F Y'));
                } elseif ($pagetitle === "Previous Month") {
                    $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
                } elseif ($pagetitle === "Last 365 Days") {
                    $titleSuffix = "LAST 365 DAYS";
                } elseif ($pagetitle === "Last 30 Days") {
                    $titleSuffix = "LAST 30 DAYS";
                } elseif ($pagetitle === "Custom") {
                    $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
                } elseif ($pagetitle === "Last 24 Hours") {
                    $titleSuffix = "LAST 24 HOURS";
                } elseif ($pagetitle === "Quaterly") {
                    $titleSuffix = "LAST 90 DAYS";
                } else {
                    $titleSuffix = $pagetitle;
                }
        
                $data['title'] = 'Medication Error';
                $data['content']  = $this->load->view('qualitymodules/feedbacks_report_CQI3c1', $data, true);
                $this->load->view('layout/main_wrapper', $data);
        
            } else {
                redirect('dashboard/noaccess');
            }
        }
        
        public function feedbacks_report_CQI3c2()
        {
            $fdate = date('Y-m-d');
            $tdate = date('Y-m-01');
            $_SESSION['from_date'] = $fdate;
            $_SESSION['to_date'] = $tdate;
        
            if ($this->session->userdata('isLogIn') == false)
                redirect('login');
            if (ismodule_active('QUALITY') === true) {
        
                $dateInfo = get_from_to_date();
                $pagetitle = $dateInfo['pagetitle'];
                $titleSuffix = "";
        
                if ($pagetitle === "Current Month") {
                    $titleSuffix = strtoupper(date('F Y'));
                } elseif ($pagetitle === "Previous Month") {
                    $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
                } elseif ($pagetitle === "Last 365 Days") {
                    $titleSuffix = "LAST 365 DAYS";
                } elseif ($pagetitle === "Last 30 Days") {
                    $titleSuffix = "LAST 30 DAYS";
                } elseif ($pagetitle === "Custom") {
                    $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
                } elseif ($pagetitle === "Last 24 Hours") {
                    $titleSuffix = "LAST 24 HOURS";
                } elseif ($pagetitle === "Quaterly") {
                    $titleSuffix = "LAST 90 DAYS";
                } else {
                    $titleSuffix = $pagetitle;
                }
        
                $data['title'] = 'Incidence of medication errors - Prescription Errors(IP) (As per NABH 4th edition) -(Clinical Pharmacy)';
                $data['content']  = $this->load->view('qualitymodules/feedbacks_report_CQI3c2', $data, true);
                $this->load->view('layout/main_wrapper', $data);
        
            } else {
                redirect('dashboard/noaccess');
            }
        }
        
        public function feedbacks_report_CQI3c3()
        {
            $fdate = date('Y-m-d');
            $tdate = date('Y-m-01');
            $_SESSION['from_date'] = $fdate;
            $_SESSION['to_date'] = $tdate;
        
            if ($this->session->userdata('isLogIn') == false)
                redirect('login');
            if (ismodule_active('QUALITY') === true) {
        
                $dateInfo = get_from_to_date();
                $pagetitle = $dateInfo['pagetitle'];
                $titleSuffix = "";
        
                if ($pagetitle === "Current Month") {
                    $titleSuffix = strtoupper(date('F Y'));
                } elseif ($pagetitle === "Previous Month") {
                    $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
                } elseif ($pagetitle === "Last 365 Days") {
                    $titleSuffix = "LAST 365 DAYS";
                } elseif ($pagetitle === "Last 30 Days") {
                    $titleSuffix = "LAST 30 DAYS";
                } elseif ($pagetitle === "Custom") {
                    $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
                } elseif ($pagetitle === "Last 24 Hours") {
                    $titleSuffix = "LAST 24 HOURS";
                } elseif ($pagetitle === "Quaterly") {
                    $titleSuffix = "LAST 90 DAYS";
                } else {
                    $titleSuffix = $pagetitle;
                }
        
                $data['title'] = 'Incidence of medication errors - Dispensing Errors(IP) (As per NABH 4th edition) -(Clinical Pharmacy)';
                $data['content']  = $this->load->view('qualitymodules/feedbacks_report_CQI3c3', $data, true);
                $this->load->view('layout/main_wrapper', $data);
        
            } else {
                redirect('dashboard/noaccess');
            }
        }
        public function feedbacks_report_CQI3c4()
        {
            $fdate = date('Y-m-d');
            $tdate = date('Y-m-01');
            $_SESSION['from_date'] = $fdate;
            $_SESSION['to_date'] = $tdate;
        
            if ($this->session->userdata('isLogIn') == false)
                redirect('login');
            if (ismodule_active('QUALITY') === true) {
        
                $dateInfo = get_from_to_date();
                $pagetitle = $dateInfo['pagetitle'];
                $titleSuffix = "";
        
                if ($pagetitle === "Current Month") {
                    $titleSuffix = strtoupper(date('F Y'));
                } elseif ($pagetitle === "Previous Month") {
                    $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
                } elseif ($pagetitle === "Last 365 Days") {
                    $titleSuffix = "LAST 365 DAYS";
                } elseif ($pagetitle === "Last 30 Days") {
                    $titleSuffix = "LAST 30 DAYS";
                } elseif ($pagetitle === "Custom") {
                    $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
                } elseif ($pagetitle === "Last 24 Hours") {
                    $titleSuffix = "LAST 24 HOURS";
                } elseif ($pagetitle === "Quaterly") {
                    $titleSuffix = "LAST 90 DAYS";
                } else {
                    $titleSuffix = $pagetitle;
                }
        
                $data['title'] = 'Percentage of admissions with ADR- (Clinical Pharmacy)';
                $data['content']  = $this->load->view('qualitymodules/feedbacks_report_CQI3c4', $data, true);
                $this->load->view('layout/main_wrapper', $data);
        
            } else {
                redirect('dashboard/noaccess');
            }
        }
        
        public function feedbacks_report_CQI3c5()
        {
            $fdate = date('Y-m-d');
            $tdate = date('Y-m-01');
            $_SESSION['from_date'] = $fdate;
            $_SESSION['to_date'] = $tdate;
        
            if ($this->session->userdata('isLogIn') == false)
                redirect('login');
            if (ismodule_active('QUALITY') === true) {
        
                $dateInfo = get_from_to_date();
                $pagetitle = $dateInfo['pagetitle'];
                $titleSuffix = "";
        
                if ($pagetitle === "Current Month") {
                    $titleSuffix = strtoupper(date('F Y'));
                } elseif ($pagetitle === "Previous Month") {
                    $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
                } elseif ($pagetitle === "Last 365 Days") {
                    $titleSuffix = "LAST 365 DAYS";
                } elseif ($pagetitle === "Last 30 Days") {
                    $titleSuffix = "LAST 30 DAYS";
                } elseif ($pagetitle === "Custom") {
                    $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
                } elseif ($pagetitle === "Last 24 Hours") {
                    $titleSuffix = "LAST 24 HOURS";
                } elseif ($pagetitle === "Quaterly") {
                    $titleSuffix = "LAST 90 DAYS";
                } else {
                    $titleSuffix = $pagetitle;
                }
        
                $data['title'] = 'Percentage of medication charts with error prone abbreviations- (Clinical Pharmacy)';
                $data['content']  = $this->load->view('qualitymodules/feedbacks_report_CQI3c5', $data, true);
                $this->load->view('layout/main_wrapper', $data);
        
            } else {
                redirect('dashboard/noaccess');
            }
        }
        
        public function feedbacks_report_CQI3c6()
        {
            $fdate = date('Y-m-d');
            $tdate = date('Y-m-01');
            $_SESSION['from_date'] = $fdate;
            $_SESSION['to_date'] = $tdate;
        
            if ($this->session->userdata('isLogIn') == false)
                redirect('login');
            if (ismodule_active('QUALITY') === true) {
        
                $dateInfo = get_from_to_date();
                $pagetitle = $dateInfo['pagetitle'];
                $titleSuffix = "";
        
                if ($pagetitle === "Current Month") {
                    $titleSuffix = strtoupper(date('F Y'));
                } elseif ($pagetitle === "Previous Month") {
                    $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
                } elseif ($pagetitle === "Last 365 Days") {
                    $titleSuffix = "LAST 365 DAYS";
                } elseif ($pagetitle === "Last 30 Days") {
                    $titleSuffix = "LAST 30 DAYS";
                } elseif ($pagetitle === "Custom") {
                    $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
                } elseif ($pagetitle === "Last 24 Hours") {
                    $titleSuffix = "LAST 24 HOURS";
                } elseif ($pagetitle === "Quaterly") {
                    $titleSuffix = "LAST 90 DAYS";
                } else {
                    $titleSuffix = $pagetitle;
                }
        
                $data['title'] = 'Percentage of patients receiving high risk medication developing adverse drug event- (Clinical Pharmacy)';
                $data['content']  = $this->load->view('qualitymodules/feedbacks_report_CQI3c6', $data, true);
                $this->load->view('layout/main_wrapper', $data);
        
            } else {
                redirect('dashboard/noaccess');
            }
        }
        
        public function feedbacks_report_CQI3c7()
        {
            $fdate = date('Y-m-d');
            $tdate = date('Y-m-01');
            $_SESSION['from_date'] = $fdate;
            $_SESSION['to_date'] = $tdate;
        
            if ($this->session->userdata('isLogIn') == false)
                redirect('login');
            if (ismodule_active('QUALITY') === true) {
        
                $dateInfo = get_from_to_date();
                $pagetitle = $dateInfo['pagetitle'];
                $titleSuffix = "";
        
                if ($pagetitle === "Current Month") {
                    $titleSuffix = strtoupper(date('F Y'));
                } elseif ($pagetitle === "Previous Month") {
                    $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
                } elseif ($pagetitle === "Last 365 Days") {
                    $titleSuffix = "LAST 365 DAYS";
                } elseif ($pagetitle === "Last 30 Days") {
                    $titleSuffix = "LAST 30 DAYS";
                } elseif ($pagetitle === "Custom") {
                    $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
                } elseif ($pagetitle === "Last 24 Hours") {
                    $titleSuffix = "LAST 24 HOURS";
                } elseif ($pagetitle === "Quaterly") {
                    $titleSuffix = "LAST 90 DAYS";
                } else {
                    $titleSuffix = $pagetitle;
                }
        
                $data['title'] = 'Incidence of Medication Administering errors (NABH 4th edition)- (Clinical Pharmacy)';
                $data['content']  = $this->load->view('qualitymodules/feedbacks_report_CQI3c7', $data, true);
                $this->load->view('layout/main_wrapper', $data);
        
            } else {
                redirect('dashboard/noaccess');
            }
        }
        
        public function feedbacks_report_CQI3c8()
        {
            $fdate = date('Y-m-d');
            $tdate = date('Y-m-01');
            $_SESSION['from_date'] = $fdate;
            $_SESSION['to_date'] = $tdate;
        
            if ($this->session->userdata('isLogIn') == false)
                redirect('login');
            if (ismodule_active('QUALITY') === true) {
        
                $dateInfo = get_from_to_date();
                $pagetitle = $dateInfo['pagetitle'];
                $titleSuffix = "";
        
                if ($pagetitle === "Current Month") {
                    $titleSuffix = strtoupper(date('F Y'));
                } elseif ($pagetitle === "Previous Month") {
                    $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
                } elseif ($pagetitle === "Last 365 Days") {
                    $titleSuffix = "LAST 365 DAYS";
                } elseif ($pagetitle === "Last 30 Days") {
                    $titleSuffix = "LAST 30 DAYS";
                } elseif ($pagetitle === "Custom") {
                    $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
                } elseif ($pagetitle === "Last 24 Hours") {
                    $titleSuffix = "LAST 24 HOURS";
                } elseif ($pagetitle === "Quaterly") {
                    $titleSuffix = "LAST 90 DAYS";
                } else {
                    $titleSuffix = $pagetitle;
                }
        
                $data['title'] = 'Percentage of in-patients developing adverse drug reaction- (Clinical Pharmacy)';
                $data['content']  = $this->load->view('qualitymodules/feedbacks_report_CQI3c8', $data, true);
                $this->load->view('layout/main_wrapper', $data);
        
            } else {
                redirect('dashboard/noaccess');
            }
        }
        
        public function feedbacks_report_CQI3c9()
        {
            $fdate = date('Y-m-d');
            $tdate = date('Y-m-01');
            $_SESSION['from_date'] = $fdate;
            $_SESSION['to_date'] = $tdate;
        
            if ($this->session->userdata('isLogIn') == false)
                redirect('login');
            if (ismodule_active('QUALITY') === true) {
        
                $dateInfo = get_from_to_date();
                $pagetitle = $dateInfo['pagetitle'];
                $titleSuffix = "";
        
                if ($pagetitle === "Current Month") {
                    $titleSuffix = strtoupper(date('F Y'));
                } elseif ($pagetitle === "Previous Month") {
                    $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
                } elseif ($pagetitle === "Last 365 Days") {
                    $titleSuffix = "LAST 365 DAYS";
                } elseif ($pagetitle === "Last 30 Days") {
                    $titleSuffix = "LAST 30 DAYS";
                } elseif ($pagetitle === "Custom") {
                    $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
                } elseif ($pagetitle === "Last 24 Hours") {
                    $titleSuffix = "LAST 24 HOURS";
                } elseif ($pagetitle === "Quaterly") {
                    $titleSuffix = "LAST 90 DAYS";
                } else {
                    $titleSuffix = $pagetitle;
                }
        
                $data['title'] = 'Incidence of Medication Administering errors- (Clinical Pharmacy)';
                $data['content']  = $this->load->view('qualitymodules/feedbacks_report_CQI3c9', $data, true);
                $this->load->view('layout/main_wrapper', $data);
        
            } else {
                redirect('dashboard/noaccess');
            }
        }
        
        public function feedbacks_report_CQI3c10()
        {
            $fdate = date('Y-m-d');
            $tdate = date('Y-m-01');
            $_SESSION['from_date'] = $fdate;
            $_SESSION['to_date'] = $tdate;
        
            if ($this->session->userdata('isLogIn') == false)
                redirect('login');
            if (ismodule_active('QUALITY') === true) {
        
                $dateInfo = get_from_to_date();
                $pagetitle = $dateInfo['pagetitle'];
                $titleSuffix = "";
        
                if ($pagetitle === "Current Month") {
                    $titleSuffix = strtoupper(date('F Y'));
                } elseif ($pagetitle === "Previous Month") {
                    $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
                } elseif ($pagetitle === "Last 365 Days") {
                    $titleSuffix = "LAST 365 DAYS";
                } elseif ($pagetitle === "Last 30 Days") {
                    $titleSuffix = "LAST 30 DAYS";
                } elseif ($pagetitle === "Custom") {
                    $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
                } elseif ($pagetitle === "Last 24 Hours") {
                    $titleSuffix = "LAST 24 HOURS";
                } elseif ($pagetitle === "Quaterly") {
                    $titleSuffix = "LAST 90 DAYS";
                } else {
                    $titleSuffix = $pagetitle;
                }
        
                $data['title'] = 'Incidence of medication errors - Dispensing errors (IP)- (Clinical Pharmacy)';
                $data['content']  = $this->load->view('qualitymodules/feedbacks_report_CQI3c10', $data, true);
                $this->load->view('layout/main_wrapper', $data);
        
            } else {
                redirect('dashboard/noaccess');
            }
        }
        
        public function feedbacks_report_CQI3c11()
        {
            $fdate = date('Y-m-d');
            $tdate = date('Y-m-01');
            $_SESSION['from_date'] = $fdate;
            $_SESSION['to_date'] = $tdate;
        
            if ($this->session->userdata('isLogIn') == false)
                redirect('login');
            if (ismodule_active('QUALITY') === true) {
        
                $dateInfo = get_from_to_date();
                $pagetitle = $dateInfo['pagetitle'];
                $titleSuffix = "";
        
                if ($pagetitle === "Current Month") {
                    $titleSuffix = strtoupper(date('F Y'));
                } elseif ($pagetitle === "Previous Month") {
                    $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
                } elseif ($pagetitle === "Last 365 Days") {
                    $titleSuffix = "LAST 365 DAYS";
                } elseif ($pagetitle === "Last 30 Days") {
                    $titleSuffix = "LAST 30 DAYS";
                } elseif ($pagetitle === "Custom") {
                    $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
                } elseif ($pagetitle === "Last 24 Hours") {
                    $titleSuffix = "LAST 24 HOURS";
                } elseif ($pagetitle === "Quaterly") {
                    $titleSuffix = "LAST 90 DAYS";
                } else {
                    $titleSuffix = $pagetitle;
                }
        
                $data['title'] = 'Incidence of medication errors - Prescription errors(IP)- (Clinical Pharmacy)';
                $data['content']  = $this->load->view('qualitymodules/feedbacks_report_CQI3c11', $data, true);
                $this->load->view('layout/main_wrapper', $data);
        
            } else {
                redirect('dashboard/noaccess');
            }
        }
        public function feedbacks_report_CQI3c12()
        {
            $fdate = date('Y-m-d');
            $tdate = date('Y-m-01');
            $_SESSION['from_date'] = $fdate;
            $_SESSION['to_date'] = $tdate;
        
            if ($this->session->userdata('isLogIn') == false)
                redirect('login');
            if (ismodule_active('QUALITY') === true) {
        
                $dateInfo = get_from_to_date();
                $pagetitle = $dateInfo['pagetitle'];
                $titleSuffix = "";
        
                if ($pagetitle === "Current Month") {
                    $titleSuffix = strtoupper(date('F Y'));
                } elseif ($pagetitle === "Previous Month") {
                    $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
                } elseif ($pagetitle === "Last 365 Days") {
                    $titleSuffix = "LAST 365 DAYS";
                } elseif ($pagetitle === "Last 30 Days") {
                    $titleSuffix = "LAST 30 DAYS";
                } elseif ($pagetitle === "Custom") {
                    $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
                } elseif ($pagetitle === "Last 24 Hours") {
                    $titleSuffix = "LAST 24 HOURS";
                } elseif ($pagetitle === "Quaterly") {
                    $titleSuffix = "LAST 90 DAYS";
                } else {
                    $titleSuffix = $pagetitle;
                }
        
                $data['title'] = 'Empirical Antibiotics therapy compliance rate for high risk infections- (Clinical Pharmacy)';
                $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3c12', $data, true);
                $this->load->view('layout/main_wrapper', $data);
        
            } else {
                redirect('dashboard/noaccess');
            }
        }
        
        public function feedbacks_report_CQI3c13()
        {
            $fdate = date('Y-m-d');
            $tdate = date('Y-m-01');
            $_SESSION['from_date'] = $fdate;
            $_SESSION['to_date'] = $tdate;
        
            if ($this->session->userdata('isLogIn') == false)
                redirect('login');
            if (ismodule_active('QUALITY') === true) {
        
                $dateInfo = get_from_to_date();
                $pagetitle = $dateInfo['pagetitle'];
                $titleSuffix = "";
        
                if ($pagetitle === "Current Month") {
                    $titleSuffix = strtoupper(date('F Y'));
                } elseif ($pagetitle === "Previous Month") {
                    $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
                } elseif ($pagetitle === "Last 365 Days") {
                    $titleSuffix = "LAST 365 DAYS";
                } elseif ($pagetitle === "Last 30 Days") {
                    $titleSuffix = "LAST 30 DAYS";
                } elseif ($pagetitle === "Custom") {
                    $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
                } elseif ($pagetitle === "Last 24 Hours") {
                    $titleSuffix = "LAST 24 HOURS";
                } elseif ($pagetitle === "Quaterly") {
                    $titleSuffix = "LAST 90 DAYS";
                } else {
                    $titleSuffix = $pagetitle;
                }
        
                $data['title'] = 'Restricted antibiotics usage compliance rate(JCI8-MMU1.1)-(Clinical Pharmacy)';
                $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3c13', $data, true);
                $this->load->view('layout/main_wrapper', $data);
        
            } else {
                redirect('dashboard/noaccess');
            }
        }
        
        public function feedbacks_report_CQI3c14()
        {
            $fdate = date('Y-m-d');
            $tdate = date('Y-m-01');
            $_SESSION['from_date'] = $fdate;
            $_SESSION['to_date'] = $tdate;
        
            if ($this->session->userdata('isLogIn') == false)
                redirect('login');
            if (ismodule_active('QUALITY') === true) {
        
                $dateInfo = get_from_to_date();
                $pagetitle = $dateInfo['pagetitle'];
                $titleSuffix = "";
        
                if ($pagetitle === "Current Month") {
                    $titleSuffix = strtoupper(date('F Y'));
                } elseif ($pagetitle === "Previous Month") {
                    $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
                } elseif ($pagetitle === "Last 365 Days") {
                    $titleSuffix = "LAST 365 DAYS";
                } elseif ($pagetitle === "Last 30 Days") {
                    $titleSuffix = "LAST 30 DAYS";
                } elseif ($pagetitle === "Custom") {
                    $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
                } elseif ($pagetitle === "Last 24 Hours") {
                    $titleSuffix = "LAST 24 HOURS";
                } elseif ($pagetitle === "Quaterly") {
                    $titleSuffix = "LAST 90 DAYS";
                } else {
                    $titleSuffix = $pagetitle;
                }
        
                $data['title'] = 'Monitor data related to appropriateness of indication for the new drugs(JCI8-MMU2.0)-(Clinical Pharmacy)';
                $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3c14', $data, true);
                $this->load->view('layout/main_wrapper', $data);
        
            } else {
                redirect('dashboard/noaccess');
            }
        }
        public function feedbacks_report_CQI3d1()
        {
            $fdate = date('Y-m-d');
            $tdate = date('Y-m-01');
            $_SESSION['from_date'] = $fdate;
            $_SESSION['to_date'] = $tdate;
        
            if ($this->session->userdata('isLogIn') == false)
                redirect('login');
            if (ismodule_active('QUALITY') === true) {
        
                $dateInfo = get_from_to_date();
                $pagetitle = $dateInfo['pagetitle'];
                $titleSuffix = "";
        
                if ($pagetitle === "Current Month") {
                    $titleSuffix = strtoupper(date('F Y'));
                } elseif ($pagetitle === "Previous Month") {
                    $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
                } elseif ($pagetitle === "Last 365 Days") {
                    $titleSuffix = "LAST 365 DAYS";
                } elseif ($pagetitle === "Last 30 Days") {
                    $titleSuffix = "LAST 30 DAYS";
                } elseif ($pagetitle === "Custom") {
                    $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
                } elseif ($pagetitle === "Last 24 Hours") {
                    $titleSuffix = "LAST 24 HOURS";
                } elseif ($pagetitle === "Quaterly") {
                    $titleSuffix = "LAST 90 DAYS";
                } else {
                    $titleSuffix = $pagetitle;
                }
        
                $data['title'] = 'Percentage of modification of anaesthesia plan (OT - Anasthesia)';
                $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3d1', $data, true);
                $this->load->view('layout/main_wrapper', $data);
        
            } else {
                redirect('dashboard/noaccess');
            }
        }
        
        public function feedbacks_report_CQI3d2()
        {
            $fdate = date('Y-m-d');
            $tdate = date('Y-m-01');
            $_SESSION['from_date'] = $fdate;
            $_SESSION['to_date'] = $tdate;
        
            if ($this->session->userdata('isLogIn') == false)
                redirect('login');
            if (ismodule_active('QUALITY') === true) {
        
                $dateInfo = get_from_to_date();
                $pagetitle = $dateInfo['pagetitle'];
                $titleSuffix = "";
        
                if ($pagetitle === "Current Month") {
                    $titleSuffix = strtoupper(date('F Y'));
                } elseif ($pagetitle === "Previous Month") {
                    $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
                } elseif ($pagetitle === "Last 365 Days") {
                    $titleSuffix = "LAST 365 DAYS";
                } elseif ($pagetitle === "Last 30 Days") {
                    $titleSuffix = "LAST 30 DAYS";
                } elseif ($pagetitle === "Custom") {
                    $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
                } elseif ($pagetitle === "Last 24 Hours") {
                    $titleSuffix = "LAST 24 HOURS";
                } elseif ($pagetitle === "Quaterly") {
                    $titleSuffix = "LAST 90 DAYS";
                } else {
                    $titleSuffix = $pagetitle;
                }
        
                $data['title'] = 'Percentage of unplanned ventilation following anaesthesia (OT - Anasthesia)';
                $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3d2', $data, true);
                $this->load->view('layout/main_wrapper', $data);
        
            } else {
                redirect('dashboard/noaccess');
            }
        }
        
        public function feedbacks_report_CQI3d3()
        {
            $fdate = date('Y-m-d');
            $tdate = date('Y-m-01');
            $_SESSION['from_date'] = $fdate;
            $_SESSION['to_date'] = $tdate;
        
            if ($this->session->userdata('isLogIn') == false)
                redirect('login');
            if (ismodule_active('QUALITY') === true) {
        
                $dateInfo = get_from_to_date();
                $pagetitle = $dateInfo['pagetitle'];
                $titleSuffix = "";
        
                if ($pagetitle === "Current Month") {
                    $titleSuffix = strtoupper(date('F Y'));
                } elseif ($pagetitle === "Previous Month") {
                    $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
                } elseif ($pagetitle === "Last 365 Days") {
                    $titleSuffix = "LAST 365 DAYS";
                } elseif ($pagetitle === "Last 30 Days") {
                    $titleSuffix = "LAST 30 DAYS";
                } elseif ($pagetitle === "Custom") {
                    $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
                } elseif ($pagetitle === "Last 24 Hours") {
                    $titleSuffix = "LAST 24 HOURS";
                } elseif ($pagetitle === "Quaterly") {
                    $titleSuffix = "LAST 90 DAYS";
                } else {
                    $titleSuffix = $pagetitle;
                }
        
                $data['title'] = 'Percentage of adverse anaesthesia events following anaesthesia (OT - Anasthesia)';
                $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3d3', $data, true);
                $this->load->view('layout/main_wrapper', $data);
        
            } else {
                redirect('dashboard/noaccess');
            }
        }
        
        public function feedbacks_report_CQI3d4()
        {
            $fdate = date('Y-m-d');
            $tdate = date('Y-m-01');
            $_SESSION['from_date'] = $fdate;
            $_SESSION['to_date'] = $tdate;
        
            if ($this->session->userdata('isLogIn') == false)
                redirect('login');
            if (ismodule_active('QUALITY') === true) {
        
                $dateInfo = get_from_to_date();
                $pagetitle = $dateInfo['pagetitle'];
                $titleSuffix = "";
        
                if ($pagetitle === "Current Month") {
                    $titleSuffix = strtoupper(date('F Y'));
                } elseif ($pagetitle === "Previous Month") {
                    $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
                } elseif ($pagetitle === "Last 365 Days") {
                    $titleSuffix = "LAST 365 DAYS";
                } elseif ($pagetitle === "Last 30 Days") {
                    $titleSuffix = "LAST 30 DAYS";
                } elseif ($pagetitle === "Custom") {
                    $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
                } elseif ($pagetitle === "Last 24 Hours") {
                    $titleSuffix = "LAST 24 HOURS";
                } elseif ($pagetitle === "Quaterly") {
                    $titleSuffix = "LAST 90 DAYS";
                } else {
                    $titleSuffix = $pagetitle;
                }
        
                $data['title'] = 'Anaesthesia related mortality rate (OT - Anasthesia)';
                $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3d4', $data, true);
                $this->load->view('layout/main_wrapper', $data);
        
            } else {
                redirect('dashboard/noaccess');
            }
        }
        
        public function feedbacks_report_CQI3d5()
        {
            $fdate = date('Y-m-d');
            $tdate = date('Y-m-01');
            $_SESSION['from_date'] = $fdate;
            $_SESSION['to_date'] = $tdate;
        
            if ($this->session->userdata('isLogIn') == false)
                redirect('login');
            if (ismodule_active('QUALITY') === true) {
        
                $dateInfo = get_from_to_date();
                $pagetitle = $dateInfo['pagetitle'];
                $titleSuffix = "";
        
                if ($pagetitle === "Current Month") {
                    $titleSuffix = strtoupper(date('F Y'));
                } elseif ($pagetitle === "Previous Month") {
                    $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
                } elseif ($pagetitle === "Last 365 Days") {
                    $titleSuffix = "LAST 365 DAYS";
                } elseif ($pagetitle === "Last 30 Days") {
                    $titleSuffix = "LAST 30 DAYS";
                } elseif ($pagetitle === "Custom") {
                    $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
                } elseif ($pagetitle === "Last 24 Hours") {
                    $titleSuffix = "LAST 24 HOURS";
                } elseif ($pagetitle === "Quaterly") {
                    $titleSuffix = "LAST 90 DAYS";
                } else {
                    $titleSuffix = $pagetitle;
                }
        
                $data['title'] = 'Percentage of safe and rational prescriptions (Clinical Pharmacy - IP - Pharmacy)';
                $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3d5', $data, true);
                $this->load->view('layout/main_wrapper', $data);
        
            } else {
                redirect('dashboard/noaccess');
            }
        }
        public function feedbacks_report_CQI3e1()
        {
            $fdate = date('Y-m-d');
            $tdate = date('Y-m-01');
            $_SESSION['from_date'] = $fdate;
            $_SESSION['to_date'] = $tdate;
        
            if ($this->session->userdata('isLogIn') == false)
                redirect('login');
            if (ismodule_active('QUALITY') === true) {
        
                $dateInfo = get_from_to_date();
                $pagetitle = $dateInfo['pagetitle'];
                $titleSuffix = "";
        
                if ($pagetitle === "Current Month") {
                    $titleSuffix = strtoupper(date('F Y'));
                } elseif ($pagetitle === "Previous Month") {
                    $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
                } elseif ($pagetitle === "Last 365 Days") {
                    $titleSuffix = "LAST 365 DAYS";
                } elseif ($pagetitle === "Last 30 Days") {
                    $titleSuffix = "LAST 30 DAYS";
                } elseif ($pagetitle === "Custom") {
                    $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
                } elseif ($pagetitle === "Last 24 Hours") {
                    $titleSuffix = "LAST 24 HOURS";
                } elseif ($pagetitle === "Quaterly") {
                    $titleSuffix = "LAST 90 DAYS";
                } else {
                    $titleSuffix = $pagetitle;
                }
        
                $data['title'] = 'Percentage of unplanned return to OT';
                $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3e1', $data, true);
                $this->load->view('layout/main_wrapper', $data);
        
            } else {
                redirect('dashboard/noaccess');
            }
        }
        
        public function feedbacks_report_CQI3e2()
        {
            $fdate = date('Y-m-d');
            $tdate = date('Y-m-01');
            $_SESSION['from_date'] = $fdate;
            $_SESSION['to_date'] = $tdate;
        
            if ($this->session->userdata('isLogIn') == false)
                redirect('login');
            if (ismodule_active('QUALITY') === true) {
        
                $dateInfo = get_from_to_date();
                $pagetitle = $dateInfo['pagetitle'];
                $titleSuffix = "";
        
                if ($pagetitle === "Current Month") {
                    $titleSuffix = strtoupper(date('F Y'));
                } elseif ($pagetitle === "Previous Month") {
                    $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
                } elseif ($pagetitle === "Last 365 Days") {
                    $titleSuffix = "LAST 365 DAYS";
                } elseif ($pagetitle === "Last 30 Days") {
                    $titleSuffix = "LAST 30 DAYS";
                } elseif ($pagetitle === "Custom") {
                    $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
                } elseif ($pagetitle === "Last 24 Hours") {
                    $titleSuffix = "LAST 24 HOURS";
                } elseif ($pagetitle === "Quaterly") {
                    $titleSuffix = "LAST 90 DAYS";
                } else {
                    $titleSuffix = $pagetitle;
                }
        
                $data['title'] = 'Percentage of rescheduling of surgeries (OT)';
                $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3e2', $data, true);
                $this->load->view('layout/main_wrapper', $data);
        
            } else {
                redirect('dashboard/noaccess');
            }
        }
        
        public function feedbacks_report_CQI3e3()
        {
            $fdate = date('Y-m-d');
            $tdate = date('Y-m-01');
            $_SESSION['from_date'] = $fdate;
            $_SESSION['to_date'] = $tdate;
        
            if ($this->session->userdata('isLogIn') == false)
                redirect('login');
            if (ismodule_active('QUALITY') === true) {
        
                $dateInfo = get_from_to_date();
                $pagetitle = $dateInfo['pagetitle'];
                $titleSuffix = "";
        
                if ($pagetitle === "Current Month") {
                    $titleSuffix = strtoupper(date('F Y'));
                } elseif ($pagetitle === "Previous Month") {
                    $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
                } elseif ($pagetitle === "Last 365 Days") {
                    $titleSuffix = "LAST 365 DAYS";
                } elseif ($pagetitle === "Last 30 Days") {
                    $titleSuffix = "LAST 30 DAYS";
                } elseif ($pagetitle === "Custom") {
                    $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
                } elseif ($pagetitle === "Last 24 Hours") {
                    $titleSuffix = "LAST 24 HOURS";
                } elseif ($pagetitle === "Quaterly") {
                    $titleSuffix = "LAST 90 DAYS";
                } else {
                    $titleSuffix = $pagetitle;
                }
        
                $data['title'] = 'Percentage of cases where organisations procedure to prevent surgery errors (wrong site, wrong procedure, wrong patient) have been adhered (OT)';
                $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3e3', $data, true);
                $this->load->view('layout/main_wrapper', $data);
        
            } else {
                redirect('dashboard/noaccess');
            }
        }
        
        public function feedbacks_report_CQI3e4()
        {
            $fdate = date('Y-m-d');
            $tdate = date('Y-m-01');
            $_SESSION['from_date'] = $fdate;
            $_SESSION['to_date'] = $tdate;
        
            if ($this->session->userdata('isLogIn') == false)
                redirect('login');
            if (ismodule_active('QUALITY') === true) {
        
                $dateInfo = get_from_to_date();
                $pagetitle = $dateInfo['pagetitle'];
                $titleSuffix = "";
        
                if ($pagetitle === "Current Month") {
                    $titleSuffix = strtoupper(date('F Y'));
                } elseif ($pagetitle === "Previous Month") {
                    $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
                } elseif ($pagetitle === "Last 365 Days") {
                    $titleSuffix = "LAST 365 DAYS";
                } elseif ($pagetitle === "Last 30 Days") {
                    $titleSuffix = "LAST 30 DAYS";
                } elseif ($pagetitle === "Custom") {
                    $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
                } elseif ($pagetitle === "Last 24 Hours") {
                    $titleSuffix = "LAST 24 HOURS";
                } elseif ($pagetitle === "Quaterly") {
                    $titleSuffix = "LAST 90 DAYS";
                } else {
                    $titleSuffix = $pagetitle;
                }
        
                $data['title'] = 'Percentage of cases receiving appropriate prophylactic antibiotics with specified time frame (Clinical Pharmacy)';
                $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3e4', $data, true);
                $this->load->view('layout/main_wrapper', $data);
        
            } else {
                redirect('dashboard/noaccess');
            }
        }
        
        public function feedbacks_report_CQI3e5()
        {
            $fdate = date('Y-m-d');
            $tdate = date('Y-m-01');
            $_SESSION['from_date'] = $fdate;
            $_SESSION['to_date'] = $tdate;
        
            if ($this->session->userdata('isLogIn') == false)
                redirect('login');
            if (ismodule_active('QUALITY') === true) {
        
                $dateInfo = get_from_to_date();
                $pagetitle = $dateInfo['pagetitle'];
                $titleSuffix = "";
        
                if ($pagetitle === "Current Month") {
                    $titleSuffix = strtoupper(date('F Y'));
                } elseif ($pagetitle === "Previous Month") {
                    $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
                } elseif ($pagetitle === "Last 365 Days") {
                    $titleSuffix = "LAST 365 DAYS";
                } elseif ($pagetitle === "Last 30 Days") {
                    $titleSuffix = "LAST 30 DAYS";
                } elseif ($pagetitle === "Custom") {
                    $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
                } elseif ($pagetitle === "Last 24 Hours") {
                    $titleSuffix = "LAST 24 HOURS";
                } elseif ($pagetitle === "Quaterly") {
                    $titleSuffix = "LAST 90 DAYS";
                } else {
                    $titleSuffix = $pagetitle;
                }
        
                $data['title'] = 'Percentage of cases where the planned surgery were changed intraoperatively (OT)';
                $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3e5', $data, true);
                $this->load->view('layout/main_wrapper', $data);
        
            } else {
                redirect('dashboard/noaccess');
            }
        }
        
        public function feedbacks_report_CQI3e6()
        {
            $fdate = date('Y-m-d');
            $tdate = date('Y-m-01');
            $_SESSION['from_date'] = $fdate;
            $_SESSION['to_date'] = $tdate;
        
            if ($this->session->userdata('isLogIn') == false)
                redirect('login');
            if (ismodule_active('QUALITY') === true) {
        
                $dateInfo = get_from_to_date();
                $pagetitle = $dateInfo['pagetitle'];
                $titleSuffix = "";
        
                if ($pagetitle === "Current Month") {
                    $titleSuffix = strtoupper(date('F Y'));
                } elseif ($pagetitle === "Previous Month") {
                    $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
                } elseif ($pagetitle === "Last 365 Days") {
                    $titleSuffix = "LAST 365 DAYS";
                } elseif ($pagetitle === "Last 30 Days") {
                    $titleSuffix = "LAST 30 DAYS";
                } elseif ($pagetitle === "Custom") {
                    $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
                } elseif ($pagetitle === "Last 24 Hours") {
                    $titleSuffix = "LAST 24 HOURS";
                } elseif ($pagetitle === "Quaterly") {
                    $titleSuffix = "LAST 90 DAYS";
                } else {
                    $titleSuffix = $pagetitle;
                }
        
                $data['title'] = 'Re-exploration rate (OT)';
                $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3e6', $data, true);
                $this->load->view('layout/main_wrapper', $data);
        
            } else {
                redirect('dashboard/noaccess');
            }
        }
        
        public function feedbacks_report_CQI3e7()
        {
            $fdate = date('Y-m-d');
            $tdate = date('Y-m-01');
            $_SESSION['from_date'] = $fdate;
            $_SESSION['to_date'] = $tdate;
        
            if ($this->session->userdata('isLogIn') == false)
                redirect('login');
            if (ismodule_active('QUALITY') === true) {
        
                $dateInfo = get_from_to_date();
                $pagetitle = $dateInfo['pagetitle'];
                $titleSuffix = "";
        
                if ($pagetitle === "Current Month") {
                    $titleSuffix = strtoupper(date('F Y'));
                } elseif ($pagetitle === "Previous Month") {
                    $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
                } elseif ($pagetitle === "Last 365 Days") {
                    $titleSuffix = "LAST 365 DAYS";
                } elseif ($pagetitle === "Last 30 Days") {
                    $titleSuffix = "LAST 30 DAYS";
                } elseif ($pagetitle === "Custom") {
                    $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
                } elseif ($pagetitle === "Last 24 Hours") {
                    $titleSuffix = "LAST 24 HOURS";
                } elseif ($pagetitle === "Quaterly") {
                    $titleSuffix = "LAST 90 DAYS";
                } else {
                    $titleSuffix = $pagetitle;
                }
        
                $data['title'] = 'Primary Cesarean Rate (Nursing - OBG)';
                $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3e7', $data, true);
                $this->load->view('layout/main_wrapper', $data);
        
            } else {
                redirect('dashboard/noaccess');
            }
        }
        
        public function feedbacks_report_CQI3e8()
        {
            $fdate = date('Y-m-d');
            $tdate = date('Y-m-01');
            $_SESSION['from_date'] = $fdate;
            $_SESSION['to_date'] = $tdate;
        
            if ($this->session->userdata('isLogIn') == false)
                redirect('login');
            if (ismodule_active('QUALITY') === true) {
        
                $dateInfo = get_from_to_date();
                $pagetitle = $dateInfo['pagetitle'];
                $titleSuffix = "";
        
                if ($pagetitle === "Current Month") {
                    $titleSuffix = strtoupper(date('F Y'));
                } elseif ($pagetitle === "Previous Month") {
                    $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
                } elseif ($pagetitle === "Last 365 Days") {
                    $titleSuffix = "LAST 365 DAYS";
                } elseif ($pagetitle === "Last 30 Days") {
                    $titleSuffix = "LAST 30 DAYS";
                } elseif ($pagetitle === "Custom") {
                    $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
                } elseif ($pagetitle === "Last 24 Hours") {
                    $titleSuffix = "LAST 24 HOURS";
                } elseif ($pagetitle === "Quaterly") {
                    $titleSuffix = "LAST 90 DAYS";
                } else {
                    $titleSuffix = $pagetitle;
                }
        
                $data['title'] = 'Adverse events related to implant devices (JCI8 - ASC 4.4) - (OT)';
                $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3e8', $data, true);
                $this->load->view('layout/main_wrapper', $data);
        
            } else {
                redirect('dashboard/noaccess');
            }
        }
        
        public function feedbacks_report_CQI3e9()
        {
            $fdate = date('Y-m-d');
            $tdate = date('Y-m-01');
            $_SESSION['from_date'] = $fdate;
            $_SESSION['to_date'] = $tdate;
        
            if ($this->session->userdata('isLogIn') == false)
                redirect('login');
            if (ismodule_active('QUALITY') === true) {
        
                $dateInfo = get_from_to_date();
                $pagetitle = $dateInfo['pagetitle'];
                $titleSuffix = "";
        
                if ($pagetitle === "Current Month") {
                    $titleSuffix = strtoupper(date('F Y'));
                } elseif ($pagetitle === "Previous Month") {
                    $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
                } elseif ($pagetitle === "Last 365 Days") {
                    $titleSuffix = "LAST 365 DAYS";
                } elseif ($pagetitle === "Last 30 Days") {
                    $titleSuffix = "LAST 30 DAYS";
                } elseif ($pagetitle === "Custom") {
                    $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
                } elseif ($pagetitle === "Last 24 Hours") {
                    $titleSuffix = "LAST 24 HOURS";
                } elseif ($pagetitle === "Quaterly") {
                    $titleSuffix = "LAST 90 DAYS";
                } else {
                    $titleSuffix = $pagetitle;
                }
        
                $data['title'] = 'All major patient safety events or errors related to surgical procedures (JCI8 - QPS 3.04)';
                $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3e9', $data, true);
                $this->load->view('layout/main_wrapper', $data);
        
            } else {
                redirect('dashboard/noaccess');
            }
        }
        public function feedbacks_report_CQI3f1()
        {
            $fdate = date('Y-m-d');
            $tdate = date('Y-m-01');
            $_SESSION['from_date'] = $fdate;
            $_SESSION['to_date'] = $tdate;
        
            if ($this->session->userdata('isLogIn') == false) redirect('login');
            if (ismodule_active('QUALITY') === true) {
                $dateInfo = get_from_to_date();
                $pagetitle = $dateInfo['pagetitle'];
                $titleSuffix = "";
        
                if ($pagetitle === "Current Month") {
                    $titleSuffix = strtoupper(date('F Y'));
                } elseif ($pagetitle === "Previous Month") {
                    $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
                } elseif ($pagetitle === "Last 365 Days") {
                    $titleSuffix = "LAST 365 DAYS";
                } elseif ($pagetitle === "Last 30 Days") {
                    $titleSuffix = "LAST 30 DAYS";
                } elseif ($pagetitle === "Custom") {
                    $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
                } elseif ($pagetitle === "Last 24 Hours") {
                    $titleSuffix = "LAST 24 HOURS";
                } elseif ($pagetitle === "Quaterly") {
                    $titleSuffix = "LAST 90 DAYS";
                } else {
                    $titleSuffix = $pagetitle;
                }
        
                $data['title'] = 'Percentage of transfusion reactions (PSQ3a) - (Blood Center)';
                $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3f1', $data, true);
                $this->load->view('layout/main_wrapper', $data);
            } else {
                redirect('dashboard/noaccess');
            }
        }
        
        public function feedbacks_report_CQI3f2()
        {
            $fdate = date('Y-m-d');
            $tdate = date('Y-m-01');
            $_SESSION['from_date'] = $fdate;
            $_SESSION['to_date'] = $tdate;
        
            if ($this->session->userdata('isLogIn') == false) redirect('login');
            if (ismodule_active('QUALITY') === true) {
                $dateInfo = get_from_to_date();
                $pagetitle = $dateInfo['pagetitle'];
                $titleSuffix = "";
        
                if ($pagetitle === "Current Month") {
                    $titleSuffix = strtoupper(date('F Y'));
                } elseif ($pagetitle === "Previous Month") {
                    $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
                } elseif ($pagetitle === "Last 365 Days") {
                    $titleSuffix = "LAST 365 DAYS";
                } elseif ($pagetitle === "Last 30 Days") {
                    $titleSuffix = "LAST 30 DAYS";
                } elseif ($pagetitle === "Custom") {
                    $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
                } elseif ($pagetitle === "Last 24 Hours") {
                    $titleSuffix = "LAST 24 HOURS";
                } elseif ($pagetitle === "Quaterly") {
                    $titleSuffix = "LAST 90 DAYS";
                } else {
                    $titleSuffix = $pagetitle;
                }
        
                $data['title'] = 'Percentage of waste of blood and blood components among those issued (Blood Center)';
                $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3f2', $data, true);
                $this->load->view('layout/main_wrapper', $data);
            } else {
                redirect('dashboard/noaccess');
            }
        }
        
        public function feedbacks_report_CQI3f3()
        {
            $fdate = date('Y-m-d');
            $tdate = date('Y-m-01');
            $_SESSION['from_date'] = $fdate;
            $_SESSION['to_date'] = $tdate;
        
            if ($this->session->userdata('isLogIn') == false) redirect('login');
            if (ismodule_active('QUALITY') === true) {
                $dateInfo = get_from_to_date();
                $pagetitle = $dateInfo['pagetitle'];
                $titleSuffix = "";
        
                if ($pagetitle === "Current Month") {
                    $titleSuffix = strtoupper(date('F Y'));
                } elseif ($pagetitle === "Previous Month") {
                    $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
                } elseif ($pagetitle === "Last 365 Days") {
                    $titleSuffix = "LAST 365 DAYS";
                } elseif ($pagetitle === "Last 30 Days") {
                    $titleSuffix = "LAST 30 DAYS";
                } elseif ($pagetitle === "Custom") {
                    $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
                } elseif ($pagetitle === "Last 24 Hours") {
                    $titleSuffix = "LAST 24 HOURS";
                } elseif ($pagetitle === "Quaterly") {
                    $titleSuffix = "LAST 90 DAYS";
                } else {
                    $titleSuffix = $pagetitle;
                }
        
                $data['title'] = 'Percentage of waste of blood and blood components among those stored (Blood Center)';
                $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3f3', $data, true);
                $this->load->view('layout/main_wrapper', $data);
            } else {
                redirect('dashboard/noaccess');
            }
        }
        
        public function feedbacks_report_CQI3f4()
        {
            $fdate = date('Y-m-d');
            $tdate = date('Y-m-01');
            $_SESSION['from_date'] = $fdate;
            $_SESSION['to_date'] = $tdate;
        
            if ($this->session->userdata('isLogIn') == false) redirect('login');
            if (ismodule_active('QUALITY') === true) {
                $dateInfo = get_from_to_date();
                $pagetitle = $dateInfo['pagetitle'];
                $titleSuffix = "";
        
                if ($pagetitle === "Current Month") {
                    $titleSuffix = strtoupper(date('F Y'));
                } elseif ($pagetitle === "Previous Month") {
                    $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
                } elseif ($pagetitle === "Last 365 Days") {
                    $titleSuffix = "LAST 365 DAYS";
                } elseif ($pagetitle === "Last 30 Days") {
                    $titleSuffix = "LAST 30 DAYS";
                } elseif ($pagetitle === "Custom") {
                    $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
                } elseif ($pagetitle === "Last 24 Hours") {
                    $titleSuffix = "LAST 24 HOURS";
                } elseif ($pagetitle === "Quaterly") {
                    $titleSuffix = "LAST 90 DAYS";
                } else {
                    $titleSuffix = $pagetitle;
                }
        
                $data['title'] = 'Percentage of number of blood component units used (Blood Center)';
                $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3f4', $data, true);
                $this->load->view('layout/main_wrapper', $data);
            } else {
                redirect('dashboard/noaccess');
            }
        }
        
        public function feedbacks_report_CQI3f5()
        {
            $fdate = date('Y-m-d');
            $tdate = date('Y-m-01');
            $_SESSION['from_date'] = $fdate;
            $_SESSION['to_date'] = $tdate;
        
            if ($this->session->userdata('isLogIn') == false) redirect('login');
            if (ismodule_active('QUALITY') === true) {
                $dateInfo = get_from_to_date();
                $pagetitle = $dateInfo['pagetitle'];
                $titleSuffix = "";
        
                if ($pagetitle === "Current Month") {
                    $titleSuffix = strtoupper(date('F Y'));
                } elseif ($pagetitle === "Previous Month") {
                    $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
                } elseif ($pagetitle === "Last 365 Days") {
                    $titleSuffix = "LAST 365 DAYS";
                } elseif ($pagetitle === "Last 30 Days") {
                    $titleSuffix = "LAST 30 DAYS";
                } elseif ($pagetitle === "Custom") {
                    $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
                } elseif ($pagetitle === "Last 24 Hours") {
                    $titleSuffix = "LAST 24 HOURS";
                } elseif ($pagetitle === "Quaterly") {
                    $titleSuffix = "LAST 90 DAYS";
                } else {
                    $titleSuffix = $pagetitle;
                }
        
                $data['title'] = 'Turn-around time for blood and blood components cross matched / reserved (Blood Center)';
                $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3f5', $data, true);
                $this->load->view('layout/main_wrapper', $data);
            } else {
                redirect('dashboard/noaccess');
            }
        }
        
        public function feedbacks_report_CQI3f6()
        {
            $fdate = date('Y-m-d');
            $tdate = date('Y-m-01');
            $_SESSION['from_date'] = $fdate;
            $_SESSION['to_date'] = $tdate;
        
            if ($this->session->userdata('isLogIn') == false) redirect('login');
            if (ismodule_active('QUALITY') === true) {
                $dateInfo = get_from_to_date();
                $pagetitle = $dateInfo['pagetitle'];
                $titleSuffix = "";
        
                if ($pagetitle === "Current Month") {
                    $titleSuffix = strtoupper(date('F Y'));
                } elseif ($pagetitle === "Previous Month") {
                    $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
                } elseif ($pagetitle === "Last 365 Days") {
                    $titleSuffix = "LAST 365 DAYS";
                } elseif ($pagetitle === "Last 30 Days") {
                    $titleSuffix = "LAST 30 DAYS";
                } elseif ($pagetitle === "Custom") {
                    $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
                } elseif ($pagetitle === "Last 24 Hours") {
                    $titleSuffix = "LAST 24 HOURS";
                } elseif ($pagetitle === "Quaterly") {
                    $titleSuffix = "LAST 90 DAYS";
                } else {
                    $titleSuffix = $pagetitle;
                }
        
                $data['title'] = 'Adverse events and near miss events involving blood bank and/or transfusion services (Transfusion to the wrong patient, Mislabeled blood product, Contaminated blood product) (JCI8-AOP 4.00) - (Blood Center)';
                $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3f6', $data, true);
                $this->load->view('layout/main_wrapper', $data);
            } else {
                redirect('dashboard/noaccess');
            }
        }
        
        public function feedbacks_report_CQI3f7()
        {
            $fdate = date('Y-m-d');
            $tdate = date('Y-m-01');
            $_SESSION['from_date'] = $fdate;
            $_SESSION['to_date'] = $tdate;
        
            if ($this->session->userdata('isLogIn') == false) redirect('login');
            if (ismodule_active('QUALITY') === true) {
                $dateInfo = get_from_to_date();
                $pagetitle = $dateInfo['pagetitle'];
                $titleSuffix = "";
        
                if ($pagetitle === "Current Month") {
                    $titleSuffix = strtoupper(date('F Y'));
                } elseif ($pagetitle === "Previous Month") {
                    $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
                } elseif ($pagetitle === "Last 365 Days") {
                    $titleSuffix = "LAST 365 DAYS";
                } elseif ($pagetitle === "Last 30 Days") {
                    $titleSuffix = "LAST 30 DAYS";
                } elseif ($pagetitle === "Custom") {
                    $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
                } elseif ($pagetitle === "Last 24 Hours") {
                    $titleSuffix = "LAST 24 HOURS";
                } elseif ($pagetitle === "Quaterly") {
                    $titleSuffix = "LAST 90 DAYS";
                } else {
                    $titleSuffix = $pagetitle;
                }
        
                $data['title'] = 'Blood availability rate (JCI8-AOP 4.00) - (Blood Center)';
                $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3f7', $data, true);
                $this->load->view('layout/main_wrapper', $data);
            } else {
                redirect('dashboard/noaccess');
            }
        }
        
        public function feedbacks_report_CQI3f8()
        {
            $fdate = date('Y-m-d');
            $tdate = date('Y-m-01');
            $_SESSION['from_date'] = $fdate;
            $_SESSION['to_date'] = $tdate;
        
            if ($this->session->userdata('isLogIn') == false) redirect('login');
            if (ismodule_active('QUALITY') === true) {
                $dateInfo = get_from_to_date();
                $pagetitle = $dateInfo['pagetitle'];
                $titleSuffix = "";
        
                if ($pagetitle === "Current Month") {
                    $titleSuffix = strtoupper(date('F Y'));
                } elseif ($pagetitle === "Previous Month") {
                    $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
                } elseif ($pagetitle === "Last 365 Days") {
                    $titleSuffix = "LAST 365 DAYS";
                } elseif ($pagetitle === "Last 30 Days") {
                    $titleSuffix = "LAST 30 DAYS";
                } elseif ($pagetitle === "Custom") {
                    $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
                } elseif ($pagetitle === "Last 24 Hours") {
                    $titleSuffix = "LAST 24 HOURS";
                } elseif ($pagetitle === "Quaterly") {
                    $titleSuffix = "LAST 90 DAYS";
                } else {
                    $titleSuffix = $pagetitle;
                }
        
                $data['title'] = 'CT Ratio (cross match to transfusion) (JCI8-AOP 4.00) - (Blood Center)';
                $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3f8', $data, true);
                $this->load->view('layout/main_wrapper', $data);
            } else {
                redirect('dashboard/noaccess');
            }
        }
        
        public function feedbacks_report_CQI3f9()
        {
            $fdate = date('Y-m-d');
            $tdate = date('Y-m-01');
            $_SESSION['from_date'] = $fdate;
            $_SESSION['to_date'] = $tdate;
        
            if ($this->session->userdata('isLogIn') == false) redirect('login');
            if (ismodule_active('QUALITY') === true) {
                $dateInfo = get_from_to_date();
                $pagetitle = $dateInfo['pagetitle'];
                $titleSuffix = "";
        
                if ($pagetitle === "Current Month") {
                    $titleSuffix = strtoupper(date('F Y'));
                } elseif ($pagetitle === "Previous Month") {
                    $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
                } elseif ($pagetitle === "Last 365 Days") {
                    $titleSuffix = "LAST 365 DAYS";
                } elseif ($pagetitle === "Last 30 Days") {
                    $titleSuffix = "LAST 30 DAYS";
                } elseif ($pagetitle === "Custom") {
                    $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
                } elseif ($pagetitle === "Last 24 Hours") {
                    $titleSuffix = "LAST 24 HOURS";
                } elseif ($pagetitle === "Quaterly") {
                    $titleSuffix = "LAST 90 DAYS";
                } else {
                    $titleSuffix = $pagetitle;
                }
        
                $data['title'] = 'Turnaround time for Platelet Apheresis (Blood Center)';
                $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3f9', $data, true);
                $this->load->view('layout/main_wrapper', $data);
            } else {
                redirect('dashboard/noaccess');
            }
        }
        public function feedbacks_report_CQI3f10() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Turnaround time for blood donation (Blood Center)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3f10', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI3g1() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Catheter associated urinary tract infection rate (PSQ 3b) - (Infection Control - Nursing)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3g1', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI3g2() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Ventilator associated pneumonias (VAP) in 1000 ventilator days (Infection Control - Nursing)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3g2', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
        public function feedbacks_report_CQI3g3() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Central Line Associated Blood Stream Infection (CLABSI) - (Infection Control - Nursing)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3g3', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function feedbacks_report_CQI3g4() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Surgical site infection rate (Infection Control - Nursing)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3g4', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI3g5() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Late Onset Sepsis Rate After 72 Hours (Nursing - NICU)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3g5', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI3g6() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Environmental cleaning & disinfection compliance rate (JCI8-PCI 4.0) - (House Keeping)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3g6', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
        public function feedbacks_report_CQI3h1() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Mortality rate (MRD)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3h1', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI3h2() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Return to ICU within 48 hours (Nursing - ICU1)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3h2', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI3h3() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Return to ICU 2 within 48 hours (Nursing - ICU2)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3h3', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI3h4() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Return to ICU 3 within 48 hours (Nursing - CICU)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3h4', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI3h5() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Return to the emergency department after 72 hours with similar presenting complaints (Emergency - Department)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3h5', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI3h6() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Reintubation rate (Nursing - ICU1)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3h6', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI3h7() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Reintubation rate (Nursing - ICU2)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3h7', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI3h8() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Reintubation rate (Nursing - CICU)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3h8', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI3h9() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Re Admission Rate (Nursing - NICU)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3h9', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
        public function feedbacks_report_CQI3j1() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Shift change handover communication (Nurses) - (Nursing - Emergency Department)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3j1', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function feedbacks_report_CQI3j2() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Shift change handover communication (Nurses) - (Nursing - ICU)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3j2', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI3j3() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Shift change handover communication (Nurses) - (Nursing - Ward)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3j3', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
        public function feedbacks_report_CQI3j4() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Incidence of patient identification error (Quality Office)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3j4', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI3j5() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Number of missed hand hygiene opportunities (Infection Control - Nursing)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3j5', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI3j6() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Compliance rate to medication prescription in capitals (Clinical Pharmacy)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3j6', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function feedbacks_report_CQI3j7() {
    $fdate = date('Y-m-d');
    $tdate = date('Y-m-01');
    $_SESSION['from_date'] = $fdate;
    $_SESSION['to_date'] = $tdate;

    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $dateInfo = get_from_to_date();
        $pagetitle = $dateInfo['pagetitle'];
        $titleSuffix = "";

        if ($pagetitle === "Current Month") {
            $titleSuffix = strtoupper(date('F Y'));
        } elseif ($pagetitle === "Previous Month") {
            $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
        } elseif ($pagetitle === "Last 365 Days") {
            $titleSuffix = "LAST 365 DAYS";
        } elseif ($pagetitle === "Last 30 Days") {
            $titleSuffix = "LAST 30 DAYS";
        } elseif ($pagetitle === "Custom") {
            $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
        } elseif ($pagetitle === "Last 24 Hours") {
            $titleSuffix = "LAST 24 HOURS";
        } elseif ($pagetitle === "Quaterly") {
            $titleSuffix = "LAST 90 DAYS";
        } else {
            $titleSuffix = $pagetitle;
        }

        $data['title'] = 'Shift change handover communication (Doctors) (MRD - Emergency Department)';
        $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3j7', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    } else {
        redirect('dashboard/noaccess');
    }
}

    public function feedbacks_report_CQI3j8() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Shift change handover communication (Doctors) - (MRD - ICU)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3j8', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI3j9() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Compliance to patient identification - IPD (Nursing)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3j9', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI3j10() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Compliance rate of timeliness of reporting Critical results in Radiology (within 30 min) - (Radiology)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3j10', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function feedbacks_report_CQI3j11() {
    $fdate = date('Y-m-d');
    $tdate = date('Y-m-01');
    $_SESSION['from_date'] = $fdate;
    $_SESSION['to_date'] = $tdate;

    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $dateInfo = get_from_to_date();
        $pagetitle = $dateInfo['pagetitle'];
        $titleSuffix = "";

        if ($pagetitle === "Current Month") {
            $titleSuffix = strtoupper(date('F Y'));
        } elseif ($pagetitle === "Previous Month") {
            $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
        } elseif ($pagetitle === "Last 365 Days") {
            $titleSuffix = "LAST 365 DAYS";
        } elseif ($pagetitle === "Last 30 Days") {
            $titleSuffix = "LAST 30 DAYS";
        } elseif ($pagetitle === "Custom") {
            $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
        } elseif ($pagetitle === "Last 24 Hours") {
            $titleSuffix = "LAST 24 HOURS";
        } elseif ($pagetitle === "Quaterly") {
            $titleSuffix = "LAST 90 DAYS";
        } else {
            $titleSuffix = $pagetitle;
        }

        $data['title'] = 'IPSG 2.2 - Hand off communication interdepartmental shift (MRD - Emergency Department)';
        $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3j11', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    } else {
        redirect('dashboard/noaccess');
    }
}

    public function feedbacks_report_CQI3j12() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'IPSG 2.2 - Hand off communication interdepartmental shift (MRD - ICU)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3j12', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI3j13() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'IPSG 2.2 - Hand off communication interdepartmental Shift (Nurses) - (Nursing - Emergency Department)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3j13', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI3j14() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'IPSG 2.2 - Hand off communication interdepartmental Shift (Nurses) - (Nursing - ICU)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3j14', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI3j15() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'IPSG 2.2 - Hand off communication interdepartmental Shift (Nurses) - (Nursing - Ward)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3j15', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI3j16() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'IPSG 2.2 - Hand off communication interdepartmental Shift (Doctors) - (MRD - Ward)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3j16', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI3j17() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'IPSG 2.2 - Hand off communication interdepartmental Shift (Doctors) - (MRD - ICU)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3j17', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI3j18() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'IPSG 2.2 - Hand off communication among nurses (During shift change)-(Nursing - EmergencyÂ Department)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3j18', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI3j19() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'IPSG 2.2 - Hand off communication among nurses (During shift change)-(Nursing -ICU)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3j19', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI3j20() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'IPSG 2.2 - Hand off communication among nurses (During shift change)-(Nursing -Ward)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3j20', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function feedbacks_report_CQI3j21() {
    $fdate = date('Y-m-d');
    $tdate = date('Y-m-01');
    $_SESSION['from_date'] = $fdate;
    $_SESSION['to_date'] = $tdate;

    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $dateInfo = get_from_to_date();
        $pagetitle = $dateInfo['pagetitle'];
        $titleSuffix = "";

        if ($pagetitle === "Current Month") {
            $titleSuffix = strtoupper(date('F Y'));
        } elseif ($pagetitle === "Previous Month") {
            $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
        } elseif ($pagetitle === "Last 365 Days") {
            $titleSuffix = "LAST 365 DAYS";
        } elseif ($pagetitle === "Last 30 Days") {
            $titleSuffix = "LAST 30 DAYS";
        } elseif ($pagetitle === "Custom") {
            $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
        } elseif ($pagetitle === "Last 24 Hours") {
            $titleSuffix = "LAST 24 HOURS";
        } elseif ($pagetitle === "Quaterly") {
            $titleSuffix = "LAST 90 DAYS";
        } else {
            $titleSuffix = $pagetitle;
        }

        $data['title'] = 'IPSG 4 - Ensure correct site, correct procedure, correct patient surgery-(Quality Office - Endoscopy)';
        $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3j21', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    } else {
        redirect('dashboard/noaccess');
    }
}

    public function feedbacks_report_CQI3j22() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'IPSG 4 - Ensure correct site, correct procedure, correct patient surgery-(Quality Office - ICU)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3j22', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI3j23() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'IPSG 4 - Ensure correct site, correct procedure, correct patient surgery-(Quality Office - OT)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3j23', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI3j24() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'PSG 6 - Compliance to Fall prevention measures in IPD-(Nursing - IPD)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3j24', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI3j25() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'PSG 6 - Compliance to Fall prevention measures in OPD-(Nursing - OPD)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3j25', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI3j26() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'IPSG 6 - Compliance to Fall prevention measures in Physiotherapy OP patients-(Physical therapy and Rehabilitation Department - Physiotherapy)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3j26', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI3j27() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Compliance to hand hygiene practice (New)-(Infection Control - Nursing)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3j27', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI3j28() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Compliance to patient identification OPD-(Nursing-OPD)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3j28', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function feedbacks_report_CQI3j29() {
    $fdate = date('Y-m-d');
    $tdate = date('Y-m-01');
    $_SESSION['from_date'] = $fdate;
    $_SESSION['to_date'] = $tdate;

    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $dateInfo = get_from_to_date();
        $pagetitle = $dateInfo['pagetitle'];
        $titleSuffix = "";

        if ($pagetitle === "Current Month") {
            $titleSuffix = strtoupper(date('F Y'));
        } elseif ($pagetitle === "Previous Month") {
            $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
        } elseif ($pagetitle === "Last 365 Days") {
            $titleSuffix = "LAST 365 DAYS";
        } elseif ($pagetitle === "Last 30 Days") {
            $titleSuffix = "LAST 30 DAYS";
        } elseif ($pagetitle === "Custom") {
            $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
        } elseif ($pagetitle === "Last 24 Hours") {
            $titleSuffix = "LAST 24 HOURS";
        } elseif ($pagetitle === "Quaterly") {
            $titleSuffix = "LAST 90 DAYS";
        } else {
            $titleSuffix = $pagetitle;
        }

        $data['title'] = 'Shift change handover communication(Doctors - ward)-(Medical Administration)';
        $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3j29', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    } else {
        redirect('dashboard/noaccess');
    }
}

    public function feedbacks_report_CQI3j30() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Incidence of Adverse events in Physiotherapy (IPD)-(Physical therapy and Rehabilitation Department - Physiotherapy)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3j30', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI3j31() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Incidence of Adverse events in Physiotherapy(OPD)-(Physical therapy and Rehabilitation Department - Physiotherapy)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3j31', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI3j32() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'IPSG 4 - Ensure correct site, correct procedure, correct patient surgery-(Quality Office - OT)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3j32', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI3j33() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Security incidents rate(JCI8-FMS 4.0)-(Safety & Security)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3j33', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI3j34() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Safety incidents rate(JCI8-FMS 3.0)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3j34', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function feedbacks_report_CQI4a1() 
    {
    $fdate = date('Y-m-d');
    $tdate = date('Y-m-01');
    $_SESSION['from_date'] = $fdate;
    $_SESSION['to_date'] = $tdate;

    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $dateInfo = get_from_to_date();
        $pagetitle = $dateInfo['pagetitle'];
        $titleSuffix = "";

        if ($pagetitle === "Current Month") {
            $titleSuffix = strtoupper(date('F Y'));
        } elseif ($pagetitle === "Previous Month") {
            $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
        } elseif ($pagetitle === "Last 365 Days") {
            $titleSuffix = "LAST 365 DAYS";
        } elseif ($pagetitle === "Last 30 Days") {
            $titleSuffix = "LAST 30 DAYS";
        } elseif ($pagetitle === "Custom") {
            $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
        } elseif ($pagetitle === "Last 24 Hours") {
            $titleSuffix = "LAST 24 HOURS";
        } elseif ($pagetitle === "Quaterly") {
            $titleSuffix = "LAST 90 DAYS";
        } else {
            $titleSuffix = $pagetitle;
        }

        $data['title'] = 'Percentage of drugs and consumables procured by local purchases within the formulary-(Pharmacy)';
        $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4a1', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    } else {
        redirect('dashboard/noaccess');
    }
}

    public function feedbacks_report_CQI4a2() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Percentage of drugs and consumables procured by local purchase outside the formulary-(Pharmacy)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4a2', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4a3() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Stock out rate of emergency medications-(Pharmacy)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4a3', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4a4() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Percentage of drugs and consumables rejected before preparation of Goods Receipt Note(SCM-Store)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4a4', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4a5() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Percentage of variations from procurement process(SCM-Purchase)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4a5', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function feedbacks_report_CQI4b1() {
    $fdate = date('Y-m-d');
    $tdate = date('Y-m-01');
    $_SESSION['from_date'] = $fdate;
    $_SESSION['to_date'] = $tdate;

    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $dateInfo = get_from_to_date();
        $pagetitle = $dateInfo['pagetitle'];
        $titleSuffix = "";

        if ($pagetitle === "Current Month") {
            $titleSuffix = strtoupper(date('F Y'));
        } elseif ($pagetitle === "Previous Month") {
            $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
        } elseif ($pagetitle === "Last 365 Days") {
            $titleSuffix = "LAST 365 DAYS";
        } elseif ($pagetitle === "Last 30 Days") {
            $titleSuffix = "LAST 30 DAYS";
        } elseif ($pagetitle === "Custom") {
            $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
        } elseif ($pagetitle === "Last 24 Hours") {
            $titleSuffix = "LAST 24 HOURS";
        } elseif ($pagetitle === "Quaterly") {
            $titleSuffix = "LAST 90 DAYS";
        } else {
            $titleSuffix = $pagetitle;
        }

        $data['title'] = 'Incidence of bed sores (hospital associated pressure ulcers) after admission (in 1000 patient days)-(Nursing)';
        $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4b1', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    } else {
        redirect('dashboard/noaccess');
    }
}

    public function feedbacks_report_CQI4b2() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Incidence of falls (in 1000 IPD days)-(Office-Quality)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4b2', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4b3() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Number of variations observed in mock drill-(Safety & Security)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4b3', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4b4() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Percentage of staff provided with pre-exposure prophylaxis-(Infection Control)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4b4', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4b5() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Number of Fire Incidents-(Safety & Security)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4b5', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4b6() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Incidence of device associated pressure ulcer after admission-(Nursing)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4b6', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4b7() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Number of Extravasation-(Nursing)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4b7', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4b8() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Monitoring of Clinical Errors (JCI8-PCC 2.3)-(Quality Office)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4b8', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function feedbacks_report_CQI4c1() {
    $fdate = date('Y-m-d');
    $tdate = date('Y-m-01');
    $_SESSION['from_date'] = $fdate;
    $_SESSION['to_date'] = $tdate;

    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $dateInfo = get_from_to_date();
        $pagetitle = $dateInfo['pagetitle'];
        $titleSuffix = "";

        if ($pagetitle === "Current Month") {
            $titleSuffix = strtoupper(date('F Y'));
        } elseif ($pagetitle === "Previous Month") {
            $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
        } elseif ($pagetitle === "Last 365 Days") {
            $titleSuffix = "LAST 365 DAYS";
        } elseif ($pagetitle === "Last 30 Days") {
            $titleSuffix = "LAST 30 DAYS";
        } elseif ($pagetitle === "Custom") {
            $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
        } elseif ($pagetitle === "Last 24 Hours") {
            $titleSuffix = "LAST 24 HOURS";
        } elseif ($pagetitle === "Quaterly") {
            $titleSuffix = "LAST 90 DAYS";
        } else {
            $titleSuffix = $pagetitle;
        }

        $data['title'] = 'Bed occupancy rate- (MRD)';
        $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4c1', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    } else {
        redirect('dashboard/noaccess');
    }
}

    public function feedbacks_report_CQI4c2() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Average length of stay (MRD)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4c2', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4c3() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'OT Utilisation Rate (OT)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4c3', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function feedbacks_report_CQI4c4() {
    $fdate = date('Y-m-d');
    $tdate = date('Y-m-01');
    $_SESSION['from_date'] = $fdate;
    $_SESSION['to_date'] = $tdate;

    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $dateInfo = get_from_to_date();
        $pagetitle = $dateInfo['pagetitle'];
        $titleSuffix = "";

        if ($pagetitle === "Current Month") {
            $titleSuffix = strtoupper(date('F Y'));
        } elseif ($pagetitle === "Previous Month") {
            $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
        } elseif ($pagetitle === "Last 365 Days") {
            $titleSuffix = "LAST 365 DAYS";
        } elseif ($pagetitle === "Last 30 Days") {
            $titleSuffix = "LAST 30 DAYS";
        } elseif ($pagetitle === "Custom") {
            $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
        } elseif ($pagetitle === "Last 24 Hours") {
            $titleSuffix = "LAST 24 HOURS";
        } elseif ($pagetitle === "Quaterly") {
            $titleSuffix = "LAST 90 DAYS";
        } else {
            $titleSuffix = $pagetitle;
        }

        $data['title'] = 'ICU equipment utilisation rate-(Nursing - ICU1)';
        $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4c4', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    } else {
        redirect('dashboard/noaccess');
    }
}

    public function feedbacks_report_CQI4c5() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'ICU equipment utilisation rate-(Nursing - ICU2)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4c5', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4c6() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'ICU equipment utilisation rate-(Nursing - ICU3)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4c6', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4c7() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'ICU Bed utilisation rate (Nursing - ICU)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4c7', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4c8() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Critical equipment downtime-(Biomedical Engineering)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4c8', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4c9() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Cath lab utilization rate (Cath Lab - Nursing)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4c9', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4c10() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Nurse patient ratio for ICU Ventilated (Nursing-ICU)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4c10', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4c11() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Nurse patient ratio for ICU Non Ventilated (Nursing-ICU)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4c11', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4c12() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Nurse patient ratio for HDU (Nursing-HDU)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4c12', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4c13() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Nurse patient ratio for Ward (Nursing-Ward)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4c13', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4c14() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Engineering Critical equipment downtime (Engineering & Maintenance)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4c14', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function feedbacks_report_CQI4d1() {
    $fdate = date('Y-m-d');
    $tdate = date('Y-m-01');
    $_SESSION['from_date'] = $fdate;
    $_SESSION['to_date'] = $tdate;

    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $dateInfo = get_from_to_date();
        $pagetitle = $dateInfo['pagetitle'];
        $titleSuffix = "";

        if ($pagetitle === "Current Month") {
            $titleSuffix = strtoupper(date('F Y'));
        } elseif ($pagetitle === "Previous Month") {
            $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
        } elseif ($pagetitle === "Last 365 Days") {
            $titleSuffix = "LAST 365 DAYS";
        } elseif ($pagetitle === "Last 30 Days") {
            $titleSuffix = "LAST 30 DAYS";
        } elseif ($pagetitle === "Custom") {
            $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
        } elseif ($pagetitle === "Last 24 Hours") {
            $titleSuffix = "LAST 24 HOURS";
        } elseif ($pagetitle === "Quaterly") {
            $titleSuffix = "LAST 90 DAYS";
        } else {
            $titleSuffix = $pagetitle;
        }

        $data['title'] = 'Out-patient satisfaction index (OPD)';
        $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4d1', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    } else {
        redirect('dashboard/noaccess');
    }
}

    public function feedbacks_report_CQI4d2() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Inpatient satisfaction index (IPD)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4d2', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4d3() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Time taken for discharge - Cash Patients';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4d3', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4d4() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Time taken for discharge - Insurance Patients';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4d4', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function feedbacks_report_CQI4d5() {
    $fdate = date('Y-m-d');
    $tdate = date('Y-m-01');
    $_SESSION['from_date'] = $fdate;
    $_SESSION['to_date'] = $tdate;

    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $dateInfo = get_from_to_date();
        $pagetitle = $dateInfo['pagetitle'];
        $titleSuffix = "";

        if ($pagetitle === "Current Month") {
            $titleSuffix = strtoupper(date('F Y'));
        } elseif ($pagetitle === "Previous Month") {
            $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
        } elseif ($pagetitle === "Last 365 Days") {
            $titleSuffix = "LAST 365 DAYS";
        } elseif ($pagetitle === "Last 30 Days") {
            $titleSuffix = "LAST 30 DAYS";
        } elseif ($pagetitle === "Custom") {
            $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
        } elseif ($pagetitle === "Last 24 Hours") {
            $titleSuffix = "LAST 24 HOURS";
        } elseif ($pagetitle === "Quaterly") {
            $titleSuffix = "LAST 90 DAYS";
        } else {
            $titleSuffix = $pagetitle;
        }

        $data['title'] = 'Waiting time for diagnostic services (Radiology - CT)';
        $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4d5', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    } else {
        redirect('dashboard/noaccess');
    }
}

    public function feedbacks_report_CQI4d6() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Waiting time for diagnostic services (Radiology - MRI)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4d6', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4d7() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Waiting time for diagnostic services (Radiology - USG)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4d7', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4d8() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Waiting Time for OPD appointments (Patient Care Services - OPD)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4d8', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4d9() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Waiting Time for OPD Walkin (Patient Care Services - OPD)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4d9', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4d10() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Patient Satisfaction Rate-(Nursing - OBG)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4d10', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4d11() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Turn-around Time for Nursing call bell responds (Nursing)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4d11', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function feedbacks_report_CQI4e1() {
    $fdate = date('Y-m-d');
    $tdate = date('Y-m-01');
    $_SESSION['from_date'] = $fdate;
    $_SESSION['to_date'] = $tdate;

    if ($this->session->userdata('isLogIn') == false) redirect('login');

    if (ismodule_active('QUALITY') === true) {
        $dateInfo = get_from_to_date();
        $pagetitle = $dateInfo['pagetitle'];
        $titleSuffix = "";

        if ($pagetitle === "Current Month") {
            $titleSuffix = strtoupper(date('F Y'));
        } elseif ($pagetitle === "Previous Month") {
            $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
        } elseif ($pagetitle === "Last 365 Days") {
            $titleSuffix = "LAST 365 DAYS";
        } elseif ($pagetitle === "Last 30 Days") {
            $titleSuffix = "LAST 30 DAYS";
        } elseif ($pagetitle === "Custom") {
            $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
        } elseif ($pagetitle === "Last 24 Hours") {
            $titleSuffix = "LAST 24 HOURS";
        } elseif ($pagetitle === "Quaterly") {
            $titleSuffix = "LAST 90 DAYS";
        } else {
            $titleSuffix = $pagetitle;
        }

        $data['title'] = 'Employee satisfaction index (HR)';
        $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4e1', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    } else {
        redirect('dashboard/noaccess');
    }
}

    public function feedbacks_report_CQI4e2() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Employee attrition rate (HR)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4e2', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4e3() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Employee absenteeism rate (HR)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4e3', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4e4() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Percentage of employees aware of rights, responsibility and welfare schemes (HR)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4e4', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4e5() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Average number of training hours (HR)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4e5', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4e6() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Nurses Attrition Rate (Nursing)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4e6', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4e7() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Outsourced employee absenteeism rate (Nursing Assistants) (Patient Care Services - OPD)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4e7', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4e8() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Average number of unpaid leave per month (HR)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4e8', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4f1() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Incidence of needle stick injuries IPD area (in 1000 IPD days) (Infection Control - IPD)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4f1', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function feedbacks_report_CQI4f2() {
    $fdate = date('Y-m-d');
    $tdate = date('Y-m-01');
    $_SESSION['from_date'] = $fdate;
    $_SESSION['to_date'] = $tdate;

    if ($this->session->userdata('isLogIn') == false) redirect('login');

    if (ismodule_active('QUALITY') === true) {
        $dateInfo = get_from_to_date();
        $pagetitle = $dateInfo['pagetitle'];
        $titleSuffix = "";

        if ($pagetitle === "Current Month") {
            $titleSuffix = strtoupper(date('F Y'));
        } elseif ($pagetitle === "Previous Month") {
            $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
        } elseif ($pagetitle === "Last 365 Days") {
            $titleSuffix = "LAST 365 DAYS";
        } elseif ($pagetitle === "Last 30 Days") {
            $titleSuffix = "LAST 30 DAYS";
        } elseif ($pagetitle === "Custom") {
            $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
        } elseif ($pagetitle === "Last 24 Hours") {
            $titleSuffix = "LAST 24 HOURS";
        } elseif ($pagetitle === "Quaterly") {
            $titleSuffix = "LAST 90 DAYS";
        } else {
            $titleSuffix = $pagetitle;
        }

        $data['title'] = 'Incidence of needle stick injuries OPD area (in 1000 OPD days) (Infection Control - OPD)';
        $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4f2', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    } else {
        redirect('dashboard/noaccess');
    }
}
    public function feedbacks_report_CQI4f3() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Percentage of sentinel events, reported, collected and analysed within the defined time frame (Quality Office)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4f3', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4f4() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Percentage of near misses (Quality Office)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4f4', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4f5() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Incidence of blood body fluid exposure IPD (Infection Control - IPD)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4f5', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function feedbacks_report_CQI4f6() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Incidence of blood body fluid exposure OPD (Infection Control - OPD)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4f6', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4f7() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Adverse events related to SUDs (JCI8-PCI 3.1) (CSSD)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4f7', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4g1() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Percentage of Medical records not having discharge summary (MRD)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4g1', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4g2() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Percentage of Medical records not having codification as per ICD (MRD)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4g2', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4g3() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Percentage of Medical records having improper or incomplete consent (MRD)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4g3', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4g4() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Percentage of missing medical records (MRD)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4g4', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4g5() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Compliance rate of adhering with policies and procedures for care of patients at risk for suicide and self-harm (JCI8-COP 5) (MRD)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4g5', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4g6() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Monthly Abbreviation Compliance (MRD)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4g6', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function feedbacks_report_CQI3k1() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Total number of LAMA cases with Reasons (MRD)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3k1', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI3k2() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Adverse events due to handover (Quality Office)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3k2', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI3k3() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Inguinal herniorrhaphy with mesh (Infection Control)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3k3', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI3k4() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Coronary artery bypass grafting (CABG) (Infection Control)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3k4', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function feedbacks_report_CQI3k5() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Laparoscopic cholecystectomy (Infection Control)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3k5', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI3k6() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Monitoring the duration of antibiotic usage in surgical prophylaxis (After 48 hours) (Clinical Pharmacy)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3k6', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI3k7() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'De-escalation of antibiotics (Clinical Pharmacy)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3k7', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI3k8() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'High Alert Medication Segregation, storage & labelling Compliance rate (Pharmacy - Store)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3k8', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI3k9() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Average recovery time (OT-Post OP)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3k9', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI3k10() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Door to thrombolysis time in ischemic stroke in ER (Emergency Department)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3k10', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI3k11() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Door to image time in Stroke patients (Emergency Department)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3k11', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI3k12() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Average number of patients visiting Emergency per day (Emergency Department)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3k12', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function feedbacks_report_CQI3k13() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Efficiency of code blue team (Emergency Department)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3k13', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI3k14() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Time for first defibrillation (Emergency Department)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3k14', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI3k15() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Door to Balloon time in PTCA (Cath Lab)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3k15', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI3k16() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Compliance to diet order (Clinical Nutrition and Dietetics)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3k16', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI3k17() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Case Fatality 1 - CAD (MRD)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3k17', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function feedbacks_report_CQI3k18() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Case Fatality 2 - Acute coronary syndrome (MRD)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3k18', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI3k19() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Case Fatality 3 - Cerebral infarction (MRD)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3k19', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI3k20() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Case Fatality 4 - MI (MRD)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3k20', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI3k21() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Case Fatality 5 - Heart failure (MRD)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3k21', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI3k22() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Compliances in patient transfer and transportation process (External transfer) - (Emergency Department)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3k22', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI3k23() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Number of Adverse Events During Patient Transfers (Out Side) - (Emergency Department)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3k23', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI3k24() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'ILC/EQAS compliance rate (Lab Services)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3k24', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI3k25() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Compliance with Biological Indicator (CSSD)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3k25', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function feedbacks_report_CQI3k26() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Compliance to risk assessment in reprocessing of SUMD (CSSD)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3k26', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI3k27() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Non-compliance to Copy and Paste policy (MRD)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3k27', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI3k28() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Compliance to POCT IQC Checking (Lab Services)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3k28', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI3k29() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Case Fatality - COVID 19 (MRD)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3k29', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function feedbacks_report_CQI3k30() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Case Fatality - Stroke (MRD)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3k30', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI3k31() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Post procedure complication rate - Colonoscopy (Endoscopy)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3k31', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI3k32() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Polyp retrieval rate after colonoscopic polypectomy (Endoscopy)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3k32', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI3k33() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Survival rate for living donor kidney transplants (Nephrology)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3k33', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI3k34() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'CAUTI Prevention Bundle compliance Rate (Infection Control)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3k34', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function feedbacks_report_CQI3k35() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Major Discrepancies between Preoperative and Post operative Diagnosis (OT)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3k35', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI3k36() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Adverse Events Related to patient Identification (Quality Office)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3k36', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI3k37() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'CLABSI Prevention Bundle compliance Rate (Infection Control)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3k37', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI3k38() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'SSI Prevention Bundle compliance Rate (Infection Control)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3k38', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI3k39() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'VAP Prevention Bundle compliance Rate (Infection Control)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3k39', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI3k40() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Restraint related injuries among admitted patients (Nursing)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3k40', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI3k41() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Rate of compliance for restraint consent policy (Nursing)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3k41', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI3k42() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Percentage of Accidental removal of line (Nursing)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3k42', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI3k43() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Significant hypotension necessitating termination of dialysis (Nursing)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3k43', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI3k44() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'IPSG4 - Time out compliance in outside OT (Nursing)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3k44', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI3k45() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Percentage of cases where Initial assessment done in physiotherapy within 24 hours (IPD) (Physical therapy and Rehabilitation Department - Medical records)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3k45', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function feedbacks_report_CQI3k46() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Radiology TAT orders for CT (Radiology)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3k46', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI3k47() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Radiology TAT orders for MRI (Radiology)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3k47', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function feedbacks_report_CQI3k48() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Radiology TAT orders for USG (Radiology)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3k48', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI3k49() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Radiology TAT orders for X-ray (Radiology)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3k49', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI3k50() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Site Marking Compliance Rate (OT)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3k50', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function feedbacks_report_CQI3k51() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Time Out Compliance Rate (OT)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3k51', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI3k52() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Sign Out Compliance Rate (OT)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3k52', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI3k53() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Post transplant complication rate for Donor (Liver) (Transplant Unit)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3k53', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI3k54() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Post transplant complication rate (Heart) (Transplant Unit)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3k54', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI3k55() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Percentage of research activities approved by ethics committee (Research)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3k55', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function feedbacks_report_CQI3k56() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Percentage of patients withdrawing from the study (Research)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3k56', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI3k57() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Percentage of protocol violations/deviations reported (Research)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3k57', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI3k58() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Percentage of serious adverse events reported to the ethics committee within the defined timeframe (Research)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3k58', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI3k59() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Percentage of cases where Initial assessment done in physiotherapy within 24 hours OPD';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3k59', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI3k60() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Survival rate for living donor Liver transplants (Gastrointestinal Surgery)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3k60', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI3k61() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Return of spontaneous circulation (ROSC) achieving rate (JCI8-COP 4) - Emergency Department';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3k61', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI3k62() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Timeliness of initiation of advanced cardiovascular life support (ACLS) within 5 Min (JCI8-COP 4) - Nursing';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3k62', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI3k63() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Timeliness of staff response to cardiac arrest (JCI8-COP 4) - Emergency Department';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3k63', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI3k64() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Rate to RRT response turn to Code blue (JCI8-COP 4) - Nursing';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3k64', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function feedbacks_report_CQI3k65() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Percentage of patient Identification Errors for Diet patients (IPD)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3k65', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function feedbacks_report_CQI3k66() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Number of Patient safety events or patterns of events during procedural sedation';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI3k66', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function feedbacks_report_CQI4h1() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Patient satisfaction index - Physiotherapy (Physical therapy and Rehabilitation Department)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4h1', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4h2() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'TAT for radiology STAT orders (Radiology - CT)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4h2', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4h3() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'TAT for radiology STAT orders (Radiology - MRI)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4h3', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4h4() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'TAT for radiology STAT orders (Radiology - USG)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4h4', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4h5() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'HAZMAT compliance in radiology';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4h5', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function feedbacks_report_CQI4h6() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'TLD Reading Compliance (Radiology)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4h6', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4h7() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Variance in Financial counselling (Patient Care Services - IPD)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4h7', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4h8() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Planned Discharge rate (Patient Care Services - IPD)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4h8', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4h9() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Incident report rate (Quality Office)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4h9', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function feedbacks_report_CQI4h10() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'TAT for dispensing medicine - IP (Pharmacy)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4h10', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4h11() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'TAT for STAT medicine (Pharmacy)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4h11', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4h12() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Average number of Doctors on hospital rolls at any point of time (HR)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4h12', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4h13() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Average Number of Nurses on hospital rolls at any point of time (HR)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4h13', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4h14() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Reason for staff exit (HR)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4h14', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function feedbacks_report_CQI4h15() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Compliance to Internal complaints committee requirements (HR)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4h15', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4h16() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Effectiveness in recruitment (MRF submission days - Staff onboarded time) (HR)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4h16', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4h17() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Compliance to Employee Engagement activities (HR)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4h17', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4h18() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Number of Mandatory training hours coverage / staff (HR)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4h18', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4h19() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Compliance to ACLS training (HR)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4h19', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4h20() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Average units of electricity consumed/Day (Units) (Engineering & Maintenance)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4h20', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4h21() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'TAT for complaints on equipment/Utility/Facility (Engineering & Maintenance)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4h21', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function feedbacks_report_CQI4h22() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Average units of water consumed/Day (L) (Engineering & Maintenance)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4h22', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4h23() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Adherence to PPE usage in Engineering and Maintenance department (Engineering & Maintenance)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4h23', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4h24() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Compliance to PM schedule (Engineering & Maintenance)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4h24', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4h25() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Compliance to safe storage of chemicals (Engineering & Maintenance)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4h25', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4h26() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Outsourced Security service Staff Attendance (Safety & Security - Security)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4h26', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4h27() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Compliance to reporting of critical values in Lab (within 30 min) (Lab Service)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4h27', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4h28() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Compliance to reporting of critical values in POCT (Lab Service)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4h28', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4h29() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'TAT for Lab tests (Lab Service)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4h29', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4h30() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'TAT for Lab STAT (Lab Service)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4h30', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function feedbacks_report_CQI4h31() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Compliance to TAT for lab outsourced test (Lab Service)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4h31', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4h32() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Lab Specimen Rejection Rate (Lab Service)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4h32', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4h33() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Insurance Claims Rejection Rate (Insurance)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4h33', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4h34() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'TPA TAT (Insurance) for the month';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4h34', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4h35() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Medical Waste Collection Rate (House Keeping)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4h35', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function feedbacks_report_CQI4h36() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Compliance to MSDS in Facility (House Keeping)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4h36', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4h37() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Percentage of Pest control Complaints rate (House Keeping)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4h37', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4h38() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Linen Quality - Compliance Rate (House Keeping)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4h38', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4h39() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Downtime of EMR (ITD)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4h39', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4h40() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Outsourced staff manpower compliance rate (House Keeping)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4h40', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function feedbacks_report_CQI4h41() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'ITD Preventive Maintenance compliance (ITD)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4h41', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4h42() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Biomedical Preventive Maintenance Completion rate (Biomedical Engineering)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4h42', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4h43() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Quality of patient transportation by ambulance (Out-sourced) (Lab Service)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4h43', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4h44() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'F&B Patient complaints rate (Food and Beverage Services)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4h44', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4h45() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Delay in room services (Food and Beverage Services)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4h45', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4h46() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = 'Compliance to PCRA (Engineering & Maintenance)';
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4h46', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4h47() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = "Compliances in patient room cleaning and hygiene practices (House Keeping)";
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4h47', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4h48() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = "Patient's Complaints Rate (House Keeping)";
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4h48', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4h49() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = "Percentage of renewable energy used against total energy used (JCI8-GHI 3) (Engineering & Maintenance)";
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4h49', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4h50() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = "To Monitor the energy consumption (JCI8-GHI 3) (Engineering & Maintenance)";
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4h50', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function feedbacks_report_CQI4h51() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = "Percentage of Wrong food Delivery for Patients & Bystanders (Food and Beverage Services)";
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4h51', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4h52() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = "Percentage of adherence to facility audit observation closure (Safety & Security)";
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4h52', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4h53() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = "Standardised Mortality Ratio for ICU - 1 (Nursing - ICU 1)";
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4h53', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4h54() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = "Standardised Mortality Ratio for ICU - 2 (Actual deaths in ICU-2)";
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4h54', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4h55() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = "Standardised Mortality Ratio for PICU (Actual deaths in PICU)";
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4h55', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4h56() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = "Standardised Mortality Ratio for NICU (Actual deaths in NICU)";
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4h56', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function feedbacks_report_CLOTCM1() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = "Average length of stay (MRD - Cardiology)";
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CLOTCM1', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CLOTCM2() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = "Average length of stay (MRD - CVTS)";
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CLOTCM2', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function feedbacks_report_CLOTCM3() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = "Average length of stay (MRD - Gastro surgery)";
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CLOTCM3', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CLOTCM4() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = "Average length of stay (MRD - Gastroenterology)";
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CLOTCM4', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CLOTCM5() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = "Average length of stay (MRD - General Medicine)";
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CLOTCM5', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CLOTCM6() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = "Average length of stay (MRD - ICU)";
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CLOTCM6', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CLOTCM7() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = "Average length of stay (MRD - Nephrology)";
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CLOTCM7', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CLOTCM8() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = "Average length of stay (MRD - Neuro Intervention)";
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CLOTCM8', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CLOTCM9() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = "Average length of stay (MRD - Neurology)";
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CLOTCM9', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CLOTCM10() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = "Average length of stay (MRD - Neurosurgery)";
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CLOTCM10', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function feedbacks_report_CLOTCM11() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = "Average length of stay (MRD - Ortho neuro integrated spine)";
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CLOTCM11', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CLOTCM12() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = "Average length of stay (MRD - Ortho THR)";
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CLOTCM12', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CLOTCM13() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = "Average length of stay (MRD - Ortho TKR)";
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CLOTCM13', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CLOTCM14() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = "Average length of stay (MRD - Orthopaedics)";
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CLOTCM14', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CLOTCM15() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = "Average length of stay (MRD - Pulmonology)";
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CLOTCM15', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CLOTCM16() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = "Average length of stay (MRD - Urology)";
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CLOTCM16', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CLOTCM17() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = "Catheter associated urinary tract infection rate (Infection Control - ICU1)";
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CLOTCM17', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CLOTCM18() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = "Catheter associated urinary tract infection rate (Infection Control - ICU2)";
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CLOTCM18', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CLOTCM19() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = "Catheter associated urinary tract infection rate (Infection Control - ICU3)";
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CLOTCM19', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CLOTCM20() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = "Central Line Associated Blood Stream Infection (CLABSI) - (Infection Control - ICU1)";
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CLOTCM20', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function feedbacks_report_CLOTCM21() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = "Central Line Associated Blood Stream Infection (CLABSI) - (Infection Control - ICU2)";
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CLOTCM21', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CLOTCM22() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = "Central Line Associated Blood Stream Infection (CLABSI) - (Infection Control - ICU3)";
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CLOTCM22', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CLOTCM23() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = "Surgical Site Infection rate (Infection Control - Ortho THR)";
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CLOTCM23', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CLOTCM24() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = "Surgical Site Infection rate (Infection Control - Ortho TKR)";
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CLOTCM24', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CLOTCM25() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = "Ventilator associated pneumonias (VAP) in 1000 ventilator days (Infection Control - ICU1)";
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CLOTCM25', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CLOTCM26() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = "Ventilator associated pneumonias (VAP) in 1000 ventilator days (Infection Control - ICU2)";
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CLOTCM26', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CLOTCM27() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = "Ventilator associated pneumonias (VAP) in 1000 ventilator days (Infection Control - ICU3)";
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CLOTCM27', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CLOTCM28() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = "Ventilator associated pneumonias (VAP) in 1000 ventilator days (Infection Control - Ortho THR)";
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CLOTCM28', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CLOTCM29() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = "Ventilator associated pneumonias (VAP) in 1000 ventilator days (Infection Control - Ortho TKR)";
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CLOTCM29', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CLOTCM30() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = "Prevalence of transfusion reactions in Leuco depleted PRBC transfusions (Blood Center)";
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CLOTCM30', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function feedbacks_report_CQI4i1() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = "Compliance to medical service requests - Heart, Lung transplantation (Medical Administration)";
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4i1', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4i2() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = "Compliance to medical service requests - Liver transplantation";
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4i2', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4i3() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = "TAT compliance for radiology outsourced test (Radiology)";
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4i3', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4i4() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = "Food waste collection rate (House Keeping)";
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4i4', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function feedbacks_report_CQI4i5() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = "Solid waste collection rate (House Keeping)";
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4i5', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4i6() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = "Outsourced GDA (General Duty Assistance) absenteeism rate (House Keeping)";
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4i6', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4i7() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = "Outsourced OPD Assistance attendance (Operation)";
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4i7', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4i8() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = "Outsourced UTIZ staff attendance (House Keeping)";
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4i8', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4i9() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = "Compliance to safe transportation of Oil waste (Engineering & Maintenance)";
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4i9', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4i10() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = "Number of laundry loads reduced by optimizing and sorting laundry (JCI8-GHI 3)";
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4i10', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4i11() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = "Percentage of cleaning products used biodegradable (JCI8-GHI 3)";
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4i11', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4i12() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = "Average use of Ecofriendly catering supplies in a month (JCI8-GHI 3)";
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4i12', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4i13() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = "Average quantity of Medical waste disposed per month in Kgs (JCI8-GHI 3)";
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4i13', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4i14() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = "Non-Recyclable Waste per Patient Day (Kg) (JCI8-GHI 3)";
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4i14', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function feedbacks_report_CQI4j1() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = "Door to Physician â‰¤10 min (Stroke Unit)";
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4j1', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4j2() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = "Door to stroke team â‰¤15 min (Stroke Unit)";
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4j2', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4j3() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = "Door to CT/MRI initiation â‰¤20 min (Stroke Unit)";
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4j3', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4j4() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = "Door to CT/MRI interpretation â‰¤30 min (Stroke Unit)";
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4j4', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4j5() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = "Order to lab results â‰¤30 min, if ordered (Stroke Unit)";
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4j5', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function feedbacks_report_CQI4j6() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = "Door to IV thrombolytic bolus (â‰¥75% compliance) â‰¤60 min (Stroke Unit)";
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4j6', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4j7() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = "Door to IV thrombolytic bolus (â‰¥50% compliance) â‰¤45 min (Stroke Unit)";
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4j7', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4j8() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = "Door to puncture time â‰¤90 min (Stroke Unit)";
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4j8', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4j9() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = "The periprocedural complication rates after correcting for various comorbidities (Stroke Unit)";
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4j9', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4j10() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = "The periprocedural mortality rate for surgical or interventional procedures (Stroke Unit)";
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4j10', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function feedbacks_report_CQI4j11() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = "Percentage of all stroke/TIA patients with a deficit at the time of initial note for whom an NIHSS score is documented (Stroke Unit)";
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4j11', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4j12() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = "Percentage of ischemic stroke patients eligible for intravenous thrombolysis who receive it within the appropriate time window (Stroke Unit)";
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4j12', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function feedbacks_report_CQI4j13() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = "Percentage of patients treated for acute ischemic stroke with IV thrombolysis whose treatment is started within 60 minutes after arrival (Stroke Unit)";
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4j13', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4j14() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = "Time from arrival to start of initial imaging workup for patients arriving within 24 hours of last known well (Minutes) (Stroke Unit)";
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4j14', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4j15() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = "Percentage of ischemic stroke patients who develop symptomatic intracranial hemorrhage â‰¤36 hours after thrombolytic therapy or mechanical thrombectomy (Stroke Unit)";
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4j15', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4j16() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = "Percentage of patients undergoing CEA, carotid angioplasty or stenting having stroke or death within 30 days of the procedure (Stroke Unit)";
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4j16', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4j17() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = "Percentage of patients undergoing intracranial angioplasty and/or stenting for atherosclerotic disease having stroke or death within 30 days of the procedure (Stroke Unit)";
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4j17', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4j18() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = "Percentage of patients with stroke or death within 24 hours of diagnostic cerebral-angiography (Stroke Unit)";
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4j18', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4j19() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = "Percentage of patients diagnosed with ischemic stroke who undergo EVD and then develop ventriculitis (Stroke Unit)";
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4j19', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4j20() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = "Percentage of ischemic stroke patients with post-treatment reperfusion grade of TICI 2B or higher after intra-arterial thrombolytic therapy or mechanical endovascular reperfusion (Stroke Unit)";
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4j20', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4j21() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = "Percentage of ischemic stroke patients with large vessel cerebral occlusion who receive mechanical endovascular reperfusion therapy within 120 minutes and achieve TICI 2B or higher (Stroke Unit)";
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4j21', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function feedbacks_report_CQI4j22() {
        $fdate = date('Y-m-d');
        $tdate = date('Y-m-01');
        $_SESSION['from_date'] = $fdate;
        $_SESSION['to_date'] = $tdate;
    
        if ($this->session->userdata('isLogIn') == false) redirect('login');
    
        if (ismodule_active('QUALITY') === true) {
            $dateInfo = get_from_to_date();
            $pagetitle = $dateInfo['pagetitle'];
            $titleSuffix = "";
    
            if ($pagetitle === "Current Month") {
                $titleSuffix = strtoupper(date('F Y'));
            } elseif ($pagetitle === "Previous Month") {
                $titleSuffix = strtoupper(date('F Y', strtotime('-1 month')));
            } elseif ($pagetitle === "Last 365 Days") {
                $titleSuffix = "LAST 365 DAYS";
            } elseif ($pagetitle === "Last 30 Days") {
                $titleSuffix = "LAST 30 DAYS";
            } elseif ($pagetitle === "Custom") {
                $titleSuffix = date('F Y', strtotime($dateInfo['tdate'])) . " - " . date('F Y', strtotime($dateInfo['fdate']));
            } elseif ($pagetitle === "Last 24 Hours") {
                $titleSuffix = "LAST 24 HOURS";
            } elseif ($pagetitle === "Quaterly") {
                $titleSuffix = "LAST 90 DAYS";
            } else {
                $titleSuffix = $pagetitle;
            }
    
            $data['title'] = "Percentage of ischemic stroke patients with large vessel cerebral occlusion who receive mechanical endovascular reperfusion therapy and achieve TICI 2B or higher â‰¤60 minutes from skin puncture (Stroke Unit)";
            $data['content'] = $this->load->view('qualitymodules/feedbacks_report_CQI4j22', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }




    


    

















































    
























        

        



    



    //individual page for all KPI
    public function patient_feedback_CQI3a1()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {

            $data['title'] = 'QUALITY KPI ANALYSIS';
            #------------------------------#

            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3a1', $data, true);


            $this->load->view('layout/main_wrapper', $data);
            // redirect('report/ip_patient_feedback');

        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function patient_feedback_CQI3a2()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
    
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3a2', $data, true);
            $this->load->view('layout/main_wrapper', $data);
    
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function patient_feedback_CQI3a3()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
    
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3a3', $data, true);
            $this->load->view('layout/main_wrapper', $data);
    
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3a4()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
    
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3a4', $data, true);
            $this->load->view('layout/main_wrapper', $data);
    
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3a5()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
    
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3a5', $data, true);
            $this->load->view('layout/main_wrapper', $data);
    
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3a6()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
    
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3a6', $data, true);
            $this->load->view('layout/main_wrapper', $data);
    
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3a7()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
    
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3a7', $data, true);
            $this->load->view('layout/main_wrapper', $data);
    
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3a8()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
    
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3a8', $data, true);
            $this->load->view('layout/main_wrapper', $data);
    
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3a9()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
    
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3a9', $data, true);
            $this->load->view('layout/main_wrapper', $data);
    
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3a10()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
    
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3a10', $data, true);
            $this->load->view('layout/main_wrapper', $data);
    
        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function patient_feedback_CQI3a11()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
    
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3a11', $data, true);
            $this->load->view('layout/main_wrapper', $data);
    
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3a12()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
    
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3a12', $data, true);
            $this->load->view('layout/main_wrapper', $data);
    
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3a13()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
    
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3a13', $data, true);
            $this->load->view('layout/main_wrapper', $data);
    
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3a14()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
    
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3a14', $data, true);
            $this->load->view('layout/main_wrapper', $data);
    
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3a15()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
    
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3a15', $data, true);
            $this->load->view('layout/main_wrapper', $data);
    
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3a16()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
    
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3a16', $data, true);
            $this->load->view('layout/main_wrapper', $data);
    
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3a17()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
    
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3a17', $data, true);
            $this->load->view('layout/main_wrapper', $data);
    
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3a18()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
    
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3a18', $data, true);
            $this->load->view('layout/main_wrapper', $data);
    
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3a19()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
    
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3a19', $data, true);
            $this->load->view('layout/main_wrapper', $data);
    
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3a20()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
    
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3a20', $data, true);
            $this->load->view('layout/main_wrapper', $data);
    
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3a21()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
    
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3a21', $data, true);
            $this->load->view('layout/main_wrapper', $data);
    
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3a22()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
    
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3a22', $data, true);
            $this->load->view('layout/main_wrapper', $data);
    
        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function patient_feedback_CQI3b1()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
    
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3b1', $data, true);
            $this->load->view('layout/main_wrapper', $data);
    
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3b2()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
    
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3b2', $data, true);
            $this->load->view('layout/main_wrapper', $data);
    
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3b3()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
    
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3b3', $data, true);
            $this->load->view('layout/main_wrapper', $data);
    
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3b4()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
    
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3b4', $data, true);
            $this->load->view('layout/main_wrapper', $data);
    
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3b5()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
    
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3b5', $data, true);
            $this->load->view('layout/main_wrapper', $data);
    
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3b6()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
    
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3b6', $data, true);
            $this->load->view('layout/main_wrapper', $data);
    
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3b7()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
    
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3b7', $data, true);
            $this->load->view('layout/main_wrapper', $data);
    
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3b8()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
    
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3b8', $data, true);
            $this->load->view('layout/main_wrapper', $data);
    
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3b9()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
    
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3b9', $data, true);
            $this->load->view('layout/main_wrapper', $data);
    
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3b10()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
    
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3b10', $data, true);
            $this->load->view('layout/main_wrapper', $data);
    
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3b11()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
    
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3b11', $data, true);
            $this->load->view('layout/main_wrapper', $data);
    
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3b12()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
    
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3b12', $data, true);
            $this->load->view('layout/main_wrapper', $data);
    
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3b13()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
    
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3b13', $data, true);
            $this->load->view('layout/main_wrapper', $data);
    
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3c1()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
    
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3c1', $data, true);
            $this->load->view('layout/main_wrapper', $data);
    
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3c2()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
    
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3c2', $data, true);
            $this->load->view('layout/main_wrapper', $data);
    
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3c3()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
    
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3c3', $data, true);
            $this->load->view('layout/main_wrapper', $data);
    
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3c4()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
    
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3c4', $data, true);
            $this->load->view('layout/main_wrapper', $data);
    
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3c5()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
    
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3c5', $data, true);
            $this->load->view('layout/main_wrapper', $data);
    
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3c6()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
    
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3c6', $data, true);
            $this->load->view('layout/main_wrapper', $data);
    
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3c7()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
    
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3c7', $data, true);
            $this->load->view('layout/main_wrapper', $data);
    
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3c8()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
    
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3c8', $data, true);
            $this->load->view('layout/main_wrapper', $data);
    
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3c9()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
    
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3c9', $data, true);
            $this->load->view('layout/main_wrapper', $data);
    
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3c10()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
    
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3c10', $data, true);
            $this->load->view('layout/main_wrapper', $data);
    
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3c11()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
    
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3c11', $data, true);
            $this->load->view('layout/main_wrapper', $data);
    
        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function patient_feedback_CQI3c12()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
    
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3c12', $data, true);
            $this->load->view('layout/main_wrapper', $data);
    
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3c13()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
    
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3c13', $data, true);
            $this->load->view('layout/main_wrapper', $data);
    
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3c14()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
    
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3c14', $data, true);
            $this->load->view('layout/main_wrapper', $data);
    
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3d1()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
    
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3d1', $data, true);
            $this->load->view('layout/main_wrapper', $data);
    
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3d2()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
    
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3d2', $data, true);
            $this->load->view('layout/main_wrapper', $data);
    
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3d3()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
    
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3d3', $data, true);
            $this->load->view('layout/main_wrapper', $data);
    
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3d4()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
    
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3d4', $data, true);
            $this->load->view('layout/main_wrapper', $data);
    
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3d5()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
    
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3d5', $data, true);
            $this->load->view('layout/main_wrapper', $data);
    
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3e1()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
    
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3e1', $data, true);
            $this->load->view('layout/main_wrapper', $data);
    
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3e2()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
    
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3e2', $data, true);
            $this->load->view('layout/main_wrapper', $data);
    
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3e3()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
    
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3e3', $data, true);
            $this->load->view('layout/main_wrapper', $data);
    
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3e4()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
    
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3e4', $data, true);
            $this->load->view('layout/main_wrapper', $data);
    
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3e5()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
    
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3e5', $data, true);
            $this->load->view('layout/main_wrapper', $data);
    
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3e6()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
    
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3e6', $data, true);
            $this->load->view('layout/main_wrapper', $data);
    
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3e7()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
    
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3e7', $data, true);
            $this->load->view('layout/main_wrapper', $data);
    
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3e8()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
    
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3e8', $data, true);
            $this->load->view('layout/main_wrapper', $data);
    
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3e9()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
    
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3e9', $data, true);
            $this->load->view('layout/main_wrapper', $data);
    
        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function patient_feedback_CQI3f1()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3f1', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3f2()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3f2', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3f3()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3f3', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3f4()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3f4', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3f5()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3f5', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3f6()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3f6', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3f7()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3f7', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3f8()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3f8', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3f9()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3f9', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3f10()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3f10', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3g1()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3g1', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3g2()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3g2', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3g3()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3g3', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3g4()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3g4', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3g5()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3g5', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3g6()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3g6', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3h1()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3h1', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3h2()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3h2', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3h3()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3h3', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3h4()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3h4', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3h5()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3h5', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3h6()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3h6', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3h7()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3h7', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3h8()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3h8', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3h9()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3h9', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function patient_feedback_CQI3j1()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3j1', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3j2()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3j2', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3j3()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3j3', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3j4()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3j4', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3j5()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3j5', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3j6()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3j6', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3j7()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3j7', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3j8()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3j8', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3j9()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3j9', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3j10()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3j10', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3j11()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3j11', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function patient_feedback_CQI3j12()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3j12', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3j13()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3j13', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3j14()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3j14', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3j15()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3j15', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3j16()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3j16', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3j17()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3j17', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3j18()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3j18', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3j19()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3j19', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3j20()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3j20', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3j21()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3j21', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3j22()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3j22', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3j23()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3j23', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3j24()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3j24', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3j25()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3j25', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3j26()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3j26', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3j27()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3j27', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3j28()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3j28', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3j29()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3j29', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3j30()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3j30', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3j31()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3j31', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3j32()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3j32', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3j33()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3j33', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI3j34()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI3j34', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function patient_feedback_CQI4a1()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI4a1', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI4a2()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI4a2', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    public function patient_feedback_CQI4a3()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI4a3', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    
    // CQI4a4 - Percentage of drugs and consumables rejected before preparation of Goods Receipt Note(SCM-Store)
    public function patient_feedback_CQI4a4()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI4a4', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    // CQI4a5 - Percentage of variations from procurement process(SCM-Purchase)
    public function patient_feedback_CQI4a5()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI4a5', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    // CQI4b1 - Incidence of bed sores (hospital associated pressure ulcers) after admission (in 1000 patient days)-(Nursing)
    public function patient_feedback_CQI4b1()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI4b1', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    // CQI4b2 - Incidence of falls (in 1000 IPD days)-(Office-Quality)
    public function patient_feedback_CQI4b2()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI4b2', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    // CQI4b3 - Number of variations observed in mock drill(Safety & Security)
    public function patient_feedback_CQI4b3()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI4b3', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    // CQI4b4 - Percentage of staff provided with pre-exposure prophylaxis(Infection Control)
    public function patient_feedback_CQI4b4()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI4b4', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    // CQI4b5 - Number of Fire Incidents (Safety & Security)
    public function patient_feedback_CQI4b5()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI4b5', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    // CQI4b6 - Incidence of device associated pressure ulcer after admission(Nursing)
    public function patient_feedback_CQI4b6()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI4b6', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    // CQI4b7 - Number of Extravasation (Nursing)
    public function patient_feedback_CQI4b7()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI4b7', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    // CQI4b8 - Monitoring of Clinical Errors (JCI8-PCC 2.3)-(Quality Office)
    public function patient_feedback_CQI4b8()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI4b8', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    // CQI4c1 - Bed occupancy rate (MRD)
    public function patient_feedback_CQI4c1()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI4c1', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    // CQI4c2 - Average length of stay (MRD)
    public function patient_feedback_CQI4c2()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI4c2', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    // CQI4c3 - OT Utilisation Rate (OT)
    public function patient_feedback_CQI4c3()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI4c3', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    // CQI4c4 - ICU equipment utilisation rate (Nursing - ICU1)
    public function patient_feedback_CQI4c4()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI4c4', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    // CQI4c5 - ICU equipment utilisation rate (Nursing - ICU2)
    public function patient_feedback_CQI4c5()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI4c5', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    // CQI4c6 - ICU equipment utilisation rate (Nursing - ICU3)
    public function patient_feedback_CQI4c6()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI4c6', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    // CQI4c7 - ICU Bed utilisation rate (Nursing - ICU)
    public function patient_feedback_CQI4c7()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI4c7', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    // CQI4c8 - Critical equipment downtime (Biomedical Engineering)
    public function patient_feedback_CQI4c8()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI4c8', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    // CQI4c9 - Cath lab utilization rate (Cath Lab - Nursing)
    public function patient_feedback_CQI4c9()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI4c9', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    // CQI4c10 - Nurse patient ratio for ICU Ventilated (Nursing-ICU)
    public function patient_feedback_CQI4c10()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI4c10', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    // CQI4c11 - Nurse patient ratio for ICU Non Ventilated (Nursing-ICU)
    public function patient_feedback_CQI4c11()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI4c11', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    // CQI4c12 - Nurse patient ratio for HDU (Nursing-HDU)
    public function patient_feedback_CQI4c12()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI4c12', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    // CQI4c13 - Nurse patient ratio for Ward (Nursing-Ward)
    public function patient_feedback_CQI4c13()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI4c13', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    // CQI4c14 - Engineering Critical equipment downtime (Engineering & Maintenance)
    public function patient_feedback_CQI4c14()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI4c14', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    // CQI4d1 - Out patient satisfaction index (Patient Care Services - OPD)
    public function patient_feedback_CQI4d1()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI4d1', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    // CQI4d2 - Inpatient satisfaction index (Patient Care Services - IPD)
    public function patient_feedback_CQI4d2()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI4d2', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    // CQI4d3 - Time taken for discharge - Cash Patients (Patient Care Services - Cash)
    public function patient_feedback_CQI4d3()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI4d3', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    // CQI4d4 - Time taken for discharge Cashless Patients (Patient Care Services - Cashless)
    public function patient_feedback_CQI4d4()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI4d4', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    // CQI4d5 - Waiting time for diagnostic services (Radiology - CT)
    public function patient_feedback_CQI4d5()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI4d5', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    // CQI4d6 - Waiting time for diagnostic services (Radiology - MRI)
    public function patient_feedback_CQI4d6()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI4d6', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    // CQI4d7 - Waiting time for diagnostic services (Radiology - USG)
    public function patient_feedback_CQI4d7()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI4d7', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    // CQI4d8 - Waiting Time for OPD appointments (Patient Care Services - OPD)
    public function patient_feedback_CQI4d8()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI4d8', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    // CQI4d9 - Waiting Time for OPD Walkin (Patient Care Services - OPD)
    public function patient_feedback_CQI4d9()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI4d9', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    // CQI4d10 - Patient Satisfaction Rate (Nursing - OBG)
    public function patient_feedback_CQI4d10()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI4d10', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    
    // CQI4d11 - Turn-around Time for Nursing call bell responds (Nursing)
    public function patient_feedback_CQI4d11()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI4d11', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else {
            redirect('dashboard/noaccess');
        }
    }
    // ======================== CQI4e1 â†’ CQI4e8 ========================

// CQI4e1 - Employee satisfaction index (HR)
    public function patient_feedback_CQI4e1()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $data['title'] = 'QUALITY KPI ANALYSIS';
            $data['content'] = $this->load->view('qualitymodules/patient_feedback_CQI4e1', $data, true);
            $this->load->view('layout/main_wrapper', $data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4e2 - Employee attrition rate (HR)
    public function patient_feedback_CQI4e2()
    {
        if ($this->session->userdata('isLogIn') == false) redirect('login');
        if (ismodule_active('QUALITY') === true) {
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4e2',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4e3 - Employee absenteeism rate (HR)
    public function patient_feedback_CQI4e3()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4e3',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4e4 - Percentage of employees aware of rights, responsibility and welfare schemes (HR)
    public function patient_feedback_CQI4e4()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4e4',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4e5 - Average number of training hours (HR)
    public function patient_feedback_CQI4e5()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4e5',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4e6 - Nurses Attrition Rate (Nursing)
    public function patient_feedback_CQI4e6()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4e6',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4e7 - Outsourced employee absenteeism rate (Nursing Assistants - Patient Care Services - OPD)
    public function patient_feedback_CQI4e7()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4e7',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4e8 - Average number of unpaid leave per month (HR)
    public function patient_feedback_CQI4e8()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4e8',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // ======================== CQI4f1 â†’ CQI4f7 ========================
    
    // CQI4f1 - Incidence of needle stick injuries IPD area (in 1000 IPD days) (Infection Control - IPD)
    public function patient_feedback_CQI4f1()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4f1',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4f2 - Incidence of needle stick injuries OPD area (in 1000 OPD days) (Infection Control - OPD)
    public function patient_feedback_CQI4f2()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4f2',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4f3 - Percentage of sentinel events, reported, collected and analysed within the defined time frame (Quality Office)
    public function patient_feedback_CQI4f3()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4f3',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4f4 - Percentage of near misses (Quality Office)
    public function patient_feedback_CQI4f4()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4f4',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4f5 - Incidence of blood body fluid exposure IPD (Infection Control - IPD)
    public function patient_feedback_CQI4f5()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4f5',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4f6 - Incidence of blood body fluid exposure OPD (Infection Control - OPD)
    public function patient_feedback_CQI4f6()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4f6',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4f7 - Adverse events related to SUDs (JCI8-PCI 3.1) (CSSD)
    public function patient_feedback_CQI4f7()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4f7',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // ======================== CQI4g1 â†’ CQI4g6 ========================
    
    // CQI4g1 - Percentage of Medical records not having discharge summary (MRD)
    public function patient_feedback_CQI4g1()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4g1',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4g2 - Percentage of Medical records not having codification as per ICD (MRD)
    public function patient_feedback_CQI4g2()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4g2',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4g3 - Percentage of Medical records having improper or incomplete consent (MRD)
    public function patient_feedback_CQI4g3()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4g3',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4g4 - Percentage of missing medical records (MRD)
    public function patient_feedback_CQI4g4()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4g4',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4g5 - Compliance rate of adhering with policies and procedures for care of patients at risk for suicide and self-harm (JCI8-COP 5) (MRD)
    public function patient_feedback_CQI4g5()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4g5',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4g6 - Monthly Abbreviation Compliance (MRD)
    public function patient_feedback_CQI4g6()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4g6',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    // ======================== CQI3k1 â†’ CQI3k20 ========================

// CQI3k1 - Total number of LAMA cases with Reasons (MRD)
    public function patient_feedback_CQI3k1()
    {
        if ($this->session->userdata('isLogIn') == false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI3k1',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI3k2 - Adverse events due to handover (Quality Office)
    public function patient_feedback_CQI3k2()
    {
        if ($this->session->userdata('isLogIn') == false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI3k2',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI3k3 - Inguinal herniorrhaphy with mesh (Infection Control)
    public function patient_feedback_CQI3k3()
    {
        if ($this->session->userdata('isLogIn') == false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI3k3',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI3k4 - Coronary artery bypass grafting (CABG) (Infection Control)
    public function patient_feedback_CQI3k4()
    {
        if ($this->session->userdata('isLogIn') == false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI3k4',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI3k5 - Laparoscopic cholecystectomy (Infection Control)
    public function patient_feedback_CQI3k5()
    {
        if ($this->session->userdata('isLogIn') == false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI3k5',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI3k6 - Monitoring the duration of antibiotic usage in surgical prophylaxis (After 48 hours) (Clinical Pharmacy)
    public function patient_feedback_CQI3k6()
    {
        if ($this->session->userdata('isLogIn') == false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI3k6',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI3k7 - De-escalation of antibiotics (Clinical Pharmacy)
    public function patient_feedback_CQI3k7()
    {
        if ($this->session->userdata('isLogIn') == false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI3k7',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI3k8 - High Alert Medication Segregation, storage & labelling Compliance rate (Pharmacy - Store)
    public function patient_feedback_CQI3k8()
    {
        if ($this->session->userdata('isLogIn') == false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI3k8',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI3k9 - Average recovery time (OT-Post OP)
    public function patient_feedback_CQI3k9()
    {
        if ($this->session->userdata('isLogIn') == false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI3k9',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI3k10 - Door to thrombolysis time in ischemic stroke in ER (Emergency Department)
    public function patient_feedback_CQI3k10()
    {
        if ($this->session->userdata('isLogIn') == false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI3k10',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI3k11 - Door to image time in Stroke patients (Emergency Department)
    public function patient_feedback_CQI3k11()
    {
        if ($this->session->userdata('isLogIn') == false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI3k11',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI3k12 - Average number of patients visiting Emergency per day (Emergency Department)
    public function patient_feedback_CQI3k12()
    {
        if ($this->session->userdata('isLogIn') == false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI3k12',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI3k13 - Efficiency of code blue team (Emergency Department)
    public function patient_feedback_CQI3k13()
    {
        if ($this->session->userdata('isLogIn') == false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI3k13',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI3k14 - Time for first defibrillation (Emergency Department)
    public function patient_feedback_CQI3k14()
    {
        if ($this->session->userdata('isLogIn') == false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI3k14',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI3k15 - Door to Balloon time in PTCA (Cath Lab)
    public function patient_feedback_CQI3k15()
    {
        if ($this->session->userdata('isLogIn') == false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI3k15',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI3k16 - Compliance to diet order (Clinical Nutrition and Dietetics)
    public function patient_feedback_CQI3k16()
    {
        if ($this->session->userdata('isLogIn') == false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI3k16',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI3k17 - Case Fatality 1 - CAD (MRD)
    public function patient_feedback_CQI3k17()
    {
        if ($this->session->userdata('isLogIn') == false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI3k17',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI3k18 - Case Fatality 2 - Acute coronary syndrome (MRD)
    public function patient_feedback_CQI3k18()
    {
        if ($this->session->userdata('isLogIn') == false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI3k18',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI3k19 - Case Fatality 3 - Cerebral infarction (MRD)
    public function patient_feedback_CQI3k19()
    {
        if ($this->session->userdata('isLogIn') == false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI3k19',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI3k20 - Case Fatality 4 - MI (MRD)
    public function patient_feedback_CQI3k20()
    {
        if ($this->session->userdata('isLogIn') == false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI3k20',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    // ======================== CQI3k21 â†’ CQI3k40 ========================

// CQI3k21 - Case Fatality 5 - Heart failure (MRD)
    public function patient_feedback_CQI3k21()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI3k21',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI3k22 - Compliances in patient transfer and transportation process (External transfer) (Emergency Department)
    public function patient_feedback_CQI3k22()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI3k22',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI3k23 - Number of Adverse Events During Patient Transfers (Out Side) (Emergency Department)
    public function patient_feedback_CQI3k23()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI3k23',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI3k24 - ILC/EQAS compliance rate (Lab Services)
    public function patient_feedback_CQI3k24()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI3k24',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI3k25 - Compliance with Biological Indicator (CSSD)
    public function patient_feedback_CQI3k25()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI3k25',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI3k26 - Compliance to risk assessment in reprocessing of SUMD (CSSD)
    public function patient_feedback_CQI3k26()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI3k26',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI3k27 - Non-compliance to Copy and paste policy (MRD)
    public function patient_feedback_CQI3k27()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI3k27',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI3k28 - Compliance to POCT IQC Checking (Lab Services)
    public function patient_feedback_CQI3k28()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI3k28',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI3k29 - Case Fatality - COVID 19 (MRD)
    public function patient_feedback_CQI3k29()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI3k29',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI3k30 - Case Fatality - Stroke (MRD)
    public function patient_feedback_CQI3k30()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI3k30',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI3k31 - Post procedure complication rate - Colonoscopy (Endoscopy)
    public function patient_feedback_CQI3k31()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI3k31',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI3k32 - Polyp retrieval rate after colonoscopic polypectomy (Endoscopy)
    public function patient_feedback_CQI3k32()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI3k32',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI3k33 - Survival rate for living donor kidney transplants (Nephrology)
    public function patient_feedback_CQI3k33()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI3k33',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI3k34 - CAUTI Prevention Bundle compliance Rate (Infection Control)
    public function patient_feedback_CQI3k34()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI3k34',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI3k35 - Major Discrepancies between Preoperative and Post operative Diagnosis (OT)
    public function patient_feedback_CQI3k35()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI3k35',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI3k36 - Adverse Events Related to patient Identification (Quality Office)
    public function patient_feedback_CQI3k36()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI3k36',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI3k37 - CLABSI Prevention Bundle compliance Rate (Infection Control)
    public function patient_feedback_CQI3k37()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI3k37',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI3k38 - SSI Prevention Bundle compliance Rate (Infection Control)
    public function patient_feedback_CQI3k38()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI3k38',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI3k39 - VAP Prevention Bundle compliance Rate (Infection Control)
    public function patient_feedback_CQI3k39()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI3k39',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI3k40 - Restraint related injuries among admitted patients (Nursing)
    public function patient_feedback_CQI3k40()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI3k40',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    // ======================== CQI3k41 â†’ CQI3k60 ========================

// CQI3k41 - Rate of compliance for restraint consent policy (Nursing)
    public function patient_feedback_CQI3k41()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI3k41',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI3k42 - Percentage of Accidental removal of line (Nursing)
    public function patient_feedback_CQI3k42()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI3k42',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI3k43 - Significant hypotension necessitating termination of dialysis (Nursing)
    public function patient_feedback_CQI3k43()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI3k43',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI3k44 - IPSG4 - Time out compliance in outside OT (Nursing)
    public function patient_feedback_CQI3k44()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI3k44',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI3k45 - Percentage of cases where Initial assessment done in physiotherapy within 24 hours (IPD) (Physical therapy and Rehabilitation Department - Medical records)
    public function patient_feedback_CQI3k45()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI3k45',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI3k46 - Radiology TAT orders for CT (Radiology)
    public function patient_feedback_CQI3k46()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI3k46',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI3k47 - Radiology TAT orders for MRI (Radiology)
    public function patient_feedback_CQI3k47()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI3k47',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI3k48 - Radiology TAT orders for USG (Radiology)
    public function patient_feedback_CQI3k48()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI3k48',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI3k49 - Radiology TAT orders for X-ray (Radiology)
    public function patient_feedback_CQI3k49()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI3k49',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI3k50 - Site Marking Compliance Rate (OT)
    public function patient_feedback_CQI3k50()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI3k50',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI3k51 - Time Out Compliance Rate (OT)
    public function patient_feedback_CQI3k51()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI3k51',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI3k52 - Sign Out Compliance Rate (OT)
    public function patient_feedback_CQI3k52()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI3k52',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI3k53 - Post transplant complication rate for Donor (Liver) (Transplant Unit)
    public function patient_feedback_CQI3k53()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI3k53',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI3k54 - Post transplant complication rate (Heart) (Transplant Unit)
    public function patient_feedback_CQI3k54()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI3k54',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI3k55 - Percentage of research activities approved by ethics committee (Research)
    public function patient_feedback_CQI3k55()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI3k55',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI3k56 - Percentage of patients withdrawing from the study (Research)
    public function patient_feedback_CQI3k56()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI3k56',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI3k57 - Percentage of protocol violations/deviations reported (Research)
    public function patient_feedback_CQI3k57()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI3k57',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI3k58 - Percentage of serious adverse events reported to ethics committee within defined timeframe (Research)
    public function patient_feedback_CQI3k58()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI3k58',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI3k59 - Percentage of cases where Initial assessment done in physiotherapy within 24 hours OPD (Physical therapy and Rehabilitation Department - Medical records)
    public function patient_feedback_CQI3k59()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI3k59',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI3k60 - Survival rate for living donor Liver transplants (Gastrointestinal Surgery)
    public function patient_feedback_CQI3k60()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI3k60',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    // ======================== CQI3k61 â†’ CQI4h25 ========================

// CQI3k61 - Return of spontaneous circulation (ROSC) achieving rate (JCI8-COP 4) (Emergency Department)
    public function patient_feedback_CQI3k61()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI3k61',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI3k62 - Timeliness of initiation of advanced cardiovascular life support (ACLS) within 5 Min (JCI8-COP 4) (Nursing)
    public function patient_feedback_CQI3k62()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI3k62',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI3k63 - Timeliness of staff response to cardiac arrest (JCI8-COP 4) (Emergency Department)
    public function patient_feedback_CQI3k63()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI3k63',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI3k64 - Rate to RRT response turn to Code blue (JCI8-COP 4) (Nursing)
    public function patient_feedback_CQI3k64()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI3k64',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }

    public function patient_feedback_CQI3k65()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI3k65',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }

    public function patient_feedback_CQI3k66()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI3k66',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4h1 - Patient satisfaction index - Physiotherapy (Physical therapy and Rehabilitation Department)
    public function patient_feedback_CQI4h1()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4h1',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4h2 - TAT for radiology STAT orders (Radiology - CT)
    public function patient_feedback_CQI4h2()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4h2',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4h3 - TAT for radiology STAT orders (Radiology - MRI)
    public function patient_feedback_CQI4h3()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4h3',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4h4 - TAT for radiology STAT orders (Radiology - USG)
    public function patient_feedback_CQI4h4()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4h4',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4h5 - HAZMAT compliance in radiology
    public function patient_feedback_CQI4h5()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4h5',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4h6 - TLD Reading Compliance (Radiology)
    public function patient_feedback_CQI4h6()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4h6',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4h7 - Variance in Financial counselling (Patient Care Services - IPD)
    public function patient_feedback_CQI4h7()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4h7',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4h8 - Planned Discharge rate (Patient Care Services - IPD)
    public function patient_feedback_CQI4h8()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4h8',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4h9 - Incident report rate (Quality Office)
    public function patient_feedback_CQI4h9()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4h9',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4h10 - TAT for dispensing medicine - IP (Pharmacy)
    public function patient_feedback_CQI4h10()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4h10',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4h11 - TAT for STAT medicine (Pharmacy)
    public function patient_feedback_CQI4h11()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4h11',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4h12 - Average number of Doctors on hospital rolls at any point of time (HR)
    public function patient_feedback_CQI4h12()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4h12',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4h13 - Average Number of Nurses on hospital rolls at any point of time (HR)
    public function patient_feedback_CQI4h13()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4h13',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4h14 - Reason for staff exit (HR)
    public function patient_feedback_CQI4h14()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4h14',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4h15 - Compliance to Internal complaints committee requirements (HR)
    public function patient_feedback_CQI4h15()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4h15',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    // ======================== CQI4h16 â†’ CQI4h40 ========================

// CQI4h16 - Effectiveness in recruitment (MRF submission days - Staff onboarded time) (HR)
    public function patient_feedback_CQI4h16()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4h16',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4h17 - Compliance to Employee Engagement activities (HR)
    public function patient_feedback_CQI4h17()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4h17',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4h18 - Number of Mandatory training hours coverage / staff (HR)
    public function patient_feedback_CQI4h18()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4h18',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4h19 - Compliance to ACLS training (HR)
    public function patient_feedback_CQI4h19()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4h19',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4h20 - Average units of electricity consumed/Day (Units) (Engineering & Maintenance)
    public function patient_feedback_CQI4h20()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4h20',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4h21 - TAT for complaints on equipment/Utility/Facility (Engineering & Maintenance)
    public function patient_feedback_CQI4h21()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4h21',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4h22 - Average units of water consumed/Day (L) (Engineering & Maintenance)
    public function patient_feedback_CQI4h22()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4h22',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4h23 - Adherence to PPE usage in Engineering and Maintenance department (Engineering & Maintenance)
    public function patient_feedback_CQI4h23()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4h23',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4h24 - Compliance to PM schedule (Engineering & Maintenance)
    public function patient_feedback_CQI4h24()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4h24',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4h25 - Compliance to safe storage of chemicals (Engineering & Maintenance)
    public function patient_feedback_CQI4h25()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4h25',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4h26 - Outsourced Security service Staff Attendance (Safety & Security - Security)
    public function patient_feedback_CQI4h26()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4h26',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4h27 - Compliance to reporting of critical values in Lab (within 30 min) (Lab Service)
    public function patient_feedback_CQI4h27()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4h27',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4h28 - Compliance to reporting of critical values in POCT (Lab Service)
    public function patient_feedback_CQI4h28()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4h28',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4h29 - TAT for Lab tests (Lab Service)
    public function patient_feedback_CQI4h29()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4h29',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4h30 - TAT for Lab STAT (Lab Service)
    public function patient_feedback_CQI4h30()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4h30',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4h31 - Compliance to TAT for lab outsourced test (Lab Service)
    public function patient_feedback_CQI4h31()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4h31',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4h32 - Lab Specimen Rejection Rate (Lab Service)
    public function patient_feedback_CQI4h32()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4h32',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4h33 - Insurance Claims Rejection Rate (Insurance)
    public function patient_feedback_CQI4h33()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4h33',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4h34 - TPA TAT (Insurance) for the month
    public function patient_feedback_CQI4h34()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4h34',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4h35 - Medical Waste Collection Rate (House Keeping)
    public function patient_feedback_CQI4h35()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4h35',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4h36 - Compliance to MSDS in Facility (House Keeping)
    public function patient_feedback_CQI4h36()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4h36',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4h37 - Percentage of Pest control Complaints rate (House Keeping)
    public function patient_feedback_CQI4h37()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4h37',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4h38 - Linen Quality - Compliance Rate (House Keeping)
    public function patient_feedback_CQI4h38()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4h38',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4h39 - Downtime of EMR (ITD)
    public function patient_feedback_CQI4h39()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4h39',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4h40 - Outsourced staff manpower compliance rate (House Keeping)
    public function patient_feedback_CQI4h40()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4h40',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    // ======================== CQI4h41 â†’ CQI4h56 ========================

// CQI4h41 - ITD Preventive Maintenance compliance (ITD)
    public function patient_feedback_CQI4h41()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4h41',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4h42 - Biomedical Preventive Maintenance Completion rate (Biomedical Engineering)
    public function patient_feedback_CQI4h42()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4h42',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4h43 - Quality of patient transportation by ambulance (Out-sourced) (Lab Service)
    public function patient_feedback_CQI4h43()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4h43',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4h44 - F&B Patient complaints rate (Food and Beverage Services)
    public function patient_feedback_CQI4h44()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4h44',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4h45 - Delay in room services (Food and Beverage Services)
    public function patient_feedback_CQI4h45()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4h45',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4h46 - Compliance to PCRA (Engineering & Maintenance)
    public function patient_feedback_CQI4h46()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4h46',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4h47 - Compliances in patient room cleaning and hygiene practices (House Keeping)
    public function patient_feedback_CQI4h47()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4h47',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4h48 - Patient's Complaints Rate (House Keeping)
    public function patient_feedback_CQI4h48()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4h48',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4h49 - Percentage of renewable energy used against total energy used (JCI8-GHI 3) (Engineering & Maintenance)
    public function patient_feedback_CQI4h49()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4h49',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4h50 - To Monitor the energy consumption (JCI8-GHI 3) (Engineering & Maintenance)
    public function patient_feedback_CQI4h50()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4h50',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4h51 - Percentage of Wrong food Delivery for Patients & Bystanders (Food and Beverage Services)
    public function patient_feedback_CQI4h51()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4h51',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4h52 - Percentage of adherence to facility audit observation closure (Safety & Security)
    public function patient_feedback_CQI4h52()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4h52',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4h53 - Standardised Mortality Ratio for ICU - 1 (Nursing - ICU 1)
    public function patient_feedback_CQI4h53()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4h53',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4h54 - Standardised Mortality Ratio for ICU - 2 (Actual deaths in ICU-2)
    public function patient_feedback_CQI4h54()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4h54',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4h55 - Standardised Mortality Ratio for PICU (Actual deaths in PICU)
    public function patient_feedback_CQI4h55()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4h55',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4h56 - Standardised Mortality Ratio for NICU (Actual deaths in NICU)
    public function patient_feedback_CQI4h56()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4h56',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    // ======================== CLOTCM1 â†’ CLOTCM20 ========================

// CLOTCM1 - Average length of stay (MRD - Cardiology)
    public function patient_feedback_CLOTCM1()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CLOTCM1',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CLOTCM2 - Average length of stay (MRD - CVTS)
    public function patient_feedback_CLOTCM2()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CLOTCM2',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CLOTCM3 - Average length of stay (MRD - Gastro surgery)
    public function patient_feedback_CLOTCM3()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CLOTCM3',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CLOTCM4 - Average length of stay (MRD - Gastroenterology)
    public function patient_feedback_CLOTCM4()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CLOTCM4',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CLOTCM5 - Average length of stay (MRD - General Medicine)
    public function patient_feedback_CLOTCM5()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CLOTCM5',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CLOTCM6 - Average length of stay (MRD - ICU)
    public function patient_feedback_CLOTCM6()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CLOTCM6',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CLOTCM7 - Average length of stay (MRD - Nephrology)
    public function patient_feedback_CLOTCM7()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CLOTCM7',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CLOTCM8 - Average length of stay (MRD - Neuro Intervention)
    public function patient_feedback_CLOTCM8()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CLOTCM8',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CLOTCM9 - Average length of stay (MRD - Neurology)
    public function patient_feedback_CLOTCM9()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CLOTCM9',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CLOTCM10 - Average length of stay (MRD - Neurosurgery)
    public function patient_feedback_CLOTCM10()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CLOTCM10',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CLOTCM11 - Average length of stay (MRD - Ortho neuro integrated spine)
    public function patient_feedback_CLOTCM11()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CLOTCM11',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CLOTCM12 - Average length of stay (MRD - Ortho THR)
    public function patient_feedback_CLOTCM12()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CLOTCM12',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CLOTCM13 - Average length of stay (MRD - Ortho TKR)
    public function patient_feedback_CLOTCM13()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CLOTCM13',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CLOTCM14 - Average length of stay (MRD - Orthopaedics)
    public function patient_feedback_CLOTCM14()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CLOTCM14',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CLOTCM15 - Average length of stay (MRD - Pulmonology)
    public function patient_feedback_CLOTCM15()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CLOTCM15',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CLOTCM16 - Average length of stay (MRD - Urology)
    public function patient_feedback_CLOTCM16()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CLOTCM16',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CLOTCM17 - Catheter associated urinary tract infection rate (Infection Control - ICU1)
    public function patient_feedback_CLOTCM17()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CLOTCM17',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CLOTCM18 - Catheter associated urinary tract infection rate (Infection Control - ICU2)
    public function patient_feedback_CLOTCM18()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CLOTCM18',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CLOTCM19 - Catheter associated urinary tract infection rate (Infection Control - ICU3)
    public function patient_feedback_CLOTCM19()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CLOTCM19',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CLOTCM20 - Central Line Associated Blood Stream Infection (CLABSI) - (Infection Control - ICU1)
    public function patient_feedback_CLOTCM20()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CLOTCM20',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    // ======================== CLOTCM21 â†’ CLOTCM30 ========================

// CLOTCM21 - Central Line Associated Blood Stream Infection (CLABSI) (Infection Control - ICU2)
    public function patient_feedback_CLOTCM21()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CLOTCM21',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CLOTCM22 - Central Line Associated Blood Stream Infection (CLABSI) (Infection Control - ICU3)
    public function patient_feedback_CLOTCM22()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CLOTCM22',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CLOTCM23 - Surgical Site Infection rate (Infection Control - Ortho THR)
    public function patient_feedback_CLOTCM23()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CLOTCM23',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CLOTCM24 - Surgical Site Infection rate (Infection Control - Ortho TKR)
    public function patient_feedback_CLOTCM24()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CLOTCM24',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CLOTCM25 - Ventilator associated pneumonias (VAP) in 1000 ventilator days (Infection Control - ICU1)
    public function patient_feedback_CLOTCM25()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CLOTCM25',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CLOTCM26 - Ventilator associated pneumonias (VAP) in 1000 ventilator days (Infection Control - ICU2)
    public function patient_feedback_CLOTCM26()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CLOTCM26',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CLOTCM27 - Ventilator associated pneumonias (VAP) in 1000 ventilator days (Infection Control - ICU3)
    public function patient_feedback_CLOTCM27()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CLOTCM27',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CLOTCM28 - Ventilator associated pneumonias (VAP) in 1000 ventilator days (Infection Control - Ortho THR)
    public function patient_feedback_CLOTCM28()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CLOTCM28',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CLOTCM29 - Ventilator associated pneumonias (VAP) in 1000 ventilator days (Infection Control - Ortho TKR)
    public function patient_feedback_CLOTCM29()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CLOTCM29',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CLOTCM30 - Prevalence of transfusion reactions in Leuco depleted PRBC transfusions (Blood Center)
    public function patient_feedback_CLOTCM30()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CLOTCM30',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    // ======================== CQI4i1 â†’ CQI4i14 ========================

// CQI4i1 - Compliance to medical service requests - Heart, Lung transplantation (Medical Administration)
    public function patient_feedback_CQI4i1()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4i1',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4i2 - Compliance to medical service requests - Heart, Lung transplantation (Liver transplantation)
    public function patient_feedback_CQI4i2()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4i2',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4i3 - TAT compliance for radiology outsourced test (Radiology)
    public function patient_feedback_CQI4i3()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4i3',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4i4 - Food waste collection rate (House Keeping)
    public function patient_feedback_CQI4i4()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4i4',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4i5 - Solid waste collection rate (House Keeping)
    public function patient_feedback_CQI4i5()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4i5',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4i6 - Outsourced GDA (General Duty Assistance) absenteeism rate (House Keeping)
    public function patient_feedback_CQI4i6()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4i6',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4i7 - Outsourced OPD Assistance attendance (Operation)
    public function patient_feedback_CQI4i7()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4i7',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4i8 - Outsourced UTIZ staff attendance (House Keeping)
    public function patient_feedback_CQI4i8()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4i8',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4i9 - Compliance to safe transportation of Oil waste (Engineering & Maintenance)
    public function patient_feedback_CQI4i9()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4i9',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4i10 - Number of laundry loads reduced by optimizing and sorting laundry (GHI 3ME4) (JCI8-GHI 3) - (House Keeping)
    public function patient_feedback_CQI4i10()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4i10',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4i11 - Percentage of cleaning products used biodegradable (GHI 3ME4) (JCI8-GHI 3) - (House Keeping)
    public function patient_feedback_CQI4i11()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4i11',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4i12 - Average use of Ecofriendly catering supplies in a month (carbon intensity reduction - JCI8-GHI 3) - (House Keeping)
    public function patient_feedback_CQI4i12()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4i12',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4i13 - Average quantity of Medical waste disposed per month in Kgs (Clinical practices to reduce the environmental impact - JCI8-GHI 3) - (House Keeping)
    public function patient_feedback_CQI4i13()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4i13',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4i14 - Non-Recyclable Waste per Patient Day (Kg) - (JCI8-GHI 3) - (House Keeping)
    public function patient_feedback_CQI4i14()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4i14',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    // ======================== CQI4j1 â†’ CQI4j22 ========================

// CQI4j1 - Door to Physician â‰¤10 min (Stroke Unit)
    public function patient_feedback_CQI4j1()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4j1',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4j2 - Door to stroke team â‰¤15 min (Stroke Unit)
    public function patient_feedback_CQI4j2()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4j2',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4j3 - Door to CT/MRI initiation â‰¤20 min (Stroke Unit)
    public function patient_feedback_CQI4j3()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4j3',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4j4 - Door to CT/MRI interpretation â‰¤30 min (Stroke Unit)
    public function patient_feedback_CQI4j4()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4j4',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4j5 - Order to lab results â‰¤30 min, if ordered (Stroke Unit)
    public function patient_feedback_CQI4j5()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4j5',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4j6 - Door to IV thrombolytic bolus (â‰¥75% compliance) â‰¤60 min (Stroke Unit)
    public function patient_feedback_CQI4j6()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4j6',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4j7 - Door to IV thrombolytic bolus (â‰¥50% compliance) â‰¤45 min (Stroke Unit)
    public function patient_feedback_CQI4j7()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4j7',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4j8 - Door to puncture time â‰¤90 min (Stroke Unit)
    public function patient_feedback_CQI4j8()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4j8',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4j9 - Periprocedural complication rates (Stroke Unit)
    public function patient_feedback_CQI4j9()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4j9',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4j10 - Periprocedural mortality rate for surgical/interventional procedures (Stroke Unit)
    public function patient_feedback_CQI4j10()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4j10',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4j11 - Percentage of all stroke/TIA patients with NIHSS score documented (Stroke Unit)
    public function patient_feedback_CQI4j11()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4j11',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4j12 - Percentage of ischemic stroke patients receiving thrombolysis within time window (Stroke Unit)
    public function patient_feedback_CQI4j12()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4j12',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4j13 - Percentage of patients treated for acute ischemic stroke with IV thrombolysis within 60 min (Stroke Unit)
    public function patient_feedback_CQI4j13()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4j13',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4j14 - Time from arrival to start of initial imaging workup (Stroke Unit)
    public function patient_feedback_CQI4j14()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4j14',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4j15 - Percentage of ischemic stroke patients developing symptomatic intracranial hemorrhage within 36h (Stroke Unit)
    public function patient_feedback_CQI4j15()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4j15',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4j16 - Percentage of patients undergoing CEA or carotid interventions with stroke/death within 30 days (Stroke Unit)
    public function patient_feedback_CQI4j16()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4j16',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4j17 - Percentage of patients undergoing intracranial angioplasty/stenting with stroke/death within 30 days (Stroke Unit)
    public function patient_feedback_CQI4j17()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4j17',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4j18 - Percentage of patients with stroke/death within 24h of diagnostic cerebral-angiography (Stroke Unit)
    public function patient_feedback_CQI4j18()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4j18',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4j19 - Percentage of ischemic stroke patients undergoing EVD developing ventriculitis (Stroke Unit)
    public function patient_feedback_CQI4j19()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4j19',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4j20 - Percentage ischemic stroke patients with post-treatment reperfusion grade TICI 2B or higher (Stroke Unit)
    public function patient_feedback_CQI4j20()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4j20',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4j21 - Percentage ischemic stroke patients with large vessel occlusion receiving MER within 120 min and achieving TICI 2B+ (Stroke Unit)
    public function patient_feedback_CQI4j21()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4j21',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }
    
    // CQI4j22 - Percentage ischemic stroke patients with large vessel occlusion achieving TICI 2B+ â‰¤60 min from skin puncture (Stroke Unit)
    public function patient_feedback_CQI4j22()
    {
        if ($this->session->userdata('isLogIn')==false) redirect('login');
        if (ismodule_active('QUALITY')===true){
            $data['title']='QUALITY KPI ANALYSIS';
            $data['content']=$this->load->view('qualitymodules/patient_feedback_CQI4j22',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } else { redirect('dashboard/noaccess'); }
    }












    




















    //Edit page for all KPI

    public function edit_feedback_CQI3a1()
    {

        if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
            $this->session->set_userdata('referred_from', current_url());
        } else {
            $this->session->set_userdata('referred_from', NULL);
        }


        $LOAD = pagetoload($this->module);
        if ($LOAD == 'inpatient_modules') {
            $data['title'] = 'EDIT KPI FORM';

            if (isfeature_active('QUALITY-DASHBOARD') === true) {
                $data['content'] = $this->load->view('qualitymodules/edit_feedback_CQI3a1', $data, true);
            } else {
                $data['content'] = $this->load->view('qualitymodules/dephead/edit_feedback_CQI3a1', $data, true);
            }
            //    $data['content'] = $this->load->view('qualitymodules/ticket_track', $data, true);

            $this->load->view('layout/main_wrapper', $data);
        }
    }


    public function edit_feedback_CQI3a1_byid($id)
{
    // Check if form is submitted
    if ($this->input->post()) {

        // 1ï¸âƒ£ Handle time formatting
        $hr = intval($this->input->post('initial_assessment_hr')) ?: 0;
        $min = intval($this->input->post('initial_assessment_min')) ?: 0;
        $sec = intval($this->input->post('initial_assessment_sec')) ?: 0;
        $timeString = sprintf('%02d:%02d:%02d', $hr, $min, $sec);

        // 2ï¸âƒ£ Format datetime
        $dataCollected = $this->input->post('dataCollected');
        $formattedDatetime = date('Y-m-d H:i:s', strtotime($dataCollected));
        $formattedDatet = date('Y-m-d', strtotime($dataCollected));

        // 3ï¸âƒ£ Fetch existing dataset and files
        
        $existing = $this->quality_model->get_feedback_CQI3a1_byid($id);
        $dataset = json_decode($existing->dataset ?? '{}', true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        // 4ï¸âƒ£ Remove files if requested
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        if (!empty($removeIndexes)) {
            foreach ($removeIndexes as $index) {
                if (isset($existingFiles[$index])) {
                    $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                    $absolutePath = FCPATH . $oldFilePath;
                    if (file_exists($absolutePath)) @unlink($absolutePath);
                    unset($existingFiles[$index]);
                }
            }
            $existingFiles = array_values($existingFiles);
        }

        // 5ï¸âƒ£ Upload new files
        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $filesCount = count($_FILES['uploaded_files']['name']);
            $config = [
                'upload_path'  => './api/file_uploads/',
                'allowed_types'=> 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                'max_size'     => 50000,
                'encrypt_name' => FALSE
            ];
            $this->load->library('upload');
            for ($i = 0; $i < $filesCount; $i++) {
                $_FILES['file'] = [
                    'name'     => $_FILES['uploaded_files']['name'][$i],
                    'type'     => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error'    => $_FILES['uploaded_files']['error'][$i],
                    'size'     => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $uploadData = $this->upload->data();
                    $existingFiles[] = [
                        'url'  => base_url('api/file_uploads/' . $uploadData['file_name']),
                        'name' => $uploadData['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = array_values($existingFiles);

        // 6ï¸âƒ£ Update other form fields into dataset
        foreach ($_POST as $key => $value) {
            if (!in_array($key, ['uploaded_files','remove_files_json'])) {
                $dataset[$key] = $value;
            }
        }

        // 7ï¸âƒ£ Prepare final data for DB update
        $data = [
            'time_taken_initial_assessment' => $timeString,
            'number_of_admission'           => $this->input->post('total_admission'),
            'average_time_taken_initial_assessment' => $this->input->post('calculatedResult'),
            'bench_mark_time'               => $this->input->post('benchmark'),
            'data_analysis'                 => $this->input->post('dataAnalysis'),
            'corrective_action'             => $this->input->post('correctiveAction'),
            'preventive_action'             => $this->input->post('preventiveAction'),
            'datetime'                      => $formattedDatetime,
            'datet'                          => $formattedDatet,
            'dataset'                        => json_encode($dataset)
        ];

        // 8ï¸âƒ£ Update database
        $this->quality_model->update_feedback_CQI3a1($id, $data);

        // 9ï¸âƒ£ Redirect after update
        redirect('quality/patient_feedback_CQI3a1?id=' . $id);
    } else {
        // Load the view with the form and existing record
        $data['param'] = $this->quality_model->get_feedback_CQI3a1_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3a1', $data);
    }
}

    public function edit_feedback_CQI3a4()
{
    if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
        $this->session->set_userdata('referred_from', current_url());
    } else {
        $this->session->set_userdata('referred_from', NULL);
    }

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';

        if (isfeature_active('QUALITY-DASHBOARD') === true) {
            $data['content'] = $this->load->view('qualitymodules/edit_feedback_CQI3a4', $data, true);
        } else {
            $data['content'] = $this->load->view('qualitymodules/dephead/edit_feedback_CQI3a4', $data, true);
        }

        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3a2()
{
    if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
        $this->session->set_userdata('referred_from', current_url());
    } else {
        $this->session->set_userdata('referred_from', NULL);
    }

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';

        if (isfeature_active('QUALITY-DASHBOARD') === true) {
            $data['content'] = $this->load->view('qualitymodules/edit_feedback_CQI3a2', $data, true);
        } else {
            $data['content'] = $this->load->view('qualitymodules/dephead/edit_feedback_CQI3a2', $data, true);
        }

        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3a2_byid($id)
{
    if ($this->input->post()) {

        // Get existing record
        $existing = $this->quality_model->get_feedback_CQI3a2_byid($id);

        $dataset = json_decode($existing->dataset, true);
        if (!is_array($dataset)) {
            $dataset = [];
        }

        $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];

        // Handle file removal
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        if (!empty($removeIndexes)) {
            foreach ($removeIndexes as $index) {
                if (isset($existingFiles[$index])) {
                    $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                    $absolutePath = FCPATH . $oldFilePath;
                    if (file_exists($absolutePath)) @unlink($absolutePath);
                    unset($existingFiles[$index]);
                }
            }
            $existingFiles = array_values($existingFiles);
        }

        // Handle file uploads
        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $filesCount = count($_FILES['uploaded_files']['name']);
            $config = [
                'upload_path'   => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                'max_size'      => 50000,
                'encrypt_name'  => FALSE
            ];
            $this->load->library('upload');
            for ($i = 0; $i < $filesCount; $i++) {
                $_FILES['file'] = [
                    'name'     => $_FILES['uploaded_files']['name'][$i],
                    'type'     => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error'    => $_FILES['uploaded_files']['error'][$i],
                    'size'     => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $uploadData = $this->upload->data();
                    $existingFiles[] = [
                        'url'  => base_url('api/file_uploads/' . $uploadData['file_name']),
                        'name' => $uploadData['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = array_values($existingFiles);

        // Add/Update form fields to dataset
        foreach ($_POST as $key => $value) {
            if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                $dataset[$key] = $value;
            }
        }

        // Compute KPI (average time or percentage)
        $numerator = intval($this->input->post('initial_assessment_hr')) ?: 0;
        $denominator = intval($this->input->post('total_admission')) ?: 0;
        $percentage = ($denominator > 0) ? ($numerator / $denominator) * 100 : 0;

        $data = [
            'dataset' => json_encode($dataset),
        ];

        log_message('debug', 'POST data: ' . json_encode($_POST));
        log_message('debug', 'Updating ID: ' . $id);
        log_message('debug', 'Data being saved: ' . json_encode($data));

        $this->quality_model->update_feedback_CQI3a2($id, $data);

        if ($this->db->affected_rows() > 0) {
            log_message('debug', 'CQI3a2 record updated successfully for ID: ' . $id);
        } else {
            log_message('error', 'CQI3a2 update failed or no changes detected for ID: ' . $id);
        }

        redirect('quality/patient_feedback_CQI3a2?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3a2_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3a2', $data);
    }
}
public function edit_feedback_CQI3a3()
{
    if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
        $this->session->set_userdata('referred_from', current_url());
    } else {
        $this->session->set_userdata('referred_from', NULL);
    }

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';

        if (isfeature_active('QUALITY-DASHBOARD') === true) {
            $data['content'] = $this->load->view('qualitymodules/edit_feedback_CQI3a3', $data, true);
        } else {
            $data['content'] = $this->load->view('qualitymodules/dephead/edit_feedback_CQI3a3', $data, true);
        }

        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3a3_byid($id)
{
    if ($this->input->post()) {

        $existing = $this->quality_model->get_feedback_CQI3a3_byid($id);
        $dataset = json_decode($existing->dataset, true);
        if (!is_array($dataset)) $dataset = [];

        $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];

        // Remove old files
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        if (!empty($removeIndexes)) {
            foreach ($removeIndexes as $index) {
                if (isset($existingFiles[$index])) {
                    $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                    $absolutePath = FCPATH . $oldFilePath;
                    if (file_exists($absolutePath)) @unlink($absolutePath);
                    unset($existingFiles[$index]);
                }
            }
            $existingFiles = array_values($existingFiles);
        }

        // Upload new files
        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $filesCount = count($_FILES['uploaded_files']['name']);
            $config = [
                'upload_path'   => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                'max_size'      => 50000,
                'encrypt_name'  => FALSE
            ];
            $this->load->library('upload');
            for ($i = 0; $i < $filesCount; $i++) {
                $_FILES['file'] = [
                    'name'     => $_FILES['uploaded_files']['name'][$i],
                    'type'     => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error'    => $_FILES['uploaded_files']['error'][$i],
                    'size'     => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $uploadData = $this->upload->data();
                    $existingFiles[] = [
                        'url'  => base_url('api/file_uploads/' . $uploadData['file_name']),
                        'name' => $uploadData['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = array_values($existingFiles);

        // Update dataset fields
        foreach ($_POST as $key => $value) {
            if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                $dataset[$key] = $value;
            }
        }

        // KPI computation (example)
        $numerator = intval($this->input->post('initial_assessment_hr')) ?: 0;
        $denominator = intval($this->input->post('total_emergency_patients')) ?: 0;
        $percentage = ($denominator > 0) ? ($numerator / $denominator) * 100 : 0;

        $data = [
            'dataset' => json_encode($dataset),
        ];

        log_message('debug', 'Updating CQI3a3 ID: ' . $id);
        $this->quality_model->update_feedback_CQI3a3($id, $data);

        redirect('quality/patient_feedback_CQI3a3?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3a3_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3a3', $data);
    }
}




public function edit_feedback_CQI3a4_byid($id)
{
    if ($this->input->post()) {

        
        $existing = $this->quality_model->get_feedback_CQI3a4_byid($id);

        $dataset = json_decode($existing->dataset, true);
        if (!is_array($dataset)) {
            $dataset = [];
        }

        $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];


        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        if (!empty($removeIndexes)) {
            foreach ($removeIndexes as $index) {
                if (isset($existingFiles[$index])) {
                    $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                    $absolutePath = FCPATH . $oldFilePath;
                    if (file_exists($absolutePath)) @unlink($absolutePath);
                    unset($existingFiles[$index]);
                }
            }
            $existingFiles = array_values($existingFiles);
        }

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $filesCount = count($_FILES['uploaded_files']['name']);
            $config = [
                'upload_path'   => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                'max_size'      => 50000,
                'encrypt_name'  => FALSE
            ];
            $this->load->library('upload');
            for ($i = 0; $i < $filesCount; $i++) {
                $_FILES['file'] = [
                    'name'     => $_FILES['uploaded_files']['name'][$i],
                    'type'     => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error'    => $_FILES['uploaded_files']['error'][$i],
                    'size'     => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $uploadData = $this->upload->data();
                    $existingFiles[] = [
                        'url'  => base_url('api/file_uploads/' . $uploadData['file_name']),
                        'name' => $uploadData['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = array_values($existingFiles);

        foreach ($_POST as $key => $value) {
            if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                $dataset[$key] = $value;
            }
        }

        $numerator = intval($this->input->post('initial_assessment_hr')) ?: 0;
        $denominator = intval($this->input->post('total_admission')) ?: 0;
        $percentage = ($denominator > 0) ? ($numerator / $denominator) * 100 : 0;

        $data = [
            'dataset' => json_encode($dataset),
        ];

        log_message('debug', 'POST data: ' . json_encode($_POST));
        log_message('debug', 'Updating ID: ' . $id);
        log_message('debug', 'Data being saved: ' . json_encode($data));

        $this->quality_model->update_feedback_CQI3a4($id, $data);

        if ($this->db->affected_rows() > 0) {
            log_message('debug', 'CQI3a4 record updated successfully for ID: ' . $id);
        } else {
            log_message('error', 'CQI3a4 update failed or no changes detected for ID: ' . $id);
        }

        redirect('quality/patient_feedback_CQI3a4?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3a4_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3a4', $data);
    }
}
public function edit_feedback_CQI3a5()
{
    if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
        $this->session->set_userdata('referred_from', current_url());
    } else {
        $this->session->set_userdata('referred_from', NULL);
    }

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';

        if (isfeature_active('QUALITY-DASHBOARD') === true) {
            $data['content'] = $this->load->view('qualitymodules/edit_feedback_CQI3a5', $data, true);
        } else {
            $data['content'] = $this->load->view('qualitymodules/dephead/edit_feedback_CQI3a5', $data, true);
        }

        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3a5_byid($id)
{
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3a5_byid($id);
        $dataset = json_decode($existing->dataset, true);
        if (!is_array($dataset)) $dataset = [];

        $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        if (!empty($removeIndexes)) {
            foreach ($removeIndexes as $index) {
                if (isset($existingFiles[$index])) {
                    $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                    $absolutePath = FCPATH . $oldFilePath;
                    if (file_exists($absolutePath)) @unlink($absolutePath);
                    unset($existingFiles[$index]);
                }
            }
            $existingFiles = array_values($existingFiles);
        }

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $filesCount = count($_FILES['uploaded_files']['name']);
            $config = [
                'upload_path'   => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                'max_size'      => 50000,
                'encrypt_name'  => FALSE
            ];
            $this->load->library('upload');
            for ($i = 0; $i < $filesCount; $i++) {
                $_FILES['file'] = [
                    'name'     => $_FILES['uploaded_files']['name'][$i],
                    'type'     => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error'    => $_FILES['uploaded_files']['error'][$i],
                    'size'     => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $uploadData = $this->upload->data();
                    $existingFiles[] = [
                        'url'  => base_url('api/file_uploads/' . $uploadData['file_name']),
                        'name' => $uploadData['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = array_values($existingFiles);

        foreach ($_POST as $key => $value) {
            if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                $dataset[$key] = $value;
            }
        }

        // KPI Calculation
        $numerator = intval($this->input->post('nutritional_assessment_done')) ?: 0;
        $denominator = intval($this->input->post('total_inpatients')) ?: 0;
        $percentage = ($denominator > 0) ? ($numerator / $denominator) * 100 : 0;
        $dataset['percentage'] = round($percentage, 2);

        $data = ['dataset' => json_encode($dataset)];

        $this->quality_model->update_feedback_CQI3a5($id, $data);
        redirect('quality/patient_feedback_CQI3a5?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3a5_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3a5', $data);
    }
}
public function edit_feedback_CQI3a6()
{
    if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
        $this->session->set_userdata('referred_from', current_url());
    } else {
        $this->session->set_userdata('referred_from', NULL);
    }

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';

        if (isfeature_active('QUALITY-DASHBOARD') === true) {
            $data['content'] = $this->load->view('qualitymodules/edit_feedback_CQI3a6', $data, true);
        } else {
            $data['content'] = $this->load->view('qualitymodules/dephead/edit_feedback_CQI3a6', $data, true);
        }

        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3a6_byid($id)
{
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3a6_byid($id);
        $dataset = json_decode($existing->dataset, true);
        if (!is_array($dataset)) $dataset = [];

        $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);

        if (!empty($removeIndexes)) {
            foreach ($removeIndexes as $index) {
                if (isset($existingFiles[$index])) {
                    $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                    $absolutePath = FCPATH . $oldFilePath;
                    if (file_exists($absolutePath)) @unlink($absolutePath);
                    unset($existingFiles[$index]);
                }
            }
            $existingFiles = array_values($existingFiles);
        }

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $filesCount = count($_FILES['uploaded_files']['name']);
            $config = [
                'upload_path'   => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                'max_size'      => 50000,
                'encrypt_name'  => FALSE
            ];
            $this->load->library('upload');
            for ($i = 0; $i < $filesCount; $i++) {
                $_FILES['file'] = [
                    'name'     => $_FILES['uploaded_files']['name'][$i],
                    'type'     => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error'    => $_FILES['uploaded_files']['error'][$i],
                    'size'     => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $uploadData = $this->upload->data();
                    $existingFiles[] = [
                        'url'  => base_url('api/file_uploads/' . $uploadData['file_name']),
                        'name' => $uploadData['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = array_values($existingFiles);

        foreach ($_POST as $key => $value) {
            if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                $dataset[$key] = $value;
            }
        }

        // KPI Calculation
        $numerator = intval($this->input->post('nursing_care_documented')) ?: 0;
        $denominator = intval($this->input->post('total_inpatients')) ?: 0;
        $percentage = ($denominator > 0) ? ($numerator / $denominator) * 100 : 0;
        $dataset['percentage'] = round($percentage, 2);

        $data = ['dataset' => json_encode($dataset)];
        $this->quality_model->update_feedback_CQI3a6($id, $data);
        redirect('quality/patient_feedback_CQI3a6?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3a6_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3a6', $data);
    }
}
public function edit_feedback_CQI3a7()
{
    if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
        $this->session->set_userdata('referred_from', current_url());
    } else {
        $this->session->set_userdata('referred_from', NULL);
    }

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';

        if (isfeature_active('QUALITY-DASHBOARD') === true) {
            $data['content'] = $this->load->view('qualitymodules/edit_feedback_CQI3a7', $data, true);
        } else {
            $data['content'] = $this->load->view('qualitymodules/dephead/edit_feedback_CQI3a7', $data, true);
        }

        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3a7_byid($id)
{
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3a7_byid($id);
        $dataset = json_decode($existing->dataset, true);
        if (!is_array($dataset)) $dataset = [];

        $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);

        if (!empty($removeIndexes)) {
            foreach ($removeIndexes as $index) {
                if (isset($existingFiles[$index])) {
                    $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                    $absolutePath = FCPATH . $oldFilePath;
                    if (file_exists($absolutePath)) @unlink($absolutePath);
                    unset($existingFiles[$index]);
                }
            }
            $existingFiles = array_values($existingFiles);
        }

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $filesCount = count($_FILES['uploaded_files']['name']);
            $config = [
                'upload_path'   => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                'max_size'      => 50000,
                'encrypt_name'  => FALSE
            ];
            $this->load->library('upload');
            for ($i = 0; $i < $filesCount; $i++) {
                $_FILES['file'] = [
                    'name'     => $_FILES['uploaded_files']['name'][$i],
                    'type'     => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error'    => $_FILES['uploaded_files']['error'][$i],
                    'size'     => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $uploadData = $this->upload->data();
                    $existingFiles[] = [
                        'url'  => base_url('api/file_uploads/' . $uploadData['file_name']),
                        'name' => $uploadData['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = array_values($existingFiles);
        foreach ($_POST as $key => $value) {
            if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                $dataset[$key] = $value;
            }
        }

        // KPI Calculation - Average time (minutes)
        $total_time = floatval($this->input->post('total_time_assessment')) ?: 0;
        $total_patients = intval($this->input->post('total_patients_assessed')) ?: 0;
        $avg_time = ($total_patients > 0) ? ($total_time / $total_patients) : 0;
        $dataset['average_time'] = round($avg_time, 2);

        $data = ['dataset' => json_encode($dataset)];
        $this->quality_model->update_feedback_CQI3a7($id, $data);
        redirect('quality/patient_feedback_CQI3a7?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3a7_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3a7', $data);
    }
}
// =============================
// ðŸ§© CQI3a8 â€“ Avg. Time for Initial Assessment of Inpatients (Nursing-ICU)
// =============================
public function edit_feedback_CQI3a8()
{
    if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
        $this->session->set_userdata('referred_from', current_url());
    } else {
        $this->session->set_userdata('referred_from', NULL);
    }

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';

        if (isfeature_active('QUALITY-DASHBOARD') === true) {
            $data['content'] = $this->load->view('qualitymodules/edit_feedback_CQI3a8', $data, true);
        } else {
            $data['content'] = $this->load->view('qualitymodules/dephead/edit_feedback_CQI3a8', $data, true);
        }

        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3a8_byid($id)
{
    if ($this->input->post()) {

        $existing = $this->quality_model->get_feedback_CQI3a8_byid($id);
        $dataset = json_decode($existing->dataset, true);
        if (!is_array($dataset)) $dataset = [];

        $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];

        // ðŸ§¹ Remove files
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        if (!empty($removeIndexes)) {
            foreach ($removeIndexes as $index) {
                if (isset($existingFiles[$index])) {
                    $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                    $absolutePath = FCPATH . $oldFilePath;
                    if (file_exists($absolutePath)) @unlink($absolutePath);
                    unset($existingFiles[$index]);
                }
            }
            $existingFiles = array_values($existingFiles);
        }

        // ðŸ“ File Upload
        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $filesCount = count($_FILES['uploaded_files']['name']);
            $config = [
                'upload_path'   => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                'max_size'      => 50000,
                'encrypt_name'  => FALSE
            ];
            $this->load->library('upload');
            for ($i = 0; $i < $filesCount; $i++) {
                $_FILES['file'] = [
                    'name'     => $_FILES['uploaded_files']['name'][$i],
                    'type'     => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error'    => $_FILES['uploaded_files']['error'][$i],
                    'size'     => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $uploadData = $this->upload->data();
                    $existingFiles[] = [
                        'url'  => base_url('api/file_uploads/' . $uploadData['file_name']),
                        'name' => $uploadData['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = array_values($existingFiles);

        // ðŸ§¾ Update dataset
        foreach ($_POST as $key => $value) {
            if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                $dataset[$key] = $value;
            }
        }

        // ðŸ“Š KPI Calculation (Average Time)
        $sum_time = floatval($this->input->post('sum_time')) ?: 0;
        $total_patients = intval($this->input->post('total_patients')) ?: 0;
        $average_time = ($total_patients > 0) ? ($sum_time / $total_patients) : 0;
        $dataset['average_time'] = round($average_time, 2);

        $data = ['dataset' => json_encode($dataset)];
        $this->quality_model->update_feedback_CQI3a8($id, $data);
        redirect('quality/patient_feedback_CQI3a8?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3a8_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3a8', $data);
    }
}



// =============================
// ðŸ§© CQI3a9 â€“ Avg. Time for Initial Assessment of Inpatients (Nursing-Ward)
// =============================
public function edit_feedback_CQI3a9()
{
    if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
        $this->session->set_userdata('referred_from', current_url());
    } else {
        $this->session->set_userdata('referred_from', NULL);
    }

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';

        if (isfeature_active('QUALITY-DASHBOARD') === true) {
            $data['content'] = $this->load->view('qualitymodules/edit_feedback_CQI3a9', $data, true);
        } else {
            $data['content'] = $this->load->view('qualitymodules/dephead/edit_feedback_CQI3a9', $data, true);
        }

        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3a9_byid($id)
{
    if ($this->input->post()) {

        $existing = $this->quality_model->get_feedback_CQI3a9_byid($id);
        $dataset = json_decode($existing->dataset, true);
        if (!is_array($dataset)) $dataset = [];

        $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];

        // ðŸ§¹ Remove files
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        if (!empty($removeIndexes)) {
            foreach ($removeIndexes as $index) {
                if (isset($existingFiles[$index])) {
                    $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                    $absolutePath = FCPATH . $oldFilePath;
                    if (file_exists($absolutePath)) @unlink($absolutePath);
                    unset($existingFiles[$index]);
                }
            }
            $existingFiles = array_values($existingFiles);
        }

        // ðŸ“ File Upload
        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $filesCount = count($_FILES['uploaded_files']['name']);
            $config = [
                'upload_path'   => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                'max_size'      => 50000,
                'encrypt_name'  => FALSE
            ];
            $this->load->library('upload');
            for ($i = 0; $i < $filesCount; $i++) {
                $_FILES['file'] = [
                    'name'     => $_FILES['uploaded_files']['name'][$i],
                    'type'     => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error'    => $_FILES['uploaded_files']['error'][$i],
                    'size'     => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $uploadData = $this->upload->data();
                    $existingFiles[] = [
                        'url'  => base_url('api/file_uploads/' . $uploadData['file_name']),
                        'name' => $uploadData['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = array_values($existingFiles);

        // ðŸ§¾ Update dataset
        foreach ($_POST as $key => $value) {
            if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                $dataset[$key] = $value;
            }
        }

        // ðŸ“Š KPI Calculation (Average Time)
        $sum_time = floatval($this->input->post('sum_time')) ?: 0;
        $total_patients = intval($this->input->post('total_patients')) ?: 0;
        $average_time = ($total_patients > 0) ? ($sum_time / $total_patients) : 0;
        $dataset['average_time'] = round($average_time, 2);

        $data = ['dataset' => json_encode($dataset)];
        $this->quality_model->update_feedback_CQI3a9($id, $data);
        redirect('quality/patient_feedback_CQI3a9?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3a9_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3a9', $data);
    }
}



// =============================
// ðŸ§© CQI3a10 â€“ % Blood Culture Contamination Rate (Lab Services)
// =============================
public function edit_feedback_CQI3a10()
{
    if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
        $this->session->set_userdata('referred_from', current_url());
    } else {
        $this->session->set_userdata('referred_from', NULL);
    }

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';

        if (isfeature_active('QUALITY-DASHBOARD') === true) {
            $data['content'] = $this->load->view('qualitymodules/edit_feedback_CQI3a10', $data, true);
        } else {
            $data['content'] = $this->load->view('qualitymodules/dephead/edit_feedback_CQI3a10', $data, true);
        }

        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3a10_byid($id)
{
    if ($this->input->post()) {

        $existing = $this->quality_model->get_feedback_CQI3a10_byid($id);
        $dataset = json_decode($existing->dataset, true);
        if (!is_array($dataset)) $dataset = [];

        $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];

        // ðŸ§¹ Remove files
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        if (!empty($removeIndexes)) {
            foreach ($removeIndexes as $index) {
                if (isset($existingFiles[$index])) {
                    $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                    $absolutePath = FCPATH . $oldFilePath;
                    if (file_exists($absolutePath)) @unlink($absolutePath);
                    unset($existingFiles[$index]);
                }
            }
            $existingFiles = array_values($existingFiles);
        }

        // ðŸ“ File Upload
        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $filesCount = count($_FILES['uploaded_files']['name']);
            $config = [
                'upload_path'   => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                'max_size'      => 50000,
                'encrypt_name'  => FALSE
            ];
            $this->load->library('upload');
            for ($i = 0; $i < $filesCount; $i++) {
                $_FILES['file'] = [
                    'name'     => $_FILES['uploaded_files']['name'][$i],
                    'type'     => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error'    => $_FILES['uploaded_files']['error'][$i],
                    'size'     => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $uploadData = $this->upload->data();
                    $existingFiles[] = [
                        'url'  => base_url('api/file_uploads/' . $uploadData['file_name']),
                        'name' => $uploadData['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = array_values($existingFiles);

        // ðŸ§¾ Update dataset
        foreach ($_POST as $key => $value) {
            if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                $dataset[$key] = $value;
            }
        }

        // ðŸ“Š KPI Calculation (Contamination %)
        $contaminated = intval($this->input->post('contaminated_samples')) ?: 0;
        $total_samples = intval($this->input->post('total_samples')) ?: 0;
        $percentage = ($total_samples > 0) ? ($contaminated / $total_samples) * 100 : 0;
        $dataset['percentage'] = round($percentage, 2);

        $data = ['dataset' => json_encode($dataset)];
        $this->quality_model->update_feedback_CQI3a10($id, $data);
        redirect('quality/patient_feedback_CQI3a10?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3a10_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3a10', $data);
    }
}
// ðŸ©º CQI3a11 - Percentage of Beta-blocker prescriptions with a diagnosis of CHF with reduced EF
public function edit_feedback_CQI3a11()
{
    if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
        $this->session->set_userdata('referred_from', current_url());
    } else {
        $this->session->set_userdata('referred_from', NULL);
    }

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        if (isfeature_active('QUALITY-DASHBOARD') === true) {
            $data['content'] = $this->load->view('qualitymodules/edit_feedback_CQI3a11', $data, true);
        } else {
            $data['content'] = $this->load->view('qualitymodules/dephead/edit_feedback_CQI3a11', $data, true);
        }
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3a11_byid($id)
{
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3a11_byid($id);
        $dataset = json_decode($existing->dataset, true);
        if (!is_array($dataset)) $dataset = [];

        $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);

        if (!empty($removeIndexes)) {
            foreach ($removeIndexes as $index) {
                if (isset($existingFiles[$index])) {
                    $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                    $absolutePath = FCPATH . $oldFilePath;
                    if (file_exists($absolutePath)) @unlink($absolutePath);
                    unset($existingFiles[$index]);
                }
            }
            $existingFiles = array_values($existingFiles);
        }

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $filesCount = count($_FILES['uploaded_files']['name']);
            $config = [
                'upload_path'   => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                'max_size'      => 50000,
                'encrypt_name'  => FALSE
            ];
            $this->load->library('upload');
            for ($i = 0; $i < $filesCount; $i++) {
                $_FILES['file'] = [
                    'name'     => $_FILES['uploaded_files']['name'][$i],
                    'type'     => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error'    => $_FILES['uploaded_files']['error'][$i],
                    'size'     => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $uploadData = $this->upload->data();
                    $existingFiles[] = [
                        'url'  => base_url('api/file_uploads/' . $uploadData['file_name']),
                        'name' => $uploadData['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = array_values($existingFiles);

        foreach ($_POST as $key => $value) {
            if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                $dataset[$key] = $value;
            }
        }

        $patients = intval($this->input->post('patients_with_beta_blocker')) ?: 0;
        $total_chf = intval($this->input->post('total_chf_patients')) ?: 0;
        $percentage = ($total_chf > 0) ? ($patients / $total_chf) * 100 : 0;
        $dataset['percentage'] = round($percentage, 2);

        $data = ['dataset' => json_encode($dataset)];
        $this->quality_model->update_feedback_CQI3a11($id, $data);
        redirect('quality/patient_feedback_CQI3a11?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3a11_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3a11', $data);
    }
}
public function edit_feedback_CQI3a12()
{
    if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
        $this->session->set_userdata('referred_from', current_url());
    } else {
        $this->session->set_userdata('referred_from', NULL);
    }

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        if (isfeature_active('QUALITY-DASHBOARD') === true) {
            $data['content'] = $this->load->view('qualitymodules/edit_feedback_CQI3a12', $data, true);
        } else {
            $data['content'] = $this->load->view('qualitymodules/dephead/edit_feedback_CQI3a12', $data, true);
        }
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3a12_byid($id)
{
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3a12_byid($id);
        $dataset = json_decode($existing->dataset, true);
        if (!is_array($dataset)) $dataset = [];

        $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);

        if (!empty($removeIndexes)) {
            foreach ($removeIndexes as $index) {
                if (isset($existingFiles[$index])) {
                    $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                    $absolutePath = FCPATH . $oldFilePath;
                    if (file_exists($absolutePath)) @unlink($absolutePath);
                    unset($existingFiles[$index]);
                }
            }
            $existingFiles = array_values($existingFiles);
        }

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $filesCount = count($_FILES['uploaded_files']['name']);
            $config = [
                'upload_path'   => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                'max_size'      => 50000,
                'encrypt_name'  => FALSE
            ];
            $this->load->library('upload');
            for ($i = 0; $i < $filesCount; $i++) {
                $_FILES['file'] = [
                    'name'     => $_FILES['uploaded_files']['name'][$i],
                    'type'     => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error'    => $_FILES['uploaded_files']['error'][$i],
                    'size'     => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $uploadData = $this->upload->data();
                    $existingFiles[] = [
                        'url'  => base_url('api/file_uploads/' . $uploadData['file_name']),
                        'name' => $uploadData['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = array_values($existingFiles);
        foreach ($_POST as $key => $value) {
            if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                $dataset[$key] = $value;
            }
        }

        $achieved = intval($this->input->post('target_achieved_patients')) ?: 0;
        $total = intval($this->input->post('total_hypoglycemia_patients')) ?: 0;
        $percentage = ($total > 0) ? ($achieved / $total) * 100 : 0;
        $dataset['percentage'] = round($percentage, 2);

        $data = ['dataset' => json_encode($dataset)];
        $this->quality_model->update_feedback_CQI3a12($id, $data);
        redirect('quality/patient_feedback_CQI3a12?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3a12_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3a12', $data);
    }
}
public function edit_feedback_CQI3a13()
{
    if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
        $this->session->set_userdata('referred_from', current_url());
    } else {
        $this->session->set_userdata('referred_from', NULL);
    }

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        if (isfeature_active('QUALITY-DASHBOARD') === true) {
            $data['content'] = $this->load->view('qualitymodules/edit_feedback_CQI3a13', $data, true);
        } else {
            $data['content'] = $this->load->view('qualitymodules/dephead/edit_feedback_CQI3a13', $data, true);
        }
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3a13_byid($id)
{
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3a13_byid($id);
        $dataset = json_decode($existing->dataset, true);
        if (!is_array($dataset)) $dataset = [];

        $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        if (!empty($removeIndexes)) {
            foreach ($removeIndexes as $index) {
                if (isset($existingFiles[$index])) {
                    $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                    $absolutePath = FCPATH . $oldFilePath;
                    if (file_exists($absolutePath)) @unlink($absolutePath);
                    unset($existingFiles[$index]);
                }
            }
            $existingFiles = array_values($existingFiles);
        }

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $filesCount = count($_FILES['uploaded_files']['name']);
            $config = [
                'upload_path'   => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                'max_size'      => 50000,
                'encrypt_name'  => FALSE
            ];
            $this->load->library('upload');
            for ($i = 0; $i < $filesCount; $i++) {
                $_FILES['file'] = [
                    'name'     => $_FILES['uploaded_files']['name'][$i],
                    'type'     => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error'    => $_FILES['uploaded_files']['error'][$i],
                    'size'     => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $uploadData = $this->upload->data();
                    $existingFiles[] = [
                        'url'  => base_url('api/file_uploads/' . $uploadData['file_name']),
                        'name' => $uploadData['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = array_values($existingFiles);
        foreach ($_POST as $key => $value) {
            if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                $dataset[$key] = $value;
            }
        }

        $tears = intval($this->input->post('spontaneous_tears')) ?: 0;
        $deliveries = intval($this->input->post('total_vaginal_deliveries')) ?: 0;
        $percentage = ($deliveries > 0) ? ($tears / $deliveries) * 100 : 0;
        $dataset['percentage'] = round($percentage, 2);

        $data = ['dataset' => json_encode($dataset)];
        $this->quality_model->update_feedback_CQI3a13($id, $data);
        redirect('quality/patient_feedback_CQI3a13?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3a13_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3a13', $data);
    }
}
public function edit_feedback_CQI3a14()
{
    if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
        $this->session->set_userdata('referred_from', current_url());
    } else {
        $this->session->set_userdata('referred_from', NULL);
    }

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        if (isfeature_active('QUALITY-DASHBOARD') === true) {
            $data['content'] = $this->load->view('qualitymodules/edit_feedback_CQI3a14', $data, true);
        } else {
            $data['content'] = $this->load->view('qualitymodules/dephead/edit_feedback_CQI3a14', $data, true);
        }
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3a14_byid($id)
{
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3a14_byid($id);
        $dataset = json_decode($existing->dataset, true);
        if (!is_array($dataset)) $dataset = [];

        $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        if (!empty($removeIndexes)) {
            foreach ($removeIndexes as $index) {
                if (isset($existingFiles[$index])) {
                    $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                    $absolutePath = FCPATH . $oldFilePath;
                    if (file_exists($absolutePath)) @unlink($absolutePath);
                    unset($existingFiles[$index]);
                }
            }
            $existingFiles = array_values($existingFiles);
        }

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $filesCount = count($_FILES['uploaded_files']['name']);
            $config = [
                'upload_path'   => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                'max_size'      => 50000,
                'encrypt_name'  => FALSE
            ];
            $this->load->library('upload');
            for ($i = 0; $i < $filesCount; $i++) {
                $_FILES['file'] = [
                    'name'     => $_FILES['uploaded_files']['name'][$i],
                    'type'     => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error'    => $_FILES['uploaded_files']['error'][$i],
                    'size'     => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $uploadData = $this->upload->data();
                    $existingFiles[] = [
                        'url'  => base_url('api/file_uploads/' . $uploadData['file_name']),
                        'name' => $uploadData['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = array_values($existingFiles);
        foreach ($_POST as $key => $value) {
            if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                $dataset[$key] = $value;
            }
        }

        // KPI Formula: (Sepsis patients received HOUR-1 care / Total sepsis patients) * 100
        $hour1 = intval($this->input->post('hour1_care_patients')) ?: 0;
        $total = intval($this->input->post('total_sepsis_patients')) ?: 0;
        $percentage = ($total > 0) ? ($hour1 / $total) * 100 : 0;
        $dataset['percentage'] = round($percentage, 2);

        $data = ['dataset' => json_encode($dataset)];
        $this->quality_model->update_feedback_CQI3a14($id, $data);
        redirect('quality/patient_feedback_CQI3a14?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3a14_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3a14', $data);
    }
}
public function edit_feedback_CQI3a15()
{
    if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
        $this->session->set_userdata('referred_from', current_url());
    } else {
        $this->session->set_userdata('referred_from', NULL);
    }

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        if (isfeature_active('QUALITY-DASHBOARD') === true) {
            $data['content'] = $this->load->view('qualitymodules/edit_feedback_CQI3a15', $data, true);
        } else {
            $data['content'] = $this->load->view('qualitymodules/dephead/edit_feedback_CQI3a15', $data, true);
        }
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3a15_byid($id)
{
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3a15_byid($id);
        $dataset = json_decode($existing->dataset, true);
        if (!is_array($dataset)) $dataset = [];

        $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        if (!empty($removeIndexes)) {
            foreach ($removeIndexes as $index) {
                if (isset($existingFiles[$index])) {
                    $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                    $absolutePath = FCPATH . $oldFilePath;
                    if (file_exists($absolutePath)) @unlink($absolutePath);
                    unset($existingFiles[$index]);
                }
            }
            $existingFiles = array_values($existingFiles);
        }

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $filesCount = count($_FILES['uploaded_files']['name']);
            $config = [
                'upload_path'   => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                'max_size'      => 50000,
                'encrypt_name'  => FALSE
            ];
            $this->load->library('upload');
            for ($i = 0; $i < $filesCount; $i++) {
                $_FILES['file'] = [
                    'name'     => $_FILES['uploaded_files']['name'][$i],
                    'type'     => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error'    => $_FILES['uploaded_files']['error'][$i],
                    'size'     => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $uploadData = $this->upload->data();
                    $existingFiles[] = [
                        'url'  => base_url('api/file_uploads/' . $uploadData['file_name']),
                        'name' => $uploadData['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = array_values($existingFiles);
        foreach ($_POST as $key => $value) {
            if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                $dataset[$key] = $value;
            }
        }

        // KPI Formula: (COPD patients with action plan / Total COPD discharged patients) * 100
        $action_plan = intval($this->input->post('copd_with_action_plan')) ?: 0;
        $total = intval($this->input->post('total_copd_discharges')) ?: 0;
        $percentage = ($total > 0) ? ($action_plan / $total) * 100 : 0;
        $dataset['percentage'] = round($percentage, 2);

        $data = ['dataset' => json_encode($dataset)];
        $this->quality_model->update_feedback_CQI3a15($id, $data);
        redirect('quality/patient_feedback_CQI3a15?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3a15_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3a15', $data);
    }
}
public function edit_feedback_CQI3a16()
{
    if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
        $this->session->set_userdata('referred_from', current_url());
    } else {
        $this->session->set_userdata('referred_from', NULL);
    }

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        if (isfeature_active('QUALITY-DASHBOARD') === true) {
            $data['content'] = $this->load->view('qualitymodules/edit_feedback_CQI3a16', $data, true);
        } else {
            $data['content'] = $this->load->view('qualitymodules/dephead/edit_feedback_CQI3a16', $data, true);
        }
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3a16_byid($id)
{
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3a16_byid($id);
        $dataset = json_decode($existing->dataset, true);
        if (!is_array($dataset)) $dataset = [];

        $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        if (!empty($removeIndexes)) {
            foreach ($removeIndexes as $index) {
                if (isset($existingFiles[$index])) {
                    $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                    $absolutePath = FCPATH . $oldFilePath;
                    if (file_exists($absolutePath)) @unlink($absolutePath);
                    unset($existingFiles[$index]);
                }
            }
            $existingFiles = array_values($existingFiles);
        }

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $filesCount = count($_FILES['uploaded_files']['name']);
            $config = [
                'upload_path'   => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                'max_size'      => 50000,
                'encrypt_name'  => FALSE
            ];
            $this->load->library('upload');
            for ($i = 0; $i < $filesCount; $i++) {
                $_FILES['file'] = [
                    'name'     => $_FILES['uploaded_files']['name'][$i],
                    'type'     => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error'    => $_FILES['uploaded_files']['error'][$i],
                    'size'     => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $uploadData = $this->upload->data();
                    $existingFiles[] = [
                        'url'  => base_url('api/file_uploads/' . $uploadData['file_name']),
                        'name' => $uploadData['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = array_values($existingFiles);
        foreach ($_POST as $key => $value) {
            if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                $dataset[$key] = $value;
            }
        }

        // KPI Formula: (Inappropriately treated / Total bronchiolitis patients) * 100
        $inappropriate = intval($this->input->post('inappropriate_treatments')) ?: 0;
        $total = intval($this->input->post('total_bronchiolitis_patients')) ?: 0;
        $percentage = ($total > 0) ? ($inappropriate / $total) * 100 : 0;
        $dataset['percentage'] = round($percentage, 2);

        $data = ['dataset' => json_encode($dataset)];
        $this->quality_model->update_feedback_CQI3a16($id, $data);
        redirect('quality/patient_feedback_CQI3a16?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3a16_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3a16', $data);
    }
}
public function edit_feedback_CQI3a17()
{
    if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
        $this->session->set_userdata('referred_from', current_url());
    } else {
        $this->session->set_userdata('referred_from', NULL);
    }

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        if (isfeature_active('QUALITY-DASHBOARD') === true) {
            $data['content'] = $this->load->view('qualitymodules/edit_feedback_CQI3a17', $data, true);
        } else {
            $data['content'] = $this->load->view('qualitymodules/dephead/edit_feedback_CQI3a17', $data, true);
        }
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3a17_byid($id)
{
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3a17_byid($id);
        $dataset = json_decode($existing->dataset, true);
        if (!is_array($dataset)) $dataset = [];

        $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);

        if (!empty($removeIndexes)) {
            foreach ($removeIndexes as $index) {
                if (isset($existingFiles[$index])) {
                    $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                    $absolutePath = FCPATH . $oldFilePath;
                    if (file_exists($absolutePath)) @unlink($absolutePath);
                    unset($existingFiles[$index]);
                }
            }
            $existingFiles = array_values($existingFiles);
        }

        // ðŸ“ File Upload
        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $filesCount = count($_FILES['uploaded_files']['name']);
            $config = [
                'upload_path'   => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                'max_size'      => 50000,
                'encrypt_name'  => FALSE
            ];
            $this->load->library('upload');
            for ($i = 0; $i < $filesCount; $i++) {
                $_FILES['file'] = [
                    'name'     => $_FILES['uploaded_files']['name'][$i],
                    'type'     => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error'    => $_FILES['uploaded_files']['error'][$i],
                    'size'     => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $uploadData = $this->upload->data();
                    $existingFiles[] = [
                        'url'  => base_url('api/file_uploads/' . $uploadData['file_name']),
                        'name' => $uploadData['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = array_values($existingFiles);

        foreach ($_POST as $key => $value) {
            if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                $dataset[$key] = $value;
            }
        }

        // ðŸ“Š KPI: Percentage of oncology patients initiated after MDM
        $initiated = intval($this->input->post('patients_initiated_after_mdm')) ?: 0;
        $total = intval($this->input->post('total_oncology_patients')) ?: 0;
        $percentage = ($total > 0) ? ($initiated / $total) * 100 : 0;
        $dataset['percentage'] = round($percentage, 2);

        $data = ['dataset' => json_encode($dataset)];
        $this->quality_model->update_feedback_CQI3a17($id, $data);
        redirect('quality/patient_feedback_CQI3a17?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3a17_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3a17', $data);
    }
}
public function edit_feedback_CQI3a18()
{
    if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
        $this->session->set_userdata('referred_from', current_url());
    } else {
        $this->session->set_userdata('referred_from', NULL);
    }

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        if (isfeature_active('QUALITY-DASHBOARD') === true) {
            $data['content'] = $this->load->view('qualitymodules/edit_feedback_CQI3a18', $data, true);
        } else {
            $data['content'] = $this->load->view('qualitymodules/dephead/edit_feedback_CQI3a18', $data, true);
        }
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3a18_byid($id)
{
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3a18_byid($id);
        $dataset = json_decode($existing->dataset, true);
        if (!is_array($dataset)) $dataset = [];

        $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);

        if (!empty($removeIndexes)) {
            foreach ($removeIndexes as $index) {
                if (isset($existingFiles[$index])) {
                    $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                    $absolutePath = FCPATH . $oldFilePath;
                    if (file_exists($absolutePath)) @unlink($absolutePath);
                    unset($existingFiles[$index]);
                }
            }
            $existingFiles = array_values($existingFiles);
        }

        // ðŸ“ File Upload
        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $filesCount = count($_FILES['uploaded_files']['name']);
            $config = [
                'upload_path'   => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                'max_size'      => 50000,
                'encrypt_name'  => FALSE
            ];
            $this->load->library('upload');
            for ($i = 0; $i < $filesCount; $i++) {
                $_FILES['file'] = [
                    'name'     => $_FILES['uploaded_files']['name'][$i],
                    'type'     => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error'    => $_FILES['uploaded_files']['error'][$i],
                    'size'     => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $uploadData = $this->upload->data();
                    $existingFiles[] = [
                        'url'  => base_url('api/file_uploads/' . $uploadData['file_name']),
                        'name' => $uploadData['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = array_values($existingFiles);

        foreach ($_POST as $key => $value) {
            if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                $dataset[$key] = $value;
            }
        }

        // ðŸ“Š KPI: Percentage of Extravasation
        $extravasation = intval($this->input->post('extravasation_cases')) ?: 0;
        $total_cases = intval($this->input->post('total_contrast_cases')) ?: 0;
        $percentage = ($total_cases > 0) ? ($extravasation / $total_cases) * 100 : 0;
        $dataset['percentage'] = round($percentage, 2);

        $data = ['dataset' => json_encode($dataset)];
        $this->quality_model->update_feedback_CQI3a18($id, $data);
        redirect('quality/patient_feedback_CQI3a18?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3a18_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3a18', $data);
    }
}
public function edit_feedback_CQI3a19()
{
    if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
        $this->session->set_userdata('referred_from', current_url());
    } else {
        $this->session->set_userdata('referred_from', NULL);
    }

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        if (isfeature_active('QUALITY-DASHBOARD') === true) {
            $data['content'] = $this->load->view('qualitymodules/edit_feedback_CQI3a19', $data, true);
        } else {
            $data['content'] = $this->load->view('qualitymodules/dephead/edit_feedback_CQI3a19', $data, true);
        }
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3a19_byid($id)
{
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3a19_byid($id);
        $dataset = json_decode($existing->dataset, true);
        if (!is_array($dataset)) $dataset = [];

        $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);

        if (!empty($removeIndexes)) {
            foreach ($removeIndexes as $index) {
                if (isset($existingFiles[$index])) {
                    $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                    $absolutePath = FCPATH . $oldFilePath;
                    if (file_exists($absolutePath)) @unlink($absolutePath);
                    unset($existingFiles[$index]);
                }
            }
            $existingFiles = array_values($existingFiles);
        }

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $filesCount = count($_FILES['uploaded_files']['name']);
            $config = [
                'upload_path'   => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                'max_size'      => 50000,
                'encrypt_name'  => FALSE
            ];
            $this->load->library('upload');
            for ($i = 0; $i < $filesCount; $i++) {
                $_FILES['file'] = [
                    'name'     => $_FILES['uploaded_files']['name'][$i],
                    'type'     => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error'    => $_FILES['uploaded_files']['error'][$i],
                    'size'     => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $uploadData = $this->upload->data();
                    $existingFiles[] = [
                        'url'  => base_url('api/file_uploads/' . $uploadData['file_name']),
                        'name' => $uploadData['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = array_values($existingFiles);

        foreach ($_POST as $key => $value) {
            if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                $dataset[$key] = $value;
            }
        }

        // â± KPI: Average Time Taken
        $total_time = floatval($this->input->post('total_time_minutes')) ?: 0;
        $total_patients = intval($this->input->post('total_patients')) ?: 0;
        $average = ($total_patients > 0) ? ($total_time / $total_patients) : 0;
        $dataset['average_time'] = round($average, 2);

        $data = ['dataset' => json_encode($dataset)];
        $this->quality_model->update_feedback_CQI3a19($id, $data);
        redirect('quality/patient_feedback_CQI3a19?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3a19_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3a19', $data);
    }
}
public function edit_feedback_CQI3a20()
{
    if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
        $this->session->set_userdata('referred_from', current_url());
    } else {
        $this->session->set_userdata('referred_from', NULL);
    }

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        if (isfeature_active('QUALITY-DASHBOARD') === true) {
            $data['content'] = $this->load->view('qualitymodules/edit_feedback_CQI3a20', $data, true);
        } else {
            $data['content'] = $this->load->view('qualitymodules/dephead/edit_feedback_CQI3a20', $data, true);
        }
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3a20_byid($id)
{
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3a20_byid($id);
        $dataset = json_decode($existing->dataset, true);
        if (!is_array($dataset)) $dataset = [];

        $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);

        if (!empty($removeIndexes)) {
            foreach ($removeIndexes as $index) {
                if (isset($existingFiles[$index])) {
                    $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                    $absolutePath = FCPATH . $oldFilePath;
                    if (file_exists($absolutePath)) @unlink($absolutePath);
                    unset($existingFiles[$index]);
                }
            }
            $existingFiles = array_values($existingFiles);
        }

        // ðŸ“ File Upload
        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $filesCount = count($_FILES['uploaded_files']['name']);
            $config = [
                'upload_path'   => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                'max_size'      => 50000,
                'encrypt_name'  => FALSE
            ];
            $this->load->library('upload');
            for ($i = 0; $i < $filesCount; $i++) {
                $_FILES['file'] = [
                    'name'     => $_FILES['uploaded_files']['name'][$i],
                    'type'     => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error'    => $_FILES['uploaded_files']['error'][$i],
                    'size'     => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $uploadData = $this->upload->data();
                    $existingFiles[] = [
                        'url'  => base_url('api/file_uploads/' . $uploadData['file_name']),
                        'name' => $uploadData['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = array_values($existingFiles);

        foreach ($_POST as $key => $value) {
            if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                $dataset[$key] = $value;
            }
        }

        // ðŸ“Š KPI: Percentage of patients at target Hb
        $achieved = intval($this->input->post('patients_achieved_target')) ?: 0;
        $total = intval($this->input->post('total_dialysis_patients')) ?: 0;
        $percentage = ($total > 0) ? ($achieved / $total) * 100 : 0;
        $dataset['percentage'] = round($percentage, 2);

        $data = ['dataset' => json_encode($dataset)];
        $this->quality_model->update_feedback_CQI3a20($id, $data);
        redirect('quality/patient_feedback_CQI3a20?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3a20_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3a20', $data);
    }
}
// ==================== CQI3a21 ====================
public function edit_feedback_CQI3a21()
{
    if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
        $this->session->set_userdata('referred_from', current_url());
    } else {
        $this->session->set_userdata('referred_from', NULL);
    }

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        if (isfeature_active('QUALITY-DASHBOARD') === true) {
            $data['content'] = $this->load->view('qualitymodules/edit_feedback_CQI3a21', $data, true);
        } else {
            $data['content'] = $this->load->view('qualitymodules/dephead/edit_feedback_CQI3a21', $data, true);
        }
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3a21_byid($id)
{
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3a21_byid($id);
        $dataset = json_decode($existing->dataset, true);
        if (!is_array($dataset)) $dataset = [];

        // ðŸ—‘ï¸ File Removal
        $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        if (!empty($removeIndexes)) {
            foreach ($removeIndexes as $index) {
                if (isset($existingFiles[$index])) {
                    $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                    $absolutePath = FCPATH . $oldFilePath;
                    if (file_exists($absolutePath)) @unlink($absolutePath);
                    unset($existingFiles[$index]);
                }
            }
            $existingFiles = array_values($existingFiles);
        }

        // ðŸ“ File Upload
        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $filesCount = count($_FILES['uploaded_files']['name']);
            $config = [
                'upload_path'   => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                'max_size'      => 50000,
                'encrypt_name'  => FALSE
            ];
            $this->load->library('upload');
            for ($i = 0; $i < $filesCount; $i++) {
                $_FILES['file'] = [
                    'name'     => $_FILES['uploaded_files']['name'][$i],
                    'type'     => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error'    => $_FILES['uploaded_files']['error'][$i],
                    'size'     => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $uploadData = $this->upload->data();
                    $existingFiles[] = [
                        'url'  => base_url('api/file_uploads/' . $uploadData['file_name']),
                        'name' => $uploadData['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = array_values($existingFiles);

        foreach ($_POST as $key => $value) {
            if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                $dataset[$key] = $value;
            }
        }

        // ðŸ“Š KPI Calculation
        $responded = intval($this->input->post('responded_on_time')) ?: 0;
        $reported = intval($this->input->post('reported_cases')) ?: 0;
        $percentage = ($reported > 0) ? ($responded / $reported) * 100 : 0;
        $dataset['percentage'] = round($percentage, 2);

        $data = ['dataset' => json_encode($dataset)];
        $this->quality_model->update_feedback_CQI3a21($id, $data);
        redirect('quality/patient_feedback_CQI3a21?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3a21_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3a21', $data);
    }
}



// ==================== CQI3a22 ====================
public function edit_feedback_CQI3a22()
{
    if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
        $this->session->set_userdata('referred_from', current_url());
    } else {
        $this->session->set_userdata('referred_from', NULL);
    }

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        if (isfeature_active('QUALITY-DASHBOARD') === true) {
            $data['content'] = $this->load->view('qualitymodules/edit_feedback_CQI3a22', $data, true);
        } else {
            $data['content'] = $this->load->view('qualitymodules/dephead/edit_feedback_CQI3a22', $data, true);
        }
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3a22_byid($id)
{
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3a22_byid($id);
        $dataset = json_decode($existing->dataset, true);
        if (!is_array($dataset)) $dataset = [];

        // ðŸ—‘ï¸ File Removal
        $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        if (!empty($removeIndexes)) {
            foreach ($removeIndexes as $index) {
                if (isset($existingFiles[$index])) {
                    $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                    $absolutePath = FCPATH . $oldFilePath;
                    if (file_exists($absolutePath)) @unlink($absolutePath);
                    unset($existingFiles[$index]);
                }
            }
            $existingFiles = array_values($existingFiles);
        }

        // ðŸ“ File Upload
        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $filesCount = count($_FILES['uploaded_files']['name']);
            $config = [
                'upload_path'   => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                'max_size'      => 50000,
                'encrypt_name'  => FALSE
            ];
            $this->load->library('upload');
            for ($i = 0; $i < $filesCount; $i++) {
                $_FILES['file'] = [
                    'name'     => $_FILES['uploaded_files']['name'][$i],
                    'type'     => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error'    => $_FILES['uploaded_files']['error'][$i],
                    'size'     => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $uploadData = $this->upload->data();
                    $existingFiles[] = [
                        'url'  => base_url('api/file_uploads/' . $uploadData['file_name']),
                        'name' => $uploadData['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = array_values($existingFiles);

        foreach ($_POST as $key => $value) {
            if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                $dataset[$key] = $value;
            }
        }

        // ðŸ“Š KPI Calculation
        $compliant = intval($this->input->post('compliant_cases')) ?: 0;
        $total = intval($this->input->post('total_cases')) ?: 0;
        $percentage = ($total > 0) ? ($compliant / $total) * 100 : 0;
        $dataset['percentage'] = round($percentage, 2);

        $data = ['dataset' => json_encode($dataset)];
        $this->quality_model->update_feedback_CQI3a22($id, $data);
        redirect('quality/patient_feedback_CQI3a22?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3a22_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3a22', $data);
    }
}
public function edit_feedback_CQI3b1()
{
    if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
        $this->session->set_userdata('referred_from', current_url());
    } else {
        $this->session->set_userdata('referred_from', NULL);
    }

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        if (isfeature_active('QUALITY-DASHBOARD') === true) {
            $data['content'] = $this->load->view('qualitymodules/edit_feedback_CQI3b1', $data, true);
        } else {
            $data['content'] = $this->load->view('qualitymodules/dephead/edit_feedback_CQI3b1', $data, true);
        }
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3b1_byid($id)
{
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3b1_byid($id);
        $dataset = json_decode($existing->dataset, true);
        if (!is_array($dataset)) $dataset = [];

        // ðŸ“ Handle existing + new files
        $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);

        if (!empty($removeIndexes)) {
            foreach ($removeIndexes as $index) {
                if (isset($existingFiles[$index])) {
                    $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                    $absolutePath = FCPATH . $oldFilePath;
                    if (file_exists($absolutePath)) @unlink($absolutePath);
                    unset($existingFiles[$index]);
                }
            }
            $existingFiles = array_values($existingFiles);
        }

        // File Uploads
        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $filesCount = count($_FILES['uploaded_files']['name']);
            $config = [
                'upload_path'   => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                'max_size'      => 50000,
                'encrypt_name'  => FALSE
            ];
            $this->load->library('upload');
            for ($i = 0; $i < $filesCount; $i++) {
                $_FILES['file'] = [
                    'name'     => $_FILES['uploaded_files']['name'][$i],
                    'type'     => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error'    => $_FILES['uploaded_files']['error'][$i],
                    'size'     => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $uploadData = $this->upload->data();
                    $existingFiles[] = [
                        'url'  => base_url('api/file_uploads/' . $uploadData['file_name']),
                        'name' => $uploadData['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = array_values($existingFiles);

        foreach ($_POST as $key => $value) {
            if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                $dataset[$key] = $value;
            }
        }

        // ðŸ“Š KPI Calculation: Number of reporting errors per 1000 investigations
        $errors = intval($this->input->post('reporting_errors')) ?: 0;
        $total = intval($this->input->post('total_investigations')) ?: 0;
        $rate = ($total > 0) ? ($errors / $total) * 1000 : 0;
        $dataset['rate'] = round($rate, 2);

        $data = ['dataset' => json_encode($dataset)];
        $this->quality_model->update_feedback_CQI3b1($id, $data);
        redirect('quality/patient_feedback_CQI3b1?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3b1_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3b1', $data);
    }
}
public function edit_feedback_CQI3b2()
{
    if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
        $this->session->set_userdata('referred_from', current_url());
    } else {
        $this->session->set_userdata('referred_from', NULL);
    }

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        if (isfeature_active('QUALITY-DASHBOARD') === true) {
            $data['content'] = $this->load->view('qualitymodules/edit_feedback_CQI3b2', $data, true);
        } else {
            $data['content'] = $this->load->view('qualitymodules/dephead/edit_feedback_CQI3b2', $data, true);
        }
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3b2_byid($id)
{
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3b2_byid($id);
        $dataset = json_decode($existing->dataset, true);
        if (!is_array($dataset)) $dataset = [];

        $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);

        if (!empty($removeIndexes)) {
            foreach ($removeIndexes as $index) {
                if (isset($existingFiles[$index])) {
                    $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                    $absolutePath = FCPATH . $oldFilePath;
                    if (file_exists($absolutePath)) @unlink($absolutePath);
                    unset($existingFiles[$index]);
                }
            }
            $existingFiles = array_values($existingFiles);
        }

        // Upload New Files
        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $filesCount = count($_FILES['uploaded_files']['name']);
            $config = [
                'upload_path'   => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                'max_size'      => 50000,
                'encrypt_name'  => FALSE
            ];
            $this->load->library('upload');
            for ($i = 0; $i < $filesCount; $i++) {
                $_FILES['file'] = [
                    'name'     => $_FILES['uploaded_files']['name'][$i],
                    'type'     => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error'    => $_FILES['uploaded_files']['error'][$i],
                    'size'     => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $uploadData = $this->upload->data();
                    $existingFiles[] = [
                        'url'  => base_url('api/file_uploads/' . $uploadData['file_name']),
                        'name' => $uploadData['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = array_values($existingFiles);

        foreach ($_POST as $key => $value) {
            if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                $dataset[$key] = $value;
            }
        }

        // ðŸ“Š KPI Calculation: Rate of redo in 1000 tests
        $redo = intval($this->input->post('redo_tests')) ?: 0;
        $total = intval($this->input->post('total_tests')) ?: 0;
        $rate = ($total > 0) ? ($redo / $total) * 1000 : 0;
        $dataset['rate'] = round($rate, 2);

        $data = ['dataset' => json_encode($dataset)];
        $this->quality_model->update_feedback_CQI3b2($id, $data);
        redirect('quality/patient_feedback_CQI3b2?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3b2_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3b2', $data);
    }
}
public function edit_feedback_CQI3b3()
{
    if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
        $this->session->set_userdata('referred_from', current_url());
    } else {
        $this->session->set_userdata('referred_from', NULL);
    }

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        if (isfeature_active('QUALITY-DASHBOARD') === true) {
            $data['content'] = $this->load->view('qualitymodules/edit_feedback_CQI3b3', $data, true);
        } else {
            $data['content'] = $this->load->view('qualitymodules/dephead/edit_feedback_CQI3b3', $data, true);
        }
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3b3_byid($id)
{
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3b3_byid($id);
        $dataset = json_decode($existing->dataset, true);
        if (!is_array($dataset)) $dataset = [];

        $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);

        if (!empty($removeIndexes)) {
            foreach ($removeIndexes as $index) {
                if (isset($existingFiles[$index])) {
                    $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                    $absolutePath = FCPATH . $oldFilePath;
                    if (file_exists($absolutePath)) @unlink($absolutePath);
                    unset($existingFiles[$index]);
                }
            }
            $existingFiles = array_values($existingFiles);
        }

        // Upload New Files
        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $filesCount = count($_FILES['uploaded_files']['name']);
            $config = [
                'upload_path'   => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                'max_size'      => 50000,
                'encrypt_name'  => FALSE
            ];
            $this->load->library('upload');
            for ($i = 0; $i < $filesCount; $i++) {
                $_FILES['file'] = [
                    'name'     => $_FILES['uploaded_files']['name'][$i],
                    'type'     => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error'    => $_FILES['uploaded_files']['error'][$i],
                    'size'     => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $uploadData = $this->upload->data();
                    $existingFiles[] = [
                        'url'  => base_url('api/file_uploads/' . $uploadData['file_name']),
                        'name' => $uploadData['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = array_values($existingFiles);

        foreach ($_POST as $key => $value) {
            if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                $dataset[$key] = $value;
            }
        }

        // ðŸ“Š KPI Calculation: Percentage of reports correlating to clinical diagnosis
        $correlated = intval($this->input->post('correlated_reports')) ?: 0;
        $total = intval($this->input->post('total_reports')) ?: 0;
        $percentage = ($total > 0) ? ($correlated / $total) * 100 : 0;
        $dataset['percentage'] = round($percentage, 2);

        $data = ['dataset' => json_encode($dataset)];
        $this->quality_model->update_feedback_CQI3b3($id, $data);
        redirect('quality/patient_feedback_CQI3b3?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3b3_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3b3', $data);
    }
}
public function edit_feedback_CQI3b4()
{
    if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
        $this->session->set_userdata('referred_from', current_url());
    } else {
        $this->session->set_userdata('referred_from', NULL);
    }

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        if (isfeature_active('QUALITY-DASHBOARD') === true) {
            $data['content'] = $this->load->view('qualitymodules/edit_feedback_CQI3b4', $data, true);
        } else {
            $data['content'] = $this->load->view('qualitymodules/dephead/edit_feedback_CQI3b4', $data, true);
        }
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3b4_byid($id)
{
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3b4_byid($id);
        $dataset = json_decode($existing->dataset, true);
        if (!is_array($dataset)) $dataset = [];

        $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);

        if (!empty($removeIndexes)) {
            foreach ($removeIndexes as $index) {
                if (isset($existingFiles[$index])) {
                    $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                    $absolutePath = FCPATH . $oldFilePath;
                    if (file_exists($absolutePath)) @unlink($absolutePath);
                    unset($existingFiles[$index]);
                }
            }
            $existingFiles = array_values($existingFiles);
        }

        // File Upload Handling
        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $filesCount = count($_FILES['uploaded_files']['name']);
            $config = [
                'upload_path'   => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                'max_size'      => 50000,
                'encrypt_name'  => FALSE
            ];
            $this->load->library('upload');
            for ($i = 0; $i < $filesCount; $i++) {
                $_FILES['file'] = [
                    'name'     => $_FILES['uploaded_files']['name'][$i],
                    'type'     => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error'    => $_FILES['uploaded_files']['error'][$i],
                    'size'     => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $uploadData = $this->upload->data();
                    $existingFiles[] = [
                        'url'  => base_url('api/file_uploads/' . $uploadData['file_name']),
                        'name' => $uploadData['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = array_values($existingFiles);

        foreach ($_POST as $key => $value) {
            if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                $dataset[$key] = $value;
            }
        }

        // ðŸ“Š KPI Calculation: Percentage of employees adhering to safety precautions
        $adhered = intval($this->input->post('employees_adhered')) ?: 0;
        $total = intval($this->input->post('total_employees')) ?: 0;
        $percentage = ($total > 0) ? ($adhered / $total) * 100 : 0;
        $dataset['percentage'] = round($percentage, 2);

        $data = ['dataset' => json_encode($dataset)];
        $this->quality_model->update_feedback_CQI3b4($id, $data);
        redirect('quality/patient_feedback_CQI3b4?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3b4_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3b4', $data);
    }
}
public function edit_feedback_CQI3b5()
{
    if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
        $this->session->set_userdata('referred_from', current_url());
    } else {
        $this->session->set_userdata('referred_from', NULL);
    }

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        if (isfeature_active('QUALITY-DASHBOARD') === true) {
            $data['content'] = $this->load->view('qualitymodules/edit_feedback_CQI3b5', $data, true);
        } else {
            $data['content'] = $this->load->view('qualitymodules/dephead/edit_feedback_CQI3b5', $data, true);
        }
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3b5_byid($id)
{
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3b5_byid($id);
        $dataset = json_decode($existing->dataset, true);
        if (!is_array($dataset)) $dataset = [];

        // File logic (same pattern)
        $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);

        if (!empty($removeIndexes)) {
            foreach ($removeIndexes as $index) {
                if (isset($existingFiles[$index])) {
                    $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                    $absolutePath = FCPATH . $oldFilePath;
                    if (file_exists($absolutePath)) @unlink($absolutePath);
                    unset($existingFiles[$index]);
                }
            }
            $existingFiles = array_values($existingFiles);
        }

        // File Upload
        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $filesCount = count($_FILES['uploaded_files']['name']);
            $config = [
                'upload_path'   => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                'max_size'      => 50000,
                'encrypt_name'  => FALSE
            ];
            $this->load->library('upload');
            for ($i = 0; $i < $filesCount; $i++) {
                $_FILES['file'] = [
                    'name'     => $_FILES['uploaded_files']['name'][$i],
                    'type'     => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error'    => $_FILES['uploaded_files']['error'][$i],
                    'size'     => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $uploadData = $this->upload->data();
                    $existingFiles[] = [
                        'url'  => base_url('api/file_uploads/' . $uploadData['file_name']),
                        'name' => $uploadData['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = array_values($existingFiles);

        foreach ($_POST as $key => $value) {
            if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                $dataset[$key] = $value;
            }
        }

        // ðŸ“Š KPI Calculation: Rate of redo per 1000 tests
        $redo = intval($this->input->post('redo_tests')) ?: 0;
        $total = intval($this->input->post('total_tests')) ?: 0;
        $rate = ($total > 0) ? ($redo / $total) * 1000 : 0;
        $dataset['rate'] = round($rate, 2);

        $data = ['dataset' => json_encode($dataset)];
        $this->quality_model->update_feedback_CQI3b5($id, $data);
        redirect('quality/patient_feedback_CQI3b5?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3b5_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3b5', $data);
    }
}
// âœ… CQI3b6 - Number of reporting errors per 1000 investigations (Radiology)
public function edit_feedback_CQI3b6()
{
    if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
        $this->session->set_userdata('referred_from', current_url());
    } else {
        $this->session->set_userdata('referred_from', NULL);
    }

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        if (isfeature_active('QUALITY-DASHBOARD') === true) {
            $data['content'] = $this->load->view('qualitymodules/edit_feedback_CQI3b6', $data, true);
        } else {
            $data['content'] = $this->load->view('qualitymodules/dephead/edit_feedback_CQI3b6', $data, true);
        }
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3b6_byid($id)
{
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3b6_byid($id);
        $dataset = json_decode($existing->dataset, true);
        if (!is_array($dataset)) $dataset = [];

        // ðŸ§¾ Handle file uploads/removals
        $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);

        if (!empty($removeIndexes)) {
            foreach ($removeIndexes as $index) {
                if (isset($existingFiles[$index])) {
                    $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                    $absolutePath = FCPATH . $oldFilePath;
                    if (file_exists($absolutePath)) @unlink($absolutePath);
                    unset($existingFiles[$index]);
                }
            }
            $existingFiles = array_values($existingFiles);
        }

        // ðŸ“ File Upload
        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $filesCount = count($_FILES['uploaded_files']['name']);
            $config = [
                'upload_path'   => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                'max_size'      => 50000,
                'encrypt_name'  => FALSE
            ];
            $this->load->library('upload');
            for ($i = 0; $i < $filesCount; $i++) {
                $_FILES['file'] = [
                    'name'     => $_FILES['uploaded_files']['name'][$i],
                    'type'     => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error'    => $_FILES['uploaded_files']['error'][$i],
                    'size'     => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $uploadData = $this->upload->data();
                    $existingFiles[] = [
                        'url'  => base_url('api/file_uploads/' . $uploadData['file_name']),
                        'name' => $uploadData['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = array_values($existingFiles);

        foreach ($_POST as $key => $value) {
            if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                $dataset[$key] = $value;
            }
        }

        // ðŸ“Š KPI: Number of reporting errors per 1000 investigations
        $errors = intval($this->input->post('reporting_errors')) ?: 0;
        $total = intval($this->input->post('total_investigations')) ?: 0;
        $rate = ($total > 0) ? ($errors / $total) * 1000 : 0;
        $dataset['rate_per_1000'] = round($rate, 2);

        $data = ['dataset' => json_encode($dataset)];
        $this->quality_model->update_feedback_CQI3b6($id, $data);
        redirect('quality/patient_feedback_CQI3b6?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3b6_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3b6', $data);
    }
}
// âœ… CQI3b7 - Percentage of reports correlating to clinical diagnosis (Radiology)
public function edit_feedback_CQI3b7()
{
    if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
        $this->session->set_userdata('referred_from', current_url());
    } else {
        $this->session->set_userdata('referred_from', NULL);
    }

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        if (isfeature_active('QUALITY-DASHBOARD') === true) {
            $data['content'] = $this->load->view('qualitymodules/edit_feedback_CQI3b7', $data, true);
        } else {
            $data['content'] = $this->load->view('qualitymodules/dephead/edit_feedback_CQI3b7', $data, true);
        }
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3b7_byid($id)
{
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3b7_byid($id);
        $dataset = json_decode($existing->dataset, true);
        if (!is_array($dataset)) $dataset = [];

        $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);

        if (!empty($removeIndexes)) {
            foreach ($removeIndexes as $index) {
                if (isset($existingFiles[$index])) {
                    $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                    $absolutePath = FCPATH . $oldFilePath;
                    if (file_exists($absolutePath)) @unlink($absolutePath);
                    unset($existingFiles[$index]);
                }
            }
            $existingFiles = array_values($existingFiles);
        }

        // ðŸ“ File Upload
        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $filesCount = count($_FILES['uploaded_files']['name']);
            $config = [
                'upload_path'   => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                'max_size'      => 50000,
                'encrypt_name'  => FALSE
            ];
            $this->load->library('upload');
            for ($i = 0; $i < $filesCount; $i++) {
                $_FILES['file'] = [
                    'name'     => $_FILES['uploaded_files']['name'][$i],
                    'type'     => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error'    => $_FILES['uploaded_files']['error'][$i],
                    'size'     => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $uploadData = $this->upload->data();
                    $existingFiles[] = [
                        'url'  => base_url('api/file_uploads/' . $uploadData['file_name']),
                        'name' => $uploadData['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = array_values($existingFiles);

        foreach ($_POST as $key => $value) {
            if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                $dataset[$key] = $value;
            }
        }

        // ðŸ“Š KPI: Percentage of reports correlating to clinical diagnosis
        $correlated = intval($this->input->post('correlated_reports')) ?: 0;
        $total = intval($this->input->post('total_reports')) ?: 0;
        $percentage = ($total > 0) ? ($correlated / $total) * 100 : 0;
        $dataset['percentage'] = round($percentage, 2);

        $data = ['dataset' => json_encode($dataset)];
        $this->quality_model->update_feedback_CQI3b7($id, $data);
        redirect('quality/patient_feedback_CQI3b7?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3b7_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3b7', $data);
    }
}
// âœ… CQI3b8 - Percentage of employees in diagnostics adhering to safety precautions (Radiology)
public function edit_feedback_CQI3b8()
{
    if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
        $this->session->set_userdata('referred_from', current_url());
    } else {
        $this->session->set_userdata('referred_from', NULL);
    }

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        if (isfeature_active('QUALITY-DASHBOARD') === true) {
            $data['content'] = $this->load->view('qualitymodules/edit_feedback_CQI3b8', $data, true);
        } else {
            $data['content'] = $this->load->view('qualitymodules/dephead/edit_feedback_CQI3b8', $data, true);
        }
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3b8_byid($id)
{
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3b8_byid($id);
        $dataset = json_decode($existing->dataset, true);
        if (!is_array($dataset)) $dataset = [];

        $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);

        if (!empty($removeIndexes)) {
            foreach ($removeIndexes as $index) {
                if (isset($existingFiles[$index])) {
                    $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                    $absolutePath = FCPATH . $oldFilePath;
                    if (file_exists($absolutePath)) @unlink($absolutePath);
                    unset($existingFiles[$index]);
                }
            }
            $existingFiles = array_values($existingFiles);
        }

        // ðŸ“ File Upload
        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $filesCount = count($_FILES['uploaded_files']['name']);
            $config = [
                'upload_path'   => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                'max_size'      => 50000,
                'encrypt_name'  => FALSE
            ];
            $this->load->library('upload');
            for ($i = 0; $i < $filesCount; $i++) {
                $_FILES['file'] = [
                    'name'     => $_FILES['uploaded_files']['name'][$i],
                    'type'     => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error'    => $_FILES['uploaded_files']['error'][$i],
                    'size'     => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $uploadData = $this->upload->data();
                    $existingFiles[] = [
                        'url'  => base_url('api/file_uploads/' . $uploadData['file_name']),
                        'name' => $uploadData['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = array_values($existingFiles);

        foreach ($_POST as $key => $value) {
            if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                $dataset[$key] = $value;
            }
        }

        // ðŸ“Š KPI: Percentage of employees adhering to safety precautions
        $compliant = intval($this->input->post('employees_following_safety')) ?: 0;
        $total = intval($this->input->post('total_employees')) ?: 0;
        $percentage = ($total > 0) ? ($compliant / $total) * 100 : 0;
        $dataset['percentage'] = round($percentage, 2);

        $data = ['dataset' => json_encode($dataset)];
        $this->quality_model->update_feedback_CQI3b8($id, $data);
        redirect('quality/patient_feedback_CQI3b8?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3b8_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3b8', $data);
    }
}
// âœ… CQI3b9 - Percentage of employees in diagnostics adhering to safety precautions (Radiology - OT)
public function edit_feedback_CQI3b9()
{
    if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
        $this->session->set_userdata('referred_from', current_url());
    } else {
        $this->session->set_userdata('referred_from', NULL);
    }

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        if (isfeature_active('QUALITY-DASHBOARD') === true) {
            $data['content'] = $this->load->view('qualitymodules/edit_feedback_CQI3b9', $data, true);
        } else {
            $data['content'] = $this->load->view('qualitymodules/dephead/edit_feedback_CQI3b9', $data, true);
        }
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3b9_byid($id)
{
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3b9_byid($id);
        $dataset = json_decode($existing->dataset, true);
        if (!is_array($dataset)) $dataset = [];

        $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);

        if (!empty($removeIndexes)) {
            foreach ($removeIndexes as $index) {
                if (isset($existingFiles[$index])) {
                    $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                    $absolutePath = FCPATH . $oldFilePath;
                    if (file_exists($absolutePath)) @unlink($absolutePath);
                    unset($existingFiles[$index]);
                }
            }
            $existingFiles = array_values($existingFiles);
        }

        // ðŸ“ File Upload
        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $filesCount = count($_FILES['uploaded_files']['name']);
            $config = [
                'upload_path'   => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                'max_size'      => 50000,
                'encrypt_name'  => FALSE
            ];
            $this->load->library('upload');
            for ($i = 0; $i < $filesCount; $i++) {
                $_FILES['file'] = [
                    'name'     => $_FILES['uploaded_files']['name'][$i],
                    'type'     => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error'    => $_FILES['uploaded_files']['error'][$i],
                    'size'     => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $uploadData = $this->upload->data();
                    $existingFiles[] = [
                        'url'  => base_url('api/file_uploads/' . $uploadData['file_name']),
                        'name' => $uploadData['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = array_values($existingFiles);

        foreach ($_POST as $key => $value) {
            if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                $dataset[$key] = $value;
            }
        }

        // ðŸ“Š KPI Calculation
        $compliant = intval($this->input->post('employees_following_safety')) ?: 0;
        $total = intval($this->input->post('total_employees')) ?: 0;
        $percentage = ($total > 0) ? ($compliant / $total) * 100 : 0;
        $dataset['percentage'] = round($percentage, 2);

        $data = ['dataset' => json_encode($dataset)];
        $this->quality_model->update_feedback_CQI3b9($id, $data);
        redirect('quality/patient_feedback_CQI3b9?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3b9_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3b9', $data);
    }
}
// âœ… CQI3b10 - Percentage of employees in diagnostics adhering to safety precautions (Radiology - Nursing)
public function edit_feedback_CQI3b10()
{
    if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
        $this->session->set_userdata('referred_from', current_url());
    } else {
        $this->session->set_userdata('referred_from', NULL);
    }

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        if (isfeature_active('QUALITY-DASHBOARD') === true) {
            $data['content'] = $this->load->view('qualitymodules/edit_feedback_CQI3b10', $data, true);
        } else {
            $data['content'] = $this->load->view('qualitymodules/dephead/edit_feedback_CQI3b10', $data, true);
        }
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3b10_byid($id)
{
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3b10_byid($id);
        $dataset = json_decode($existing->dataset, true);
        if (!is_array($dataset)) $dataset = [];

        $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);

        if (!empty($removeIndexes)) {
            foreach ($removeIndexes as $index) {
                if (isset($existingFiles[$index])) {
                    $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                    $absolutePath = FCPATH . $oldFilePath;
                    if (file_exists($absolutePath)) @unlink($absolutePath);
                    unset($existingFiles[$index]);
                }
            }
            $existingFiles = array_values($existingFiles);
        }

        // ðŸ“ File Upload
        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $filesCount = count($_FILES['uploaded_files']['name']);
            $config = [
                'upload_path'   => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                'max_size'      => 50000,
                'encrypt_name'  => FALSE
            ];
            $this->load->library('upload');
            for ($i = 0; $i < $filesCount; $i++) {
                $_FILES['file'] = [
                    'name'     => $_FILES['uploaded_files']['name'][$i],
                    'type'     => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error'    => $_FILES['uploaded_files']['error'][$i],
                    'size'     => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $uploadData = $this->upload->data();
                    $existingFiles[] = [
                        'url'  => base_url('api/file_uploads/' . $uploadData['file_name']),
                        'name' => $uploadData['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = array_values($existingFiles);

        foreach ($_POST as $key => $value) {
            if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                $dataset[$key] = $value;
            }
        }

        // ðŸ“Š KPI Calculation
        $compliant = intval($this->input->post('employees_following_safety')) ?: 0;
        $total = intval($this->input->post('total_employees')) ?: 0;
        $percentage = ($total > 0) ? ($compliant / $total) * 100 : 0;
        $dataset['percentage'] = round($percentage, 2);

        $data = ['dataset' => json_encode($dataset)];
        $this->quality_model->update_feedback_CQI3b10($id, $data);
        redirect('quality/patient_feedback_CQI3b10?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3b10_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3b10', $data);
    }
}
// CQI3b11 - Number of reporting errors before dispatch (Lab)
public function edit_feedback_CQI3b11()
{
    if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
        $this->session->set_userdata('referred_from', current_url());
    } else {
        $this->session->set_userdata('referred_from', NULL);
    }

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        if (isfeature_active('QUALITY-DASHBOARD') === true) {
            $data['content'] = $this->load->view('qualitymodules/edit_feedback_CQI3b11', $data, true);
        } else {
            $data['content'] = $this->load->view('qualitymodules/dephead/edit_feedback_CQI3b11', $data, true);
        }
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3b11_byid($id)
{
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3b11_byid($id);
        $dataset = json_decode($existing->dataset, true);
        if (!is_array($dataset)) $dataset = [];

        $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);

        if (!empty($removeIndexes)) {
            foreach ($removeIndexes as $index) {
                if (isset($existingFiles[$index])) {
                    $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                    $absolutePath = FCPATH . $oldFilePath;
                    if (file_exists($absolutePath)) @unlink($absolutePath);
                    unset($existingFiles[$index]);
                }
            }
            $existingFiles = array_values($existingFiles);
        }

        // ðŸ“ File Upload
        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $filesCount = count($_FILES['uploaded_files']['name']);
            $config = [
                'upload_path'   => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                'max_size'      => 50000,
                'encrypt_name'  => FALSE
            ];
            $this->load->library('upload');
            for ($i = 0; $i < $filesCount; $i++) {
                $_FILES['file'] = [
                    'name'     => $_FILES['uploaded_files']['name'][$i],
                    'type'     => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error'    => $_FILES['uploaded_files']['error'][$i],
                    'size'     => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $uploadData = $this->upload->data();
                    $existingFiles[] = [
                        'url'  => base_url('api/file_uploads/' . $uploadData['file_name']),
                        'name' => $uploadData['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = array_values($existingFiles);

        foreach ($_POST as $key => $value) {
            if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                $dataset[$key] = $value;
            }
        }

        // ðŸ“Š KPI Calculation (Rate per 1000 samples)
        $errors = intval($this->input->post('reporting_errors')) ?: 0;
        $total = intval($this->input->post('total_tests')) ?: 0;
        $rate = ($total > 0) ? ($errors / $total) * 1000 : 0;
        $dataset['rate_per_1000'] = round($rate, 2);

        $data = ['dataset' => json_encode($dataset)];
        $this->quality_model->update_feedback_CQI3b11($id, $data);
        redirect('quality/patient_feedback_CQI3b11?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3b11_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3b11', $data);
    }
}
// CQI3b12 - Waiting time for Laboratory services
public function edit_feedback_CQI3b12()
{
    if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
        $this->session->set_userdata('referred_from', current_url());
    } else {
        $this->session->set_userdata('referred_from', NULL);
    }

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        if (isfeature_active('QUALITY-DASHBOARD') === true) {
            $data['content'] = $this->load->view('qualitymodules/edit_feedback_CQI3b12', $data, true);
        } else {
            $data['content'] = $this->load->view('qualitymodules/dephead/edit_feedback_CQI3b12', $data, true);
        }
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3b12_byid($id)
{
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3b12_byid($id);
        $dataset = json_decode($existing->dataset, true);
        if (!is_array($dataset)) $dataset = [];

        $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);

        if (!empty($removeIndexes)) {
            foreach ($removeIndexes as $index) {
                if (isset($existingFiles[$index])) {
                    $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                    $absolutePath = FCPATH . $oldFilePath;
                    if (file_exists($absolutePath)) @unlink($absolutePath);
                    unset($existingFiles[$index]);
                }
            }
            $existingFiles = array_values($existingFiles);
        }

        // ðŸ“ File Upload
        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $filesCount = count($_FILES['uploaded_files']['name']);
            $config = [
                'upload_path'   => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                'max_size'      => 50000,
                'encrypt_name'  => FALSE
            ];
            $this->load->library('upload');
            for ($i = 0; $i < $filesCount; $i++) {
                $_FILES['file'] = [
                    'name'     => $_FILES['uploaded_files']['name'][$i],
                    'type'     => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error'    => $_FILES['uploaded_files']['error'][$i],
                    'size'     => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $uploadData = $this->upload->data();
                    $existingFiles[] = [
                        'url'  => base_url('api/file_uploads/' . $uploadData['file_name']),
                        'name' => $uploadData['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = array_values($existingFiles);

        foreach ($_POST as $key => $value) {
            if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                $dataset[$key] = $value;
            }
        }

        // ðŸ“Š KPI Calculation (Average waiting time)
        $total_wait_time = floatval($this->input->post('total_wait_time')) ?: 0;
        $patients = intval($this->input->post('total_patients')) ?: 0;
        $average = ($patients > 0) ? ($total_wait_time / $patients) : 0;
        $dataset['average_waiting_time'] = round($average, 2);

        $data = ['dataset' => json_encode($dataset)];
        $this->quality_model->update_feedback_CQI3b12($id, $data);
        redirect('quality/patient_feedback_CQI3b12?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3b12_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3b12', $data);
    }
}
// CQI3b13 - Patient safety events or errors related to pathology samples (JCI8-QPS 3.04) - (Lab Services)
public function edit_feedback_CQI3b13()
{
    if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
        $this->session->set_userdata('referred_from', current_url());
    } else {
        $this->session->set_userdata('referred_from', NULL);
    }

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        if (isfeature_active('QUALITY-DASHBOARD') === true) {
            $data['content'] = $this->load->view('qualitymodules/edit_feedback_CQI3b13', $data, true);
        } else {
            $data['content'] = $this->load->view('qualitymodules/dephead/edit_feedback_CQI3b13', $data, true);
        }
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3b13_byid($id)
{
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3b13_byid($id);
        $dataset = json_decode($existing->dataset, true);
        if (!is_array($dataset)) $dataset = [];

        $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);

        if (!empty($removeIndexes)) {
            foreach ($removeIndexes as $index) {
                if (isset($existingFiles[$index])) {
                    $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                    $absolutePath = FCPATH . $oldFilePath;
                    if (file_exists($absolutePath)) @unlink($absolutePath);
                    unset($existingFiles[$index]);
                }
            }
            $existingFiles = array_values($existingFiles);
        }

        // ðŸ“ File Upload
        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $filesCount = count($_FILES['uploaded_files']['name']);
            $config = [
                'upload_path'   => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                'max_size'      => 50000,
                'encrypt_name'  => FALSE
            ];
            $this->load->library('upload');
            for ($i = 0; $i < $filesCount; $i++) {
                $_FILES['file'] = [
                    'name'     => $_FILES['uploaded_files']['name'][$i],
                    'type'     => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error'    => $_FILES['uploaded_files']['error'][$i],
                    'size'     => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $uploadData = $this->upload->data();
                    $existingFiles[] = [
                        'url'  => base_url('api/file_uploads/' . $uploadData['file_name']),
                        'name' => $uploadData['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = array_values($existingFiles);

        foreach ($_POST as $key => $value) {
            if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                $dataset[$key] = $value;
            }
        }

        // ðŸ“Š KPI Calculation (Error rate per 1000 samples)
        $errors = intval($this->input->post('safety_events')) ?: 0;
        $total_samples = intval($this->input->post('total_samples')) ?: 0;
        $rate = ($total_samples > 0) ? ($errors / $total_samples) * 1000 : 0;
        $dataset['error_rate_per_1000'] = round($rate, 2);

        $data = ['dataset' => json_encode($dataset)];
        $this->quality_model->update_feedback_CQI3b13($id, $data);
        redirect('quality/patient_feedback_CQI3b13?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3b13_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3b13', $data);
    }
}
// âœ… CQI3c1 - Medication errors Rate (Clinical Pharmacy)
public function edit_feedback_CQI3c1()
{
    if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
        $this->session->set_userdata('referred_from', current_url());
    } else {
        $this->session->set_userdata('referred_from', NULL);
    }

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        if (isfeature_active('QUALITY-DASHBOARD') === true) {
            $data['content'] = $this->load->view('qualitymodules/edit_feedback_CQI3c1', $data, true);
        } else {
            $data['content'] = $this->load->view('qualitymodules/dephead/edit_feedback_CQI3c1', $data, true);
        }
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3c1_byid($id)
{
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3c1_byid($id);
        $dataset = json_decode($existing->dataset, true);
        if (!is_array($dataset)) $dataset = [];

        $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);

        if (!empty($removeIndexes)) {
            foreach ($removeIndexes as $index) {
                if (isset($existingFiles[$index])) {
                    $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                    $absolutePath = FCPATH . $oldFilePath;
                    if (file_exists($absolutePath)) @unlink($absolutePath);
                    unset($existingFiles[$index]);
                }
            }
            $existingFiles = array_values($existingFiles);
        }

        // ðŸ“ File Upload
        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $filesCount = count($_FILES['uploaded_files']['name']);
            $config = [
                'upload_path'   => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                'max_size'      => 50000,
                'encrypt_name'  => FALSE
            ];
            $this->load->library('upload');
            for ($i = 0; $i < $filesCount; $i++) {
                $_FILES['file'] = [
                    'name'     => $_FILES['uploaded_files']['name'][$i],
                    'type'     => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error'    => $_FILES['uploaded_files']['error'][$i],
                    'size'     => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $uploadData = $this->upload->data();
                    $existingFiles[] = [
                        'url'  => base_url('api/file_uploads/' . $uploadData['file_name']),
                        'name' => $uploadData['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = array_values($existingFiles);

        foreach ($_POST as $key => $value) {
            if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                $dataset[$key] = $value;
            }
        }

        // ðŸ“Š KPI Calculation (Medication error rate per 1000 prescriptions)
        $errors = intval($this->input->post('medication_errors')) ?: 0;
        $total_prescriptions = intval($this->input->post('total_prescriptions')) ?: 0;
        $rate = ($total_prescriptions > 0) ? ($errors / $total_prescriptions) * 1000 : 0;
        $dataset['medication_error_rate_per_1000'] = round($rate, 2);

        $data = ['dataset' => json_encode($dataset)];
        $this->quality_model->update_feedback_CQI3c1($id, $data);
        redirect('quality/patient_feedback_CQI3c1?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3c1_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3c1', $data);
    }
}
// âœ… CQI3c2 - Incidence of medication errors - Prescription errors (IP)
public function edit_feedback_CQI3c2()
{
    if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
        $this->session->set_userdata('referred_from', current_url());
    } else {
        $this->session->set_userdata('referred_from', NULL);
    }

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        if (isfeature_active('QUALITY-DASHBOARD') === true) {
            $data['content'] = $this->load->view('qualitymodules/edit_feedback_CQI3c2', $data, true);
        } else {
            $data['content'] = $this->load->view('qualitymodules/dephead/edit_feedback_CQI3c2', $data, true);
        }
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3c2_byid($id)
{
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3c2_byid($id);
        $dataset = json_decode($existing->dataset, true);
        if (!is_array($dataset)) $dataset = [];

        $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);

        if (!empty($removeIndexes)) {
            foreach ($removeIndexes as $index) {
                if (isset($existingFiles[$index])) {
                    $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                    $absolutePath = FCPATH . $oldFilePath;
                    if (file_exists($absolutePath)) @unlink($absolutePath);
                    unset($existingFiles[$index]);
                }
            }
            $existingFiles = array_values($existingFiles);
        }

        // ðŸ“ File Upload
        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $filesCount = count($_FILES['uploaded_files']['name']);
            $config = [
                'upload_path'   => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                'max_size'      => 50000,
                'encrypt_name'  => FALSE
            ];
            $this->load->library('upload');
            for ($i = 0; $i < $filesCount; $i++) {
                $_FILES['file'] = [
                    'name'     => $_FILES['uploaded_files']['name'][$i],
                    'type'     => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error'    => $_FILES['uploaded_files']['error'][$i],
                    'size'     => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $uploadData = $this->upload->data();
                    $existingFiles[] = [
                        'url'  => base_url('api/file_uploads/' . $uploadData['file_name']),
                        'name' => $uploadData['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = array_values($existingFiles);

        foreach ($_POST as $key => $value) {
            if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                $dataset[$key] = $value;
            }
        }

        // ðŸ“Š KPI Calculation (Prescription Error Rate per 100 prescriptions)
        $errors = intval($this->input->post('prescription_errors')) ?: 0;
        $total = intval($this->input->post('total_prescriptions_checked')) ?: 0;
        $rate = ($total > 0) ? ($errors / $total) * 100 : 0;
        $dataset['prescription_error_rate'] = round($rate, 2);

        $data = ['dataset' => json_encode($dataset)];
        $this->quality_model->update_feedback_CQI3c2($id, $data);
        redirect('quality/patient_feedback_CQI3c2?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3c2_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3c2', $data);
    }
}
// âœ… CQI3c3 - Incidence of medication errors - Dispensing errors (IP)
public function edit_feedback_CQI3c3()
{
    if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
        $this->session->set_userdata('referred_from', current_url());
    } else {
        $this->session->set_userdata('referred_from', NULL);
    }

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        if (isfeature_active('QUALITY-DASHBOARD') === true) {
            $data['content'] = $this->load->view('qualitymodules/edit_feedback_CQI3c3', $data, true);
        } else {
            $data['content'] = $this->load->view('qualitymodules/dephead/edit_feedback_CQI3c3', $data, true);
        }
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3c3_byid($id)
{
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3c3_byid($id);
        $dataset = json_decode($existing->dataset, true);
        if (!is_array($dataset)) $dataset = [];

        $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);

        if (!empty($removeIndexes)) {
            foreach ($removeIndexes as $index) {
                if (isset($existingFiles[$index])) {
                    $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                    $absolutePath = FCPATH . $oldFilePath;
                    if (file_exists($absolutePath)) @unlink($absolutePath);
                    unset($existingFiles[$index]);
                }
            }
            $existingFiles = array_values($existingFiles);
        }

        // ðŸ“ File Upload
        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $filesCount = count($_FILES['uploaded_files']['name']);
            $config = [
                'upload_path'   => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                'max_size'      => 50000,
                'encrypt_name'  => FALSE
            ];
            $this->load->library('upload');
            for ($i = 0; $i < $filesCount; $i++) {
                $_FILES['file'] = [
                    'name'     => $_FILES['uploaded_files']['name'][$i],
                    'type'     => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error'    => $_FILES['uploaded_files']['error'][$i],
                    'size'     => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $uploadData = $this->upload->data();
                    $existingFiles[] = [
                        'url'  => base_url('api/file_uploads/' . $uploadData['file_name']),
                        'name' => $uploadData['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = array_values($existingFiles);

        foreach ($_POST as $key => $value) {
            if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                $dataset[$key] = $value;
            }
        }

        // ðŸ“Š KPI Calculation (Dispensing Error Rate per 1000 prescriptions)
        $dispensing_errors = intval($this->input->post('dispensing_errors')) ?: 0;
        $total_dispensed = intval($this->input->post('total_doses_dispensed')) ?: 0;
        $rate = ($total_dispensed > 0) ? ($dispensing_errors / $total_dispensed) * 1000 : 0;
        $dataset['dispensing_error_rate_per_1000'] = round($rate, 2);

        $data = ['dataset' => json_encode($dataset)];
        $this->quality_model->update_feedback_CQI3c3($id, $data);
        redirect('quality/patient_feedback_CQI3c3?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3c3_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3c3', $data);
    }
}
// âœ… CQI3c4 - Percentage of admissions with ADR (Adverse Drug Reaction)
public function edit_feedback_CQI3c4()
{
    if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
        $this->session->set_userdata('referred_from', current_url());
    } else {
        $this->session->set_userdata('referred_from', NULL);
    }

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        if (isfeature_active('QUALITY-DASHBOARD') === true) {
            $data['content'] = $this->load->view('qualitymodules/edit_feedback_CQI3c4', $data, true);
        } else {
            $data['content'] = $this->load->view('qualitymodules/dephead/edit_feedback_CQI3c4', $data, true);
        }
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3c4_byid($id)
{
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3c4_byid($id);
        $dataset = json_decode($existing->dataset, true);
        if (!is_array($dataset)) $dataset = [];

        $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);

        if (!empty($removeIndexes)) {
            foreach ($removeIndexes as $index) {
                if (isset($existingFiles[$index])) {
                    $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                    $absolutePath = FCPATH . $oldFilePath;
                    if (file_exists($absolutePath)) @unlink($absolutePath);
                    unset($existingFiles[$index]);
                }
            }
            $existingFiles = array_values($existingFiles);
        }

        // ðŸ“ File Upload
        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $filesCount = count($_FILES['uploaded_files']['name']);
            $config = [
                'upload_path'   => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                'max_size'      => 50000,
                'encrypt_name'  => FALSE
            ];
            $this->load->library('upload');
            for ($i = 0; $i < $filesCount; $i++) {
                $_FILES['file'] = [
                    'name'     => $_FILES['uploaded_files']['name'][$i],
                    'type'     => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error'    => $_FILES['uploaded_files']['error'][$i],
                    'size'     => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $uploadData = $this->upload->data();
                    $existingFiles[] = [
                        'url'  => base_url('api/file_uploads/' . $uploadData['file_name']),
                        'name' => $uploadData['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = array_values($existingFiles);

        foreach ($_POST as $key => $value) {
            if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                $dataset[$key] = $value;
            }
        }

        // ðŸ“Š KPI Calculation (ADR %)
        $adr_cases = intval($this->input->post('adr_cases')) ?: 0;
        $total_admissions = intval($this->input->post('total_admissions')) ?: 0;
        $percentage = ($total_admissions > 0) ? ($adr_cases / $total_admissions) * 100 : 0;
        $dataset['adr_percentage'] = round($percentage, 2);

        $data = ['dataset' => json_encode($dataset)];
        $this->quality_model->update_feedback_CQI3c4($id, $data);
        redirect('quality/patient_feedback_CQI3c4?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3c4_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3c4', $data);
    }
}
// âœ… CQI3c5 - Percentage of medication charts with error prone abbreviations
public function edit_feedback_CQI3c5()
{
    if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
        $this->session->set_userdata('referred_from', current_url());
    } else {
        $this->session->set_userdata('referred_from', NULL);
    }

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        if (isfeature_active('QUALITY-DASHBOARD') === true) {
            $data['content'] = $this->load->view('qualitymodules/edit_feedback_CQI3c5', $data, true);
        } else {
            $data['content'] = $this->load->view('qualitymodules/dephead/edit_feedback_CQI3c5', $data, true);
        }
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3c5_byid($id)
{
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3c5_byid($id);
        $dataset = json_decode($existing->dataset, true);
        if (!is_array($dataset)) $dataset = [];

        $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);

        if (!empty($removeIndexes)) {
            foreach ($removeIndexes as $index) {
                if (isset($existingFiles[$index])) {
                    $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                    $absolutePath = FCPATH . $oldFilePath;
                    if (file_exists($absolutePath)) @unlink($absolutePath);
                    unset($existingFiles[$index]);
                }
            }
            $existingFiles = array_values($existingFiles);
        }

        // ðŸ“ File Upload
        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $filesCount = count($_FILES['uploaded_files']['name']);
            $config = [
                'upload_path'   => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                'max_size'      => 50000,
                'encrypt_name'  => FALSE
            ];
            $this->load->library('upload');
            for ($i = 0; $i < $filesCount; $i++) {
                $_FILES['file'] = [
                    'name'     => $_FILES['uploaded_files']['name'][$i],
                    'type'     => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error'    => $_FILES['uploaded_files']['error'][$i],
                    'size'     => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $uploadData = $this->upload->data();
                    $existingFiles[] = [
                        'url'  => base_url('api/file_uploads/' . $uploadData['file_name']),
                        'name' => $uploadData['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = array_values($existingFiles);

        foreach ($_POST as $key => $value) {
            if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                $dataset[$key] = $value;
            }
        }

        // ðŸ“Š KPI Calculation (Error-Prone Abbreviation %)
        $charts_with_errors = intval($this->input->post('charts_with_error_abbreviations')) ?: 0;
        $total_charts = intval($this->input->post('total_charts_reviewed')) ?: 0;
        $percentage = ($total_charts > 0) ? ($charts_with_errors / $total_charts) * 100 : 0;
        $dataset['error_prone_abbreviation_percentage'] = round($percentage, 2);

        $data = ['dataset' => json_encode($dataset)];
        $this->quality_model->update_feedback_CQI3c5($id, $data);
        redirect('quality/patient_feedback_CQI3c5?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3c5_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3c5', $data);
    }
}
// CQI3c6 - Percentage of patients receiving high-risk medication developing adverse drug event (Clinical Pharmacy)
public function edit_feedback_CQI3c6()
{
    if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
        $this->session->set_userdata('referred_from', current_url());
    } else {
        $this->session->set_userdata('referred_from', NULL);
    }

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        if (isfeature_active('QUALITY-DASHBOARD') === true) {
            $data['content'] = $this->load->view('qualitymodules/edit_feedback_CQI3c6', $data, true);
        } else {
            $data['content'] = $this->load->view('qualitymodules/dephead/edit_feedback_CQI3c6', $data, true);
        }
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3c6_byid($id)
{
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3c6_byid($id);
        $dataset = json_decode($existing->dataset, true);
        if (!is_array($dataset)) $dataset = [];

        // ðŸ“ Handle File Upload and Removal (common logic)
        $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        if (!empty($removeIndexes)) {
            foreach ($removeIndexes as $index) {
                if (isset($existingFiles[$index])) {
                    $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                    $absolutePath = FCPATH . $oldFilePath;
                    if (file_exists($absolutePath)) @unlink($absolutePath);
                    unset($existingFiles[$index]);
                }
            }
            $existingFiles = array_values($existingFiles);
        }

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $filesCount = count($_FILES['uploaded_files']['name']);
            $config = [
                'upload_path'   => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                'max_size'      => 50000,
                'encrypt_name'  => FALSE
            ];
            $this->load->library('upload');
            for ($i = 0; $i < $filesCount; $i++) {
                $_FILES['file'] = [
                    'name'     => $_FILES['uploaded_files']['name'][$i],
                    'type'     => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error'    => $_FILES['uploaded_files']['error'][$i],
                    'size'     => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $uploadData = $this->upload->data();
                    $existingFiles[] = [
                        'url'  => base_url('api/file_uploads/' . $uploadData['file_name']),
                        'name' => $uploadData['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = array_values($existingFiles);

        foreach ($_POST as $key => $value) {
            if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                $dataset[$key] = $value;
            }
        }

        // ðŸ“Š KPI Calculation (Adverse event %)
        $adverse_cases = intval($this->input->post('adverse_cases')) ?: 0;
        $total_high_risk_patients = intval($this->input->post('total_high_risk_patients')) ?: 0;
        $percentage = ($total_high_risk_patients > 0) ? ($adverse_cases / $total_high_risk_patients) * 100 : 0;
        $dataset['adverse_event_percentage'] = round($percentage, 2);

        $data = ['dataset' => json_encode($dataset)];
        $this->quality_model->update_feedback_CQI3c6($id, $data);
        redirect('quality/patient_feedback_CQI3c6?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3c6_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3c6', $data);
    }
}
// CQI3c7 - Incidence of Medication Administering Errors (As per NABH 4th edition) - (Clinical Pharmacy)
public function edit_feedback_CQI3c7()
{
    if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
        $this->session->set_userdata('referred_from', current_url());
    } else {
        $this->session->set_userdata('referred_from', NULL);
    }

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        if (isfeature_active('QUALITY-DASHBOARD') === true) {
            $data['content'] = $this->load->view('qualitymodules/edit_feedback_CQI3c7', $data, true);
        } else {
            $data['content'] = $this->load->view('qualitymodules/dephead/edit_feedback_CQI3c7', $data, true);
        }
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3c7_byid($id)
{
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3c7_byid($id);
        $dataset = json_decode($existing->dataset, true);
        if (!is_array($dataset)) $dataset = [];

        // ðŸ“ File Handling
        $existingFiles = $dataset['files_name'] ?? [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        if (!empty($removeIndexes)) {
            foreach ($removeIndexes as $index) {
                if (isset($existingFiles[$index])) {
                    $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                    $absolutePath = FCPATH . $oldFilePath;
                    if (file_exists($absolutePath)) @unlink($absolutePath);
                    unset($existingFiles[$index]);
                }
            }
            $existingFiles = array_values($existingFiles);
        }

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $filesCount = count($_FILES['uploaded_files']['name']);
            $config = [
                'upload_path'   => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                'max_size'      => 50000,
                'encrypt_name'  => FALSE
            ];
            $this->load->library('upload');
            for ($i = 0; $i < $filesCount; $i++) {
                $_FILES['file'] = [
                    'name'     => $_FILES['uploaded_files']['name'][$i],
                    'type'     => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error'    => $_FILES['uploaded_files']['error'][$i],
                    'size'     => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $uploadData = $this->upload->data();
                    $existingFiles[] = [
                        'url'  => base_url('api/file_uploads/' . $uploadData['file_name']),
                        'name' => $uploadData['file_name']
                    ];
                }
            }
        }
        $dataset['files_name'] = array_values($existingFiles);

        foreach ($_POST as $key => $value)
            if (!in_array($key, ['uploaded_files', 'remove_files_json']))
                $dataset[$key] = $value;

        // ðŸ“Š KPI Formula (Incidence rate per 1000 administrations)
        $errors = intval($this->input->post('admin_errors')) ?: 0;
        $total_admins = intval($this->input->post('total_admins')) ?: 0;
        $rate = ($total_admins > 0) ? ($errors / $total_admins) * 1000 : 0;
        $dataset['admin_error_rate_per_1000'] = round($rate, 2);

        $data = ['dataset' => json_encode($dataset)];
        $this->quality_model->update_feedback_CQI3c7($id, $data);
        redirect('quality/patient_feedback_CQI3c7?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3c7_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3c7', $data);
    }
}
// CQI3c8 - Percentage of in-patients developing adverse drug reaction (PSQ3a) (Clinical Pharmacy)
public function edit_feedback_CQI3c8()
{
    if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
        $this->session->set_userdata('referred_from', current_url());
    } else {
        $this->session->set_userdata('referred_from', NULL);
    }

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        if (isfeature_active('QUALITY-DASHBOARD') === true) {
            $data['content'] = $this->load->view('qualitymodules/edit_feedback_CQI3c8', $data, true);
        } else {
            $data['content'] = $this->load->view('qualitymodules/dephead/edit_feedback_CQI3c8', $data, true);
        }
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3c8_byid($id)
{
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3c8_byid($id);
        $dataset = json_decode($existing->dataset, true);
        if (!is_array($dataset)) $dataset = [];

        // File upload and cleanup
        $existingFiles = $dataset['files_name'] ?? [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        if (!empty($removeIndexes)) {
            foreach ($removeIndexes as $index) {
                if (isset($existingFiles[$index])) {
                    $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                    $absolutePath = FCPATH . $oldFilePath;
                    if (file_exists($absolutePath)) @unlink($absolutePath);
                    unset($existingFiles[$index]);
                }
            }
            $existingFiles = array_values($existingFiles);
        }

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $filesCount = count($_FILES['uploaded_files']['name']);
            $config = [
                'upload_path'   => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                'max_size'      => 50000,
                'encrypt_name'  => FALSE
            ];
            $this->load->library('upload');
            for ($i = 0; $i < $filesCount; $i++) {
                $_FILES['file'] = [
                    'name'     => $_FILES['uploaded_files']['name'][$i],
                    'type'     => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error'    => $_FILES['uploaded_files']['error'][$i],
                    'size'     => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $uploadData = $this->upload->data();
                    $existingFiles[] = [
                        'url'  => base_url('api/file_uploads/' . $uploadData['file_name']),
                        'name' => $uploadData['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = array_values($existingFiles);
        foreach ($_POST as $key => $value)
            if (!in_array($key, ['uploaded_files', 'remove_files_json']))
                $dataset[$key] = $value;

        // ðŸ“Š KPI Calculation
        $adr_cases = intval($this->input->post('adr_cases')) ?: 0;
        $total_inpatients = intval($this->input->post('total_inpatients')) ?: 0;
        $percentage = ($total_inpatients > 0) ? ($adr_cases / $total_inpatients) * 100 : 0;
        $dataset['adr_percentage'] = round($percentage, 2);

        $data = ['dataset' => json_encode($dataset)];
        $this->quality_model->update_feedback_CQI3c8($id, $data);
        redirect('quality/patient_feedback_CQI3c8?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3c8_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3c8', $data);
    }
}
// CQI3c9 - Incidence of Medication Administering Errors (Clinical Pharmacy)
public function edit_feedback_CQI3c9()
{
    if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
        $this->session->set_userdata('referred_from', current_url());
    } else {
        $this->session->set_userdata('referred_from', NULL);
    }

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        if (isfeature_active('QUALITY-DASHBOARD') === true) {
            $data['content'] = $this->load->view('qualitymodules/edit_feedback_CQI3c9', $data, true);
        } else {
            $data['content'] = $this->load->view('qualitymodules/dephead/edit_feedback_CQI3c9', $data, true);
        }
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3c9_byid($id)
{
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3c9_byid($id);
        $dataset = json_decode($existing->dataset, true);
        if (!is_array($dataset)) $dataset = [];

        // ðŸ“ Handle File Upload and Removal
        $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        if (!empty($removeIndexes)) {
            foreach ($removeIndexes as $index) {
                if (isset($existingFiles[$index])) {
                    $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                    $absolutePath = FCPATH . $oldFilePath;
                    if (file_exists($absolutePath)) @unlink($absolutePath);
                    unset($existingFiles[$index]);
                }
            }
            $existingFiles = array_values($existingFiles);
        }

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $filesCount = count($_FILES['uploaded_files']['name']);
            $config = [
                'upload_path'   => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                'max_size'      => 50000,
                'encrypt_name'  => FALSE
            ];
            $this->load->library('upload');
            for ($i = 0; $i < $filesCount; $i++) {
                $_FILES['file'] = [
                    'name'     => $_FILES['uploaded_files']['name'][$i],
                    'type'     => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error'    => $_FILES['uploaded_files']['error'][$i],
                    'size'     => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $uploadData = $this->upload->data();
                    $existingFiles[] = [
                        'url'  => base_url('api/file_uploads/' . $uploadData['file_name']),
                        'name' => $uploadData['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = array_values($existingFiles);

        foreach ($_POST as $key => $value) {
            if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                $dataset[$key] = $value;
            }
        }

        // ðŸ“Š KPI Calculation (Incidence Rate)
        $admin_error_cases = intval($this->input->post('admin_error_cases')) ?: 0;
        $total_administered = intval($this->input->post('total_administered')) ?: 0;
        $incidence_rate = ($total_administered > 0) ? ($admin_error_cases / $total_administered) * 100 : 0;
        $dataset['admin_error_rate'] = round($incidence_rate, 2);

        $data = ['dataset' => json_encode($dataset)];
        $this->quality_model->update_feedback_CQI3c9($id, $data);
        redirect('quality/patient_feedback_CQI3c9?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3c9_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3c9', $data);
    }
}
// CQI3c10 - Incidence of medication errors - Dispensing errors (IP) (Clinical Pharmacy)
public function edit_feedback_CQI3c10()
{
    if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
        $this->session->set_userdata('referred_from', current_url());
    } else {
        $this->session->set_userdata('referred_from', NULL);
    }

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        if (isfeature_active('QUALITY-DASHBOARD') === true) {
            $data['content'] = $this->load->view('qualitymodules/edit_feedback_CQI3c10', $data, true);
        } else {
            $data['content'] = $this->load->view('qualitymodules/dephead/edit_feedback_CQI3c10', $data, true);
        }
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3c10_byid($id)
{
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3c10_byid($id);
        $dataset = json_decode($existing->dataset, true);
        if (!is_array($dataset)) $dataset = [];

        // ðŸ“ File Upload and Removal Logic
        $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        if (!empty($removeIndexes)) {
            foreach ($removeIndexes as $index) {
                if (isset($existingFiles[$index])) {
                    $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                    $absolutePath = FCPATH . $oldFilePath;
                    if (file_exists($absolutePath)) @unlink($absolutePath);
                    unset($existingFiles[$index]);
                }
            }
            $existingFiles = array_values($existingFiles);
        }

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $filesCount = count($_FILES['uploaded_files']['name']);
            $config = [
                'upload_path'   => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                'max_size'      => 50000,
                'encrypt_name'  => FALSE
            ];
            $this->load->library('upload');
            for ($i = 0; $i < $filesCount; $i++) {
                $_FILES['file'] = [
                    'name'     => $_FILES['uploaded_files']['name'][$i],
                    'type'     => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error'    => $_FILES['uploaded_files']['error'][$i],
                    'size'     => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $uploadData = $this->upload->data();
                    $existingFiles[] = [
                        'url'  => base_url('api/file_uploads/' . $uploadData['file_name']),
                        'name' => $uploadData['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = array_values($existingFiles);

        foreach ($_POST as $key => $value) {
            if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                $dataset[$key] = $value;
            }
        }

        // ðŸ“Š KPI Calculation (Dispensing Error Rate)
        $dispense_errors = intval($this->input->post('dispense_errors')) ?: 0;
        $total_dispenses = intval($this->input->post('total_dispenses')) ?: 0;
        $error_rate = ($total_dispenses > 0) ? ($dispense_errors / $total_dispenses) * 100 : 0;
        $dataset['dispensing_error_rate'] = round($error_rate, 2);

        $data = ['dataset' => json_encode($dataset)];
        $this->quality_model->update_feedback_CQI3c10($id, $data);
        redirect('quality/patient_feedback_CQI3c10?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3c10_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3c10', $data);
    }
}
// CQI3c11 - Incidence of medication errors - Prescription errors (IP) (Clinical Pharmacy)
public function edit_feedback_CQI3c11()
{
    if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
        $this->session->set_userdata('referred_from', current_url());
    } else {
        $this->session->set_userdata('referred_from', NULL);
    }

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        if (isfeature_active('QUALITY-DASHBOARD') === true) {
            $data['content'] = $this->load->view('qualitymodules/edit_feedback_CQI3c11', $data, true);
        } else {
            $data['content'] = $this->load->view('qualitymodules/dephead/edit_feedback_CQI3c11', $data, true);
        }
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3c11_byid($id)
{
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3c11_byid($id);
        $dataset = json_decode($existing->dataset, true);
        if (!is_array($dataset)) $dataset = [];

        // File upload/removal logic
        $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        if (!empty($removeIndexes)) {
            foreach ($removeIndexes as $index) {
                if (isset($existingFiles[$index])) {
                    $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                    $absolutePath = FCPATH . $oldFilePath;
                    if (file_exists($absolutePath)) @unlink($absolutePath);
                    unset($existingFiles[$index]);
                }
            }
            $existingFiles = array_values($existingFiles);
        }

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $filesCount = count($_FILES['uploaded_files']['name']);
            $config = [
                'upload_path'   => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                'max_size'      => 50000,
                'encrypt_name'  => FALSE
            ];
            $this->load->library('upload');
            for ($i = 0; $i < $filesCount; $i++) {
                $_FILES['file'] = [
                    'name'     => $_FILES['uploaded_files']['name'][$i],
                    'type'     => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error'    => $_FILES['uploaded_files']['error'][$i],
                    'size'     => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $uploadData = $this->upload->data();
                    $existingFiles[] = [
                        'url'  => base_url('api/file_uploads/' . $uploadData['file_name']),
                        'name' => $uploadData['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = array_values($existingFiles);

        foreach ($_POST as $key => $value) {
            if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                $dataset[$key] = $value;
            }
        }

        // KPI: Prescription Error Rate
        $prescription_errors = intval($this->input->post('prescription_errors')) ?: 0;
        $total_prescriptions = intval($this->input->post('total_prescriptions')) ?: 0;
        $error_rate = ($total_prescriptions > 0) ? ($prescription_errors / $total_prescriptions) * 100 : 0;
        $dataset['prescription_error_rate'] = round($error_rate, 2);

        $data = ['dataset' => json_encode($dataset)];
        $this->quality_model->update_feedback_CQI3c11($id, $data);
        redirect('quality/patient_feedback_CQI3c11?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3c11_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3c11', $data);
    }
}
// CQI3c12 - Empirical Antibiotics therapy compliance rate (Clinical Pharmacy)
public function edit_feedback_CQI3c12() {
    if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
        $this->session->set_userdata('referred_from', current_url());
    } else {
        $this->session->set_userdata('referred_from', NULL);
    }

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        if (isfeature_active('QUALITY-DASHBOARD') === true) {
            $data['content'] = $this->load->view('qualitymodules/edit_feedback_CQI3c12', $data, true);
        } else {
            $data['content'] = $this->load->view('qualitymodules/dephead/edit_feedback_CQI3c12', $data, true);
        }
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3c12_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3c12_byid($id);
        $dataset = json_decode($existing->dataset, true);
        if (!is_array($dataset)) $dataset = [];

        // File upload/removal logic
        $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        if (!empty($removeIndexes)) {
            foreach ($removeIndexes as $index) {
                if (isset($existingFiles[$index])) {
                    $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                    $absolutePath = FCPATH . $oldFilePath;
                    if (file_exists($absolutePath)) @unlink($absolutePath);
                    unset($existingFiles[$index]);
                }
            }
            $existingFiles = array_values($existingFiles);
        }

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $filesCount = count($_FILES['uploaded_files']['name']);
            $config = [
                'upload_path'   => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                'max_size'      => 50000,
                'encrypt_name'  => FALSE
            ];
            $this->load->library('upload');
            for ($i = 0; $i < $filesCount; $i++) {
                $_FILES['file'] = [
                    'name'     => $_FILES['uploaded_files']['name'][$i],
                    'type'     => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error'    => $_FILES['uploaded_files']['error'][$i],
                    'size'     => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $uploadData = $this->upload->data();
                    $existingFiles[] = [
                        'url'  => base_url('api/file_uploads/' . $uploadData['file_name']),
                        'name' => $uploadData['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = array_values($existingFiles);

        foreach ($_POST as $key => $value) {
            if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                $dataset[$key] = $value;
            }
        }

        // KPI: Empirical Antibiotic Compliance Rate
        $compliant_cases = intval($this->input->post('compliant_cases')) ?: 0;
        $total_cases = intval($this->input->post('total_cases')) ?: 0;
        $rate = ($total_cases > 0) ? ($compliant_cases / $total_cases) * 100 : 0;
        $dataset['empirical_compliance_rate'] = round($rate, 2);

        $data = ['dataset' => json_encode($dataset)];
        $this->quality_model->update_feedback_CQI3c12($id, $data);
        redirect('quality/patient_feedback_CQI3c12?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3c12_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3c12', $data);
    }
}
// CQI3c13 - Restricted antibiotics usage compliance rate (JCI8-MMU1.1) (Clinical Pharmacy)
public function edit_feedback_CQI3c13() {
    if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
        $this->session->set_userdata('referred_from', current_url());
    } else {
        $this->session->set_userdata('referred_from', NULL);
    }

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        if (isfeature_active('QUALITY-DASHBOARD') === true) {
            $data['content'] = $this->load->view('qualitymodules/edit_feedback_CQI3c13', $data, true);
        } else {
            $data['content'] = $this->load->view('qualitymodules/dephead/edit_feedback_CQI3c13', $data, true);
        }
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3c13_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3c13_byid($id);
        $dataset = json_decode($existing->dataset, true);
        if (!is_array($dataset)) $dataset = [];

        // File upload/removal logic
        $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        if (!empty($removeIndexes)) {
            foreach ($removeIndexes as $index) {
                if (isset($existingFiles[$index])) {
                    $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                    $absolutePath = FCPATH . $oldFilePath;
                    if (file_exists($absolutePath)) @unlink($absolutePath);
                    unset($existingFiles[$index]);
                }
            }
            $existingFiles = array_values($existingFiles);
        }

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $filesCount = count($_FILES['uploaded_files']['name']);
            $config = [
                'upload_path'   => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                'max_size'      => 50000,
                'encrypt_name'  => FALSE
            ];
            $this->load->library('upload');
            for ($i = 0; $i < $filesCount; $i++) {
                $_FILES['file'] = [
                    'name'     => $_FILES['uploaded_files']['name'][$i],
                    'type'     => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error'    => $_FILES['uploaded_files']['error'][$i],
                    'size'     => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $uploadData = $this->upload->data();
                    $existingFiles[] = [
                        'url'  => base_url('api/file_uploads/' . $uploadData['file_name']),
                        'name' => $uploadData['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = array_values($existingFiles);

        foreach ($_POST as $key => $value) {
            if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                $dataset[$key] = $value;
            }
        }

        // KPI: Restricted Antibiotics Compliance Rate
        $restricted_compliant_cases = intval($this->input->post('restricted_compliant_cases')) ?: 0;
        $total_restricted_cases = intval($this->input->post('total_restricted_cases')) ?: 0;
        $rate = ($total_restricted_cases > 0) ? ($restricted_compliant_cases / $total_restricted_cases) * 100 : 0;
        $dataset['restricted_compliance_rate'] = round($rate, 2);

        $data = ['dataset' => json_encode($dataset)];
        $this->quality_model->update_feedback_CQI3c13($id, $data);
        redirect('quality/patient_feedback_CQI3c13?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3c13_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3c13', $data);
    }
}


// CQI3c14 - Monitor data related to appropriateness of indication for the new drugs (JCI8-MMU2.0) (Clinical Pharmacy)
public function edit_feedback_CQI3c14() {
    if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
        $this->session->set_userdata('referred_from', current_url());
    } else {
        $this->session->set_userdata('referred_from', NULL);
    }

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        if (isfeature_active('QUALITY-DASHBOARD') === true) {
            $data['content'] = $this->load->view('qualitymodules/edit_feedback_CQI3c14', $data, true);
        } else {
            $data['content'] = $this->load->view('qualitymodules/dephead/edit_feedback_CQI3c14', $data, true);
        }
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3c14_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3c14_byid($id);
        $dataset = json_decode($existing->dataset, true);
        if (!is_array($dataset)) $dataset = [];

        // File upload/removal logic
        $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        if (!empty($removeIndexes)) {
            foreach ($removeIndexes as $index) {
                if (isset($existingFiles[$index])) {
                    $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                    $absolutePath = FCPATH . $oldFilePath;
                    if (file_exists($absolutePath)) @unlink($absolutePath);
                    unset($existingFiles[$index]);
                }
            }
            $existingFiles = array_values($existingFiles);
        }

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $filesCount = count($_FILES['uploaded_files']['name']);
            $config = [
                'upload_path'   => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                'max_size'      => 50000,
                'encrypt_name'  => FALSE
            ];
            $this->load->library('upload');
            for ($i = 0; $i < $filesCount; $i++) {
                $_FILES['file'] = [
                    'name'     => $_FILES['uploaded_files']['name'][$i],
                    'type'     => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error'    => $_FILES['uploaded_files']['error'][$i],
                    'size'     => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $uploadData = $this->upload->data();
                    $existingFiles[] = [
                        'url'  => base_url('api/file_uploads/' . $uploadData['file_name']),
                        'name' => $uploadData['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = array_values($existingFiles);

        foreach ($_POST as $key => $value) {
            if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                $dataset[$key] = $value;
            }
        }

        // KPI: Appropriateness Rate for New Drugs
        $appropriate_cases = intval($this->input->post('appropriate_cases')) ?: 0;
        $total_new_drugs = intval($this->input->post('total_new_drugs')) ?: 0;
        $rate = ($total_new_drugs > 0) ? ($appropriate_cases / $total_new_drugs) * 100 : 0;
        $dataset['appropriateness_rate'] = round($rate, 2);

        $data = ['dataset' => json_encode($dataset)];
        $this->quality_model->update_feedback_CQI3c14($id, $data);
        redirect('quality/patient_feedback_CQI3c14?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3c14_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3c14', $data);
    }
}


// CQI3d1 - Percentage of modification of anaesthesia plan (OT - Anaesthesia)
public function edit_feedback_CQI3d1() {
    if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
        $this->session->set_userdata('referred_from', current_url());
    } else {
        $this->session->set_userdata('referred_from', NULL);
    }

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        if (isfeature_active('QUALITY-DASHBOARD') === true) {
            $data['content'] = $this->load->view('qualitymodules/edit_feedback_CQI3d1', $data, true);
        } else {
            $data['content'] = $this->load->view('qualitymodules/dephead/edit_feedback_CQI3d1', $data, true);
        }
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3d1_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3d1_byid($id);
        $dataset = json_decode($existing->dataset, true);
        if (!is_array($dataset)) $dataset = [];

        // File upload/removal logic
        $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        if (!empty($removeIndexes)) {
            foreach ($removeIndexes as $index) {
                if (isset($existingFiles[$index])) {
                    $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                    $absolutePath = FCPATH . $oldFilePath;
                    if (file_exists($absolutePath)) @unlink($absolutePath);
                    unset($existingFiles[$index]);
                }
            }
            $existingFiles = array_values($existingFiles);
        }

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $filesCount = count($_FILES['uploaded_files']['name']);
            $config = [
                'upload_path'   => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                'max_size'      => 50000,
                'encrypt_name'  => FALSE
            ];
            $this->load->library('upload');
            for ($i = 0; $i < $filesCount; $i++) {
                $_FILES['file'] = [
                    'name'     => $_FILES['uploaded_files']['name'][$i],
                    'type'     => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error'    => $_FILES['uploaded_files']['error'][$i],
                    'size'     => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $uploadData = $this->upload->data();
                    $existingFiles[] = [
                        'url'  => base_url('api/file_uploads/' . $uploadData['file_name']),
                        'name' => $uploadData['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = array_values($existingFiles);

        foreach ($_POST as $key => $value) {
            if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                $dataset[$key] = $value;
            }
        }

        // KPI: Modification of Anaesthesia Plan Rate
        $modified_cases = intval($this->input->post('modified_cases')) ?: 0;
        $total_anaesthesia_cases = intval($this->input->post('total_anaesthesia_cases')) ?: 0;
        $rate = ($total_anaesthesia_cases > 0) ? ($modified_cases / $total_anaesthesia_cases) * 100 : 0;
        $dataset['modification_rate'] = round($rate, 2);

        $data = ['dataset' => json_encode($dataset)];
        $this->quality_model->update_feedback_CQI3d1($id, $data);
        redirect('quality/patient_feedback_CQI3d1?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3d1_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3d1', $data);
    }
}


// CQI3d2 - Percentage of unplanned ventilation following anaesthesia (OT - Anaesthesia)
public function edit_feedback_CQI3d2() {
    if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
        $this->session->set_userdata('referred_from', current_url());
    } else {
        $this->session->set_userdata('referred_from', NULL);
    }

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        if (isfeature_active('QUALITY-DASHBOARD') === true) {
            $data['content'] = $this->load->view('qualitymodules/edit_feedback_CQI3d2', $data, true);
        } else {
            $data['content'] = $this->load->view('qualitymodules/dephead/edit_feedback_CQI3d2', $data, true);
        }
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3d2_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3d2_byid($id);
        $dataset = json_decode($existing->dataset, true);
        if (!is_array($dataset)) $dataset = [];

        // File upload/removal logic
        $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        if (!empty($removeIndexes)) {
            foreach ($removeIndexes as $index) {
                if (isset($existingFiles[$index])) {
                    $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                    $absolutePath = FCPATH . $oldFilePath;
                    if (file_exists($absolutePath)) @unlink($absolutePath);
                    unset($existingFiles[$index]);
                }
            }
            $existingFiles = array_values($existingFiles);
        }

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $filesCount = count($_FILES['uploaded_files']['name']);
            $config = [
                'upload_path'   => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                'max_size'      => 50000,
                'encrypt_name'  => FALSE
            ];
            $this->load->library('upload');
            for ($i = 0; $i < $filesCount; $i++) {
                $_FILES['file'] = [
                    'name'     => $_FILES['uploaded_files']['name'][$i],
                    'type'     => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error'    => $_FILES['uploaded_files']['error'][$i],
                    'size'     => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $uploadData = $this->upload->data();
                    $existingFiles[] = [
                        'url'  => base_url('api/file_uploads/' . $uploadData['file_name']),
                        'name' => $uploadData['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = array_values($existingFiles);

        foreach ($_POST as $key => $value) {
            if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                $dataset[$key] = $value;
            }
        }

        // KPI: Unplanned Ventilation Rate
        $unplanned_ventilations = intval($this->input->post('unplanned_ventilations')) ?: 0;
        $total_anaesthesia_cases = intval($this->input->post('total_anaesthesia_cases')) ?: 0;
        $rate = ($total_anaesthesia_cases > 0) ? ($unplanned_ventilations / $total_anaesthesia_cases) * 100 : 0;
        $dataset['unplanned_ventilation_rate'] = round($rate, 2);

        $data = ['dataset' => json_encode($dataset)];
        $this->quality_model->update_feedback_CQI3d2($id, $data);
        redirect('quality/patient_feedback_CQI3d2?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3d2_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3d2', $data);
    }
}


// CQI3d3 - Percentage of adverse anaesthesia events following anaesthesia (OT - Anaesthesia)
public function edit_feedback_CQI3d3() {
    if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
        $this->session->set_userdata('referred_from', current_url());
    } else {
        $this->session->set_userdata('referred_from', NULL);
    }

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        if (isfeature_active('QUALITY-DASHBOARD') === true) {
            $data['content'] = $this->load->view('qualitymodules/edit_feedback_CQI3d3', $data, true);
        } else {
            $data['content'] = $this->load->view('qualitymodules/dephead/edit_feedback_CQI3d3', $data, true);
        }
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3d3_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3d3_byid($id);
        $dataset = json_decode($existing->dataset, true);
        if (!is_array($dataset)) $dataset = [];

        // File upload/removal logic
        $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        if (!empty($removeIndexes)) {
            foreach ($removeIndexes as $index) {
                if (isset($existingFiles[$index])) {
                    $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                    $absolutePath = FCPATH . $oldFilePath;
                    if (file_exists($absolutePath)) @unlink($absolutePath);
                    unset($existingFiles[$index]);
                }
            }
            $existingFiles = array_values($existingFiles);
        }

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $filesCount = count($_FILES['uploaded_files']['name']);
            $config = [
                'upload_path'   => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                'max_size'      => 50000,
                'encrypt_name'  => FALSE
            ];
            $this->load->library('upload');
            for ($i = 0; $i < $filesCount; $i++) {
                $_FILES['file'] = [
                    'name'     => $_FILES['uploaded_files']['name'][$i],
                    'type'     => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error'    => $_FILES['uploaded_files']['error'][$i],
                    'size'     => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $uploadData = $this->upload->data();
                    $existingFiles[] = [
                        'url'  => base_url('api/file_uploads/' . $uploadData['file_name']),
                        'name' => $uploadData['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = array_values($existingFiles);

        foreach ($_POST as $key => $value) {
            if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                $dataset[$key] = $value;
            }
        }

        // KPI: Adverse Anaesthesia Event Rate
        $adverse_events = intval($this->input->post('adverse_events')) ?: 0;
        $total_anaesthesia_cases = intval($this->input->post('total_anaesthesia_cases')) ?: 0;
        $rate = ($total_anaesthesia_cases > 0) ? ($adverse_events / $total_anaesthesia_cases) * 100 : 0;
        $dataset['adverse_event_rate'] = round($rate, 2);

        $data = ['dataset' => json_encode($dataset)];
        $this->quality_model->update_feedback_CQI3d3($id, $data);
        redirect('quality/patient_feedback_CQI3d3?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3d3_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3d3', $data);
    }
}


// CQI3d4 - Anaesthesia related mortality rate (OT - Anaesthesia)
public function edit_feedback_CQI3d4() {
    if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
        $this->session->set_userdata('referred_from', current_url());
    } else {
        $this->session->set_userdata('referred_from', NULL);
    }

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        if (isfeature_active('QUALITY-DASHBOARD') === true) {
            $data['content'] = $this->load->view('qualitymodules/edit_feedback_CQI3d4', $data, true);
        } else {
            $data['content'] = $this->load->view('qualitymodules/dephead/edit_feedback_CQI3d4', $data, true);
        }
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3d4_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3d4_byid($id);
        $dataset = json_decode($existing->dataset, true);
        if (!is_array($dataset)) $dataset = [];

        // File upload/removal logic
        $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        if (!empty($removeIndexes)) {
            foreach ($removeIndexes as $index) {
                if (isset($existingFiles[$index])) {
                    $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                    $absolutePath = FCPATH . $oldFilePath;
                    if (file_exists($absolutePath)) @unlink($absolutePath);
                    unset($existingFiles[$index]);
                }
            }
            $existingFiles = array_values($existingFiles);
        }

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $filesCount = count($_FILES['uploaded_files']['name']);
            $config = [
                'upload_path'   => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                'max_size'      => 50000,
                'encrypt_name'  => FALSE
            ];
            $this->load->library('upload');
            for ($i = 0; $i < $filesCount; $i++) {
                $_FILES['file'] = [
                    'name'     => $_FILES['uploaded_files']['name'][$i],
                    'type'     => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error'    => $_FILES['uploaded_files']['error'][$i],
                    'size'     => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $uploadData = $this->upload->data();
                    $existingFiles[] = [
                        'url'  => base_url('api/file_uploads/' . $uploadData['file_name']),
                        'name' => $uploadData['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = array_values($existingFiles);

        foreach ($_POST as $key => $value) {
            if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                $dataset[$key] = $value;
            }
        }

        // KPI: Anaesthesia Mortality Rate
        $anaesthesia_deaths = intval($this->input->post('anaesthesia_deaths')) ?: 0;
        $total_anaesthesia_cases = intval($this->input->post('total_anaesthesia_cases')) ?: 0;
        $rate = ($total_anaesthesia_cases > 0) ? ($anaesthesia_deaths / $total_anaesthesia_cases) * 100 : 0;
        $dataset['anaesthesia_mortality_rate'] = round($rate, 2);

        $data = ['dataset' => json_encode($dataset)];
        $this->quality_model->update_feedback_CQI3d4($id, $data);
        redirect('quality/patient_feedback_CQI3d4?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3d4_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3d4', $data);
    }
}


// CQI3d5 - Percentage of safe and rational prescriptions (Clinical Pharmacy - IP-Pharmacy)
public function edit_feedback_CQI3d5() {
    if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
        $this->session->set_userdata('referred_from', current_url());
    } else {
        $this->session->set_userdata('referred_from', NULL);
    }

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        if (isfeature_active('QUALITY-DASHBOARD') === true) {
            $data['content'] = $this->load->view('qualitymodules/edit_feedback_CQI3d5', $data, true);
        } else {
            $data['content'] = $this->load->view('qualitymodules/dephead/edit_feedback_CQI3d5', $data, true);
        }
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3d5_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3d5_byid($id);
        $dataset = json_decode($existing->dataset, true);
        if (!is_array($dataset)) $dataset = [];

        // File upload/removal logic
        $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        if (!empty($removeIndexes)) {
            foreach ($removeIndexes as $index) {
                if (isset($existingFiles[$index])) {
                    $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                    $absolutePath = FCPATH . $oldFilePath;
                    if (file_exists($absolutePath)) @unlink($absolutePath);
                    unset($existingFiles[$index]);
                }
            }
            $existingFiles = array_values($existingFiles);
        }

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $filesCount = count($_FILES['uploaded_files']['name']);
            $config = [
                'upload_path'   => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                'max_size'      => 50000,
                'encrypt_name'  => FALSE
            ];
            $this->load->library('upload');
            for ($i = 0; $i < $filesCount; $i++) {
                $_FILES['file'] = [
                    'name'     => $_FILES['uploaded_files']['name'][$i],
                    'type'     => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error'    => $_FILES['uploaded_files']['error'][$i],
                    'size'     => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $uploadData = $this->upload->data();
                    $existingFiles[] = [
                        'url'  => base_url('api/file_uploads/' . $uploadData['file_name']),
                        'name' => $uploadData['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = array_values($existingFiles);

        foreach ($_POST as $key => $value) {
            if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                $dataset[$key] = $value;
            }
        }

        // KPI: Safe & Rational Prescription Rate
        $safe_prescriptions = intval($this->input->post('safe_prescriptions')) ?: 0;
        $total_prescriptions = intval($this->input->post('total_prescriptions')) ?: 0;
        $rate = ($total_prescriptions > 0) ? ($safe_prescriptions / $total_prescriptions) * 100 : 0;
        $dataset['safe_prescription_rate'] = round($rate, 2);

        $data = ['dataset' => json_encode($dataset)];
        $this->quality_model->update_feedback_CQI3d5($id, $data);
        redirect('quality/patient_feedback_CQI3d5?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3d5_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3d5', $data);
    }
}
// CQI3e1 - Percentage of unplanned return to OT (OT)
public function edit_feedback_CQI3e1() {
    if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
        $this->session->set_userdata('referred_from', current_url());
    } else {
        $this->session->set_userdata('referred_from', NULL);
    }

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        if (isfeature_active('QUALITY-DASHBOARD') === true) {
            $data['content'] = $this->load->view('qualitymodules/edit_feedback_CQI3e1', $data, true);
        } else {
            $data['content'] = $this->load->view('qualitymodules/dephead/edit_feedback_CQI3e1', $data, true);
        }
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3e1_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3e1_byid($id);
        $dataset = json_decode($existing->dataset, true);
        if (!is_array($dataset)) $dataset = [];

        // File upload/removal logic
        $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        if (!empty($removeIndexes)) {
            foreach ($removeIndexes as $index) {
                if (isset($existingFiles[$index])) {
                    $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                    $absolutePath = FCPATH . $oldFilePath;
                    if (file_exists($absolutePath)) @unlink($absolutePath);
                    unset($existingFiles[$index]);
                }
            }
            $existingFiles = array_values($existingFiles);
        }

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $filesCount = count($_FILES['uploaded_files']['name']);
            $config = [
                'upload_path'   => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                'max_size'      => 50000,
                'encrypt_name'  => FALSE
            ];
            $this->load->library('upload');
            for ($i = 0; $i < $filesCount; $i++) {
                $_FILES['file'] = [
                    'name'     => $_FILES['uploaded_files']['name'][$i],
                    'type'     => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error'    => $_FILES['uploaded_files']['error'][$i],
                    'size'     => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $uploadData = $this->upload->data();
                    $existingFiles[] = [
                        'url'  => base_url('api/file_uploads/' . $uploadData['file_name']),
                        'name' => $uploadData['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = array_values($existingFiles);

        foreach ($_POST as $key => $value) {
            if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                $dataset[$key] = $value;
            }
        }

        // KPI: Percentage of unplanned return to OT
        $unplanned_return_cases = intval($this->input->post('unplanned_return_cases')) ?: 0;
        $total_surgeries = intval($this->input->post('total_surgeries')) ?: 0;
        $rate = ($total_surgeries > 0) ? ($unplanned_return_cases / $total_surgeries) * 100 : 0;
        $dataset['unplanned_return_rate'] = round($rate, 2);

        $data = ['dataset' => json_encode($dataset)];
        $this->quality_model->update_feedback_CQI3e1($id, $data);
        redirect('quality/patient_feedback_CQI3e1?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3e1_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3e1', $data);
    }
}


// CQI3e2 - Percentage of rescheduling of surgeries (OT)
public function edit_feedback_CQI3e2() {
    if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
        $this->session->set_userdata('referred_from', current_url());
    } else {
        $this->session->set_userdata('referred_from', NULL);
    }

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        if (isfeature_active('QUALITY-DASHBOARD') === true) {
            $data['content'] = $this->load->view('qualitymodules/edit_feedback_CQI3e2', $data, true);
        } else {
            $data['content'] = $this->load->view('qualitymodules/dephead/edit_feedback_CQI3e2', $data, true);
        }
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3e2_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3e2_byid($id);
        $dataset = json_decode($existing->dataset, true);
        if (!is_array($dataset)) $dataset = [];

        // File upload/removal logic same as above
        $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        if (!empty($removeIndexes)) {
            foreach ($removeIndexes as $index) {
                if (isset($existingFiles[$index])) {
                    $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                    $absolutePath = FCPATH . $oldFilePath;
                    if (file_exists($absolutePath)) @unlink($absolutePath);
                    unset($existingFiles[$index]);
                }
            }
            $existingFiles = array_values($existingFiles);
        }

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $filesCount = count($_FILES['uploaded_files']['name']);
            $config = [
                'upload_path'   => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                'max_size'      => 50000,
                'encrypt_name'  => FALSE
            ];
            $this->load->library('upload');
            for ($i = 0; $i < $filesCount; $i++) {
                $_FILES['file'] = [
                    'name'     => $_FILES['uploaded_files']['name'][$i],
                    'type'     => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error'    => $_FILES['uploaded_files']['error'][$i],
                    'size'     => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $uploadData = $this->upload->data();
                    $existingFiles[] = [
                        'url'  => base_url('api/file_uploads/' . $uploadData['file_name']),
                        'name' => $uploadData['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = array_values($existingFiles);

        foreach ($_POST as $key => $value) {
            if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                $dataset[$key] = $value;
            }
        }

        // KPI: Percentage of rescheduled surgeries
        $rescheduled_cases = intval($this->input->post('rescheduled_cases')) ?: 0;
        $total_surgeries = intval($this->input->post('total_surgeries')) ?: 0;
        $rate = ($total_surgeries > 0) ? ($rescheduled_cases / $total_surgeries) * 100 : 0;
        $dataset['rescheduled_rate'] = round($rate, 2);

        $data = ['dataset' => json_encode($dataset)];
        $this->quality_model->update_feedback_CQI3e2($id, $data);
        redirect('quality/patient_feedback_CQI3e2?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3e2_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3e2', $data);
    }
}
// CQI3e3 - Percentage of cases where organisationâ€™s procedure to prevent surgery errors (wrong site, wrong procedure, wrong patient) have been adhered (OT)
public function edit_feedback_CQI3e3() {
    if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
        $this->session->set_userdata('referred_from', current_url());
    } else {
        $this->session->set_userdata('referred_from', NULL);
    }

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        if (isfeature_active('QUALITY-DASHBOARD') === true) {
            $data['content'] = $this->load->view('qualitymodules/edit_feedback_CQI3e3', $data, true);
        } else {
            $data['content'] = $this->load->view('qualitymodules/dephead/edit_feedback_CQI3e3', $data, true);
        }
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3e3_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3e3_byid($id);
        $dataset = json_decode($existing->dataset, true);
        if (!is_array($dataset)) $dataset = [];

        // File upload/removal logic
        $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        if (!empty($removeIndexes)) {
            foreach ($removeIndexes as $index) {
                if (isset($existingFiles[$index])) {
                    $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                    $absolutePath = FCPATH . $oldFilePath;
                    if (file_exists($absolutePath)) @unlink($absolutePath);
                    unset($existingFiles[$index]);
                }
            }
            $existingFiles = array_values($existingFiles);
        }

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $filesCount = count($_FILES['uploaded_files']['name']);
            $config = [
                'upload_path'   => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                'max_size'      => 50000,
                'encrypt_name'  => FALSE
            ];
            $this->load->library('upload');
            for ($i = 0; $i < $filesCount; $i++) {
                $_FILES['file'] = [
                    'name'     => $_FILES['uploaded_files']['name'][$i],
                    'type'     => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error'    => $_FILES['uploaded_files']['error'][$i],
                    'size'     => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $uploadData = $this->upload->data();
                    $existingFiles[] = [
                        'url'  => base_url('api/file_uploads/' . $uploadData['file_name']),
                        'name' => $uploadData['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = array_values($existingFiles);

        foreach ($_POST as $key => $value) {
            if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                $dataset[$key] = $value;
            }
        }

        // KPI: Percentage of cases adhering to surgery error prevention protocol
        $cases_adhered = intval($this->input->post('cases_adhered')) ?: 0;
        $total_cases = intval($this->input->post('total_cases')) ?: 0;
        $rate = ($total_cases > 0) ? ($cases_adhered / $total_cases) * 100 : 0;
        $dataset['adherence_rate'] = round($rate, 2);

        $data = ['dataset' => json_encode($dataset)];
        $this->quality_model->update_feedback_CQI3e3($id, $data);
        redirect('quality/patient_feedback_CQI3e3?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3e3_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3e3', $data);
    }
}


// CQI3e4 - Percentage of cases receiving appropriate prophylactic antibiotics within specified time frame (Clinical Pharmacy)
public function edit_feedback_CQI3e4() {
    if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
        $this->session->set_userdata('referred_from', current_url());
    } else {
        $this->session->set_userdata('referred_from', NULL);
    }

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        if (isfeature_active('QUALITY-DASHBOARD') === true) {
            $data['content'] = $this->load->view('qualitymodules/edit_feedback_CQI3e4', $data, true);
        } else {
            $data['content'] = $this->load->view('qualitymodules/dephead/edit_feedback_CQI3e4', $data, true);
        }
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3e4_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3e4_byid($id);
        $dataset = json_decode($existing->dataset, true);
        if (!is_array($dataset)) $dataset = [];

        // File upload/removal logic
        $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        if (!empty($removeIndexes)) {
            foreach ($removeIndexes as $index) {
                if (isset($existingFiles[$index])) {
                    $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                    $absolutePath = FCPATH . $oldFilePath;
                    if (file_exists($absolutePath)) @unlink($absolutePath);
                    unset($existingFiles[$index]);
                }
            }
            $existingFiles = array_values($existingFiles);
        }

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $filesCount = count($_FILES['uploaded_files']['name']);
            $config = [
                'upload_path'   => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                'max_size'      => 50000,
                'encrypt_name'  => FALSE
            ];
            $this->load->library('upload');
            for ($i = 0; $i < $filesCount; $i++) {
                $_FILES['file'] = [
                    'name'     => $_FILES['uploaded_files']['name'][$i],
                    'type'     => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error'    => $_FILES['uploaded_files']['error'][$i],
                    'size'     => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $uploadData = $this->upload->data();
                    $existingFiles[] = [
                        'url'  => base_url('api/file_uploads/' . $uploadData['file_name']),
                        'name' => $uploadData['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = array_values($existingFiles);

        foreach ($_POST as $key => $value) {
            if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                $dataset[$key] = $value;
            }
        }

        // KPI: Percentage of appropriate prophylactic antibiotic administration
        $appropriate_cases = intval($this->input->post('appropriate_cases')) ?: 0;
        $total_cases = intval($this->input->post('total_cases')) ?: 0;
        $rate = ($total_cases > 0) ? ($appropriate_cases / $total_cases) * 100 : 0;
        $dataset['appropriate_antibiotic_rate'] = round($rate, 2);

        $data = ['dataset' => json_encode($dataset)];
        $this->quality_model->update_feedback_CQI3e4($id, $data);
        redirect('quality/patient_feedback_CQI3e4?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3e4_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3e4', $data);
    }
}


// CQI3e5 - Percentage of cases where the planned surgery was changed intraoperatively (OT)
public function edit_feedback_CQI3e5() {
    if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
        $this->session->set_userdata('referred_from', current_url());
    } else {
        $this->session->set_userdata('referred_from', NULL);
    }

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        if (isfeature_active('QUALITY-DASHBOARD') === true) {
            $data['content'] = $this->load->view('qualitymodules/edit_feedback_CQI3e5', $data, true);
        } else {
            $data['content'] = $this->load->view('qualitymodules/dephead/edit_feedback_CQI3e5', $data, true);
        }
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3e5_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3e5_byid($id);
        $dataset = json_decode($existing->dataset, true);
        if (!is_array($dataset)) $dataset = [];

        // File upload/removal logic
        $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        if (!empty($removeIndexes)) {
            foreach ($removeIndexes as $index) {
                if (isset($existingFiles[$index])) {
                    $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                    $absolutePath = FCPATH . $oldFilePath;
                    if (file_exists($absolutePath)) @unlink($absolutePath);
                    unset($existingFiles[$index]);
                }
            }
            $existingFiles = array_values($existingFiles);
        }

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $filesCount = count($_FILES['uploaded_files']['name']);
            $config = [
                'upload_path'   => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                'max_size'      => 50000,
                'encrypt_name'  => FALSE
            ];
            $this->load->library('upload');
            for ($i = 0; $i < $filesCount; $i++) {
                $_FILES['file'] = [
                    'name'     => $_FILES['uploaded_files']['name'][$i],
                    'type'     => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error'    => $_FILES['uploaded_files']['error'][$i],
                    'size'     => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $uploadData = $this->upload->data();
                    $existingFiles[] = [
                        'url'  => base_url('api/file_uploads/' . $uploadData['file_name']),
                        'name' => $uploadData['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = array_values($existingFiles);

        foreach ($_POST as $key => $value) {
            if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                $dataset[$key] = $value;
            }
        }

        // KPI: Percentage of cases with intraoperative change in planned surgery
        $changed_cases = intval($this->input->post('changed_cases')) ?: 0;
        $total_surgeries = intval($this->input->post('total_surgeries')) ?: 0;
        $rate = ($total_surgeries > 0) ? ($changed_cases / $total_surgeries) * 100 : 0;
        $dataset['intraoperative_change_rate'] = round($rate, 2);

        $data = ['dataset' => json_encode($dataset)];
        $this->quality_model->update_feedback_CQI3e5($id, $data);
        redirect('quality/patient_feedback_CQI3e5?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3e5_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3e5', $data);
    }
}
// CQI3e6 - Re-exploration rate (OT)
public function edit_feedback_CQI3e6() {
    if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
        $this->session->set_userdata('referred_from', current_url());
    } else {
        $this->session->set_userdata('referred_from', NULL);
    }

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        if (isfeature_active('QUALITY-DASHBOARD') === true) {
            $data['content'] = $this->load->view('qualitymodules/edit_feedback_CQI3e6', $data, true);
        } else {
            $data['content'] = $this->load->view('qualitymodules/dephead/edit_feedback_CQI3e6', $data, true);
        }
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3e6_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3e6_byid($id);
        $dataset = json_decode($existing->dataset, true);
        if (!is_array($dataset)) $dataset = [];

        // File upload/removal
        $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        if (!empty($removeIndexes)) {
            foreach ($removeIndexes as $index) {
                if (isset($existingFiles[$index])) {
                    $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                    $absolutePath = FCPATH . $oldFilePath;
                    if (file_exists($absolutePath)) @unlink($absolutePath);
                    unset($existingFiles[$index]);
                }
            }
            $existingFiles = array_values($existingFiles);
        }

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $filesCount = count($_FILES['uploaded_files']['name']);
            $config = [
                'upload_path'   => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                'max_size'      => 50000,
                'encrypt_name'  => FALSE
            ];
            $this->load->library('upload');
            for ($i = 0; $i < $filesCount; $i++) {
                $_FILES['file'] = [
                    'name'     => $_FILES['uploaded_files']['name'][$i],
                    'type'     => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error'    => $_FILES['uploaded_files']['error'][$i],
                    'size'     => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $uploadData = $this->upload->data();
                    $existingFiles[] = [
                        'url'  => base_url('api/file_uploads/' . $uploadData['file_name']),
                        'name' => $uploadData['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = array_values($existingFiles);

        foreach ($_POST as $key => $value) {
            if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                $dataset[$key] = $value;
            }
        }

        // KPI: Re-exploration rate = (Re-explorations / Total Surgeries) * 100
        $re_explorations = intval($this->input->post('re_explorations')) ?: 0;
        $total_surgeries = intval($this->input->post('total_surgeries')) ?: 0;
        $rate = ($total_surgeries > 0) ? ($re_explorations / $total_surgeries) * 100 : 0;
        $dataset['re_exploration_rate'] = round($rate, 2);

        $data = ['dataset' => json_encode($dataset)];
        $this->quality_model->update_feedback_CQI3e6($id, $data);
        redirect('quality/patient_feedback_CQI3e6?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3e6_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3e6', $data);
    }
}
// CQI3e7 - Primary Cesarean Rate (Nursing - OBG)
public function edit_feedback_CQI3e7() {
    if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
        $this->session->set_userdata('referred_from', current_url());
    } else {
        $this->session->set_userdata('referred_from', NULL);
    }

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        if (isfeature_active('QUALITY-DASHBOARD') === true) {
            $data['content'] = $this->load->view('qualitymodules/edit_feedback_CQI3e7', $data, true);
        } else {
            $data['content'] = $this->load->view('qualitymodules/dephead/edit_feedback_CQI3e7', $data, true);
        }
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3e7_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3e7_byid($id);
        $dataset = json_decode($existing->dataset, true);
        if (!is_array($dataset)) $dataset = [];

        // File upload/removal logic (same as above)
        $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        if (!empty($removeIndexes)) {
            foreach ($removeIndexes as $index) {
                if (isset($existingFiles[$index])) {
                    $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                    $absolutePath = FCPATH . $oldFilePath;
                    if (file_exists($absolutePath)) @unlink($absolutePath);
                    unset($existingFiles[$index]);
                }
            }
            $existingFiles = array_values($existingFiles);
        }

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $filesCount = count($_FILES['uploaded_files']['name']);
            $config = [
                'upload_path'   => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                'max_size'      => 50000,
                'encrypt_name'  => FALSE
            ];
            $this->load->library('upload');
            for ($i = 0; $i < $filesCount; $i++) {
                $_FILES['file'] = [
                    'name'     => $_FILES['uploaded_files']['name'][$i],
                    'type'     => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error'    => $_FILES['uploaded_files']['error'][$i],
                    'size'     => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $uploadData = $this->upload->data();
                    $existingFiles[] = [
                        'url'  => base_url('api/file_uploads/' . $uploadData['file_name']),
                        'name' => $uploadData['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = array_values($existingFiles);

        foreach ($_POST as $key => $value) {
            if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                $dataset[$key] = $value;
            }
        }

        // KPI: Primary Cesarean Rate = (Primary Cesarean Deliveries / Total Deliveries) * 100
        $primary_cesareans = intval($this->input->post('primary_cesareans')) ?: 0;
        $total_deliveries = intval($this->input->post('total_deliveries')) ?: 0;
        $rate = ($total_deliveries > 0) ? ($primary_cesareans / $total_deliveries) * 100 : 0;
        $dataset['primary_cesarean_rate'] = round($rate, 2);

        $data = ['dataset' => json_encode($dataset)];
        $this->quality_model->update_feedback_CQI3e7($id, $data);
        redirect('quality/patient_feedback_CQI3e7?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3e7_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3e7', $data);
    }
}
// CQI3e8 - Adverse events related to implant devices (JCI8-ASC 4.4) - (OT)
public function edit_feedback_CQI3e8() {
    if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
        $this->session->set_userdata('referred_from', current_url());
    } else {
        $this->session->set_userdata('referred_from', NULL);
    }

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        if (isfeature_active('QUALITY-DASHBOARD') === true) {
            $data['content'] = $this->load->view('qualitymodules/edit_feedback_CQI3e8', $data, true);
        } else {
            $data['content'] = $this->load->view('qualitymodules/dephead/edit_feedback_CQI3e8', $data, true);
        }
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3e8_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3e8_byid($id);
        $dataset = json_decode($existing->dataset, true);
        if (!is_array($dataset)) $dataset = [];

        // File upload/removal logic
        $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        if (!empty($removeIndexes)) {
            foreach ($removeIndexes as $index) {
                if (isset($existingFiles[$index])) {
                    $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                    $absolutePath = FCPATH . $oldFilePath;
                    if (file_exists($absolutePath)) @unlink($absolutePath);
                    unset($existingFiles[$index]);
                }
            }
            $existingFiles = array_values($existingFiles);
        }

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $filesCount = count($_FILES['uploaded_files']['name']);
            $config = [
                'upload_path'   => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                'max_size'      => 50000,
                'encrypt_name'  => FALSE
            ];
            $this->load->library('upload');
            for ($i = 0; $i < $filesCount; $i++) {
                $_FILES['file'] = [
                    'name'     => $_FILES['uploaded_files']['name'][$i],
                    'type'     => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error'    => $_FILES['uploaded_files']['error'][$i],
                    'size'     => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $uploadData = $this->upload->data();
                    $existingFiles[] = [
                        'url'  => base_url('api/file_uploads/' . $uploadData['file_name']),
                        'name' => $uploadData['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = array_values($existingFiles);

        foreach ($_POST as $key => $value) {
            if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                $dataset[$key] = $value;
            }
        }

        // KPI: Adverse events related to implant devices = (Adverse Implant Events / Total Implant Cases) * 100
        $adverse_events = intval($this->input->post('adverse_events')) ?: 0;
        $total_implant_cases = intval($this->input->post('total_implant_cases')) ?: 0;
        $rate = ($total_implant_cases > 0) ? ($adverse_events / $total_implant_cases) * 100 : 0;
        $dataset['adverse_implant_event_rate'] = round($rate, 2);

        $data = ['dataset' => json_encode($dataset)];
        $this->quality_model->update_feedback_CQI3e8($id, $data);
        redirect('quality/patient_feedback_CQI3e8?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3e8_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3e8', $data);
    }
}
// CQI3e9 - All major patient safety events or errors related to surgical procedures (JCI8-QPS 3.04)
public function edit_feedback_CQI3e9() {
    if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
        $this->session->set_userdata('referred_from', current_url());
    } else {
        $this->session->set_userdata('referred_from', NULL);
    }

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        if (isfeature_active('QUALITY-DASHBOARD') === true) {
            $data['content'] = $this->load->view('qualitymodules/edit_feedback_CQI3e9', $data, true);
        } else {
            $data['content'] = $this->load->view('qualitymodules/dephead/edit_feedback_CQI3e9', $data, true);
        }
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3e9_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3e9_byid($id);
        $dataset = json_decode($existing->dataset, true);
        if (!is_array($dataset)) $dataset = [];

        // File upload/removal logic
        $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        if (!empty($removeIndexes)) {
            foreach ($removeIndexes as $index) {
                if (isset($existingFiles[$index])) {
                    $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                    $absolutePath = FCPATH . $oldFilePath;
                    if (file_exists($absolutePath)) @unlink($absolutePath);
                    unset($existingFiles[$index]);
                }
            }
            $existingFiles = array_values($existingFiles);
        }

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $filesCount = count($_FILES['uploaded_files']['name']);
            $config = [
                'upload_path'   => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                'max_size'      => 50000,
                'encrypt_name'  => FALSE
            ];
            $this->load->library('upload');
            for ($i = 0; $i < $filesCount; $i++) {
                $_FILES['file'] = [
                    'name'     => $_FILES['uploaded_files']['name'][$i],
                    'type'     => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error'    => $_FILES['uploaded_files']['error'][$i],
                    'size'     => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $uploadData = $this->upload->data();
                    $existingFiles[] = [
                        'url'  => base_url('api/file_uploads/' . $uploadData['file_name']),
                        'name' => $uploadData['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = array_values($existingFiles);

        foreach ($_POST as $key => $value) {
            if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                $dataset[$key] = $value;
            }
        }

        // KPI: Surgical safety event rate = (No. of Surgical Safety Events / Total Surgeries) * 100
        $safety_events = intval($this->input->post('safety_events')) ?: 0;
        $total_surgeries = intval($this->input->post('total_surgeries')) ?: 0;
        $rate = ($total_surgeries > 0) ? ($safety_events / $total_surgeries) * 100 : 0;
        $dataset['surgical_safety_event_rate'] = round($rate, 2);

        $data = ['dataset' => json_encode($dataset)];
        $this->quality_model->update_feedback_CQI3e9($id, $data);
        redirect('quality/patient_feedback_CQI3e9?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3e9_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3e9', $data);
    }
}
// ---------------------------------------------------------------------
// CQI3f1 - Percentage of transfusion reactions (PSQ3a) - (Blood Center)
// ---------------------------------------------------------------------
public function edit_feedback_CQI3f1() {
    if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
        $this->session->set_userdata('referred_from', current_url());
    } else {
        $this->session->set_userdata('referred_from', NULL);
    }

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        if (isfeature_active('QUALITY-DASHBOARD') === true) {
            $data['content'] = $this->load->view('qualitymodules/edit_feedback_CQI3f1', $data, true);
        } else {
            $data['content'] = $this->load->view('qualitymodules/dephead/edit_feedback_CQI3f1', $data, true);
        }
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3f1_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3f1_byid($id);
        $dataset = json_decode($existing->dataset, true);
        if (!is_array($dataset)) $dataset = [];

        // File handling
        $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        if (!empty($removeIndexes)) {
            foreach ($removeIndexes as $index) {
                if (isset($existingFiles[$index])) {
                    $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                    $absolutePath = FCPATH . $oldFilePath;
                    if (file_exists($absolutePath)) @unlink($absolutePath);
                    unset($existingFiles[$index]);
                }
            }
            $existingFiles = array_values($existingFiles);
        }

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $filesCount = count($_FILES['uploaded_files']['name']);
            $config = [
                'upload_path'   => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                'max_size'      => 50000,
                'encrypt_name'  => FALSE
            ];
            $this->load->library('upload');
            for ($i = 0; $i < $filesCount; $i++) {
                $_FILES['file'] = [
                    'name'     => $_FILES['uploaded_files']['name'][$i],
                    'type'     => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error'    => $_FILES['uploaded_files']['error'][$i],
                    'size'     => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $uploadData = $this->upload->data();
                    $existingFiles[] = [
                        'url'  => base_url('api/file_uploads/' . $uploadData['file_name']),
                        'name' => $uploadData['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = array_values($existingFiles);

        foreach ($_POST as $key => $value) {
            if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                $dataset[$key] = $value;
            }
        }

        // KPI Calculation: (No. of Transfusion Reactions / Total Transfusions) * 100
        $reactions = intval($this->input->post('transfusion_reactions')) ?: 0;
        $total_transfusions = intval($this->input->post('total_transfusions')) ?: 0;
        $rate = ($total_transfusions > 0) ? ($reactions / $total_transfusions) * 100 : 0;
        $dataset['transfusion_reaction_rate'] = round($rate, 2);

        $data = ['dataset' => json_encode($dataset)];
        $this->quality_model->update_feedback_CQI3f1($id, $data);
        redirect('quality/patient_feedback_CQI3f1?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3f1_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3f1', $data);
    }
}

// ---------------------------------------------------------------------
// CQI3f2 - Percentage of waste of blood and blood components among those issued (Blood Center)
// ---------------------------------------------------------------------
public function edit_feedback_CQI3f2() {
    if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
        $this->session->set_userdata('referred_from', current_url());
    } else {
        $this->session->set_userdata('referred_from', NULL);
    }

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        if (isfeature_active('QUALITY-DASHBOARD') === true) {
            $data['content'] = $this->load->view('qualitymodules/edit_feedback_CQI3f2', $data, true);
        } else {
            $data['content'] = $this->load->view('qualitymodules/dephead/edit_feedback_CQI3f2', $data, true);
        }
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3f2_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3f2_byid($id);
        $dataset = json_decode($existing->dataset, true);
        if (!is_array($dataset)) $dataset = [];

        // Handle files
        $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        if (!empty($removeIndexes)) {
            foreach ($removeIndexes as $index) {
                if (isset($existingFiles[$index])) {
                    $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                    $absolutePath = FCPATH . $oldFilePath;
                    if (file_exists($absolutePath)) @unlink($absolutePath);
                    unset($existingFiles[$index]);
                }
            }
            $existingFiles = array_values($existingFiles);
        }

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $filesCount = count($_FILES['uploaded_files']['name']);
            $config = [
                'upload_path'   => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                'max_size'      => 50000,
                'encrypt_name'  => FALSE
            ];
            $this->load->library('upload');
            for ($i = 0; $i < $filesCount; $i++) {
                $_FILES['file'] = [
                    'name'     => $_FILES['uploaded_files']['name'][$i],
                    'type'     => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error'    => $_FILES['uploaded_files']['error'][$i],
                    'size'     => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $uploadData = $this->upload->data();
                    $existingFiles[] = [
                        'url'  => base_url('api/file_uploads/' . $uploadData['file_name']),
                        'name' => $uploadData['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = array_values($existingFiles);

        foreach ($_POST as $key => $value) {
            if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                $dataset[$key] = $value;
            }
        }

        // KPI Calculation: (Wasted Blood Units / Total Blood Units Issued) * 100
        $wasted_units = intval($this->input->post('wasted_units')) ?: 0;
        $issued_units = intval($this->input->post('issued_units')) ?: 0;
        $rate = ($issued_units > 0) ? ($wasted_units / $issued_units) * 100 : 0;
        $dataset['blood_waste_rate_issued'] = round($rate, 2);

        $data = ['dataset' => json_encode($dataset)];
        $this->quality_model->update_feedback_CQI3f2($id, $data);
        redirect('quality/patient_feedback_CQI3f2?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3f2_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3f2', $data);
    }
}

// ---------------------------------------------------------------------
// CQI3f3 - Percentage of waste of blood and blood components among those stored (Blood Center)
// ---------------------------------------------------------------------
public function edit_feedback_CQI3f3() {
    if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
        $this->session->set_userdata('referred_from', current_url());
    } else {
        $this->session->set_userdata('referred_from', NULL);
    }

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        if (isfeature_active('QUALITY-DASHBOARD') === true) {
            $data['content'] = $this->load->view('qualitymodules/edit_feedback_CQI3f3', $data, true);
        } else {
            $data['content'] = $this->load->view('qualitymodules/dephead/edit_feedback_CQI3f3', $data, true);
        }
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3f3_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3f3_byid($id);
        $dataset = json_decode($existing->dataset, true);
        if (!is_array($dataset)) $dataset = [];

        // Handle files (same as above)
        $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        if (!empty($removeIndexes)) {
            foreach ($removeIndexes as $index) {
                if (isset($existingFiles[$index])) {
                    $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                    $absolutePath = FCPATH . $oldFilePath;
                    if (file_exists($absolutePath)) @unlink($absolutePath);
                    unset($existingFiles[$index]);
                }
            }
            $existingFiles = array_values($existingFiles);
        }

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $filesCount = count($_FILES['uploaded_files']['name']);
            $config = [
                'upload_path'   => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                'max_size'      => 50000,
                'encrypt_name'  => FALSE
            ];
            $this->load->library('upload');
            for ($i = 0; $i < $filesCount; $i++) {
                $_FILES['file'] = [
                    'name'     => $_FILES['uploaded_files']['name'][$i],
                    'type'     => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error'    => $_FILES['uploaded_files']['error'][$i],
                    'size'     => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $uploadData = $this->upload->data();
                    $existingFiles[] = [
                        'url'  => base_url('api/file_uploads/' . $uploadData['file_name']),
                        'name' => $uploadData['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = array_values($existingFiles);

        foreach ($_POST as $key => $value) {
            if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                $dataset[$key] = $value;
            }
        }

        // KPI Calculation: (Wasted Blood Units / Total Stored Units) * 100
        $wasted_stored_units = intval($this->input->post('wasted_stored_units')) ?: 0;
        $total_stored_units = intval($this->input->post('total_stored_units')) ?: 0;
        $rate = ($total_stored_units > 0) ? ($wasted_stored_units / $total_stored_units) * 100 : 0;
        $dataset['blood_waste_rate_stored'] = round($rate, 2);

        $data = ['dataset' => json_encode($dataset)];
        $this->quality_model->update_feedback_CQI3f3($id, $data);
        redirect('quality/patient_feedback_CQI3f3?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3f3_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3f3', $data);
    }
}

// ---------------------------------------------------------------------
// CQI3f4 - Percentage of number of blood component units used (Blood Center)
// ---------------------------------------------------------------------
public function edit_feedback_CQI3f4() {
    if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
        $this->session->set_userdata('referred_from', current_url());
    } else {
        $this->session->set_userdata('referred_from', NULL);
    }

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        if (isfeature_active('QUALITY-DASHBOARD') === true) {
            $data['content'] = $this->load->view('qualitymodules/edit_feedback_CQI3f4', $data, true);
        } else {
            $data['content'] = $this->load->view('qualitymodules/dephead/edit_feedback_CQI3f4', $data, true);
        }
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3f4_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3f4_byid($id);
        $dataset = json_decode($existing->dataset, true);
        if (!is_array($dataset)) $dataset = [];

        // Handle files
        $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        if (!empty($removeIndexes)) {
            foreach ($removeIndexes as $index) {
                if (isset($existingFiles[$index])) {
                    $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                    $absolutePath = FCPATH . $oldFilePath;
                    if (file_exists($absolutePath)) @unlink($absolutePath);
                    unset($existingFiles[$index]);
                }
            }
            $existingFiles = array_values($existingFiles);
        }

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $filesCount = count($_FILES['uploaded_files']['name']);
            $config = [
                'upload_path'   => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                'max_size'      => 50000,
                'encrypt_name'  => FALSE
            ];
            $this->load->library('upload');
            for ($i = 0; $i < $filesCount; $i++) {
                $_FILES['file'] = [
                    'name'     => $_FILES['uploaded_files']['name'][$i],
                    'type'     => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error'    => $_FILES['uploaded_files']['error'][$i],
                    'size'     => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $uploadData = $this->upload->data();
                    $existingFiles[] = [
                        'url'  => base_url('api/file_uploads/' . $uploadData['file_name']),
                        'name' => $uploadData['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = array_values($existingFiles);

        foreach ($_POST as $key => $value) {
            if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                $dataset[$key] = $value;
            }
        }

        // KPI: (Blood Units Used / Total Blood Units Available) * 100
        $used_units = intval($this->input->post('used_units')) ?: 0;
        $available_units = intval($this->input->post('available_units')) ?: 0;
        $rate = ($available_units > 0) ? ($used_units / $available_units) * 100 : 0;
        $dataset['blood_use_rate'] = round($rate, 2);

        $data = ['dataset' => json_encode($dataset)];
        $this->quality_model->update_feedback_CQI3f4($id, $data);
        redirect('quality/patient_feedback_CQI3f4?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3f4_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3f4', $data);
    }
}

// ---------------------------------------------------------------------
// CQI3f5 - Percentage of discard of blood components due to expiry (Blood Center)
// ---------------------------------------------------------------------
public function edit_feedback_CQI3f5() {
    if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
        $this->session->set_userdata('referred_from', current_url());
    } else {
        $this->session->set_userdata('referred_from', NULL);
    }

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        if (isfeature_active('QUALITY-DASHBOARD') === true) {
            $data['content'] = $this->load->view('qualitymodules/edit_feedback_CQI3f5', $data, true);
        } else {
            $data['content'] = $this->load->view('qualitymodules/dephead/edit_feedback_CQI3f5', $data, true);
        }
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3f5_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3f5_byid($id);
        $dataset = json_decode($existing->dataset, true);
        if (!is_array($dataset)) $dataset = [];

        // Handle files
        $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        if (!empty($removeIndexes)) {
            foreach ($removeIndexes as $index) {
                if (isset($existingFiles[$index])) {
                    $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                    $absolutePath = FCPATH . $oldFilePath;
                    if (file_exists($absolutePath)) @unlink($absolutePath);
                    unset($existingFiles[$index]);
                }
            }
            $existingFiles = array_values($existingFiles);
        }

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $filesCount = count($_FILES['uploaded_files']['name']);
            $config = [
                'upload_path'   => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                'max_size'      => 50000,
                'encrypt_name'  => FALSE
            ];
            $this->load->library('upload');
            for ($i = 0; $i < $filesCount; $i++) {
                $_FILES['file'] = [
                    'name'     => $_FILES['uploaded_files']['name'][$i],
                    'type'     => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error'    => $_FILES['uploaded_files']['error'][$i],
                    'size'     => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $uploadData = $this->upload->data();
                    $existingFiles[] = [
                        'url'  => base_url('api/file_uploads/' . $uploadData['file_name']),
                        'name' => $uploadData['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = array_values($existingFiles);

        foreach ($_POST as $key => $value) {
            if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                $dataset[$key] = $value;
            }
        }

        // KPI: (Units Discarded Due to Expiry / Total Units Prepared) * 100
        $expired_units = intval($this->input->post('expired_units')) ?: 0;
        $prepared_units = intval($this->input->post('prepared_units')) ?: 0;
        $rate = ($prepared_units > 0) ? ($expired_units / $prepared_units) * 100 : 0;
        $dataset['expiry_discard_rate'] = round($rate, 2);

        $data = ['dataset' => json_encode($dataset)];
        $this->quality_model->update_feedback_CQI3f5($id, $data);
        redirect('quality/patient_feedback_CQI3f5?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3f5_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3f5', $data);
    }
}
// ---------------------------------------------------------------------
// CQI3f6 - Adverse events and near miss events involving blood bank and/or transfusion services (Blood Center)
// ---------------------------------------------------------------------
public function edit_feedback_CQI3f6() {
    if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
        $this->session->set_userdata('referred_from', current_url());
    } else {
        $this->session->set_userdata('referred_from', NULL);
    }

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        if (isfeature_active('QUALITY-DASHBOARD') === true) {
            $data['content'] = $this->load->view('qualitymodules/edit_feedback_CQI3f6', $data, true);
        } else {
            $data['content'] = $this->load->view('qualitymodules/dephead/edit_feedback_CQI3f6', $data, true);
        }
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3f6_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3f6_byid($id);
        $dataset = json_decode($existing->dataset, true);
        if (!is_array($dataset)) $dataset = [];

        // File Handling
        $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        if (!empty($removeIndexes)) {
            foreach ($removeIndexes as $index) {
                if (isset($existingFiles[$index])) {
                    $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                    $absolutePath = FCPATH . $oldFilePath;
                    if (file_exists($absolutePath)) @unlink($absolutePath);
                    unset($existingFiles[$index]);
                }
            }
            $existingFiles = array_values($existingFiles);
        }

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $filesCount = count($_FILES['uploaded_files']['name']);
            $config = [
                'upload_path'   => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                'max_size'      => 50000,
                'encrypt_name'  => FALSE
            ];
            $this->load->library('upload');
            for ($i = 0; $i < $filesCount; $i++) {
                $_FILES['file'] = [
                    'name'     => $_FILES['uploaded_files']['name'][$i],
                    'type'     => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error'    => $_FILES['uploaded_files']['error'][$i],
                    'size'     => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $uploadData = $this->upload->data();
                    $existingFiles[] = [
                        'url'  => base_url('api/file_uploads/' . $uploadData['file_name']),
                        'name' => $uploadData['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = array_values($existingFiles);

        foreach ($_POST as $key => $value) {
            if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                $dataset[$key] = $value;
            }
        }

        // KPI: (No. of Adverse/Near Miss Events / Total Transfusions) * 100
        $events = intval($this->input->post('events')) ?: 0;
        $transfusions = intval($this->input->post('transfusions')) ?: 0;
        $rate = ($transfusions > 0) ? ($events / $transfusions) * 100 : 0;
        $dataset['adverse_event_rate'] = round($rate, 2);

        $data = ['dataset' => json_encode($dataset)];
        $this->quality_model->update_feedback_CQI3f6($id, $data);
        redirect('quality/patient_feedback_CQI3f6?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3f6_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3f6', $data);
    }
}


// ---------------------------------------------------------------------
// CQI3f7 - Blood availability rate (Blood Center)
// ---------------------------------------------------------------------
public function edit_feedback_CQI3f7() {
    if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
        $this->session->set_userdata('referred_from', current_url());
    } else {
        $this->session->set_userdata('referred_from', NULL);
    }

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        if (isfeature_active('QUALITY-DASHBOARD') === true) {
            $data['content'] = $this->load->view('qualitymodules/edit_feedback_CQI3f7', $data, true);
        } else {
            $data['content'] = $this->load->view('qualitymodules/dephead/edit_feedback_CQI3f7', $data, true);
        }
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3f7_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3f7_byid($id);
        $dataset = json_decode($existing->dataset, true);
        if (!is_array($dataset)) $dataset = [];

        // Handle Files
        $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        if (!empty($removeIndexes)) {
            foreach ($removeIndexes as $index) {
                if (isset($existingFiles[$index])) {
                    $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                    $absolutePath = FCPATH . $oldFilePath;
                    if (file_exists($absolutePath)) @unlink($absolutePath);
                    unset($existingFiles[$index]);
                }
            }
            $existingFiles = array_values($existingFiles);
        }

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $filesCount = count($_FILES['uploaded_files']['name']);
            $config = [
                'upload_path'   => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                'max_size'      => 50000,
                'encrypt_name'  => FALSE
            ];
            $this->load->library('upload');
            for ($i = 0; $i < $filesCount; $i++) {
                $_FILES['file'] = [
                    'name'     => $_FILES['uploaded_files']['name'][$i],
                    'type'     => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error'    => $_FILES['uploaded_files']['error'][$i],
                    'size'     => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $uploadData = $this->upload->data();
                    $existingFiles[] = [
                        'url'  => base_url('api/file_uploads/' . $uploadData['file_name']),
                        'name' => $uploadData['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = array_values($existingFiles);

        foreach ($_POST as $key => $value) {
            if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                $dataset[$key] = $value;
            }
        }

        // KPI: (Units Available / Units Requested) * 100
        $available_units = intval($this->input->post('available_units')) ?: 0;
        $requested_units = intval($this->input->post('requested_units')) ?: 0;
        $rate = ($requested_units > 0) ? ($available_units / $requested_units) * 100 : 0;
        $dataset['availability_rate'] = round($rate, 2);

        $data = ['dataset' => json_encode($dataset)];
        $this->quality_model->update_feedback_CQI3f7($id, $data);
        redirect('quality/patient_feedback_CQI3f7?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3f7_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3f7', $data);
    }
}


// ---------------------------------------------------------------------
// CQI3f8 - CT Ratio (Crossmatch to Transfusion Ratio) (Blood Center)
// ---------------------------------------------------------------------
public function edit_feedback_CQI3f8() {
    if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
        $this->session->set_userdata('referred_from', current_url());
    } else {
        $this->session->set_userdata('referred_from', NULL);
    }

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        if (isfeature_active('QUALITY-DASHBOARD') === true) {
            $data['content'] = $this->load->view('qualitymodules/edit_feedback_CQI3f8', $data, true);
        } else {
            $data['content'] = $this->load->view('qualitymodules/dephead/edit_feedback_CQI3f8', $data, true);
        }
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3f8_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3f8_byid($id);
        $dataset = json_decode($existing->dataset, true);
        if (!is_array($dataset)) $dataset = [];

        // Handle Files
        $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        if (!empty($removeIndexes)) {
            foreach ($removeIndexes as $index) {
                if (isset($existingFiles[$index])) {
                    $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                    $absolutePath = FCPATH . $oldFilePath;
                    if (file_exists($absolutePath)) @unlink($absolutePath);
                    unset($existingFiles[$index]);
                }
            }
            $existingFiles = array_values($existingFiles);
        }

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $filesCount = count($_FILES['uploaded_files']['name']);
            $config = [
                'upload_path'   => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                'max_size'      => 50000,
                'encrypt_name'  => FALSE
            ];
            $this->load->library('upload');
            for ($i = 0; $i < $filesCount; $i++) {
                $_FILES['file'] = [
                    'name'     => $_FILES['uploaded_files']['name'][$i],
                    'type'     => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error'    => $_FILES['uploaded_files']['error'][$i],
                    'size'     => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $uploadData = $this->upload->data();
                    $existingFiles[] = [
                        'url'  => base_url('api/file_uploads/' . $uploadData['file_name']),
                        'name' => $uploadData['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = array_values($existingFiles);

        foreach ($_POST as $key => $value) {
            if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                $dataset[$key] = $value;
            }
        }

        // KPI: CT Ratio = Total Crossmatches / Total Transfusions
        $crossmatches = intval($this->input->post('crossmatches')) ?: 0;
        $transfusions = intval($this->input->post('transfusions')) ?: 0;
        $ratio = ($transfusions > 0) ? ($crossmatches / $transfusions) : 0;
        $dataset['ct_ratio'] = round($ratio, 2);

        $data = ['dataset' => json_encode($dataset)];
        $this->quality_model->update_feedback_CQI3f8($id, $data);
        redirect('quality/patient_feedback_CQI3f8?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3f8_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3f8', $data);
    }
}
// ---------------------------------------------------------------------
public function edit_feedback_CQI3f9() {
    if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
        $this->session->set_userdata('referred_from', current_url());
    } else {
        $this->session->set_userdata('referred_from', NULL);
    }

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        if (isfeature_active('QUALITY-DASHBOARD') === true) {
            $data['content'] = $this->load->view('qualitymodules/edit_feedback_CQI3f9', $data, true);
        } else {
            $data['content'] = $this->load->view('qualitymodules/dephead/edit_feedback_CQI3f9', $data, true);
        }
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3f9_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3f9_byid($id);
        $dataset = json_decode($existing->dataset, true);
        if (!is_array($dataset)) $dataset = [];

        // ðŸ”¹ Handle File Uploads
        $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);

        // Remove unwanted files
        if (!empty($removeIndexes)) {
            foreach ($removeIndexes as $index) {
                if (isset($existingFiles[$index])) {
                    $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                    $absolutePath = FCPATH . $oldFilePath;
                    if (file_exists($absolutePath)) @unlink($absolutePath);
                    unset($existingFiles[$index]);
                }
            }
            $existingFiles = array_values($existingFiles);
        }

        // Upload new files
        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $filesCount = count($_FILES['uploaded_files']['name']);
            $config = [
                'upload_path'   => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                'max_size'      => 50000,
                'encrypt_name'  => FALSE
            ];
            $this->load->library('upload');
            for ($i = 0; $i < $filesCount; $i++) {
                $_FILES['file'] = [
                    'name'     => $_FILES['uploaded_files']['name'][$i],
                    'type'     => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error'    => $_FILES['uploaded_files']['error'][$i],
                    'size'     => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $uploadData = $this->upload->data();
                    $existingFiles[] = [
                        'url'  => base_url('api/file_uploads/' . $uploadData['file_name']),
                        'name' => $uploadData['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = array_values($existingFiles);

        // ðŸ”¹ Update dataset from POST
        foreach ($_POST as $key => $value) {
            if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                $dataset[$key] = $value;
            }
        }

        // ðŸ”¹ KPI Calculation: TAT = End Time - Start Time (in minutes)
        $start_time = strtotime($this->input->post('start_time'));
        $end_time = strtotime($this->input->post('end_time'));
        $tat = ($end_time > $start_time) ? round(($end_time - $start_time) / 60, 2) : 0;
        $dataset['turnaround_time'] = $tat;

        // Save record
        $data = ['dataset' => json_encode($dataset)];
        $this->quality_model->update_feedback_CQI3f9($id, $data);
        redirect('quality/patient_feedback_CQI3f9?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3f9_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3f9', $data);
    }
}
// ---------------------------------------------------------------------
public function edit_feedback_CQI3f10() {
    if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
        $this->session->set_userdata('referred_from', current_url());
    } else {
        $this->session->set_userdata('referred_from', NULL);
    }

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        if (isfeature_active('QUALITY-DASHBOARD') === true) {
            $data['content'] = $this->load->view('qualitymodules/edit_feedback_CQI3f10', $data, true);
        } else {
            $data['content'] = $this->load->view('qualitymodules/dephead/edit_feedback_CQI3f10', $data, true);
        }
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3f10_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3f10_byid($id);
        $dataset = json_decode($existing->dataset, true);
        if (!is_array($dataset)) $dataset = [];

        // ðŸ”¹ Handle File Uploads
        $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);

        // Remove unwanted files
        if (!empty($removeIndexes)) {
            foreach ($removeIndexes as $index) {
                if (isset($existingFiles[$index])) {
                    $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                    $absolutePath = FCPATH . $oldFilePath;
                    if (file_exists($absolutePath)) @unlink($absolutePath);
                    unset($existingFiles[$index]);
                }
            }
            $existingFiles = array_values($existingFiles);
        }

        // Upload new files
        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $filesCount = count($_FILES['uploaded_files']['name']);
            $config = [
                'upload_path'   => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                'max_size'      => 50000,
                'encrypt_name'  => FALSE
            ];
            $this->load->library('upload');
            for ($i = 0; $i < $filesCount; $i++) {
                $_FILES['file'] = [
                    'name'     => $_FILES['uploaded_files']['name'][$i],
                    'type'     => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error'    => $_FILES['uploaded_files']['error'][$i],
                    'size'     => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $uploadData = $this->upload->data();
                    $existingFiles[] = [
                        'url'  => base_url('api/file_uploads/' . $uploadData['file_name']),
                        'name' => $uploadData['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = array_values($existingFiles);

        // ðŸ”¹ Update dataset from POST
        foreach ($_POST as $key => $value) {
            if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                $dataset[$key] = $value;
            }
        }

        // ðŸ”¹ KPI Calculation: TAT = End Time - Start Time (in minutes)
        $start_time = strtotime($this->input->post('donation_start_time'));
        $end_time = strtotime($this->input->post('donation_end_time'));
        $tat = ($end_time > $start_time) ? round(($end_time - $start_time) / 60, 2) : 0;
        $dataset['turnaround_time'] = $tat;

        // Save record
        $data = ['dataset' => json_encode($dataset)];
        $this->quality_model->update_feedback_CQI3f10($id, $data);
        redirect('quality/patient_feedback_CQI3f10?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3f10_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3f10', $data);
    }
}
// ---------------------------------------------------------------------
public function edit_feedback_CQI3g1() {
    if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
        $this->session->set_userdata('referred_from', current_url());
    } else {
        $this->session->set_userdata('referred_from', NULL);
    }

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        if (isfeature_active('QUALITY-DASHBOARD') === true) {
            $data['content'] = $this->load->view('qualitymodules/edit_feedback_CQI3g1', $data, true);
        } else {
            $data['content'] = $this->load->view('qualitymodules/dephead/edit_feedback_CQI3g1', $data, true);
        }
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3g1_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3g1_byid($id);
        $dataset = json_decode($existing->dataset, true);
        if (!is_array($dataset)) $dataset = [];

        // File handling
        $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);

        if (!empty($removeIndexes)) {
            foreach ($removeIndexes as $index) {
                if (isset($existingFiles[$index])) {
                    $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                    $absolutePath = FCPATH . $oldFilePath;
                    if (file_exists($absolutePath)) @unlink($absolutePath);
                    unset($existingFiles[$index]);
                }
            }
            $existingFiles = array_values($existingFiles);
        }

        // Upload new files
        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $filesCount = count($_FILES['uploaded_files']['name']);
            $config = [
                'upload_path'   => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                'max_size'      => 50000,
                'encrypt_name'  => FALSE
            ];
            $this->load->library('upload');
            for ($i = 0; $i < $filesCount; $i++) {
                $_FILES['file'] = [
                    'name'     => $_FILES['uploaded_files']['name'][$i],
                    'type'     => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error'    => $_FILES['uploaded_files']['error'][$i],
                    'size'     => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $uploadData = $this->upload->data();
                    $existingFiles[] = [
                        'url'  => base_url('api/file_uploads/' . $uploadData['file_name']),
                        'name' => $uploadData['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = array_values($existingFiles);

        // Update dataset from POST
        foreach ($_POST as $key => $value) {
            if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                $dataset[$key] = $value;
            }
        }

        // KPI: (CAUTI Cases / Catheter Days) Ã— 1000
        $cauti_cases = intval($this->input->post('cauti_cases')) ?: 0;
        $catheter_days = intval($this->input->post('catheter_days')) ?: 0;
        $rate = ($catheter_days > 0) ? ($cauti_cases / $catheter_days) * 1000 : 0;
        $dataset['cauti_rate'] = round($rate, 2);

        $data = ['dataset' => json_encode($dataset)];
        $this->quality_model->update_feedback_CQI3g1($id, $data);
        redirect('quality/patient_feedback_CQI3g1?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3g1_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3g1', $data);
    }
}
// ---------------------------------------------------------------------
public function edit_feedback_CQI3g2() {
    if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
        $this->session->set_userdata('referred_from', current_url());
    } else {
        $this->session->set_userdata('referred_from', NULL);
    }

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        if (isfeature_active('QUALITY-DASHBOARD') === true) {
            $data['content'] = $this->load->view('qualitymodules/edit_feedback_CQI3g2', $data, true);
        } else {
            $data['content'] = $this->load->view('qualitymodules/dephead/edit_feedback_CQI3g2', $data, true);
        }
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3g2_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3g2_byid($id);
        $dataset = json_decode($existing->dataset, true);
        if (!is_array($dataset)) $dataset = [];

        // File handling
        $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        if (!empty($removeIndexes)) {
            foreach ($removeIndexes as $index) {
                if (isset($existingFiles[$index])) {
                    $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                    $absolutePath = FCPATH . $oldFilePath;
                    if (file_exists($absolutePath)) @unlink($absolutePath);
                    unset($existingFiles[$index]);
                }
            }
            $existingFiles = array_values($existingFiles);
        }

        // Upload new files
        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $filesCount = count($_FILES['uploaded_files']['name']);
            $config = [
                'upload_path'   => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                'max_size'      => 50000,
                'encrypt_name'  => FALSE
            ];
            $this->load->library('upload');
            for ($i = 0; $i < $filesCount; $i++) {
                $_FILES['file'] = [
                    'name'     => $_FILES['uploaded_files']['name'][$i],
                    'type'     => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error'    => $_FILES['uploaded_files']['error'][$i],
                    'size'     => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $uploadData = $this->upload->data();
                    $existingFiles[] = [
                        'url'  => base_url('api/file_uploads/' . $uploadData['file_name']),
                        'name' => $uploadData['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = array_values($existingFiles);

        // Update dataset
        foreach ($_POST as $key => $value) {
            if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                $dataset[$key] = $value;
            }
        }

        // KPI Formula: (VAP Cases / Ventilator Days) Ã— 1000
        $vap_cases = intval($this->input->post('vap_cases')) ?: 0;
        $ventilator_days = intval($this->input->post('ventilator_days')) ?: 0;
        $rate = ($ventilator_days > 0) ? ($vap_cases / $ventilator_days) * 1000 : 0;
        $dataset['vap_rate'] = round($rate, 2);

        $data = ['dataset' => json_encode($dataset)];
        $this->quality_model->update_feedback_CQI3g2($id, $data);
        redirect('quality/patient_feedback_CQI3g2?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3g2_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3g2', $data);
    }
}
// ---------------------------------------------------------------------
public function edit_feedback_CQI3g3() {
    if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
        $this->session->set_userdata('referred_from', current_url());
    } else {
        $this->session->set_userdata('referred_from', NULL);
    }

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        if (isfeature_active('QUALITY-DASHBOARD') === true) {
            $data['content'] = $this->load->view('qualitymodules/edit_feedback_CQI3g3', $data, true);
        } else {
            $data['content'] = $this->load->view('qualitymodules/dephead/edit_feedback_CQI3g3', $data, true);
        }
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3g3_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3g3_byid($id);
        $dataset = json_decode($existing->dataset, true);
        if (!is_array($dataset)) $dataset = [];

        // File handling
        $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        if (!empty($removeIndexes)) {
            foreach ($removeIndexes as $index) {
                if (isset($existingFiles[$index])) {
                    $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                    $absolutePath = FCPATH . $oldFilePath;
                    if (file_exists($absolutePath)) @unlink($absolutePath);
                    unset($existingFiles[$index]);
                }
            }
            $existingFiles = array_values($existingFiles);
        }

        // Upload new files
        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $filesCount = count($_FILES['uploaded_files']['name']);
            $config = [
                'upload_path'   => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                'max_size'      => 50000,
                'encrypt_name'  => FALSE
            ];
            $this->load->library('upload');
            for ($i = 0; $i < $filesCount; $i++) {
                $_FILES['file'] = [
                    'name'     => $_FILES['uploaded_files']['name'][$i],
                    'type'     => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error'    => $_FILES['uploaded_files']['error'][$i],
                    'size'     => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $uploadData = $this->upload->data();
                    $existingFiles[] = [
                        'url'  => base_url('api/file_uploads/' . $uploadData['file_name']),
                        'name' => $uploadData['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = array_values($existingFiles);

        // Update dataset
        foreach ($_POST as $key => $value) {
            if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                $dataset[$key] = $value;
            }
        }

        // KPI Formula: (CLABSI Cases / Central Line Days) Ã— 1000
        $clabsi_cases = intval($this->input->post('clabsi_cases')) ?: 0;
        $central_line_days = intval($this->input->post('central_line_days')) ?: 0;
        $rate = ($central_line_days > 0) ? ($clabsi_cases / $central_line_days) * 1000 : 0;
        $dataset['clabsi_rate'] = round($rate, 2);

        $data = ['dataset' => json_encode($dataset)];
        $this->quality_model->update_feedback_CQI3g3($id, $data);
        redirect('quality/patient_feedback_CQI3g3?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3g3_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3g3', $data);
    }
}
// ---------------------------------------------------------------------
public function edit_feedback_CQI3g4() {
    if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
        $this->session->set_userdata('referred_from', current_url());
    } else {
        $this->session->set_userdata('referred_from', NULL);
    }

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        if (isfeature_active('QUALITY-DASHBOARD') === true) {
            $data['content'] = $this->load->view('qualitymodules/edit_feedback_CQI3g4', $data, true);
        } else {
            $data['content'] = $this->load->view('qualitymodules/dephead/edit_feedback_CQI3g4', $data, true);
        }
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3g4_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3g4_byid($id);
        $dataset = json_decode($existing->dataset, true);
        if (!is_array($dataset)) $dataset = [];

        // File handling
        $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        if (!empty($removeIndexes)) {
            foreach ($removeIndexes as $index) {
                if (isset($existingFiles[$index])) {
                    $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                    $absolutePath = FCPATH . $oldFilePath;
                    if (file_exists($absolutePath)) @unlink($absolutePath);
                    unset($existingFiles[$index]);
                }
            }
            $existingFiles = array_values($existingFiles);
        }

        // Upload new files
        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $filesCount = count($_FILES['uploaded_files']['name']);
            $config = [
                'upload_path'   => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                'max_size'      => 50000,
                'encrypt_name'  => FALSE
            ];
            $this->load->library('upload');
            for ($i = 0; $i < $filesCount; $i++) {
                $_FILES['file'] = [
                    'name'     => $_FILES['uploaded_files']['name'][$i],
                    'type'     => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error'    => $_FILES['uploaded_files']['error'][$i],
                    'size'     => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $uploadData = $this->upload->data();
                    $existingFiles[] = [
                        'url'  => base_url('api/file_uploads/' . $uploadData['file_name']),
                        'name' => $uploadData['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = array_values($existingFiles);

        // Update dataset
        foreach ($_POST as $key => $value) {
            if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                $dataset[$key] = $value;
            }
        }

        // KPI Formula: (SSI Cases / Total Surgeries) Ã— 100
        $ssi_cases = intval($this->input->post('ssi_cases')) ?: 0;
        $total_surgeries = intval($this->input->post('total_surgeries')) ?: 0;
        $rate = ($total_surgeries > 0) ? ($ssi_cases / $total_surgeries) * 100 : 0;
        $dataset['ssi_rate'] = round($rate, 2);

        $data = ['dataset' => json_encode($dataset)];
        $this->quality_model->update_feedback_CQI3g4($id, $data);
        redirect('quality/patient_feedback_CQI3g4?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3g4_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3g4', $data);
    }
}
// ---------------------------------------------------------------------
public function edit_feedback_CQI3g5() {
    if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
        $this->session->set_userdata('referred_from', current_url());
    } else {
        $this->session->set_userdata('referred_from', NULL);
    }

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        if (isfeature_active('QUALITY-DASHBOARD') === true) {
            $data['content'] = $this->load->view('qualitymodules/edit_feedback_CQI3g5', $data, true);
        } else {
            $data['content'] = $this->load->view('qualitymodules/dephead/edit_feedback_CQI3g5', $data, true);
        }
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3g5_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3g5_byid($id);
        $dataset = json_decode($existing->dataset, true);
        if (!is_array($dataset)) $dataset = [];

        // File handling
        $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        if (!empty($removeIndexes)) {
            foreach ($removeIndexes as $index) {
                if (isset($existingFiles[$index])) {
                    $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                    $absolutePath = FCPATH . $oldFilePath;
                    if (file_exists($absolutePath)) @unlink($absolutePath);
                    unset($existingFiles[$index]);
                }
            }
            $existingFiles = array_values($existingFiles);
        }

        // Upload new files
        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $filesCount = count($_FILES['uploaded_files']['name']);
            $config = [
                'upload_path'   => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                'max_size'      => 50000,
                'encrypt_name'  => FALSE
            ];
            $this->load->library('upload');
            for ($i = 0; $i < $filesCount; $i++) {
                $_FILES['file'] = [
                    'name'     => $_FILES['uploaded_files']['name'][$i],
                    'type'     => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error'    => $_FILES['uploaded_files']['error'][$i],
                    'size'     => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $uploadData = $this->upload->data();
                    $existingFiles[] = [
                        'url'  => base_url('api/file_uploads/' . $uploadData['file_name']),
                        'name' => $uploadData['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = array_values($existingFiles);

        // Update dataset
        foreach ($_POST as $key => $value) {
            if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                $dataset[$key] = $value;
            }
        }

        // KPI Formula: (Sepsis Cases / NICU Admissions) Ã— 100
        $sepsis_cases = intval($this->input->post('sepsis_cases')) ?: 0;
        $nicu_admissions = intval($this->input->post('nicu_admissions')) ?: 0;
        $rate = ($nicu_admissions > 0) ? ($sepsis_cases / $nicu_admissions) * 100 : 0;
        $dataset['sepsis_rate'] = round($rate, 2);

        $data = ['dataset' => json_encode($dataset)];
        $this->quality_model->update_feedback_CQI3g5($id, $data);
        redirect('quality/patient_feedback_CQI3g5?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3g5_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3g5', $data);
    }
}
// ---------------------------------------------------------------------
public function edit_feedback_CQI3g6() {
    if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
        $this->session->set_userdata('referred_from', current_url());
    } else {
        $this->session->set_userdata('referred_from', NULL);
    }

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        if (isfeature_active('QUALITY-DASHBOARD') === true) {
            $data['content'] = $this->load->view('qualitymodules/edit_feedback_CQI3g6', $data, true);
        } else {
            $data['content'] = $this->load->view('qualitymodules/dephead/edit_feedback_CQI3g6', $data, true);
        }
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3g6_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3g6_byid($id);
        $dataset = json_decode($existing->dataset, true);
        if (!is_array($dataset)) $dataset = [];

        // File handling
        $existingFiles = !empty($dataset['files_name']) ? $dataset['files_name'] : [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        if (!empty($removeIndexes)) {
            foreach ($removeIndexes as $index) {
                if (isset($existingFiles[$index])) {
                    $oldFilePath = str_replace(base_url(), '', $existingFiles[$index]['url']);
                    $absolutePath = FCPATH . $oldFilePath;
                    if (file_exists($absolutePath)) @unlink($absolutePath);
                    unset($existingFiles[$index]);
                }
            }
            $existingFiles = array_values($existingFiles);
        }

        // Upload new files
        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $filesCount = count($_FILES['uploaded_files']['name']);
            $config = [
                'upload_path'   => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                'max_size'      => 50000,
                'encrypt_name'  => FALSE
            ];
            $this->load->library('upload');
            for ($i = 0; $i < $filesCount; $i++) {
                $_FILES['file'] = [
                    'name'     => $_FILES['uploaded_files']['name'][$i],
                    'type'     => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error'    => $_FILES['uploaded_files']['error'][$i],
                    'size'     => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $uploadData = $this->upload->data();
                    $existingFiles[] = [
                        'url'  => base_url('api/file_uploads/' . $uploadData['file_name']),
                        'name' => $uploadData['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = array_values($existingFiles);

        // Update dataset
        foreach ($_POST as $key => $value) {
            if (!in_array($key, ['uploaded_files', 'remove_files_json'])) {
                $dataset[$key] = $value;
            }
        }

        // KPI Formula: (Compliant Checks / Total Checks) Ã— 100
        $compliant_checks = intval($this->input->post('compliant_checks')) ?: 0;
        $total_checks = intval($this->input->post('total_checks')) ?: 0;
        $rate = ($total_checks > 0) ? ($compliant_checks / $total_checks) * 100 : 0;
        $dataset['cleaning_compliance_rate'] = round($rate, 2);

        $data = ['dataset' => json_encode($dataset)];
        $this->quality_model->update_feedback_CQI3g6($id, $data);
        redirect('quality/patient_feedback_CQI3g6?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3g6_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3g6', $data);
    }
}
// ---------------------------------------------------------------------
public function edit_feedback_CQI3h1() {
    if (!isset($this->session->userdata['isLogIn']) || ($this->session->userdata('isLogIn') === false)) {
        $this->session->set_userdata('referred_from', current_url());
    } else {
        $this->session->set_userdata('referred_from', NULL);
    }
    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        if (isfeature_active('QUALITY-DASHBOARD') === true)
            $data['content'] = $this->load->view('qualitymodules/edit_feedback_CQI3h1', $data, true);
        else
            $data['content'] = $this->load->view('qualitymodules/dephead/edit_feedback_CQI3h1', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3h1_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3h1_byid($id);
        $dataset = json_decode($existing->dataset, true);
        if (!is_array($dataset)) $dataset = [];

        // ðŸ—‚ File handling
        $existingFiles = $dataset['files_name'] ?? [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        if (!empty($removeIndexes)) {
            foreach ($removeIndexes as $i) {
                if (isset($existingFiles[$i])) {
                    $path = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                    if (file_exists($path)) @unlink($path);
                    unset($existingFiles[$i]);
                }
            }
            $existingFiles = array_values($existingFiles);
        }

        // ðŸ“¤ Upload new files
        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $count = count($_FILES['uploaded_files']['name']);
            $config = [
                'upload_path'   => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                'max_size'      => 50000
            ];
            $this->load->library('upload');
            for ($i = 0; $i < $count; $i++) {
                $_FILES['file'] = [
                    'name'     => $_FILES['uploaded_files']['name'][$i],
                    'type'     => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error'    => $_FILES['uploaded_files']['error'][$i],
                    'size'     => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url'  => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;

        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // KPI: (Deaths / Discharges) Ã— 100
        $deaths = intval($this->input->post('deaths')) ?: 0;
        $discharges = intval($this->input->post('discharges')) ?: 0;
        $rate = ($discharges > 0) ? ($deaths / $discharges) * 100 : 0;
        $dataset['mortality_rate'] = round($rate, 2);

        $this->quality_model->update_feedback_CQI3h1($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3h1?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3h1_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3h1', $data);
    }
}
// ---------------------------------------------------------------------
public function edit_feedback_CQI3h2() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);
    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3h2', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3h2', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3h2_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3h2_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];

        // File handling + uploads (same as above)
        $existingFiles = $dataset['files_name'] ?? [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = ['upload_path' => './api/file_uploads/', 'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'];
            $count = count($_FILES['uploaded_files']['name']);
            for ($i = 0; $i < $count; $i++) {
                $_FILES['file'] = [
                    'name' => $_FILES['uploaded_files']['name'][$i],
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = ['url' => base_url('api/file_uploads/' . $up['file_name']), 'name' => $up['file_name']];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;

        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // KPI formula
        $readmit = intval($this->input->post('readmit_48hr')) ?: 0;
        $discharges = intval($this->input->post('icu_discharges')) ?: 0;
        $dataset['return_rate'] = ($discharges > 0) ? round(($readmit / $discharges) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI3h2($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3h2?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3h2_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3h2', $data);
    }
}
// ---------------------------------------------------------------------
public function edit_feedback_CQI3h3() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);
    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3h3', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3h3', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3h3_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3h3_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];

        // File handling + uploads (same as above)
        $existingFiles = $dataset['files_name'] ?? [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = ['upload_path' => './api/file_uploads/', 'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'];
            $count = count($_FILES['uploaded_files']['name']);
            for ($i = 0; $i < $count; $i++) {
                $_FILES['file'] = [
                    'name' => $_FILES['uploaded_files']['name'][$i],
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = ['url' => base_url('api/file_uploads/' . $up['file_name']), 'name' => $up['file_name']];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;

        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // KPI formula
        $readmit = intval($this->input->post('readmit_48hr')) ?: 0;
        $discharges = intval($this->input->post('icu_discharges')) ?: 0;
        $dataset['return_rate'] = ($discharges > 0) ? round(($readmit / $discharges) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI3h3($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3h3?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3h3_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3h3', $data);
    }
}
// ---------------------------------------------------------------------
public function edit_feedback_CQI3h4() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);
    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3h4', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3h4', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3h4_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3h4_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];

        // ðŸ”¹ File handling (same as other functions)
        $existingFiles = $dataset['files_name'] ?? [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = ['upload_path' => './api/file_uploads/', 'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'];
            $count = count($_FILES['uploaded_files']['name']);
            for ($i = 0; $i < $count; $i++) {
                $_FILES['file'] = [
                    'name' => $_FILES['uploaded_files']['name'][$i],
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = ['url' => base_url('api/file_uploads/' . $up['file_name']), 'name' => $up['file_name']];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // KPI formula
        $readmit = intval($this->input->post('readmit_48hr')) ?: 0;
        $discharges = intval($this->input->post('icu_discharges')) ?: 0;
        $dataset['return_rate'] = ($discharges > 0) ? round(($readmit / $discharges) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI3h4($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3h4?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3h4_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3h4', $data);
    }
}
// ---------------------------------------------------------------------
public function edit_feedback_CQI3h5() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);
    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3h5', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3h5', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3h5_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3h5_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];

        // ðŸ”¹ File handling
        $existingFiles = $dataset['files_name'] ?? [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = ['upload_path' => './api/file_uploads/', 'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'];
            $count = count($_FILES['uploaded_files']['name']);
            for ($i = 0; $i < $count; $i++) {
                $_FILES['file'] = [
                    'name' => $_FILES['uploaded_files']['name'][$i],
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = ['url' => base_url('api/file_uploads/' . $up['file_name']), 'name' => $up['file_name']];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // KPI formula
        $returns = intval($this->input->post('return_cases')) ?: 0;
        $total = intval($this->input->post('total_emergency_visits')) ?: 0;
        $dataset['return_rate'] = ($total > 0) ? round(($returns / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI3h5($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3h5?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3h5_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3h5', $data);
    }
}
// ---------------------------------------------------------------------
public function edit_feedback_CQI3h6() {  // change 3h6 â†’ 3h7 or 3h8 for others
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);
    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3h6', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3h6', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3h6_byid($id) {  // same pattern for 3h7 / 3h8
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3h6_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];

        // ðŸ”¹ File handling
        $existingFiles = $dataset['files_name'] ?? [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = ['upload_path' => './api/file_uploads/', 'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'];
            $count = count($_FILES['uploaded_files']['name']);
            for ($i = 0; $i < $count; $i++) {
                $_FILES['file'] = [
                    'name' => $_FILES['uploaded_files']['name'][$i],
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = ['url' => base_url('api/file_uploads/' . $up['file_name']), 'name' => $up['file_name']];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // KPI formula
        $reintubations = intval($this->input->post('reintubation_cases')) ?: 0;
        $extubations = intval($this->input->post('total_extubated_patients')) ?: 0;
        $dataset['reintubation_rate'] = ($extubations > 0) ? round(($reintubations / $extubations) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI3h6($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3h6?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3h6_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3h6', $data);
    }
}
// ---------------------------------------------------------------------
public function edit_feedback_CQI3h7() {  // change 3h6 â†’ 3h7 or 3h8 for others
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);
    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3h7', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3h7', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3h7_byid($id) {  // same pattern for 3h7 / 3h8
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3h7_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];

        // ðŸ”¹ File handling
        $existingFiles = $dataset['files_name'] ?? [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = ['upload_path' => './api/file_uploads/', 'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'];
            $count = count($_FILES['uploaded_files']['name']);
            for ($i = 0; $i < $count; $i++) {
                $_FILES['file'] = [
                    'name' => $_FILES['uploaded_files']['name'][$i],
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = ['url' => base_url('api/file_uploads/' . $up['file_name']), 'name' => $up['file_name']];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // KPI formula
        $reintubations = intval($this->input->post('reintubation_cases')) ?: 0;
        $extubations = intval($this->input->post('total_extubated_patients')) ?: 0;
        $dataset['reintubation_rate'] = ($extubations > 0) ? round(($reintubations / $extubations) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI3h7($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3h7?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3h7_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3h7', $data);
    }
}
// ---------------------------------------------------------------------
public function edit_feedback_CQI3h8() {  // change 3h6 â†’ 3h7 or 3h8 for others
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);
    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3h8', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3h8', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3h8_byid($id) {  // same pattern for 3h7 / 3h8
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3h8_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];

        // ðŸ”¹ File handling
        $existingFiles = $dataset['files_name'] ?? [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = ['upload_path' => './api/file_uploads/', 'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'];
            $count = count($_FILES['uploaded_files']['name']);
            for ($i = 0; $i < $count; $i++) {
                $_FILES['file'] = [
                    'name' => $_FILES['uploaded_files']['name'][$i],
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = ['url' => base_url('api/file_uploads/' . $up['file_name']), 'name' => $up['file_name']];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // KPI formula
        $reintubations = intval($this->input->post('reintubation_cases')) ?: 0;
        $extubations = intval($this->input->post('total_extubated_patients')) ?: 0;
        $dataset['reintubation_rate'] = ($extubations > 0) ? round(($reintubations / $extubations) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI3h8($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3h8?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3h8_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3h8', $data);
    }
}
// ---------------------------------------------------------------------
public function edit_feedback_CQI3h9() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);
    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3h9', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3h9', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3h9_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3h9_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];

        // ðŸ”¹ File handling
        $existingFiles = $dataset['files_name'] ?? [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = ['upload_path' => './api/file_uploads/', 'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'];
            $count = count($_FILES['uploaded_files']['name']);
            for ($i = 0; $i < $count; $i++) {
                $_FILES['file'] = [
                    'name' => $_FILES['uploaded_files']['name'][$i],
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = ['url' => base_url('api/file_uploads/' . $up['file_name']), 'name' => $up['file_name']];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // KPI formula
        $readmit = intval($this->input->post('readmission_cases')) ?: 0;
        $discharges = intval($this->input->post('total_discharges')) ?: 0;
        $dataset['readmission_rate'] = ($discharges > 0) ? round(($readmit / $discharges) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI3h9($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3h9?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3h9_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3h9', $data);
    }
}
// ---------------------------------------------------------------------
public function edit_feedback_CQI3j1() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3j1', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3j1', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3j1_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3j1_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];

        // ðŸ”¹ File Handling
        $existingFiles = $dataset['files_name'] ?? [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        // ðŸ”¹ File Upload
        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            $count = count($_FILES['uploaded_files']['name']);
            for ($i = 0; $i < $count; $i++) {
                $_FILES['file'] = [
                    'name' => $_FILES['uploaded_files']['name'][$i],
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula (Example: compliance %)
        $compliant = intval($this->input->post('compliant_cases')) ?: 0;
        $total = intval($this->input->post('total_cases')) ?: 0;
        $dataset['handover_compliance_rate'] = ($total > 0) ? round(($compliant / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI3j1($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3j1?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3j1_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3j1', $data);
    }
}
// ---------------------------------------------------------------------
public function edit_feedback_CQI3j2() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3j2', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3j2', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3j2_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3j2_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];

        // ðŸ”¹ File Handling
        $existingFiles = $dataset['files_name'] ?? [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        // ðŸ”¹ Upload new files
        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            $count = count($_FILES['uploaded_files']['name']);
            for ($i = 0; $i < $count; $i++) {
                $_FILES['file'] = [
                    'name' => $_FILES['uploaded_files']['name'][$i],
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula (handover compliance rate)
        $compliant = intval($this->input->post('compliant_cases')) ?: 0;
        $total = intval($this->input->post('total_cases')) ?: 0;
        $dataset['handover_compliance_rate'] = ($total > 0) ? round(($compliant / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI3j2($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3j2?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3j2_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3j2', $data);
    }
}
// ---------------------------------------------------------------------
public function edit_feedback_CQI3j3() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3j3', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3j3', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3j3_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3j3_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];

        $existingFiles = $dataset['files_name'] ?? [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            $count = count($_FILES['uploaded_files']['name']);
            for ($i = 0; $i < $count; $i++) {
                $_FILES['file'] = [
                    'name' => $_FILES['uploaded_files']['name'][$i],
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        $compliant = intval($this->input->post('compliant_cases')) ?: 0;
        $total = intval($this->input->post('total_cases')) ?: 0;
        $dataset['handover_compliance_rate'] = ($total > 0) ? round(($compliant / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI3j3($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3j3?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3j3_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3j3', $data);
    }
}
// ---------------------------------------------------------------------
public function edit_feedback_CQI3j4() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3j4', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3j4', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3j4_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3j4_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];

        $existingFiles = $dataset['files_name'] ?? [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            $count = count($_FILES['uploaded_files']['name']);
            for ($i = 0; $i < $count; $i++) {
                $_FILES['file'] = [
                    'name' => $_FILES['uploaded_files']['name'][$i],
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula (identification error rate)
        $errors = intval($this->input->post('identification_errors')) ?: 0;
        $total = intval($this->input->post('total_patients')) ?: 0;
        $dataset['identification_error_rate'] = ($total > 0) ? round(($errors / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI3j4($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3j4?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3j4_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3j4', $data);
    }
}
// ---------------------------------------------------------------------
public function edit_feedback_CQI3j5() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3j5', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3j5', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3j5_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3j5_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];

        $existingFiles = $dataset['files_name'] ?? [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            $count = count($_FILES['uploaded_files']['name']);
            for ($i = 0; $i < $count; $i++) {
                $_FILES['file'] = [
                    'name' => $_FILES['uploaded_files']['name'][$i],
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula (hand hygiene compliance rate)
        $missed = intval($this->input->post('missed_opportunities')) ?: 0;
        $total = intval($this->input->post('total_opportunities')) ?: 0;
        $dataset['hand_hygiene_compliance'] = ($total > 0) ? round((($total - $missed) / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI3j5($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3j5?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3j5_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3j5', $data);
    }
}
// ---------------------------------------------------------------------
public function edit_feedback_CQI3j6() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3j6', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3j6', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3j6_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3j6_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];

        $existingFiles = $dataset['files_name'] ?? [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            $count = count($_FILES['uploaded_files']['name']);
            for ($i = 0; $i < $count; $i++) {
                $_FILES['file'] = [
                    'name' => $_FILES['uploaded_files']['name'][$i],
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula (Compliance %)
        $correct = intval($this->input->post('correct_prescriptions')) ?: 0;
        $total = intval($this->input->post('total_prescriptions')) ?: 0;
        $dataset['compliance_rate'] = ($total > 0) ? round(($correct / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI3j6($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3j6?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3j6_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3j6', $data);
    }
}
// ---------------------------------------------------------------------
public function edit_feedback_CQI3j7() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3j7', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3j7', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3j7_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3j7_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];

        $existingFiles = $dataset['files_name'] ?? [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            $count = count($_FILES['uploaded_files']['name']);
            for ($i = 0; $i < $count; $i++) {
                $_FILES['file'] = [
                    'name' => $_FILES['uploaded_files']['name'][$i],
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula (handover compliance rate)
        $done = intval($this->input->post('handover_completed')) ?: 0;
        $total = intval($this->input->post('handover_required')) ?: 0;
        $dataset['handover_compliance'] = ($total > 0) ? round(($done / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI3j7($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3j7?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3j7_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3j7', $data);
    }
}
// ---------------------------------------------------------------------
public function edit_feedback_CQI3j8() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3j8', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3j8', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3j8_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3j8_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];

        $existingFiles = $dataset['files_name'] ?? [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            $count = count($_FILES['uploaded_files']['name']);
            for ($i = 0; $i < $count; $i++) {
                $_FILES['file'] = [
                    'name' => $_FILES['uploaded_files']['name'][$i],
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula (handover compliance rate)
        $done = intval($this->input->post('handover_completed')) ?: 0;
        $total = intval($this->input->post('handover_required')) ?: 0;
        $dataset['handover_compliance'] = ($total > 0) ? round(($done / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI3j8($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3j8?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3j8_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3j8', $data);
    }
}
// ---------------------------------------------------------------------
public function edit_feedback_CQI3j9() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3j9', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3j9', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3j9_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3j9_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];

        $existingFiles = $dataset['files_name'] ?? [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            $count = count($_FILES['uploaded_files']['name']);
            for ($i = 0; $i < $count; $i++) {
                $_FILES['file'] = [
                    'name' => $_FILES['uploaded_files']['name'][$i],
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula (Patient ID compliance rate)
        $correct = intval($this->input->post('correct_identifications')) ?: 0;
        $total = intval($this->input->post('total_checks')) ?: 0;
        $dataset['id_compliance'] = ($total > 0) ? round(($correct / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI3j9($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3j9?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3j9_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3j9', $data);
    }
}
// ---------------------------------------------------------------------
public function edit_feedback_CQI3j10() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3j10', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3j10', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3j10_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3j10_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];

        $existingFiles = $dataset['files_name'] ?? [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            $count = count($_FILES['uploaded_files']['name']);
            for ($i = 0; $i < $count; $i++) {
                $_FILES['file'] = [
                    'name' => $_FILES['uploaded_files']['name'][$i],
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula (Timeliness rate)
        $timely = intval($this->input->post('reports_within_30min')) ?: 0;
        $total = intval($this->input->post('total_critical_reports')) ?: 0;
        $dataset['timeliness_rate'] = ($total > 0) ? round(($timely / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI3j10($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3j10?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3j10_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3j10', $data);
    }
}
// ---------------------------------------------------------------------
// CQI3j11 - IPSG 2.2 - Hand off communication interdepartmental shift (MRD - Emergency Department)
public function edit_feedback_CQI3j11() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3j11', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3j11', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3j11_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3j11_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];

        $existingFiles = $dataset['files_name'] ?? [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            $count = count($_FILES['uploaded_files']['name']);
            for ($i = 0; $i < $count; $i++) {
                $_FILES['file'] = [
                    'name' => $_FILES['uploaded_files']['name'][$i],
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula (Handoff communication compliance rate)
        $missed = intval($this->input->post('missed_handoffs')) ?: 0;
        $total = intval($this->input->post('total_handoffs')) ?: 0;
        $dataset['handoff_compliance_rate'] = ($total > 0) ? round((($total - $missed) / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI3j11($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3j11?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3j11_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3j11', $data);
    }
}

// ---------------------------------------------------------------------
// CQI3j12 - IPSG 2.2 - Hand off communication interdepartmental shift (MRD - ICU)
public function edit_feedback_CQI3j12() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3j12', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3j12', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3j12_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3j12_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];

        $existingFiles = $dataset['files_name'] ?? [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            $count = count($_FILES['uploaded_files']['name']);
            for ($i = 0; $i < $count; $i++) {
                $_FILES['file'] = [
                    'name' => $_FILES['uploaded_files']['name'][$i],
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula (Handoff communication compliance rate)
        $missed = intval($this->input->post('missed_handoffs')) ?: 0;
        $total = intval($this->input->post('total_handoffs')) ?: 0;
        $dataset['handoff_compliance_rate'] = ($total > 0) ? round((($total - $missed) / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI3j12($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3j12?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3j12_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3j12', $data);
    }
}

// ---------------------------------------------------------------------
// CQI3j13 - IPSG 2.2 - Hand off communication interdepartmental shift (Nurses)-(Nursing - Emergency Department)
public function edit_feedback_CQI3j13() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3j13', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3j13', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3j13_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3j13_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];

        $existingFiles = $dataset['files_name'] ?? [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            $count = count($_FILES['uploaded_files']['name']);
            for ($i = 0; $i < $count; $i++) {
                $_FILES['file'] = [
                    'name' => $_FILES['uploaded_files']['name'][$i],
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula (Handoff communication compliance rate)
        $missed = intval($this->input->post('missed_handoffs')) ?: 0;
        $total = intval($this->input->post('total_handoffs')) ?: 0;
        $dataset['handoff_compliance_rate'] = ($total > 0) ? round((($total - $missed) / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI3j13($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3j13?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3j13_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3j13', $data);
    }
}

// ---------------------------------------------------------------------
// CQI3j14 - IPSG 2.2 - Hand off communication interdepartmental shift (Nurses)-(Nursing - ICU)
public function edit_feedback_CQI3j14() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3j14', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3j14', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3j14_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3j14_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];

        $existingFiles = $dataset['files_name'] ?? [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            $count = count($_FILES['uploaded_files']['name']);
            for ($i = 0; $i < $count; $i++) {
                $_FILES['file'] = [
                    'name' => $_FILES['uploaded_files']['name'][$i],
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula (Handoff communication compliance rate)
        $missed = intval($this->input->post('missed_handoffs')) ?: 0;
        $total = intval($this->input->post('total_handoffs')) ?: 0;
        $dataset['handoff_compliance_rate'] = ($total > 0) ? round((($total - $missed) / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI3j14($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3j14?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3j14_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3j14', $data);
    }
}

// ---------------------------------------------------------------------
// CQI3j15 - IPSG 2.2 - Hand off communication interdepartmental shift (Nurses)-(Nursing - Ward)
public function edit_feedback_CQI3j15() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3j15', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3j15', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3j15_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3j15_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];

        $existingFiles = $dataset['files_name'] ?? [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            $count = count($_FILES['uploaded_files']['name']);
            for ($i = 0; $i < $count; $i++) {
                $_FILES['file'] = [
                    'name' => $_FILES['uploaded_files']['name'][$i],
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula (Handoff communication compliance rate)
        $missed = intval($this->input->post('missed_handoffs')) ?: 0;
        $total = intval($this->input->post('total_handoffs')) ?: 0;
        $dataset['handoff_compliance_rate'] = ($total > 0) ? round((($total - $missed) / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI3j15($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3j15?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3j15_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3j15', $data);
    }
}
// ---------------------------------------------------------------------
public function edit_feedback_CQI3j16() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3j16', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3j16', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3j16_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3j16_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];

        $existingFiles = $dataset['files_name'] ?? [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            $count = count($_FILES['uploaded_files']['name']);
            for ($i = 0; $i < $count; $i++) {
                $_FILES['file'] = [
                    'name' => $_FILES['uploaded_files']['name'][$i],
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: Handoff compliance rate among doctors
        $missed = intval($this->input->post('missed_handoffs')) ?: 0;
        $total = intval($this->input->post('total_handoffs')) ?: 0;
        $dataset['handoff_compliance_rate'] = ($total > 0) ? round((($total - $missed) / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI3j16($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3j16?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3j16_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3j16', $data);
    }
}

// ---------------------------------------------------------------------
public function edit_feedback_CQI3j17() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3j17', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3j17', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3j17_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3j17_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];

        $existingFiles = $dataset['files_name'] ?? [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            $count = count($_FILES['uploaded_files']['name']);
            for ($i = 0; $i < $count; $i++) {
                $_FILES['file'] = [
                    'name' => $_FILES['uploaded_files']['name'][$i],
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        $missed = intval($this->input->post('missed_handoffs')) ?: 0;
        $total = intval($this->input->post('total_handoffs')) ?: 0;
        $dataset['handoff_compliance_rate'] = ($total > 0) ? round((($total - $missed) / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI3j17($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3j17?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3j17_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3j17', $data);
    }
}

// ---------------------------------------------------------------------
public function edit_feedback_CQI3j18() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3j18', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3j18', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3j18_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3j18_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];

        $existingFiles = $dataset['files_name'] ?? [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            $count = count($_FILES['uploaded_files']['name']);
            for ($i = 0; $i < $count; $i++) {
                $_FILES['file'] = [
                    'name' => $_FILES['uploaded_files']['name'][$i],
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        $missed = intval($this->input->post('missed_handoffs')) ?: 0;
        $total = intval($this->input->post('total_handoffs')) ?: 0;
        $dataset['handoff_compliance_rate'] = ($total > 0) ? round((($total - $missed) / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI3j18($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3j18?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3j18_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3j18', $data);
    }
}
// ---------------------------------------------------------------------
public function edit_feedback_CQI3j19() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3j19', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3j19', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3j19_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3j19_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];

        $existingFiles = $dataset['files_name'] ?? [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            $count = count($_FILES['uploaded_files']['name']);
            for ($i = 0; $i < $count; $i++) {
                $_FILES['file'] = [
                    'name' => $_FILES['uploaded_files']['name'][$i],
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: Handoff compliance rate among nurses
        $missed = intval($this->input->post('missed_handoffs')) ?: 0;
        $total = intval($this->input->post('total_handoffs')) ?: 0;
        $dataset['handoff_compliance_rate'] = ($total > 0) ? round((($total - $missed) / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI3j19($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3j19?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3j19_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3j19', $data);
    }
}
// ---------------------------------------------------------------------
public function edit_feedback_CQI3j20() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3j20', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3j20', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3j20_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3j20_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];

        $existingFiles = $dataset['files_name'] ?? [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            $count = count($_FILES['uploaded_files']['name']);
            for ($i = 0; $i < $count; $i++) {
                $_FILES['file'] = [
                    'name' => $_FILES['uploaded_files']['name'][$i],
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: Handoff compliance rate among nurses
        $missed = intval($this->input->post('missed_handoffs')) ?: 0;
        $total = intval($this->input->post('total_handoffs')) ?: 0;
        $dataset['handoff_compliance_rate'] = ($total > 0) ? round((($total - $missed) / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI3j20($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3j20?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3j20_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3j20', $data);
    }
}
// ---------------------------------------------------------------------
public function edit_feedback_CQI3j21() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3j21', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3j21', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3j21_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3j21_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];

        $existingFiles = $dataset['files_name'] ?? [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            $count = count($_FILES['uploaded_files']['name']);
            for ($i = 0; $i < $count; $i++) {
                $_FILES['file'] = [
                    'name' => $_FILES['uploaded_files']['name'][$i],
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: Surgical compliance (correct site/procedure/patient)
        $non_compliant = intval($this->input->post('non_compliant_cases')) ?: 0;
        $total = intval($this->input->post('total_cases')) ?: 0;
        $dataset['surgical_compliance_rate'] = ($total > 0) ? round((($total - $non_compliant) / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI3j21($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3j21?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3j21_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3j21', $data);
    }
}
// ---------------------------------------------------------------------
public function edit_feedback_CQI3j22() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3j22', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3j22', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3j22_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3j22_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];

        $existingFiles = $dataset['files_name'] ?? [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            $count = count($_FILES['uploaded_files']['name']);
            for ($i = 0; $i < $count; $i++) {
                $_FILES['file'] = [
                    'name' => $_FILES['uploaded_files']['name'][$i],
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        $non_compliant = intval($this->input->post('non_compliant_cases')) ?: 0;
        $total = intval($this->input->post('total_cases')) ?: 0;
        $dataset['surgical_compliance_rate'] = ($total > 0) ? round((($total - $non_compliant) / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI3j22($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3j22?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3j22_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3j22', $data);
    }
}
// ---------------------------------------------------------------------
public function edit_feedback_CQI3j23() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3j23', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3j23', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3j23_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3j23_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];

        $existingFiles = $dataset['files_name'] ?? [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            $count = count($_FILES['uploaded_files']['name']);
            for ($i = 0; $i < $count; $i++) {
                $_FILES['file'] = [
                    'name' => $_FILES['uploaded_files']['name'][$i],
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula (Correct Site/Procedure Compliance Rate)
        $correct = intval($this->input->post('correct_cases')) ?: 0;
        $total = intval($this->input->post('total_surgeries')) ?: 0;
        $dataset['compliance_rate'] = ($total > 0) ? round(($correct / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI3j23($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3j23?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3j23_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3j23', $data);
    }
}
// ---------------------------------------------------------------------
public function edit_feedback_CQI3j24() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3j24', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3j24', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3j24_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3j24_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];

        $existingFiles = $dataset['files_name'] ?? [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            $count = count($_FILES['uploaded_files']['name']);
            for ($i = 0; $i < $count; $i++) {
                $_FILES['file'] = [
                    'name' => $_FILES['uploaded_files']['name'][$i],
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula (Fall Prevention Compliance)
        $compliant = intval($this->input->post('fall_measures_complied')) ?: 0;
        $total = intval($this->input->post('total_patients')) ?: 0;
        $dataset['compliance_rate'] = ($total > 0) ? round(($compliant / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI3j24($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3j24?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3j24_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3j24', $data);
    }
}
// ---------------------------------------------------------------------
public function edit_feedback_CQI3j25() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3j25', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3j25', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3j25_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3j25_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];

        $existingFiles = $dataset['files_name'] ?? [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            $count = count($_FILES['uploaded_files']['name']);
            for ($i = 0; $i < $count; $i++) {
                $_FILES['file'] = [
                    'name' => $_FILES['uploaded_files']['name'][$i],
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula (Fall Prevention Compliance)
        $compliant = intval($this->input->post('fall_measures_complied')) ?: 0;
        $total = intval($this->input->post('total_patients')) ?: 0;
        $dataset['compliance_rate'] = ($total > 0) ? round(($compliant / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI3j25($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3j25?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3j25_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3j25', $data);
    }
}
// ---------------------------------------------------------------------
public function edit_feedback_CQI3j26() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3j26', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3j26', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3j26_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3j26_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];

        $existingFiles = $dataset['files_name'] ?? [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            $count = count($_FILES['uploaded_files']['name']);
            for ($i = 0; $i < $count; $i++) {
                $_FILES['file'] = [
                    'name' => $_FILES['uploaded_files']['name'][$i],
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula (Fall Prevention Compliance in Physiotherapy OP)
        $compliant = intval($this->input->post('fall_measures_complied')) ?: 0;
        $total = intval($this->input->post('total_patients')) ?: 0;
        $dataset['compliance_rate'] = ($total > 0) ? round(($compliant / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI3j26($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3j26?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3j26_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3j26', $data);
    }
}
// ---------------------------------------------------------------------
public function edit_feedback_CQI3j27() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3j27', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3j27', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3j27_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3j27_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];

        $existingFiles = $dataset['files_name'] ?? [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            $count = count($_FILES['uploaded_files']['name']);
            for ($i = 0; $i < $count; $i++) {
                $_FILES['file'] = [
                    'name' => $_FILES['uploaded_files']['name'][$i],
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula (Hand Hygiene Compliance)
        $missed = intval($this->input->post('missed_opportunities')) ?: 0;
        $total = intval($this->input->post('total_opportunities')) ?: 0;
        $dataset['hand_hygiene_compliance'] = ($total > 0) ? round((($total - $missed) / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI3j27($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3j27?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3j27_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3j27', $data);
    }
}
// ---------------------------------------------------------------------
public function edit_feedback_CQI3j28() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3j28', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3j28', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3j28_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3j28_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];

        $existingFiles = $dataset['files_name'] ?? [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            $count = count($_FILES['uploaded_files']['name']);
            for ($i = 0; $i < $count; $i++) {
                $_FILES['file'] = [
                    'name' => $_FILES['uploaded_files']['name'][$i],
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula (Patient Identification Compliance)
        $identified = intval($this->input->post('correctly_identified')) ?: 0;
        $total = intval($this->input->post('total_patients')) ?: 0;
        $dataset['compliance_rate'] = ($total > 0) ? round(($identified / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI3j28($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3j28?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3j28_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3j28', $data);
    }
}
// ---------------------------------------------------------------------
public function edit_feedback_CQI3j29() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3j29', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3j29', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3j29_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3j29_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];

        $existingFiles = $dataset['files_name'] ?? [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            $count = count($_FILES['uploaded_files']['name']);
            for ($i = 0; $i < $count; $i++) {
                $_FILES['file'] = [
                    'name' => $_FILES['uploaded_files']['name'][$i],
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula (Handover Compliance Rate)
        $successful = intval($this->input->post('successful_handovers')) ?: 0;
        $total = intval($this->input->post('total_handovers')) ?: 0;
        $dataset['handover_compliance'] = ($total > 0) ? round(($successful / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI3j29($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3j29?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3j29_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3j29', $data);
    }
}
// ---------------------------------------------------------------------
public function edit_feedback_CQI3j30() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3j30', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3j30', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3j30_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3j30_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];

        $existingFiles = $dataset['files_name'] ?? [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            $count = count($_FILES['uploaded_files']['name']);
            for ($i = 0; $i < $count; $i++) {
                $_FILES['file'] = [
                    'name' => $_FILES['uploaded_files']['name'][$i],
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula (Adverse Event Rate)
        $adverse = intval($this->input->post('adverse_events')) ?: 0;
        $total = intval($this->input->post('total_sessions')) ?: 0;
        $dataset['adverse_event_rate'] = ($total > 0) ? round(($adverse / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI3j30($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3j30?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3j30_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3j30', $data);
    }
}
// ---------------------------------------------------------------------
public function edit_feedback_CQI3j31() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3j31', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3j31', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3j31_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3j31_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];

        $existingFiles = $dataset['files_name'] ?? [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            $count = count($_FILES['uploaded_files']['name']);
            for ($i = 0; $i < $count; $i++) {
                $_FILES['file'] = [
                    'name' => $_FILES['uploaded_files']['name'][$i],
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula (Adverse Event Rate OPD)
        $adverse = intval($this->input->post('adverse_events')) ?: 0;
        $total = intval($this->input->post('total_sessions')) ?: 0;
        $dataset['adverse_event_rate'] = ($total > 0) ? round(($adverse / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI3j31($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3j31?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3j31_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3j31', $data);
    }
}

// ---------------------------------------------------------------------
public function edit_feedback_CQI3j32() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3j32', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3j32', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3j32_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3j32_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];

        $existingFiles = $dataset['files_name'] ?? [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            $count = count($_FILES['uploaded_files']['name']);
            for ($i = 0; $i < $count; $i++) {
                $_FILES['file'] = [
                    'name' => $_FILES['uploaded_files']['name'][$i],
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula (Correct Surgery Compliance)
        $incorrect = intval($this->input->post('incorrect_cases')) ?: 0;
        $total = intval($this->input->post('total_cases')) ?: 0;
        $dataset['surgery_compliance_rate'] = ($total > 0) ? round((($total - $incorrect) / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI3j32($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3j32?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3j32_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3j32', $data);
    }
}

// ---------------------------------------------------------------------
public function edit_feedback_CQI3j33() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3j33', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3j33', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3j33_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3j33_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];

        $existingFiles = $dataset['files_name'] ?? [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            $count = count($_FILES['uploaded_files']['name']);
            for ($i = 0; $i < $count; $i++) {
                $_FILES['file'] = [
                    'name' => $_FILES['uploaded_files']['name'][$i],
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula (Security Incident Rate)
        $incidents = intval($this->input->post('security_incidents')) ?: 0;
        $total = intval($this->input->post('total_patients')) ?: 0;
        $dataset['security_incident_rate'] = ($total > 0) ? round(($incidents / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI3j33($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3j33?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3j33_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3j33', $data);
    }
}

// ---------------------------------------------------------------------
public function edit_feedback_CQI3j34() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3j34', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3j34', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3j34_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3j34_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];

        $existingFiles = $dataset['files_name'] ?? [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            $count = count($_FILES['uploaded_files']['name']);
            for ($i = 0; $i < $count; $i++) {
                $_FILES['file'] = [
                    'name' => $_FILES['uploaded_files']['name'][$i],
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula (Safety Incident Rate)
        $incidents = intval($this->input->post('safety_incidents')) ?: 0;
        $total = intval($this->input->post('total_patients')) ?: 0;
        $dataset['safety_incident_rate'] = ($total > 0) ? round(($incidents / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI3j34($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3j34?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3j34_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3j34', $data);
    }
}
// ---------------------------------------------------------------------
public function edit_feedback_CQI4a1() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4a1', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4a1', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4a1_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4a1_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];

        $existingFiles = $dataset['files_name'] ?? [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            $count = count($_FILES['uploaded_files']['name']);
            for ($i = 0; $i < $count; $i++) {
                $_FILES['file'] = [
                    'name' => $_FILES['uploaded_files']['name'][$i],
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula (Example)
        $total = intval($this->input->post('total_items')) ?: 0;
        $local = intval($this->input->post('local_purchases')) ?: 0;
        $dataset['percentage_local_procured'] = ($total > 0) ? round(($local / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI4a1($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4a1?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4a1_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4a1', $data);
    }
}
// ---------------------------------------------------------------------
public function edit_feedback_CQI4a2() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4a2', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4a2', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4a2_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4a2_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];

        $existingFiles = $dataset['files_name'] ?? [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            $count = count($_FILES['uploaded_files']['name']);
            for ($i = 0; $i < $count; $i++) {
                $_FILES['file'] = [
                    'name' => $_FILES['uploaded_files']['name'][$i],
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula (Outside Formulary Purchase %)
        $outside = intval($this->input->post('outside_formulary')) ?: 0;
        $total = intval($this->input->post('total_purchases')) ?: 0;
        $dataset['outside_formulary_percentage'] = ($total > 0) ? round(($outside / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI4a2($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4a2?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4a2_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4a2', $data);
    }
}
// ---------------------------------------------------------------------
public function edit_feedback_CQI4a3() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4a3', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4a3', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4a3_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4a3_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];

        $existingFiles = $dataset['files_name'] ?? [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            $count = count($_FILES['uploaded_files']['name']);
            for ($i = 0; $i < $count; $i++) {
                $_FILES['file'] = [
                    'name' => $_FILES['uploaded_files']['name'][$i],
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula (Stock Out Rate)
        $stockout_days = intval($this->input->post('stockout_days')) ?: 0;
        $total_days = intval($this->input->post('total_days')) ?: 0;
        $dataset['stockout_rate'] = ($total_days > 0) ? round(($stockout_days / $total_days) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI4a3($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4a3?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4a3_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4a3', $data);
    }
}
// ---------------------------------------------------------------------
public function edit_feedback_CQI4a4() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4a4', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4a4', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4a4_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4a4_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];

        $existingFiles = $dataset['files_name'] ?? [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            $count = count($_FILES['uploaded_files']['name']);
            for ($i = 0; $i < $count; $i++) {
                $_FILES['file'] = [
                    'name' => $_FILES['uploaded_files']['name'][$i],
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula (Rejection %)
        $rejected = intval($this->input->post('rejected_items')) ?: 0;
        $total = intval($this->input->post('total_items_received')) ?: 0;
        $dataset['rejection_percentage'] = ($total > 0) ? round(($rejected / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI4a4($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4a4?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4a4_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4a4', $data);
    }
}
// ---------------------------------------------------------------------
public function edit_feedback_CQI4a5() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4a5', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4a5', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4a5_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4a5_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];

        $existingFiles = $dataset['files_name'] ?? [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            $count = count($_FILES['uploaded_files']['name']);
            for ($i = 0; $i < $count; $i++) {
                $_FILES['file'] = [
                    'name' => $_FILES['uploaded_files']['name'][$i],
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula (Variation %)
        $variations = intval($this->input->post('variation_cases')) ?: 0;
        $total = intval($this->input->post('total_procurements')) ?: 0;
        $dataset['variation_percentage'] = ($total > 0) ? round(($variations / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI4a5($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4a5?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4a5_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4a5', $data);
    }
}
// ---------------------------------------------------------------------
// âœ… CQI4b1 - Incidence of bed sores (hospital associated pressure ulcers) after admission (in 1000 patient days)-(Nursing)
public function edit_feedback_CQI4b1() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4b1', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4b1', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4b1_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4b1_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];

        $existingFiles = $dataset['files_name'] ?? [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            $count = count($_FILES['uploaded_files']['name']);
            for ($i = 0; $i < $count; $i++) {
                $_FILES['file'] = [
                    'name' => $_FILES['uploaded_files']['name'][$i],
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula (Example Placeholder)
        $total = intval($this->input->post('total_patients')) ?: 0;
        $bedsores = intval($this->input->post('bed_sore_cases')) ?: 0;
        $dataset['bed_sore_rate'] = ($total > 0) ? round(($bedsores / $total) * 1000, 2) : 0;

        $this->quality_model->update_feedback_CQI4b1($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4b1?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4b1_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4b1', $data);
    }
}
// ---------------------------------------------------------------------
// âœ… CQI4b2 - Incidence of falls (in 1000 IPD days)-(Office-Quality)
public function edit_feedback_CQI4b2() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4b2', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4b2', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4b2_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4b2_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];

        $existingFiles = $dataset['files_name'] ?? [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            $count = count($_FILES['uploaded_files']['name']);
            for ($i = 0; $i < $count; $i++) {
                $_FILES['file'] = [
                    'name' => $_FILES['uploaded_files']['name'][$i],
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula (Falls rate per 1000 IPD days)
        $falls = intval($this->input->post('fall_cases')) ?: 0;
        $ipd_days = intval($this->input->post('ipd_days')) ?: 0;
        $dataset['fall_rate'] = ($ipd_days > 0) ? round(($falls / $ipd_days) * 1000, 2) : 0;

        $this->quality_model->update_feedback_CQI4b2($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4b2?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4b2_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4b2', $data);
    }
}

// ---------------------------------------------------------------------
// âœ… CQI4b3 - Number of variations observed in mock drill(Safety & Security)
public function edit_feedback_CQI4b3() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4b3', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4b3', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4b3_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4b3_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];

        $existingFiles = $dataset['files_name'] ?? [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            $count = count($_FILES['uploaded_files']['name']);
            for ($i = 0; $i < $count; $i++) {
                $_FILES['file'] = [
                    'name' => $_FILES['uploaded_files']['name'][$i],
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula (Variation count)
        $dataset['variation_count'] = intval($this->input->post('variations')) ?: 0;

        $this->quality_model->update_feedback_CQI4b3($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4b3?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4b3_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4b3', $data);
    }
}

// ---------------------------------------------------------------------
// âœ… CQI4b4 - Percentage of staff provided with pre-exposure prophylaxis(Infection Control)
public function edit_feedback_CQI4b4() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4b4', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4b4', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4b4_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4b4_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];

        $existingFiles = $dataset['files_name'] ?? [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            $count = count($_FILES['uploaded_files']['name']);
            for ($i = 0; $i < $count; $i++) {
                $_FILES['file'] = [
                    'name' => $_FILES['uploaded_files']['name'][$i],
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula (Staff prophylaxis %)
        $given = intval($this->input->post('staff_given')) ?: 0;
        $total = intval($this->input->post('total_staff')) ?: 0;
        $dataset['prophylaxis_percentage'] = ($total > 0) ? round(($given / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI4b4($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4b4?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4b4_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4b4', $data);
    }
}
// âœ… CQI4b5 - Number of Fire Incidents (Safety & Security)
public function edit_feedback_CQI4b5() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4b5', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4b5', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4b5_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4b5_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];

        $existingFiles = $dataset['files_name'] ?? [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            $count = count($_FILES['uploaded_files']['name']);
            for ($i = 0; $i < $count; $i++) {
                $_FILES['file'] = [
                    'name' => $_FILES['uploaded_files']['name'][$i],
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula (Number of Fire Incidents)
        $dataset['fire_incidents'] = intval($this->input->post('fire_incidents')) ?: 0;

        $this->quality_model->update_feedback_CQI4b5($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4b5?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4b5_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4b5', $data);
    }
}
// âœ… CQI4b6 
public function edit_feedback_CQI4b6() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4b6', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4b6', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4b6_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4b6_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];

        $existingFiles = $dataset['files_name'] ?? [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            $count = count($_FILES['uploaded_files']['name']);
            for ($i = 0; $i < $count; $i++) {
                $_FILES['file'] = [
                    'name' => $_FILES['uploaded_files']['name'][$i],
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula (Number of Fire Incidents)
        $dataset['fire_incidents'] = intval($this->input->post('fire_incidents')) ?: 0;

        $this->quality_model->update_feedback_CQI4b6($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4b6?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4b6_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4b6', $data);
    }
}
// âœ… CQI4b7 - Number of Extravasation (Nursing)
public function edit_feedback_CQI4b7() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4b7', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4b7', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4b7_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4b7_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];

        $existingFiles = $dataset['files_name'] ?? [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            $count = count($_FILES['uploaded_files']['name']);
            for ($i = 0; $i < $count; $i++) {
                $_FILES['file'] = [
                    'name' => $_FILES['uploaded_files']['name'][$i],
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula (Number of Extravasation)
        $dataset['extravasation_cases'] = intval($this->input->post('extravasation_cases')) ?: 0;

        $this->quality_model->update_feedback_CQI4b7($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4b7?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4b7_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4b7', $data);
    }
}
// âœ… CQI4b8 - Monitoring of Clinical Errors (JCI8-PCC 2.3)-(Quality Office)
public function edit_feedback_CQI4b8() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4b8', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4b8', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4b8_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4b8_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];

        $existingFiles = $dataset['files_name'] ?? [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            $count = count($_FILES['uploaded_files']['name']);
            for ($i = 0; $i < $count; $i++) {
                $_FILES['file'] = [
                    'name' => $_FILES['uploaded_files']['name'][$i],
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula (Total Clinical Errors)
        $dataset['clinical_errors'] = intval($this->input->post('clinical_errors')) ?: 0;

        $this->quality_model->update_feedback_CQI4b8($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4b8?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4b8_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4b8', $data);
    }
}
// âœ… CQI4c1 - Bed Occupancy Rate (MRD)
public function edit_feedback_CQI4c1() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4c1', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4c1', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4c1_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4c1_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];

        $existingFiles = $dataset['files_name'] ?? [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            $count = count($_FILES['uploaded_files']['name']);
            for ($i = 0; $i < $count; $i++) {
                $_FILES['file'] = [
                    'name' => $_FILES['uploaded_files']['name'][$i],
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula (Bed Occupancy Rate %)
        $occupied_bed_days = intval($this->input->post('occupied_bed_days')) ?: 0;
        $available_bed_days = intval($this->input->post('available_bed_days')) ?: 0;
        $dataset['bed_occupancy_rate'] = ($available_bed_days > 0)
            ? round(($occupied_bed_days / $available_bed_days) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI4c1($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4c1?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4c1_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4c1', $data);
    }
}
// âœ… CQI4c2 - Average Length of Stay (MRD)
public function edit_feedback_CQI4c2() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4c2', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4c2', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4c2_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4c2_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];

        $existingFiles = $dataset['files_name'] ?? [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            $count = count($_FILES['uploaded_files']['name']);
            for ($i = 0; $i < $count; $i++) {
                $_FILES['file'] = [
                    'name' => $_FILES['uploaded_files']['name'][$i],
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula (Average Length of Stay)
        $total_patient_days = intval($this->input->post('total_patient_days')) ?: 0;
        $total_discharges = intval($this->input->post('total_discharges')) ?: 0;
        $dataset['average_length_of_stay'] = ($total_discharges > 0)
            ? round($total_patient_days / $total_discharges, 2) : 0;

        $this->quality_model->update_feedback_CQI4c2($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4c2?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4c2_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4c2', $data);
    }
}
// âœ… CQI4c3 - OT Utilisation Rate (OT)
public function edit_feedback_CQI4c3() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4c3', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4c3', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4c3_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4c3_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];

        $existingFiles = $dataset['files_name'] ?? [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            $count = count($_FILES['uploaded_files']['name']);
            for ($i = 0; $i < $count; $i++) {
                $_FILES['file'] = [
                    'name' => $_FILES['uploaded_files']['name'][$i],
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula (OT Utilisation %)
        $actual = intval($this->input->post('actual_ot_hours')) ?: 0;
        $available = intval($this->input->post('available_ot_hours')) ?: 0;
        $dataset['ot_utilisation_rate'] = ($available > 0) ? round(($actual / $available) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI4c3($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4c3?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4c3_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4c3', $data);
    }
}
// âœ… CQI4c4 - ICU equipment utilisation rate (Nursing - ICU1)
public function edit_feedback_CQI4c4() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4c4', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4c4', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4c4_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4c4_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];

        $existingFiles = $dataset['files_name'] ?? [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            $count = count($_FILES['uploaded_files']['name']);
            for ($i = 0; $i < $count; $i++) {
                $_FILES['file'] = [
                    'name' => $_FILES['uploaded_files']['name'][$i],
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula (Equipment Utilisation %)
        $used = intval($this->input->post('equipment_used_hours')) ?: 0;
        $available = intval($this->input->post('equipment_available_hours')) ?: 0;
        $dataset['equipment_utilisation_rate'] = ($available > 0) ? round(($used / $available) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI4c4($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4c4?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4c4_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4c4', $data);
    }
}
// âœ… CQI4c5 - ICU equipment utilisation rate (Nursing - ICU2)
public function edit_feedback_CQI4c5() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4c5', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4c5', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4c5_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4c5_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];

        $existingFiles = $dataset['files_name'] ?? [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            $count = count($_FILES['uploaded_files']['name']);
            for ($i = 0; $i < $count; $i++) {
                $_FILES['file'] = [
                    'name' => $_FILES['uploaded_files']['name'][$i],
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula (Equipment Utilisation %)
        $used = intval($this->input->post('equipment_used_hours')) ?: 0;
        $available = intval($this->input->post('equipment_available_hours')) ?: 0;
        $dataset['equipment_utilisation_rate'] = ($available > 0) ? round(($used / $available) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI4c5($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4c5?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4c5_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4c5', $data);
    }
}
// âœ… CQI4c6 - ICU equipment utilisation rate (Nursing - ICU3)
public function edit_feedback_CQI4c6() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4c6', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4c6', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4c6_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4c6_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];

        $existingFiles = $dataset['files_name'] ?? [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            $count = count($_FILES['uploaded_files']['name']);
            for ($i = 0; $i < $count; $i++) {
                $_FILES['file'] = [
                    'name' => $_FILES['uploaded_files']['name'][$i],
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula (Equipment Utilisation %)
        $used = intval($this->input->post('equipment_used_hours')) ?: 0;
        $available = intval($this->input->post('equipment_available_hours')) ?: 0;
        $dataset['equipment_utilisation_rate'] = ($available > 0) ? round(($used / $available) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI4c6($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4c6?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4c6_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4c6', $data);
    }
}
// âœ… CQI4c7 - ICU Bed utilisation rate (Nursing - ICU)
public function edit_feedback_CQI4c7() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4c7', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4c7', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4c7_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4c7_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];

        $existingFiles = $dataset['files_name'] ?? [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            $count = count($_FILES['uploaded_files']['name']);
            for ($i = 0; $i < $count; $i++) {
                $_FILES['file'] = [
                    'name' => $_FILES['uploaded_files']['name'][$i],
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula (Bed Utilisation %)
        $occupied = intval($this->input->post('beds_occupied_days')) ?: 0;
        $available = intval($this->input->post('beds_available_days')) ?: 0;
        $dataset['bed_utilisation_rate'] = ($available > 0) ? round(($occupied / $available) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI4c7($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4c7?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4c7_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4c7', $data);
    }
}
// âœ… CQI4c8 - Critical equipment downtime (Biomedical Engineering)
public function edit_feedback_CQI4c8() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4c8', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4c8', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4c8_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4c8_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];

        $existingFiles = $dataset['files_name'] ?? [];
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            $count = count($_FILES['uploaded_files']['name']);
            for ($i = 0; $i < $count; $i++) {
                $_FILES['file'] = [
                    'name' => $_FILES['uploaded_files']['name'][$i],
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula (Downtime %)
        $downtime = intval($this->input->post('equipment_downtime_hours')) ?: 0;
        $total = intval($this->input->post('total_equipment_hours')) ?: 0;
        $dataset['downtime_percentage'] = ($total > 0) ? round(($downtime / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI4c8($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4c8?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4c8_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4c8', $data);
    }
}
// âœ… CQI4c9 - Cath lab utilization rate (Cath Lab - Nursing)
public function edit_feedback_CQI4c9() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4c9', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4c9', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4c9_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4c9_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = ['upload_path' => './api/file_uploads/', 'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'];
            $count = count($_FILES['uploaded_files']['name']);
            for ($i = 0; $i < $count; $i++) {
                $_FILES['file'] = [
                    'name' => $_FILES['uploaded_files']['name'][$i],
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = ['url' => base_url('api/file_uploads/' . $up['file_name']), 'name' => $up['file_name']];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula (Cath lab utilization %)
        $used = intval($this->input->post('hours_used')) ?: 0;
        $available = intval($this->input->post('hours_available')) ?: 0;
        $dataset['utilization_percentage'] = ($available > 0) ? round(($used / $available) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI4c9($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4c9?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4c9_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4c9', $data);
    }
}
// âœ… CQI4c10 - Nurse patient ratio for ICU Ventilated (Nursing-ICU)
public function edit_feedback_CQI4c10() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4c10', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4c10', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4c10_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4c10_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = ['upload_path' => './api/file_uploads/', 'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'];
            $count = count($_FILES['uploaded_files']['name']);
            for ($i = 0; $i < $count; $i++) {
                $_FILES['file'] = [
                    'name' => $_FILES['uploaded_files']['name'][$i],
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = ['url' => base_url('api/file_uploads/' . $up['file_name']), 'name' => $up['file_name']];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula (Nurse-patient ratio ventilated)
        $nurse = intval($this->input->post('nurse_count')) ?: 0;
        $patients = intval($this->input->post('ventilated_patients')) ?: 0;
        $dataset['nurse_patient_ratio'] = ($patients > 0) ? round(($nurse / $patients), 2) : 0;

        $this->quality_model->update_feedback_CQI4c10($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4c10?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4c10_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4c10', $data);
    }
}
// âœ… CQI4c11 - Nurse patient ratio for ICU Non Ventilated (Nursing-ICU)
public function edit_feedback_CQI4c11() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4c11', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4c11', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4c11_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4c11_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = ['upload_path' => './api/file_uploads/', 'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'];
            $count = count($_FILES['uploaded_files']['name']);
            for ($i = 0; $i < $count; $i++) {
                $_FILES['file'] = [
                    'name' => $_FILES['uploaded_files']['name'][$i],
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = ['url' => base_url('api/file_uploads/' . $up['file_name']), 'name' => $up['file_name']];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula (Nurse-patient ratio non-ventilated)
        $nurse = intval($this->input->post('nurse_count')) ?: 0;
        $patients = intval($this->input->post('non_ventilated_patients')) ?: 0;
        $dataset['nurse_patient_ratio'] = ($patients > 0) ? round(($nurse / $patients), 2) : 0;

        $this->quality_model->update_feedback_CQI4c11($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4c11?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4c11_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4c11', $data);
    }
}
// âœ… CQI4c12 - Nurse patient ratio for HDU (Nursing-HDU)
public function edit_feedback_CQI4c12() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4c12', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4c12', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4c12_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4c12_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = ['upload_path' => './api/file_uploads/', 'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'];
            $count = count($_FILES['uploaded_files']['name']);
            for ($i = 0; $i < $count; $i++) {
                $_FILES['file'] = [
                    'name' => $_FILES['uploaded_files']['name'][$i],
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = ['url' => base_url('api/file_uploads/' . $up['file_name']), 'name' => $up['file_name']];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula (Nurse-patient ratio HDU)
        $nurse = intval($this->input->post('nurse_count')) ?: 0;
        $patients = intval($this->input->post('hdu_patients')) ?: 0;
        $dataset['nurse_patient_ratio'] = ($patients > 0) ? round(($nurse / $patients), 2) : 0;

        $this->quality_model->update_feedback_CQI4c12($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4c12?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4c12_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4c12', $data);
    }
}
// âœ… CQI4c13 - Nurse patient ratio for Ward (Nursing-Ward)
public function edit_feedback_CQI4c13() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4c13', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4c13', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4c13_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4c13_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = ['upload_path' => './api/file_uploads/', 'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'];
            $count = count($_FILES['uploaded_files']['name']);
            for ($i = 0; $i < $count; $i++) {
                $_FILES['file'] = [
                    'name' => $_FILES['uploaded_files']['name'][$i],
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = ['url' => base_url('api/file_uploads/' . $up['file_name']), 'name' => $up['file_name']];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula (Nurse-patient ratio ward)
        $nurse = intval($this->input->post('nurse_count')) ?: 0;
        $patients = intval($this->input->post('ward_patients')) ?: 0;
        $dataset['nurse_patient_ratio'] = ($patients > 0) ? round(($nurse / $patients), 2) : 0;

        $this->quality_model->update_feedback_CQI4c13($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4c13?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4c13_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4c13', $data);
    }
}
// âœ… CQI4c14 - Engineering Critical equipment downtime (Engineering & Maintenance)
public function edit_feedback_CQI4c14() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4c14', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4c14', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4c14_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4c14_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = ['upload_path' => './api/file_uploads/', 'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'];
            $count = count($_FILES['uploaded_files']['name']);
            for ($i = 0; $i < $count; $i++) {
                $_FILES['file'] = [
                    'name' => $_FILES['uploaded_files']['name'][$i],
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = ['url' => base_url('api/file_uploads/' . $up['file_name']), 'name' => $up['file_name']];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula (Critical equipment downtime %)
        $downtime = floatval($this->input->post('equipment_downtime_hours')) ?: 0;
        $total_hours = floatval($this->input->post('total_operating_hours')) ?: 0;
        $dataset['downtime_percentage'] = ($total_hours > 0) ? round(($downtime / $total_hours) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI4c14($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4c14?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4c14_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4c14', $data);
    }
}
// âœ… CQI4d1 - Out patient satisfaction index (Patient Care Services - OPD)
public function edit_feedback_CQI4d1() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4d1', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4d1', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4d1_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4d1_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = ['upload_path' => './api/file_uploads/', 'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'];
            $count = count($_FILES['uploaded_files']['name']);
            for ($i = 0; $i < $count; $i++) {
                $_FILES['file'] = [
                    'name' => $_FILES['uploaded_files']['name'][$i],
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = ['url' => base_url('api/file_uploads/' . $up['file_name']), 'name' => $up['file_name']];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula (Outpatient satisfaction index)
        $satisfied = intval($this->input->post('satisfied_patients')) ?: 0;
        $total = intval($this->input->post('total_patients')) ?: 0;
        $dataset['opd_satisfaction_index'] = ($total > 0) ? round(($satisfied / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI4d1($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4d1?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4d1_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4d1', $data);
    }
}


// âœ… CQI4d2 - Inpatient satisfaction index (Patient Care Services - IPD)
public function edit_feedback_CQI4d2() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4d2', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4d2', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4d2_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4d2_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = ['upload_path' => './api/file_uploads/', 'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'];
            $count = count($_FILES['uploaded_files']['name']);
            for ($i = 0; $i < $count; $i++) {
                $_FILES['file'] = [
                    'name' => $_FILES['uploaded_files']['name'][$i],
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = ['url' => base_url('api/file_uploads/' . $up['file_name']), 'name' => $up['file_name']];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula (Inpatient satisfaction index)
        $satisfied = intval($this->input->post('satisfied_inpatients')) ?: 0;
        $total = intval($this->input->post('total_inpatients')) ?: 0;
        $dataset['ipd_satisfaction_index'] = ($total > 0) ? round(($satisfied / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI4d2($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4d2?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4d2_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4d2', $data);
    }
}
// âœ… CQI4d3 - Time taken for discharge - Cash Patients (Patient Care Services - Cash)
public function edit_feedback_CQI4d3() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4d3', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4d3', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4d3_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4d3_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = ['upload_path' => './api/file_uploads/', 'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'];
            $count = count($_FILES['uploaded_files']['name']);
            for ($i = 0; $i < $count; $i++) {
                $_FILES['file'] = [
                    'name' => $_FILES['uploaded_files']['name'][$i],
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = ['url' => base_url('api/file_uploads/' . $up['file_name']), 'name' => $up['file_name']];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula (Average time to discharge for cash patients â€” minutes)
        $total_minutes = floatval($this->input->post('total_discharge_minutes')) ?: 0;
        $cash_patients = intval($this->input->post('cash_discharges')) ?: 0;
        $dataset['avg_discharge_time_cash_min'] = ($cash_patients > 0) ? round($total_minutes / $cash_patients, 2) : 0;

        $this->quality_model->update_feedback_CQI4d3($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4d3?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4d3_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4d3', $data);
    }
}


// âœ… CQI4d4 - Time taken for discharge - Cashless Patients (Patient Care Services - Cashless)
public function edit_feedback_CQI4d4() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4d4', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4d4', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4d4_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4d4_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = ['upload_path' => './api/file_uploads/', 'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'];
            $count = count($_FILES['uploaded_files']['name']);
            for ($i = 0; $i < $count; $i++) {
                $_FILES['file'] = [
                    'name' => $_FILES['uploaded_files']['name'][$i],
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = ['url' => base_url('api/file_uploads/' . $up['file_name']), 'name' => $up['file_name']];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula (Average time to discharge for cashless patients â€” minutes)
        $total_minutes = floatval($this->input->post('total_discharge_minutes')) ?: 0;
        $cashless_patients = intval($this->input->post('cashless_discharges')) ?: 0;
        $dataset['avg_discharge_time_cashless_min'] = ($cashless_patients > 0) ? round($total_minutes / $cashless_patients, 2) : 0;

        $this->quality_model->update_feedback_CQI4d4($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4d4?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4d4_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4d4', $data);
    }
}


// âœ… CQI4d5 - Waiting time for diagnostic services (Radiology - CT)
public function edit_feedback_CQI4d5() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4d5', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4d5', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4d5_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4d5_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = ['upload_path' => './api/file_uploads/', 'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'];
            $count = count($_FILES['uploaded_files']['name']);
            for ($i = 0; $i < $count; $i++) {
                $_FILES['file'] = [
                    'name' => $_FILES['uploaded_files']['name'][$i],
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = ['url' => base_url('api/file_uploads/' . $up['file_name']), 'name' => $up['file_name']];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula (Average waiting time for CT â€” minutes)
        $total_wait_min = floatval($this->input->post('total_wait_minutes')) ?: 0;
        $requests = intval($this->input->post('ct_requests')) ?: 0;
        $dataset['avg_wait_ct_min'] = ($requests > 0) ? round($total_wait_min / $requests, 2) : 0;

        $this->quality_model->update_feedback_CQI4d5($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4d5?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4d5_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4d5', $data);
    }
}


// âœ… CQI4d6 - Waiting time for diagnostic services (Radiology - MRI)
public function edit_feedback_CQI4d6() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4d6', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4d6', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4d6_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4d6_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = ['upload_path' => './api/file_uploads/', 'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'];
            $count = count($_FILES['uploaded_files']['name']);
            for ($i = 0; $i < $count; $i++) {
                $_FILES['file'] = [
                    'name' => $_FILES['uploaded_files']['name'][$i],
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = ['url' => base_url('api/file_uploads/' . $up['file_name']), 'name' => $up['file_name']];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula (Average waiting time for MRI â€” minutes)
        $total_wait_min = floatval($this->input->post('total_wait_minutes')) ?: 0;
        $requests = intval($this->input->post('mri_requests')) ?: 0;
        $dataset['avg_wait_mri_min'] = ($requests > 0) ? round($total_wait_min / $requests, 2) : 0;

        $this->quality_model->update_feedback_CQI4d6($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4d6?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4d6_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4d6', $data);
    }
}


// âœ… CQI4d7 - Waiting time for diagnostic services (Radiology - USG)
public function edit_feedback_CQI4d7() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4d7', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4d7', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4d7_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4d7_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

       // 5ï¸âƒ£ Upload new files
        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $filesCount = count($_FILES['uploaded_files']['name']);
            $config = [
                'upload_path'  => './api/file_uploads/',
                'allowed_types'=> 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                'max_size'     => 50000,
                'encrypt_name' => FALSE
            ];
            $this->load->library('upload');
            for ($i = 0; $i < $filesCount; $i++) {
                $_FILES['file'] = [
                    'name'     => $_FILES['uploaded_files']['name'][$i],
                    'type'     => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error'    => $_FILES['uploaded_files']['error'][$i],
                    'size'     => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $uploadData = $this->upload->data();
                    $existingFiles[] = [
                        'url'  => base_url('api/file_uploads/' . $uploadData['file_name']),
                        'name' => $uploadData['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula (Average waiting time for USG â€” minutes)
        $total_wait_min = floatval($this->input->post('total_wait_minutes')) ?: 0;
        $requests = intval($this->input->post('usg_requests')) ?: 0;
        $dataset['avg_wait_usg_min'] = ($requests > 0) ? round($total_wait_min / $requests, 2) : 0;

        $this->quality_model->update_feedback_CQI4d7($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4d7?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4d7_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4d7', $data);
    }
}


// âœ… CQI4d8 - Waiting Time for OPD appointments (Patient Care Services - OPD)
public function edit_feedback_CQI4d8() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4d8', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4d8', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4d8_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4d8_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        // 5ï¸âƒ£ Upload new files
        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $filesCount = count($_FILES['uploaded_files']['name']);
            $config = [
                'upload_path'  => './api/file_uploads/',
                'allowed_types'=> 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                'max_size'     => 50000,
                'encrypt_name' => FALSE
            ];
            $this->load->library('upload');
            for ($i = 0; $i < $filesCount; $i++) {
                $_FILES['file'] = [
                    'name'     => $_FILES['uploaded_files']['name'][$i],
                    'type'     => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error'    => $_FILES['uploaded_files']['error'][$i],
                    'size'     => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $uploadData = $this->upload->data();
                    $existingFiles[] = [
                        'url'  => base_url('api/file_uploads/' . $uploadData['file_name']),
                        'name' => $uploadData['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula (Average waiting time for OPD appointments â€” minutes)
        $total_wait_min = floatval($this->input->post('total_wait_minutes')) ?: 0;
        $appointments = intval($this->input->post('appointments')) ?: 0;
        $dataset['avg_wait_opd_appointments_min'] = ($appointments > 0) ? round($total_wait_min / $appointments, 2) : 0;

        $this->quality_model->update_feedback_CQI4d8($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4d8?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4d8_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4d8', $data);
    }
}


// âœ… CQI4d9 - Waiting Time for OPD Walk-in (Patient Care Services - OPD)
public function edit_feedback_CQI4d9() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4d9', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4d9', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4d9_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4d9_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

       // 5ï¸âƒ£ Upload new files
        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $filesCount = count($_FILES['uploaded_files']['name']);
            $config = [
                'upload_path'  => './api/file_uploads/',
                'allowed_types'=> 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                'max_size'     => 50000,
                'encrypt_name' => FALSE
            ];
            $this->load->library('upload');
            for ($i = 0; $i < $filesCount; $i++) {
                $_FILES['file'] = [
                    'name'     => $_FILES['uploaded_files']['name'][$i],
                    'type'     => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error'    => $_FILES['uploaded_files']['error'][$i],
                    'size'     => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $uploadData = $this->upload->data();
                    $existingFiles[] = [
                        'url'  => base_url('api/file_uploads/' . $uploadData['file_name']),
                        'name' => $uploadData['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula (Average waiting time for OPD walk-in â€” minutes)
        $total_wait_min = floatval($this->input->post('total_wait_minutes')) ?: 0;
        $walkins = intval($this->input->post('walkin_patients')) ?: 0;
        $dataset['avg_wait_opd_walkin_min'] = ($walkins > 0) ? round($total_wait_min / $walkins, 2) : 0;

        $this->quality_model->update_feedback_CQI4d9($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4d9?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4d9_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4d9', $data);
    }
}


// âœ… CQI4d10 - Patient Satisfaction Rate (Nursing - OBG)
public function edit_feedback_CQI4d10() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4d10', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4d10', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4d10_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4d10_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

       // 5ï¸âƒ£ Upload new files
        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $filesCount = count($_FILES['uploaded_files']['name']);
            $config = [
                'upload_path'  => './api/file_uploads/',
                'allowed_types'=> 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx',
                'max_size'     => 50000,
                'encrypt_name' => FALSE
            ];
            $this->load->library('upload');
            for ($i = 0; $i < $filesCount; $i++) {
                $_FILES['file'] = [
                    'name'     => $_FILES['uploaded_files']['name'][$i],
                    'type'     => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error'    => $_FILES['uploaded_files']['error'][$i],
                    'size'     => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $uploadData = $this->upload->data();
                    $existingFiles[] = [
                        'url'  => base_url('api/file_uploads/' . $uploadData['file_name']),
                        'name' => $uploadData['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula (OBG patient satisfaction %)
        $satisfied = intval($this->input->post('satisfied_patients')) ?: 0;
        $total = intval($this->input->post('total_patients')) ?: 0;
        $dataset['obg_satisfaction_rate'] = ($total > 0) ? round(($satisfied / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI4d10($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4d10?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4d10_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4d10', $data);
    }
}


// âœ… CQI4d11 - Turn-around Time for Nursing call bell responds (Nursing)
public function edit_feedback_CQI4d11() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4d11', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4d11', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4d11_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4d11_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = ['upload_path' => './api/file_uploads/', 'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'];
            $count = count($_FILES['uploaded_files']['name']);
            for ($i = 0; $i < $count; $i++) {
                $_FILES['file'] = [
                    'name' => $_FILES['uploaded_files']['name'][$i],
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = ['url' => base_url('api/file_uploads/' . $up['file_name']), 'name' => $up['file_name']];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula (Average response time to call bell â€” minutes)
        $total_response_min = floatval($this->input->post('total_response_minutes')) ?: 0;
        $total_calls = intval($this->input->post('total_calls')) ?: 0;
        $dataset['avg_callbell_response_min'] = ($total_calls > 0) ? round($total_response_min / $total_calls, 2) : 0;

        $this->quality_model->update_feedback_CQI4d11($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4d11?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4d11_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4d11', $data);
    }
}
// âœ… CQI4e1 - Employee satisfaction index(HR)
public function edit_feedback_CQI4e1() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4e1', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4e1', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4e1_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4e1_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = ['upload_path' => './api/file_uploads/', 'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'];
            $count = count($_FILES['uploaded_files']['name']);
            for ($i = 0; $i < $count; $i++) {
                $_FILES['file'] = [
                    'name' => $_FILES['uploaded_files']['name'][$i],
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = ['url' => base_url('api/file_uploads/' . $up['file_name']), 'name' => $up['file_name']];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula (Employee satisfaction %)
        $satisfied = intval($this->input->post('satisfied_employees')) ?: 0;
        $total = intval($this->input->post('total_employees')) ?: 0;
        $dataset['employee_satisfaction_index'] = ($total > 0) ? round(($satisfied / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI4e1($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4e1?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4e1_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4e1', $data);
    }
}
// âœ… CQI4e2 - Employee Attrition Rate(HR)
public function edit_feedback_CQI4e2() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4e2', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4e2', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4e2_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4e2_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = ['upload_path' => './api/file_uploads/', 'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'];
            $count = count($_FILES['uploaded_files']['name']);
            for ($i = 0; $i < $count; $i++) {
                $_FILES['file'] = [
                    'name' => $_FILES['uploaded_files']['name'][$i],
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = ['url' => base_url('api/file_uploads/' . $up['file_name']), 'name' => $up['file_name']];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: (Employees Left / Avg Employees) * 100
        $left = intval($this->input->post('employees_left')) ?: 0;
        $avg = intval($this->input->post('average_employees')) ?: 0;
        $dataset['employee_attrition_rate'] = ($avg > 0) ? round(($left / $avg) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI4e2($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4e2?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4e2_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4e2', $data);
    }
}
// âœ… CQI4e3 - Employee absenteeism rate(HR)
public function edit_feedback_CQI4e3() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4e3', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4e3', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4e3_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4e3_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = ['upload_path' => './api/file_uploads/', 'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'];
            $count = count($_FILES['uploaded_files']['name']);
            for ($i = 0; $i < $count; $i++) {
                $_FILES['file'] = [
                    'name' => $_FILES['uploaded_files']['name'][$i],
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = ['url' => base_url('api/file_uploads/' . $up['file_name']), 'name' => $up['file_name']];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: (Absent Days / Total Working Days) * 100
        $absent = intval($this->input->post('absent_days')) ?: 0;
        $total = intval($this->input->post('total_working_days')) ?: 0;
        $dataset['employee_absenteeism_rate'] = ($total > 0) ? round(($absent / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI4e3($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4e3?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4e3_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4e3', $data);
    }
}
// âœ… CQI4e4 - Percentage of employees aware of rights, responsibility and welfare schemes (HR)
public function edit_feedback_CQI4e4() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4e4', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4e4', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4e4_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4e4_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = ['upload_path' => './api/file_uploads/', 'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'];
            foreach ($_FILES['uploaded_files']['name'] as $i => $fileName) {
                $_FILES['file'] = [
                    'name' => $fileName,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = ['url' => base_url('api/file_uploads/' . $up['file_name']), 'name' => $up['file_name']];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: (Aware Employees / Total Employees) * 100
        $aware = intval($this->input->post('aware_employees')) ?: 0;
        $total = intval($this->input->post('total_employees')) ?: 0;
        $dataset['awareness_percentage'] = ($total > 0) ? round(($aware / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI4e4($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4e4?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4e4_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4e4', $data);
    }
}
// âœ… CQI4e5 - Average number of training hours (HR)
public function edit_feedback_CQI4e5() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4e5', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4e5', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4e5_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4e5_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = ['upload_path' => './api/file_uploads/', 'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'];
            foreach ($_FILES['uploaded_files']['name'] as $i => $fileName) {
                $_FILES['file'] = [
                    'name' => $fileName,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = ['url' => base_url('api/file_uploads/' . $up['file_name']), 'name' => $up['file_name']];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: Total Training Hours / Number of Employees Trained
        $hours = intval($this->input->post('total_training_hours')) ?: 0;
        $trained = intval($this->input->post('employees_trained')) ?: 0;
        $dataset['average_training_hours'] = ($trained > 0) ? round(($hours / $trained), 2) : 0;

        $this->quality_model->update_feedback_CQI4e5($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4e5?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4e5_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4e5', $data);
    }
}
// âœ… CQI4e6 - Nurses Attrition Rate (Nursing)
public function edit_feedback_CQI4e6() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4e6', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4e6', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4e6_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4e6_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = ['upload_path' => './api/file_uploads/', 'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'];
            foreach ($_FILES['uploaded_files']['name'] as $i => $fileName) {
                $_FILES['file'] = [
                    'name' => $fileName,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = ['url' => base_url('api/file_uploads/' . $up['file_name']), 'name' => $up['file_name']];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: (Nurses Left / Avg Nurses) * 100
        $left = intval($this->input->post('nurses_left')) ?: 0;
        $avg = intval($this->input->post('average_nurses')) ?: 0;
        $dataset['nurses_attrition_rate'] = ($avg > 0) ? round(($left / $avg) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI4e6($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4e6?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4e6_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4e6', $data);
    }
}
// âœ… CQI4e7 - Outsourced employee absenteeism rate (Nursing Assistants - Patient Care Services - OPD)
public function edit_feedback_CQI4e7() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4e7', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4e7', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4e7_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4e7_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = ['upload_path' => './api/file_uploads/', 'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'];
            foreach ($_FILES['uploaded_files']['name'] as $i => $fileName) {
                $_FILES['file'] = [
                    'name' => $fileName,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = ['url' => base_url('api/file_uploads/' . $up['file_name']), 'name' => $up['file_name']];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: (Absent Days / Total Working Days) * 100
        $absent = intval($this->input->post('absent_days')) ?: 0;
        $working = intval($this->input->post('total_working_days')) ?: 0;
        $dataset['outsourced_absenteeism_rate'] = ($working > 0) ? round(($absent / $working) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI4e7($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4e7?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4e7_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4e7', $data);
    }
}
// âœ… CQI4e8 - Average number of unpaid leaves per month (HR)
public function edit_feedback_CQI4e8() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4e8', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4e8', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4e8_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4e8_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = ['upload_path' => './api/file_uploads/', 'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'];
            foreach ($_FILES['uploaded_files']['name'] as $i => $fileName) {
                $_FILES['file'] = [
                    'name' => $fileName,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = ['url' => base_url('api/file_uploads/' . $up['file_name']), 'name' => $up['file_name']];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: (Total Unpaid Leaves / Total Employees)
        $leaves = intval($this->input->post('total_unpaid_leaves')) ?: 0;
        $employees = intval($this->input->post('total_employees')) ?: 0;
        $dataset['average_unpaid_leaves'] = ($employees > 0) ? round(($leaves / $employees), 2) : 0;

        $this->quality_model->update_feedback_CQI4e8($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4e8?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4e8_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4e8', $data);
    }
}
// âœ… CQI4f1 - Incidence of needle stick injuries IPD area (Infection Control - IPD)
public function edit_feedback_CQI4f1() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4f1', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4f1', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4f1_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4f1_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        // Handle file removals
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        // Handle new uploads
        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = ['upload_path' => './api/file_uploads/', 'allowed_types' => 'jpg|jpeg|png|pdf|doc|docx|xls|xlsx|csv'];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = ['url' => base_url('api/file_uploads/' . $up['file_name']), 'name' => $up['file_name']];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula (Incidence per 1000 IPD days)
        $injuries = intval($this->input->post('needle_injuries')) ?: 0;
        $ipd_days = intval($this->input->post('ipd_days')) ?: 0;
        $dataset['incidence_rate_ipd'] = ($ipd_days > 0) ? round(($injuries / $ipd_days) * 1000, 2) : 0;

        $this->quality_model->update_feedback_CQI4f1($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4f1?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4f1_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4f1', $data);
    }
}
// âœ… CQI4f2 - Incidence of needle stick injuries OPD area (Infection Control - OPD)
public function edit_feedback_CQI4f2() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4f2', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4f2', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4f2_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4f2_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = ['upload_path' => './api/file_uploads/', 'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = ['url' => base_url('api/file_uploads/' . $up['file_name']), 'name' => $up['file_name']];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula (Incidence per 1000 OPD days)
        $injuries = intval($this->input->post('needle_injuries_opd')) ?: 0;
        $opd_days = intval($this->input->post('opd_days')) ?: 0;
        $dataset['incidence_rate_opd'] = ($opd_days > 0) ? round(($injuries / $opd_days) * 1000, 2) : 0;

        $this->quality_model->update_feedback_CQI4f2($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4f2?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4f2_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4f2', $data);
    }
}
// âœ… CQI4f3 - Percentage of sentinel events, reported, collected and analysed within the defined time frame (Quality Office)
public function edit_feedback_CQI4f3() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4f3', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4f3', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4f3_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4f3_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        // Handle file removals
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        // Handle new uploads
        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = ['upload_path' => './api/file_uploads/', 'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = ['url' => base_url('api/file_uploads/' . $up['file_name']), 'name' => $up['file_name']];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula (Percentage of sentinel events reported within time)
        $total_events = intval($this->input->post('total_events')) ?: 0;
        $reported_events = intval($this->input->post('reported_events')) ?: 0;
        $dataset['sentinel_percentage'] = ($total_events > 0) ? round(($reported_events / $total_events) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI4f3($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4f3?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4f3_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4f3', $data);
    }
}
// âœ… CQI4f4 - Percentage of near misses (Quality Office)
public function edit_feedback_CQI4f4() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4f4', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4f4', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4f4_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4f4_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = ['upload_path' => './api/file_uploads/', 'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = ['url' => base_url('api/file_uploads/' . $up['file_name']), 'name' => $up['file_name']];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula (Percentage of near misses)
        $total_incidents = intval($this->input->post('total_incidents')) ?: 0;
        $near_misses = intval($this->input->post('near_misses')) ?: 0;
        $dataset['near_miss_percentage'] = ($total_incidents > 0) ? round(($near_misses / $total_incidents) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI4f4($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4f4?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4f4_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4f4', $data);
    }
}
// âœ… CQI4f5 - Incidence of blood body fluid exposure IPD (Infection Control - IPD)
public function edit_feedback_CQI4f5() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4f5', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4f5', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4f5_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4f5_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        // Handle file removals
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        // Handle new uploads
        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = ['upload_path' => './api/file_uploads/', 'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = ['url' => base_url('api/file_uploads/' . $up['file_name']), 'name' => $up['file_name']];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula (Incidence per 1000 IPD days)
        $exposures = intval($this->input->post('blood_fluid_exposures_ipd')) ?: 0;
        $ipd_days = intval($this->input->post('ipd_days')) ?: 0;
        $dataset['incidence_rate_ipd'] = ($ipd_days > 0) ? round(($exposures / $ipd_days) * 1000, 2) : 0;

        $this->quality_model->update_feedback_CQI4f5($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4f5?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4f5_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4f5', $data);
    }
}
// âœ… CQI4f6 - Incidence of blood body fluid exposure OPD (Infection Control - OPD)
public function edit_feedback_CQI4f6() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4f6', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4f6', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4f6_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4f6_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        // Remove old files
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        // Handle uploads
        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = ['upload_path' => './api/file_uploads/', 'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = ['url' => base_url('api/file_uploads/' . $up['file_name']), 'name' => $up['file_name']];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula (Incidence per 1000 OPD days)
        $exposures = intval($this->input->post('blood_fluid_exposures_opd')) ?: 0;
        $opd_days = intval($this->input->post('opd_days')) ?: 0;
        $dataset['incidence_rate_opd'] = ($opd_days > 0) ? round(($exposures / $opd_days) * 1000, 2) : 0;

        $this->quality_model->update_feedback_CQI4f6($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4f6?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4f6_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4f6', $data);
    }
}
// âœ… CQI4f7 - Adverse events related to SUDs (JCI8-PCI 3.1) (CSSD)
public function edit_feedback_CQI4f7() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4f7', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4f7', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4f7_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4f7_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        // Remove selected files
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        // Handle file uploads
        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = ['upload_path' => './api/file_uploads/', 'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = ['url' => base_url('api/file_uploads/' . $up['file_name']), 'name' => $up['file_name']];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula (Adverse events per 1000 SUDs used)
        $adverse_events = intval($this->input->post('adverse_events_sud')) ?: 0;
        $suds_used = intval($this->input->post('suds_used')) ?: 0;
        $dataset['adverse_event_rate'] = ($suds_used > 0) ? round(($adverse_events / $suds_used) * 1000, 2) : 0;

        $this->quality_model->update_feedback_CQI4f7($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4f7?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4f7_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4f7', $data);
    }
}
// âœ… CQI4g1 - Percentage of Medical records not having discharge summary (MRD)
public function edit_feedback_CQI4g1() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4g1', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4g1', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4g1_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4g1_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        // Remove selected files
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        // Upload new files
        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = ['upload_path' => './api/file_uploads/', 'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = ['url' => base_url('api/file_uploads/' . $up['file_name']), 'name' => $up['file_name']];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula (Percentage = (Records without discharge summary / Total records) * 100)
        $missing = intval($this->input->post('records_without_discharge_summary')) ?: 0;
        $total = intval($this->input->post('total_records_checked')) ?: 0;
        $dataset['percentage_missing_summary'] = ($total > 0) ? round(($missing / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI4g1($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4g1?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4g1_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4g1', $data);
    }
}
// âœ… CQI4g2 - Percentage of Medical records not having codification as per ICD (MRD)
public function edit_feedback_CQI4g2() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4g2', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4g2', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4g2_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4g2_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = ['upload_path' => './api/file_uploads/', 'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = ['url' => base_url('api/file_uploads/' . $up['file_name']), 'name' => $up['file_name']];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula (Percentage = Records without ICD codification / Total records * 100)
        $without_icd = intval($this->input->post('records_without_icd')) ?: 0;
        $total = intval($this->input->post('total_records_checked')) ?: 0;
        $dataset['percentage_no_icd'] = ($total > 0) ? round(($without_icd / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI4g2($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4g2?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4g2_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4g2', $data);
    }
}
// âœ… CQI4g3 - Percentage of Medical records having improper or incomplete consent (MRD)
public function edit_feedback_CQI4g3() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4g3', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4g3', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4g3_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4g3_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = ['upload_path' => './api/file_uploads/', 'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = ['url' => base_url('api/file_uploads/' . $up['file_name']), 'name' => $up['file_name']];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula (Percentage = Improper/incomplete consent / Total records * 100)
        $improper = intval($this->input->post('improper_consent_records')) ?: 0;
        $total = intval($this->input->post('total_records_checked')) ?: 0;
        $dataset['percentage_improper_consent'] = ($total > 0) ? round(($improper / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI4g3($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4g3?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4g3_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4g3', $data);
    }
}
// âœ… CQI4g4 - Percentage of Missing Medical Records (MRD)
public function edit_feedback_CQI4g4() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4g4', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4g4', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4g4_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4g4_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = ['upload_path' => './api/file_uploads/', 'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = ['url' => base_url('api/file_uploads/' . $up['file_name']), 'name' => $up['file_name']];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula (Percentage = Missing Records / Total Records * 100)
        $missing = intval($this->input->post('missing_records')) ?: 0;
        $total = intval($this->input->post('total_records_checked')) ?: 0;
        $dataset['percentage_missing_records'] = ($total > 0) ? round(($missing / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI4g4($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4g4?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4g4_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4g4', $data);
    }
}
// âœ… CQI4g5 - Compliance rate of adhering with policies and procedures for care of patients at risk for suicide and self-harm (JCI8-COP 5) (MRD)
public function edit_feedback_CQI4g5() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4g5', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4g5', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4g5_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4g5_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = ['upload_path' => './api/file_uploads/', 'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = ['url' => base_url('api/file_uploads/' . $up['file_name']), 'name' => $up['file_name']];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula (Compliance Rate = (Compliant Cases / Total Cases) * 100)
        $compliant = intval($this->input->post('compliant_cases')) ?: 0;
        $total = intval($this->input->post('total_cases_checked')) ?: 0;
        $dataset['compliance_rate'] = ($total > 0) ? round(($compliant / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI4g5($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4g5?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4g5_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4g5', $data);
    }
}
// âœ… CQI4g6 - Monthly Abbreviation Compliance (MRD)
public function edit_feedback_CQI4g6() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4g6', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4g6', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4g6_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4g6_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = ['upload_path' => './api/file_uploads/', 'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = ['url' => base_url('api/file_uploads/' . $up['file_name']), 'name' => $up['file_name']];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula (Abbreviation Compliance = (Compliant Records / Total Records Checked) * 100)
        $compliant = intval($this->input->post('abbreviation_compliant_records')) ?: 0;
        $total = intval($this->input->post('total_records_checked')) ?: 0;
        $dataset['abbreviation_compliance'] = ($total > 0) ? round(($compliant / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI4g6($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4g6?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4g6_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4g6', $data);
    }
}
// âœ… CQI3k1 - Total number of LAMA cases with Reasons (MRD)
public function edit_feedback_CQI3k1() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3k1', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k1', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3k1_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3k1_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = ['upload_path' => './api/file_uploads/', 'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = ['url' => base_url('api/file_uploads/' . $up['file_name']), 'name' => $up['file_name']];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula (LAMA % = (LAMA Cases / Total Discharges) * 100)
        $lama = intval($this->input->post('lama_cases')) ?: 0;
        $total_discharges = intval($this->input->post('total_discharges')) ?: 0;
        $dataset['lama_percentage'] = ($total_discharges > 0) ? round(($lama / $total_discharges) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI3k1($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3k1?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3k1_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k1', $data);
    }
}
// âœ… CQI3k2 - Adverse events due to handover (Quality Office)
public function edit_feedback_CQI3k2() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3k2', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k2', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3k2_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3k2_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = ['upload_path' => './api/file_uploads/', 'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = ['url' => base_url('api/file_uploads/' . $up['file_name']), 'name' => $up['file_name']];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula (Adverse Events % = (Adverse Events / Total Handovers) * 100)
        $adverse = intval($this->input->post('adverse_events')) ?: 0;
        $total = intval($this->input->post('total_handovers')) ?: 0;
        $dataset['adverse_events_percentage'] = ($total > 0) ? round(($adverse / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI3k2($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3k2?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3k2_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k2', $data);
    }
}
// âœ… CQI3k3 - Inguinal herniorrhaphy with mesh (Infection Control)
public function edit_feedback_CQI3k3() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3k3', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k3', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3k3_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3k3_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = ['upload_path' => './api/file_uploads/', 'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = ['url' => base_url('api/file_uploads/' . $up['file_name']), 'name' => $up['file_name']];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula (SSI Rate = (Infections / Total Surgeries) * 100)
        $infection = intval($this->input->post('infection_cases')) ?: 0;
        $surgeries = intval($this->input->post('total_hernia_surgeries')) ?: 0;
        $dataset['ssi_rate'] = ($surgeries > 0) ? round(($infection / $surgeries) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI3k3($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3k3?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3k3_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k3', $data);
    }
}
// âœ… CQI3k4 - Coronary artery bypass grafting (CABG) (Infection Control)
public function edit_feedback_CQI3k4() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3k4', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k4', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3k4_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3k4_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = ['upload_path' => './api/file_uploads/', 'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = ['url' => base_url('api/file_uploads/' . $up['file_name']), 'name' => $up['file_name']];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula (Example: Post-op infection rate for CABG = (Infections / Total CABG) * 100)
        $infections = intval($this->input->post('cabg_infections')) ?: 0;
        $total_cabg = intval($this->input->post('total_cabg')) ?: 0;
        $dataset['cabg_infection_rate'] = ($total_cabg > 0) ? round(($infections / $total_cabg) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI3k4($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3k4?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3k4_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k4', $data);
    }
}
// âœ… CQI3k5 - Laparoscopic cholecystectomy (Infection Control)
public function edit_feedback_CQI3k5() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3k5', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k5', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3k5_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3k5_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = ['upload_path' => './api/file_uploads/', 'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = ['url' => base_url('api/file_uploads/' . $up['file_name']), 'name' => $up['file_name']];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula (Post-op SSI rate for lap chole = (Infections / Total Lap Chole) * 100)
        $infections = intval($this->input->post('lap_chole_infections')) ?: 0;
        $total = intval($this->input->post('total_lap_chole')) ?: 0;
        $dataset['lap_chole_ssi_rate'] = ($total > 0) ? round(($infections / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI3k5($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3k5?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3k5_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k5', $data);
    }
}
// âœ… CQI3k6 - Monitoring the duration of antibiotic usage in surgical prophylaxis (After 48 hours) (Clinical Pharmacy)
public function edit_feedback_CQI3k6() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3k6', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k6', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3k6_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3k6_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        // File removal
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        // File upload
        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = ['upload_path' => './api/file_uploads/', 'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = ['url' => base_url('api/file_uploads/' . $up['file_name']), 'name' => $up['file_name']];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: % cases where antibiotic stopped within 48 hours = (Compliant cases / Total cases) * 100
        $compliant = intval($this->input->post('compliant_cases')) ?: 0;
        $total = intval($this->input->post('total_cases')) ?: 0;
        $dataset['antibiotic_compliance_rate'] = ($total > 0) ? round(($compliant / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI3k6($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3k6?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3k6_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k6', $data);
    }
}
// âœ… CQI3k7 - De-escalation of antibiotics (Clinical Pharmacy)
public function edit_feedback_CQI3k7() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3k7', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k7', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3k7_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3k7_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = ['upload_path' => './api/file_uploads/', 'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = ['url' => base_url('api/file_uploads/' . $up['file_name']), 'name' => $up['file_name']];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json'])) $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: De-escalation Rate = (De-escalated cases / Total Antibiotic Cases) * 100
        $de_escalated = intval($this->input->post('de_escalated_cases')) ?: 0;
        $total = intval($this->input->post('total_antibiotic_cases')) ?: 0;
        $dataset['de_escalation_rate'] = ($total > 0) ? round(($de_escalated / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI3k7($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3k7?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3k7_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k7', $data);
    }
}
// âœ… CQI3k8 - High Alert Medication Segregation, Storage & Labelling Compliance Rate (Pharmacy - Store)
public function edit_feedback_CQI3k8() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3k8', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k8', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3k8_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3k8_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        // ðŸ”¹ Remove deleted files
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        // ðŸ”¹ Handle new uploads
        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;

        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: Compliance Rate = (Compliant areas / Total assessed areas) * 100
        $compliant = intval($this->input->post('compliant_areas')) ?: 0;
        $total = intval($this->input->post('total_areas')) ?: 0;
        $dataset['compliance_rate'] = ($total > 0) ? round(($compliant / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI3k8($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3k8?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3k8_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k8', $data);
    }
}
// âœ… CQI3k9 - Average Recovery Time (OT - Post OP)
public function edit_feedback_CQI3k9() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3k9', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k9', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3k9_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3k9_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        // ðŸ”¹ Handle removed files
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        // ðŸ”¹ Handle new uploads
        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;

        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: Average Recovery Time = Total Recovery Hours / No. of Cases
        $totalHours = floatval($this->input->post('total_recovery_hours')) ?: 0;
        $cases = intval($this->input->post('total_cases')) ?: 0;
        $dataset['average_recovery_time'] = ($cases > 0) ? round($totalHours / $cases, 2) : 0;

        $this->quality_model->update_feedback_CQI3k9($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3k9?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3k9_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k9', $data);
    }
}
// âœ… CQI3k10 - Door to Thrombolysis Time in Ischemic Stroke (Emergency Department)
public function edit_feedback_CQI3k10() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3k10', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k10', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3k10_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3k10_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        // ðŸ”¹ Remove files
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        // ðŸ”¹ Handle uploads
        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;

        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: Average Door-to-Thrombolysis Time = Total Minutes / No. of Stroke Cases
        $totalMinutes = floatval($this->input->post('total_minutes')) ?: 0;
        $strokeCases = intval($this->input->post('stroke_cases')) ?: 0;
        $dataset['average_door_to_thrombolysis_time'] = ($strokeCases > 0) ? round($totalMinutes / $strokeCases, 2) : 0;

        $this->quality_model->update_feedback_CQI3k10($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3k10?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3k10_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k10', $data);
    }
}
// âœ… CQI3k11 - Door to Image Time in Stroke Patients (Emergency Department)
public function edit_feedback_CQI3k11() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3k11', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k11', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3k11_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3k11_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;

        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: Average Door-to-Image Time = Total Minutes / No. of Stroke Patients
        $totalMinutes = floatval($this->input->post('total_minutes')) ?: 0;
        $patients = intval($this->input->post('stroke_patients')) ?: 0;
        $dataset['average_door_to_image_time'] = ($patients > 0) ? round($totalMinutes / $patients, 2) : 0;

        $this->quality_model->update_feedback_CQI3k11($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3k11?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3k11_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k11', $data);
    }
}
// âœ… CQI3k12 - Average number of patients visiting Emergency per day (Emergency Department)
public function edit_feedback_CQI3k12() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3k12', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k12', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3k12_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3k12_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;

        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: Average Patients per Day = Total Patients / Total Days
        $totalPatients = intval($this->input->post('total_patients')) ?: 0;
        $totalDays = intval($this->input->post('total_days')) ?: 0;
        $dataset['average_patients_per_day'] = ($totalDays > 0) ? round($totalPatients / $totalDays, 2) : 0;

        $this->quality_model->update_feedback_CQI3k12($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3k12?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3k12_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k12', $data);
    }
}
// âœ… CQI3k13 - Efficiency of code blue team (Emergency Department)
public function edit_feedback_CQI3k13() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3k13', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k13', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3k13_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3k13_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;

        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: Efficiency (%) = (Successful Resuscitations / Total Code Blue Events) * 100
        $successful = intval($this->input->post('successful_resuscitations')) ?: 0;
        $totalEvents = intval($this->input->post('total_code_blue_events')) ?: 0;
        $dataset['code_blue_efficiency_percent'] = ($totalEvents > 0) ? round(($successful / $totalEvents) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI3k13($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3k13?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3k13_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k13', $data);
    }
}
// âœ… CQI3k14 - Time for first defibrillation (Emergency Department)
public function edit_feedback_CQI3k14() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3k14', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k14', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3k14_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3k14_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;

        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: Average Time to First Defibrillation = Total Minutes to Defib / Number of Defib Cases
        $totalMinutes = floatval($this->input->post('total_minutes_to_defib')) ?: 0;
        $defibCases = intval($this->input->post('defib_cases')) ?: 0;
        $dataset['average_time_first_defibrillation'] = ($defibCases > 0) ? round($totalMinutes / $defibCases, 2) : 0;

        $this->quality_model->update_feedback_CQI3k14($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3k14?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3k14_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k14', $data);
    }
}
// âœ… CQI3k15 - Door to Balloon time in PTCA (Cath Lab)
public function edit_feedback_CQI3k15() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3k15', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k15', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3k15_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3k15_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;

        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: Average Door-to-Balloon Time = Total Minutes / Number of PTCA Cases
        $totalMinutes = floatval($this->input->post('total_minutes')) ?: 0;
        $ptcaCases = intval($this->input->post('ptca_cases')) ?: 0;
        $dataset['average_door_to_balloon_time'] = ($ptcaCases > 0) ? round($totalMinutes / $ptcaCases, 2) : 0;

        $this->quality_model->update_feedback_CQI3k15($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3k15?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3k15_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k15', $data);
    }
}
// âœ… CQI3k16 - Compliance to diet order (Clinical Nutrition and Dietetics)
public function edit_feedback_CQI3k16() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3k16', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k16', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3k16_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3k16_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;

        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: Compliance (%) = (Compliant Orders / Total Orders) * 100
        $compliant = intval($this->input->post('compliant_orders')) ?: 0;
        $totalOrders = intval($this->input->post('total_orders')) ?: 0;
        $dataset['diet_compliance_percent'] = ($totalOrders > 0) ? round(($compliant / $totalOrders) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI3k16($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3k16?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3k16_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k16', $data);
    }
}
// âœ… CQI3k17 - Case Fatality 1 - CAD (MRD)
public function edit_feedback_CQI3k17() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3k17', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k17', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3k17_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3k17_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;

        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: Case Fatality Rate (%) = (Deaths / Cases) * 100
        $deaths = intval($this->input->post('deaths_cad')) ?: 0;
        $cases = intval($this->input->post('cases_cad')) ?: 0;
        $dataset['case_fatality_cad_percent'] = ($cases > 0) ? round(($deaths / $cases) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI3k17($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3k17?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3k17_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k17', $data);
    }
}
// âœ… CQI3k18 - Case Fatality 2 - Acute coronary syndrome (MRD)
public function edit_feedback_CQI3k18() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3k18', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k18', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3k18_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3k18_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;

        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: Case Fatality Rate (%) = (Deaths / Cases) * 100
        $deaths = intval($this->input->post('deaths_acs')) ?: 0;
        $cases = intval($this->input->post('cases_acs')) ?: 0;
        $dataset['case_fatality_acs_percent'] = ($cases > 0) ? round(($deaths / $cases) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI3k18($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3k18?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3k18_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k18', $data);
    }
}
// âœ… CQI3k19 - Case Fatality 3 - Cerebral infarction (MRD)
public function edit_feedback_CQI3k19() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3k19', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k19', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3k19_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3k19_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;

        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: Case Fatality Rate (%) = (Deaths / Cases) * 100
        $deaths = intval($this->input->post('deaths_cerebral_infarction')) ?: 0;
        $cases = intval($this->input->post('cases_cerebral_infarction')) ?: 0;
        $dataset['case_fatality_cerebral_infarction_percent'] = ($cases > 0) ? round(($deaths / $cases) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI3k19($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3k19?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3k19_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k19', $data);
    }
}
// âœ… CQI3k20 - Case Fatality 4 - MI (MRD)
public function edit_feedback_CQI3k20() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3k20', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k20', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3k20_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3k20_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;

        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: Case Fatality Rate (%) = (Deaths / Cases) * 100
        $deaths = intval($this->input->post('deaths_mi')) ?: 0;
        $cases = intval($this->input->post('cases_mi')) ?: 0;
        $dataset['case_fatality_mi_percent'] = ($cases > 0) ? round(($deaths / $cases) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI3k20($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3k20?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3k20_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k20', $data);
    }
}
// âœ… CQI3k21 - Case Fatality 5 - Heart Failure (MRD)
public function edit_feedback_CQI3k21() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3k21', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k21', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3k21_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3k21_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: Case Fatality Rate = (Number of Deaths / Total Heart Failure Cases) Ã— 100
        $deaths = floatval($this->input->post('deaths')) ?: 0;
        $totalCases = floatval($this->input->post('total_cases')) ?: 0;
        $dataset['case_fatality_rate'] = ($totalCases > 0) ? round(($deaths / $totalCases) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI3k21($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3k21?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3k21_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k21', $data);
    }
}
// âœ… CQI3k22 - Compliances in Patient Transfer and Transportation Process (External Transfer) (Emergency Department)
public function edit_feedback_CQI3k22() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3k22', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k22', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3k22_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3k22_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: Compliance Rate = (Compliant Transfers / Total Transfers) Ã— 100
        $compliant = floatval($this->input->post('compliant_transfers')) ?: 0;
        $total = floatval($this->input->post('total_transfers')) ?: 0;
        $dataset['compliance_rate'] = ($total > 0) ? round(($compliant / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI3k22($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3k22?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3k22_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k22', $data);
    }
}
// âœ… CQI3k23 - Number of Adverse Events During Patient Transfers (Outside) (Emergency Department)
public function edit_feedback_CQI3k23() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3k23', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k23', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3k23_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3k23_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: Adverse Event Rate = (Adverse Events / Total Transfers) Ã— 100
        $events = floatval($this->input->post('adverse_events')) ?: 0;
        $total = floatval($this->input->post('total_transfers')) ?: 0;
        $dataset['adverse_event_rate'] = ($total > 0) ? round(($events / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI3k23($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3k23?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3k23_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k23', $data);
    }
}
// âœ… CQI3k24 - ILC/EQAS compliance rate (Lab Services)
public function edit_feedback_CQI3k24() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3k24', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k24', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3k24_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3k24_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: ILC/EQAS Compliance (%) = (Compliant Samples / Total Samples) * 100
        $compliant = floatval($this->input->post('ilc_compliant_samples')) ?: 0;
        $total = floatval($this->input->post('ilc_total_samples')) ?: 0;
        $dataset['ilc_eqas_compliance_percent'] = ($total > 0) ? round(($compliant / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI3k24($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3k24?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3k24_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k24', $data);
    }
}
// âœ… CQI3k25 - Compliance with Biological Indicator (CSSD)
public function edit_feedback_CQI3k25() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3k25', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k25', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3k25_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3k25_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: BI Compliance (%) = (BI Passes / Total BI Tests) * 100
        $passes = floatval($this->input->post('bi_passes')) ?: 0;
        $total = floatval($this->input->post('bi_total_tests')) ?: 0;
        $dataset['bi_compliance_percent'] = ($total > 0) ? round(($passes / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI3k25($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3k25?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3k25_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k25', $data);
    }
}
// âœ… CQI3k26 - Compliance to risk assessment in reprocessing of SUMD (CSSD)
public function edit_feedback_CQI3k26() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3k26', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k26', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3k26_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3k26_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: Risk Assessment Compliance (%) = (Compliant Assessments / Total Assessments) * 100
        $compliant = floatval($this->input->post('risk_compliant_assessments')) ?: 0;
        $total = floatval($this->input->post('risk_total_assessments')) ?: 0;
        $dataset['risk_assessment_compliance_percent'] = ($total > 0) ? round(($compliant / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI3k26($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3k26?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3k26_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k26', $data);
    }
}
// âœ… CQI3k27 - Non-compliance to Copy and paste policy (MRD)
public function edit_feedback_CQI3k27() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3k27', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k27', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3k27_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3k27_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: Non-compliance Rate (%) = (Non-compliant Records / Total Records Audited) * 100
        $noncompliant = floatval($this->input->post('noncompliant_records')) ?: 0;
        $audited = floatval($this->input->post('total_records_audited')) ?: 0;
        $dataset['copy_paste_noncompliance_percent'] = ($audited > 0) ? round(($noncompliant / $audited) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI3k27($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3k27?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3k27_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k27', $data);
    }
}
// âœ… CQI3k28 - Compliance to POCT IQC Checking (Lab Services)
public function edit_feedback_CQI3k28() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3k28', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k28', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3k28_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3k28_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: POCT IQC Compliance (%) = (Compliant IQC Checks / Total IQC Checks) * 100
        $compliant = floatval($this->input->post('iqc_compliant_checks')) ?: 0;
        $total = floatval($this->input->post('iqc_total_checks')) ?: 0;
        $dataset['poct_iqc_compliance_percent'] = ($total > 0) ? round(($compliant / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI3k28($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3k28?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3k28_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k28', $data);
    }
}
// âœ… CQI3k29 - Case Fatality - COVID 19 (MRD)
public function edit_feedback_CQI3k29() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3k29', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k29', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3k29_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3k29_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: Case Fatality Rate (%) = (COVID Deaths / COVID Cases) * 100
        $deaths = floatval($this->input->post('covid_deaths')) ?: 0;
        $cases = floatval($this->input->post('covid_cases')) ?: 0;
        $dataset['case_fatality_covid_percent'] = ($cases > 0) ? round(($deaths / $cases) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI3k29($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3k29?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3k29_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k29', $data);
    }
}
// âœ… CQI3k30 - Case Fatality - Stroke (MRD)
public function edit_feedback_CQI3k30() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3k30', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k30', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3k30_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3k30_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: Case Fatality Rate (%) = (Stroke Deaths / Stroke Cases) * 100
        $deaths = floatval($this->input->post('stroke_deaths')) ?: 0;
        $cases = floatval($this->input->post('stroke_cases')) ?: 0;
        $dataset['case_fatality_stroke_percent'] = ($cases > 0) ? round(($deaths / $cases) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI3k30($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3k30?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3k30_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k30', $data);
    }
}
// âœ… CQI3k31 - Post procedure complication rate - Colonoscopy (Endoscopy)
public function edit_feedback_CQI3k31() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3k31', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k31', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3k31_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3k31_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: Post Procedure Complication Rate (%) = (Number of Complications / Total Procedures) * 100
        $complications = floatval($this->input->post('complications')) ?: 0;
        $total = floatval($this->input->post('total_procedures')) ?: 0;
        $dataset['post_procedure_complication_percent'] = ($total > 0) ? round(($complications / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI3k31($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3k31?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3k31_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k31', $data);
    }
}
// âœ… CQI3k32 - Polyp retrieval rate after colonoscopic polypectomy (Endoscopy)
public function edit_feedback_CQI3k32() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3k32', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k32', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3k32_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3k32_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: Polyp Retrieval Rate (%) = (Retrieved Polyps / Total Polyps Removed) * 100
        $retrieved = floatval($this->input->post('retrieved_polyps')) ?: 0;
        $removed = floatval($this->input->post('removed_polyps')) ?: 0;
        $dataset['polyp_retrieval_rate_percent'] = ($removed > 0) ? round(($retrieved / $removed) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI3k32($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3k32?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3k32_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k32', $data);
    }
}
// âœ… CQI3k33 - Survival rate for living donor kidney transplants (Nephrology)
public function edit_feedback_CQI3k33() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3k33', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k33', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3k33_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3k33_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: Survival Rate (%) = (Number of Survived Patients / Total Transplants) * 100
        $survived = floatval($this->input->post('survived_patients')) ?: 0;
        $total = floatval($this->input->post('total_transplants')) ?: 0;
        $dataset['survival_rate_percent'] = ($total > 0) ? round(($survived / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI3k33($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3k33?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3k33_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k33', $data);
    }
}
// âœ… CQI3k34 - CAUTI Prevention Bundle compliance Rate (Infection Control)
public function edit_feedback_CQI3k34() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3k34', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k34', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3k34_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3k34_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: CAUTI Bundle Compliance Rate (%) = (Compliant Instances / Total Opportunities) * 100
        $compliant = floatval($this->input->post('compliant_instances')) ?: 0;
        $total = floatval($this->input->post('total_opportunities')) ?: 0;
        $dataset['cauti_compliance_rate_percent'] = ($total > 0) ? round(($compliant / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI3k34($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3k34?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3k34_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k34', $data);
    }
}
// âœ… CQI3k35 - Major Discrepancies between Preoperative and Postoperative Diagnosis (OT)
public function edit_feedback_CQI3k35() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3k35', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k35', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3k35_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3k35_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: Discrepancy Rate (%) = (Number of Major Discrepancies / Total Surgeries Reviewed) * 100
        $discrepancies = floatval($this->input->post('major_discrepancies')) ?: 0;
        $total = floatval($this->input->post('total_surgeries')) ?: 0;
        $dataset['discrepancy_rate_percent'] = ($total > 0) ? round(($discrepancies / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI3k35($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3k35?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3k35_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k35', $data);
    }
}
// âœ… CQI3k36 - Adverse Events Related to Patient Identification (Quality Office)
public function edit_feedback_CQI3k36() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3k36', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k36', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3k36_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3k36_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: Adverse Event Rate (%) = (Number of ID-related Events / Total Admissions) * 100
        $events = floatval($this->input->post('adverse_events')) ?: 0;
        $total = floatval($this->input->post('total_admissions')) ?: 0;
        $dataset['id_event_rate_percent'] = ($total > 0) ? round(($events / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI3k36($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3k36?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3k36_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k36', $data);
    }
}
// âœ… CQI3k37 - CLABSI Prevention Bundle compliance Rate (Infection Control)
public function edit_feedback_CQI3k37() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3k37', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k37', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3k37_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3k37_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: CLABSI Bundle Compliance Rate (%) = (Compliant Instances / Total Observations) * 100
        $compliant = floatval($this->input->post('compliant_instances')) ?: 0;
        $total = floatval($this->input->post('total_observations')) ?: 0;
        $dataset['clabsi_compliance_rate_percent'] = ($total > 0) ? round(($compliant / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI3k37($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3k37?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3k37_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k37', $data);
    }
}
// âœ… CQI3k38 - SSI Prevention Bundle compliance Rate (Infection Control)
public function edit_feedback_CQI3k38() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3k38', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k38', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3k38_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3k38_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: SSI Bundle Compliance Rate (%) = (Compliant Instances / Total Observations) * 100
        $compliant = floatval($this->input->post('compliant_instances')) ?: 0;
        $total = floatval($this->input->post('total_observations')) ?: 0;
        $dataset['ssi_compliance_rate_percent'] = ($total > 0) ? round(($compliant / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI3k38($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3k38?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3k38_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k38', $data);
    }
}



// âœ… CQI3k39 - VAP Prevention Bundle compliance Rate (Infection Control)
public function edit_feedback_CQI3k39() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3k39', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k39', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3k39_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3k39_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: VAP Bundle Compliance Rate (%) = (Compliant Instances / Total Observations) * 100
        $compliant = floatval($this->input->post('compliant_instances')) ?: 0;
        $total = floatval($this->input->post('total_observations')) ?: 0;
        $dataset['vap_compliance_rate_percent'] = ($total > 0) ? round(($compliant / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI3k39($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3k39?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3k39_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k39', $data);
    }
}
// âœ… CQI3k40 - Restraint related injuries among admitted patients (Nursing)
public function edit_feedback_CQI3k40() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3k40', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k40', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3k40_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3k40_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: Restraint Related Injuries Rate (%) = (No. of restraint injuries / Total restrained patients) * 100
        $injuries = floatval($this->input->post('restraint_injuries')) ?: 0;
        $restrained = floatval($this->input->post('restrained_patients')) ?: 0;
        $dataset['restraint_injury_rate_percent'] = ($restrained > 0) ? round(($injuries / $restrained) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI3k40($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3k40?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3k40_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k40', $data);
    }
}



// âœ… CQI3k41 - Rate of compliance for restraint consent policy (Nursing)
public function edit_feedback_CQI3k41() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3k41', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k41', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3k41_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3k41_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: Restraint Consent Compliance (%) = (Patients with consent / Total restrained patients) * 100
        $consented = floatval($this->input->post('consent_patients')) ?: 0;
        $total = floatval($this->input->post('restrained_patients')) ?: 0;
        $dataset['restraint_consent_compliance_percent'] = ($total > 0) ? round(($consented / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI3k41($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3k41?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3k41_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k41', $data);
    }
}
// âœ… CQI3k42 - Percentage of Accidental removal of line (Nursing)
public function edit_feedback_CQI3k42() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3k42', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k42', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3k42_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3k42_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: Accidental Line Removal Rate (%) = (Accidental Removals / Total Lines) * 100
        $accidental = floatval($this->input->post('accidental_removals')) ?: 0;
        $totalLines = floatval($this->input->post('total_lines')) ?: 0;
        $dataset['accidental_line_removal_percent'] = ($totalLines > 0) ? round(($accidental / $totalLines) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI3k42($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3k42?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3k42_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k42', $data);
    }
}


// âœ… CQI3k43 - Significant hypotension necessitating termination of dialysis (Nursing)
public function edit_feedback_CQI3k43() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3k43', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k43', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3k43_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3k43_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: Dialysis Termination Rate (%) = (Terminations due to Hypotension / Total Dialysis Sessions) * 100
        $terminations = floatval($this->input->post('terminations')) ?: 0;
        $sessions = floatval($this->input->post('total_sessions')) ?: 0;
        $dataset['dialysis_termination_rate_percent'] = ($sessions > 0) ? round(($terminations / $sessions) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI3k43($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3k43?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3k43_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k43', $data);
    }
}


// âœ… CQI3k44 - IPSG4 - Time out compliance in outside OT (Nursing)
public function edit_feedback_CQI3k44() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3k44', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k44', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3k44_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3k44_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: Time-out Compliance (%) = (Compliant Time-outs / Total Time-outs) * 100
        $compliant = floatval($this->input->post('compliant_timeouts')) ?: 0;
        $total = floatval($this->input->post('total_timeouts')) ?: 0;
        $dataset['timeout_compliance_percent'] = ($total > 0) ? round(($compliant / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI3k44($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3k44?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3k44_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k44', $data);
    }
}


// âœ… CQI3k45 - % of cases where Initial assessment done in physiotherapy within 24 hours (IPD)
public function edit_feedback_CQI3k45() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3k45', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k45', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3k45_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3k45_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: Initial Assessment within 24h (%) = (Assessed within 24h / Total IPD cases) * 100
        $assessed24 = floatval($this->input->post('assessed_within_24h')) ?: 0;
        $totalCases = floatval($this->input->post('total_ipd_cases')) ?: 0;
        $dataset['initial_assessment_24h_percent'] = ($totalCases > 0) ? round(($assessed24 / $totalCases) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI3k45($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3k45?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3k45_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k45', $data);
    }
}


// âœ… CQI3k46 - Radiology TAT orders for CT (Radiology)
public function edit_feedback_CQI3k46() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3k46', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k46', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3k46_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3k46_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: Average TAT (minutes) = Total Minutes for CT Orders / Number of CT Orders
        $totalMinutes = floatval($this->input->post('total_minutes_ct')) ?: 0;
        $orders = intval($this->input->post('ct_orders')) ?: 0;
        $dataset['avg_tat_ct_minutes'] = ($orders > 0) ? round($totalMinutes / $orders, 2) : 0;

        $this->quality_model->update_feedback_CQI3k46($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3k46?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3k46_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k46', $data);
    }
}


// âœ… CQI3k47 - Radiology TAT orders for MRI (Radiology)
public function edit_feedback_CQI3k47() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3k47', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k47', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3k47_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3k47_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: Average TAT (minutes) = Total Minutes for MRI Orders / Number of MRI Orders
        $totalMinutes = floatval($this->input->post('total_minutes_mri')) ?: 0;
        $orders = intval($this->input->post('mri_orders')) ?: 0;
        $dataset['avg_tat_mri_minutes'] = ($orders > 0) ? round($totalMinutes / $orders, 2) : 0;

        $this->quality_model->update_feedback_CQI3k47($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3k47?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3k47_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k47', $data);
    }
}


// âœ… CQI3k48 - Radiology TAT orders for USG (Radiology)
public function edit_feedback_CQI3k48() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3k48', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k48', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3k48_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3k48_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: Average TAT (minutes) = Total Minutes for USG Orders / Number of USG Orders
        $totalMinutes = floatval($this->input->post('total_minutes_usg')) ?: 0;
        $orders = intval($this->input->post('usg_orders')) ?: 0;
        $dataset['avg_tat_usg_minutes'] = ($orders > 0) ? round($totalMinutes / $orders, 2) : 0;

        $this->quality_model->update_feedback_CQI3k48($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3k48?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3k48_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k48', $data);
    }
}


// âœ… CQI3k49 - Radiology TAT orders for X-ray (Radiology)
public function edit_feedback_CQI3k49() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3k49', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k49', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3k49_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3k49_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: Average TAT (minutes) = Total Minutes for X-ray Orders / Number of X-ray Orders
        $totalMinutes = floatval($this->input->post('total_minutes_xray')) ?: 0;
        $orders = intval($this->input->post('xray_orders')) ?: 0;
        $dataset['avg_tat_xray_minutes'] = ($orders > 0) ? round($totalMinutes / $orders, 2) : 0;

        $this->quality_model->update_feedback_CQI3k49($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3k49?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3k49_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k49', $data);
    }
}
// âœ… CQI3k50 - Site Marking Compliance Rate (OT)
public function edit_feedback_CQI3k50() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3k50', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k50', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3k50_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3k50_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: Site Marking Compliance = (Number of Correctly Marked Sites / Total Surgeries) * 100
        $correct = intval($this->input->post('correct_markings')) ?: 0;
        $total = intval($this->input->post('total_surgeries')) ?: 0;
        $dataset['site_marking_compliance_rate'] = ($total > 0) ? round(($correct / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI3k50($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3k50?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3k50_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k50', $data);
    }
}


// âœ… CQI3k51 - Time Out Compliance Rate (OT)
public function edit_feedback_CQI3k51() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3k51', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k51', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3k51_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3k51_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: Time Out Compliance = (Time Outs Done / Total Procedures) * 100
        $done = intval($this->input->post('timeouts_done')) ?: 0;
        $total = intval($this->input->post('total_procedures')) ?: 0;
        $dataset['timeout_compliance_rate'] = ($total > 0) ? round(($done / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI3k51($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3k51?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3k51_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k51', $data);
    }
}
// âœ… CQI3k52 - Sign Out Compliance Rate (OT)
public function edit_feedback_CQI3k52() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3k52', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k52', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3k52_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3k52_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        // ðŸ”¹ Remove files
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        // ðŸ”¹ Upload new files
        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        // ðŸ”¹ Update dataset
        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: Sign Out Compliance Rate = (Sign Outs Done / Total Surgeries) * 100
        $done = intval($this->input->post('signouts_done')) ?: 0;
        $total = intval($this->input->post('total_surgeries')) ?: 0;
        $dataset['signout_compliance_rate'] = ($total > 0) ? round(($done / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI3k52($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3k52?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3k52_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k52', $data);
    }
}



// âœ… CQI3k53 - Post transplant complication rate for Donor (Liver) (Transplant Unit)
public function edit_feedback_CQI3k53() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3k53', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k53', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3k53_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3k53_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: Post Transplant Complication Rate = (Complications / Total Donor Transplants) * 100
        $complications = intval($this->input->post('complications')) ?: 0;
        $total = intval($this->input->post('total_donor_transplants')) ?: 0;
        $dataset['post_tx_donor_complication_rate'] = ($total > 0) ? round(($complications / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI3k53($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3k53?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3k53_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k53', $data);
    }
}



// âœ… CQI3k54 - Post transplant complication rate (Heart) (Transplant Unit)
public function edit_feedback_CQI3k54() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3k54', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k54', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3k54_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3k54_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: Post Transplant Complication Rate (Heart) = (Heart Transplant Complications / Total Heart Transplants) * 100
        $complications = intval($this->input->post('heart_complications')) ?: 0;
        $total = intval($this->input->post('total_heart_transplants')) ?: 0;
        $dataset['post_tx_heart_complication_rate'] = ($total > 0) ? round(($complications / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI3k54($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3k54?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3k54_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k54', $data);
    }
}



// âœ… CQI3k55 - Percentage of research activities approved by ethics committee (Research)
public function edit_feedback_CQI3k55() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3k55', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k55', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3k55_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3k55_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: % Approved Research = (Approved / Total Submitted) * 100
        $approved = intval($this->input->post('approved_research')) ?: 0;
        $submitted = intval($this->input->post('total_research_submitted')) ?: 0;
        $dataset['research_approval_rate'] = ($submitted > 0) ? round(($approved / $submitted) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI3k55($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3k55?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3k55_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k55', $data);
    }
}
// âœ… CQI3k56 - Percentage of patients withdrawing from the study (Research)
public function edit_feedback_CQI3k56() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3k56', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k56', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3k56_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3k56_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: Withdrawal % = (No. of Patients Withdrawing / Total Patients in Study) * 100
        $withdraw = intval($this->input->post('patients_withdrawn')) ?: 0;
        $total = intval($this->input->post('total_patients_study')) ?: 0;
        $dataset['withdrawal_percentage'] = ($total > 0) ? round(($withdraw / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI3k56($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3k56?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3k56_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k56', $data);
    }
}


// âœ… CQI3k57 - Percentage of protocol violations/deviations reported (Research)
public function edit_feedback_CQI3k57() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3k57', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k57', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3k57_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3k57_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: Protocol Violation % = (Violations / Total Protocols) * 100
        $violations = intval($this->input->post('protocol_violations')) ?: 0;
        $total = intval($this->input->post('total_protocols')) ?: 0;
        $dataset['violation_percentage'] = ($total > 0) ? round(($violations / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI3k57($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3k57?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3k57_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k57', $data);
    }
}


// âœ… CQI3k58 - Percentage of serious adverse events reported to ethics committee within timeframe (Research)
public function edit_feedback_CQI3k58() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3k58', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k58', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3k58_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3k58_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: SAE Reporting % = (SAE Reported within Time / Total SAE) * 100
        $reported = intval($this->input->post('sae_reported_timeframe')) ?: 0;
        $total = intval($this->input->post('total_sae')) ?: 0;
        $dataset['sae_reporting_percentage'] = ($total > 0) ? round(($reported / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI3k58($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3k58?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3k58_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k58', $data);
    }
}


// âœ… CQI3k59 - Percentage of cases where Initial physiotherapy assessment done within 24 hours (OPD)
public function edit_feedback_CQI3k59() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3k59', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k59', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3k59_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3k59_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: Assessment % = (Assessments Done within 24h / Total OPD Cases) * 100
        $assessed = intval($this->input->post('assessed_24h')) ?: 0;
        $total = intval($this->input->post('total_opd_cases')) ?: 0;
        $dataset['assessment_percentage'] = ($total > 0) ? round(($assessed / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI3k59($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3k59?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3k59_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k59', $data);
    }
}


// âœ… CQI3k60 - Survival rate for living donor Liver transplants (Gastrointestinal Surgery)
public function edit_feedback_CQI3k60() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3k60', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k60', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3k60_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3k60_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: Survival Rate % = (Survived Donor Cases / Total Liver Transplants) * 100
        $survived = intval($this->input->post('survived_cases')) ?: 0;
        $total = intval($this->input->post('total_liver_transplants')) ?: 0;
        $dataset['survival_rate_percentage'] = ($total > 0) ? round(($survived / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI3k60($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3k60?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3k60_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k60', $data);
    }
}
// âœ… CQI3k61 - Return of spontaneous circulation (ROSC) achieving rate (Emergency Department)
public function edit_feedback_CQI3k61() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3k61', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k61', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3k61_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3k61_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: ROSC Achieving Rate (%) = (ROSC Cases / Total Arrest Cases) * 100
        $rosc_cases = intval($this->input->post('rosc_cases')) ?: 0;
        $total_cases = intval($this->input->post('total_arrest_cases')) ?: 0;
        $dataset['rosc_rate_percentage'] = ($total_cases > 0) ? round(($rosc_cases / $total_cases) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI3k61($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3k61?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3k61_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k61', $data);
    }
}
// âœ… CQI3k62 - Timeliness of initiation of advanced cardiovascular life support (ACLS) within 5 Min (Nursing)
public function edit_feedback_CQI3k62() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3k62', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k62', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3k62_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3k62_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: ACLS Timeliness % = (ACLS Initiated within 5 min / Total ACLS Cases) * 100
        $within_time = intval($this->input->post('acls_within_5min')) ?: 0;
        $total_cases = intval($this->input->post('total_acls_cases')) ?: 0;
        $dataset['acls_timeliness_percentage'] = ($total_cases > 0) ? round(($within_time / $total_cases) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI3k62($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3k62?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3k62_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k62', $data);
    }
}
// âœ… CQI3k63 - Timeliness of staff response to cardiac arrest (Emergency Department)
public function edit_feedback_CQI3k63() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3k63', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k63', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3k63_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3k63_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: Staff Response Timeliness % = (Responses within Target Time / Total Cardiac Arrests) * 100
        $within_time = intval($this->input->post('responses_within_time')) ?: 0;
        $total_cases = intval($this->input->post('total_cardiac_cases')) ?: 0;
        $dataset['staff_response_timeliness_percentage'] = ($total_cases > 0) ? round(($within_time / $total_cases) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI3k63($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3k63?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3k63_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k63', $data);
    }
}
// âœ… CQI3k64 - Rate to RRT response turn to Code blue (Nursing)
public function edit_feedback_CQI3k64() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI3k64', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k64', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI3k64_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI3k64_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: RRT to Code Blue Conversion Rate (%) = (RRT Cases Converted to Code Blue / Total RRT Calls) * 100
        $converted_cases = intval($this->input->post('rrt_converted_cases')) ?: 0;
        $total_rrt = intval($this->input->post('total_rrt_calls')) ?: 0;
        $dataset['rrt_to_codeblue_percentage'] = ($total_rrt > 0) ? round(($converted_cases / $total_rrt) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI3k64($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI3k64?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI3k64_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI3k64', $data);
    }
}
// âœ… CQI4h1 - Patient satisfaction index - Physiotherapy (Physical therapy and Rehabilitation Department)
public function edit_feedback_CQI4h1() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4h1', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h1', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4h1_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4h1_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: Patient Satisfaction Index = (Sum of scores / Max possible score) * 100
        // expected POST: sum_scores, max_possible_score
        $sumScores = floatval($this->input->post('sum_scores')) ?: 0;
        $maxScore = floatval($this->input->post('max_possible_score')) ?: 0;
        $dataset['patient_satisfaction_index_percent'] = ($maxScore > 0) ? round(($sumScores / $maxScore) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI4h1($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4h1?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4h1_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h1', $data);
    }
}


// âœ… CQI4h2 - TAT for radiology STAT orders (Radiology - CT)
public function edit_feedback_CQI4h2() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4h2', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h2', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4h2_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4h2_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: Average TAT (minutes) = Total Minutes for CT STAT orders / Number of CT STAT orders
        $totalMinutes = floatval($this->input->post('total_minutes_ct_stat')) ?: 0;
        $orders = intval($this->input->post('ct_stat_orders')) ?: 0;
        $dataset['avg_tat_ct_stat_minutes'] = ($orders > 0) ? round($totalMinutes / $orders, 2) : 0;

        $this->quality_model->update_feedback_CQI4h2($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4h2?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4h2_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h2', $data);
    }
}


// âœ… CQI4h3 - TAT for radiology STAT orders (Radiology - MRI)
public function edit_feedback_CQI4h3() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4h3', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h3', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4h3_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4h3_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: Average TAT (minutes) = Total Minutes for MRI STAT orders / Number of MRI STAT orders
        $totalMinutes = floatval($this->input->post('total_minutes_mri_stat')) ?: 0;
        $orders = intval($this->input->post('mri_stat_orders')) ?: 0;
        $dataset['avg_tat_mri_stat_minutes'] = ($orders > 0) ? round($totalMinutes / $orders, 2) : 0;

        $this->quality_model->update_feedback_CQI4h3($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4h3?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4h3_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h3', $data);
    }
}


// âœ… CQI4h4 - TAT for radiology STAT orders (Radiology - USG)
public function edit_feedback_CQI4h4() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4h4', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h4', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4h4_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4h4_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: Average TAT (minutes) = Total Minutes for USG STAT orders / Number of USG STAT orders
        $totalMinutes = floatval($this->input->post('total_minutes_usg_stat')) ?: 0;
        $orders = intval($this->input->post('usg_stat_orders')) ?: 0;
        $dataset['avg_tat_usg_stat_minutes'] = ($orders > 0) ? round($totalMinutes / $orders, 2) : 0;

        $this->quality_model->update_feedback_CQI4h4($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4h4?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4h4_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h4', $data);
    }
}


// âœ… CQI4h5 - HAZMAT compliance in radiology
public function edit_feedback_CQI4h5() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4h5', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h5', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4h5_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4h5_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: HAZMAT Compliance Rate (%) = (Compliant Instances / Total Observations) * 100
        $compliant = floatval($this->input->post('compliant_instances')) ?: 0;
        $total = floatval($this->input->post('total_observations')) ?: 0;
        $dataset['hazmat_compliance_percent'] = ($total > 0) ? round(($compliant / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI4h5($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4h5?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4h5_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h5', $data);
    }
}


// âœ… CQI4h6 - TLD Reading Compliance (Radiology)
public function edit_feedback_CQI4h6() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4h6', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h6', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4h6_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4h6_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: TLD Reading Compliance (%) = (Compliant Readings / Total Readings) * 100
        $compliant = floatval($this->input->post('compliant_readings')) ?: 0;
        $total = floatval($this->input->post('total_readings')) ?: 0;
        $dataset['tld_reading_compliance_percent'] = ($total > 0) ? round(($compliant / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI4h6($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4h6?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4h6_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h6', $data);
    }
}


// âœ… CQI4h7 - Variance in Financial counselling (Patient Care Services - IPD)
public function edit_feedback_CQI4h7() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4h7', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h7', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4h7_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4h7_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

         if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: Financial Counselling Variance (%) = (Variance cases / Total counselling cases) * 100
        $variance = intval($this->input->post('variance_cases')) ?: 0;
        $total = intval($this->input->post('total_counselling')) ?: 0;
        $dataset['financial_counselling_variance_percent'] = ($total > 0) ? round(($variance / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI4h7($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4h7?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4h7_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h7', $data);
    }
}


// âœ… CQI4h8 - Planned Discharge rate (Patient Care Services - IPD)
public function edit_feedback_CQI4h8() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4h8', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h8', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4h8_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4h8_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: Planned Discharge Rate (%) = (Planned discharges / Total discharges) * 100
        $planned = intval($this->input->post('planned_discharges')) ?: 0;
        $total = intval($this->input->post('total_discharges')) ?: 0;
        $dataset['planned_discharge_rate_percent'] = ($total > 0) ? round(($planned / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI4h8($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4h8?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4h8_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h8', $data);
    }
}


// âœ… CQI4h9 - Incident report rate (Quality Office)
public function edit_feedback_CQI4h9() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4h9', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h9', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4h9_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4h9_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: Incident Report Rate (%) = (Incident Reports / Total Admissions) * 100
        $incidents = intval($this->input->post('incident_reports')) ?: 0;
        $admissions = intval($this->input->post('total_admissions')) ?: 0;
        $dataset['incident_report_rate_percent'] = ($admissions > 0) ? round(($incidents / $admissions) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI4h9($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4h9?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4h9_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h9', $data);
    }
}


// âœ… CQI4h10 - TAT for dispensing medicine - IP (Pharmacy)
public function edit_feedback_CQI4h10() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4h10', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h10', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4h10_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4h10_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

         if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: Average Dispensing TAT (minutes) = Total Minutes / Number of dispensing orders
        $totalMinutes = floatval($this->input->post('total_minutes_dispensing')) ?: 0;
        $orders = intval($this->input->post('dispensing_orders')) ?: 0;
        $dataset['avg_dispensing_tat_minutes'] = ($orders > 0) ? round($totalMinutes / $orders, 2) : 0;

        $this->quality_model->update_feedback_CQI4h10($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4h10?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4h10_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h10', $data);
    }
}
// âœ… CQI4h11 - TAT for STAT medicine (Pharmacy)
public function edit_feedback_CQI4h11() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4h11', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h11', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4h11_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4h11_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        // ðŸ—‘ï¸ Handle file removals
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        // ðŸ“ Handle new uploads
        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: Average STAT Medicine TAT (minutes)
        $totalMinutes = floatval($this->input->post('total_minutes_stat')) ?: 0;
        $orders = intval($this->input->post('stat_orders')) ?: 0;
        $dataset['avg_stat_tat_minutes'] = ($orders > 0) ? round($totalMinutes / $orders, 2) : 0;

        $this->quality_model->update_feedback_CQI4h11($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4h11?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4h11_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h11', $data);
    }
}
// âœ… CQI4h12 - Average number of Doctors on hospital rolls at any point of time (HR)
public function edit_feedback_CQI4h12() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4h12', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h12', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4h12_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4h12_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: Average Doctors = Total Doctors Count / Measurement Points (e.g. days)
        $totalDoctors = floatval($this->input->post('total_doctors')) ?: 0;
        $measurementPoints = floatval($this->input->post('measurement_points')) ?: 0;
        $dataset['avg_doctors_on_rolls'] = ($measurementPoints > 0) ? round($totalDoctors / $measurementPoints, 2) : 0;

        $this->quality_model->update_feedback_CQI4h12($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4h12?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4h12_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h12', $data);
    }
}


// âœ… CQI4h13 - Average Number of Nurses on hospital rolls at any point of time (HR)
public function edit_feedback_CQI4h13() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4h13', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h13', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4h13_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4h13_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: Average Nurses = Total Nurses Count / Measurement Points (e.g. days)
        $totalNurses = floatval($this->input->post('total_nurses')) ?: 0;
        $measurementPoints = floatval($this->input->post('measurement_points')) ?: 0;
        $dataset['avg_nurses_on_rolls'] = ($measurementPoints > 0) ? round($totalNurses / $measurementPoints, 2) : 0;

        $this->quality_model->update_feedback_CQI4h13($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4h13?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4h13_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h13', $data);
    }
}


// âœ… CQI4h14 - Reason for staff exit (HR)
public function edit_feedback_CQI4h14() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4h14', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h14', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4h14_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4h14_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: Exit Rate (%) = (Number of Exits / Average Staff Count) * 100
        $exits = intval($this->input->post('number_of_exits')) ?: 0;
        $avgStaff = intval($this->input->post('average_staff_count')) ?: 0;
        $dataset['exit_rate_percent'] = ($avgStaff > 0) ? round(($exits / $avgStaff) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI4h14($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4h14?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4h14_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h14', $data);
    }
}


// âœ… CQI4h15 - Compliance to Internal complaints committee requirements (HR)
public function edit_feedback_CQI4h15() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4h15', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h15', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4h15_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4h15_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: ICC Compliance % = (Compliant Cases / Total Cases Reviewed) * 100
        $compliant = intval($this->input->post('icc_compliant_cases')) ?: 0;
        $total = intval($this->input->post('icc_total_cases')) ?: 0;
        $dataset['icc_compliance_percent'] = ($total > 0) ? round(($compliant / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI4h15($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4h15?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4h15_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h15', $data);
    }
}


// âœ… CQI4h16 - Effectiveness in recruitment (MRF submission days - Staff onboarded time) (HR)
public function edit_feedback_CQI4h16() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4h16', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h16', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4h16_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4h16_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: Avg Onboard Time (days) = Sum of (Onboard Days for each hire) / Number of hires
        $sumDays = floatval($this->input->post('sum_onboard_days')) ?: 0;
        $hires = intval($this->input->post('number_of_hires')) ?: 0;
        $dataset['avg_onboard_days'] = ($hires > 0) ? round($sumDays / $hires, 2) : 0;

        $this->quality_model->update_feedback_CQI4h16($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4h16?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4h16_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h16', $data);
    }
}


// âœ… CQI4h17 - Compliance to Employee Engagement activities (HR)
public function edit_feedback_CQI4h17() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4h17', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h17', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4h17_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4h17_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: Employee Engagement Compliance % = (Engaged Staff / Total Staff) * 100
        $engaged = intval($this->input->post('engaged_staff')) ?: 0;
        $total = intval($this->input->post('total_staff')) ?: 0;
        $dataset['engagement_compliance_percent'] = ($total > 0) ? round(($engaged / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI4h17($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4h17?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4h17_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h17', $data);
    }
}


// âœ… CQI4h18 - Number of Mandatory training hours coverage / staff (HR)
public function edit_feedback_CQI4h18() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4h18', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h18', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4h18_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4h18_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: Avg Mandatory Training Hours / Staff = Total Mandatory Hours / Total Staff
        $totalHours = floatval($this->input->post('total_mandatory_hours')) ?: 0;
        $totalStaff = intval($this->input->post('total_staff')) ?: 0;
        $dataset['avg_mandatory_hours_per_staff'] = ($totalStaff > 0) ? round($totalHours / $totalStaff, 2) : 0;

        $this->quality_model->update_feedback_CQI4h18($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4h18?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4h18_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h18', $data);
    }
}


// âœ… CQI4h19 - Compliance to ACLS training (HR)
public function edit_feedback_CQI4h19() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4h19', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h19', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4h19_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4h19_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: ACLS Training Compliance % = (Staff Trained / Total Staff) * 100
        $trained = intval($this->input->post('acls_trained_staff')) ?: 0;
        $total = intval($this->input->post('total_staff')) ?: 0;
        $dataset['acls_training_compliance_percent'] = ($total > 0) ? round(($trained / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI4h19($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4h19?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4h19_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h19', $data);
    }
}


// âœ… CQI4h20 - Average units of electricity consumed/Day (Units) (Engineering & Maintenance)
public function edit_feedback_CQI4h20() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4h20', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h20', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4h20_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4h20_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: Average Units/Day = Total Units Consumed / Number of Days
        $totalUnits = floatval($this->input->post('total_units')) ?: 0;
        $days = intval($this->input->post('number_of_days')) ?: 0;
        $dataset['avg_units_per_day'] = ($days > 0) ? round($totalUnits / $days, 2) : 0;

        $this->quality_model->update_feedback_CQI4h20($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4h20?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4h20_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h20', $data);
    }
}
// âœ… CQI4h21 - TAT for complaints on equipment/Utility/Facility (Engineering & Maintenance)
public function edit_feedback_CQI4h21() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4h21', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h21', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4h21_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4h21_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: Average TAT (hours) = Total Resolution Time / Number of Complaints
        $totalHours = floatval($this->input->post('total_resolution_time')) ?: 0;
        $complaints = intval($this->input->post('total_complaints')) ?: 0;
        $dataset['avg_tat_hours'] = ($complaints > 0) ? round($totalHours / $complaints, 2) : 0;

        $this->quality_model->update_feedback_CQI4h21($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4h21?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4h21_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h21', $data);
    }
}
// âœ… CQI4h22 - Average units of water consumed/Day (L) (Engineering & Maintenance)
public function edit_feedback_CQI4h22() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4h22', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h22', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4h22_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4h22_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: Average Water Consumption per Day = Total Water Consumed / Number of Days
        $totalLiters = floatval($this->input->post('total_water_consumed')) ?: 0;
        $days = intval($this->input->post('days_count')) ?: 0;
        $dataset['avg_water_per_day_liters'] = ($days > 0) ? round($totalLiters / $days, 2) : 0;

        $this->quality_model->update_feedback_CQI4h22($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4h22?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4h22_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h22', $data);
    }
}
// âœ… CQI4h23 - Adherence to PPE usage in Engineering and Maintenance Department (Engineering & Maintenance)
public function edit_feedback_CQI4h23() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4h23', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h23', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4h23_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4h23_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: PPE Compliance % = (No. of staff adhering / Total staff observed) * 100
        $adhering = intval($this->input->post('staff_adhering')) ?: 0;
        $totalObserved = intval($this->input->post('total_observed')) ?: 0;
        $dataset['ppe_compliance_percentage'] = ($totalObserved > 0) ? round(($adhering / $totalObserved) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI4h23($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4h23?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4h23_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h23', $data);
    }
}
// âœ… CQI4h24 - Compliance to PM schedule (Engineering & Maintenance)
public function edit_feedback_CQI4h24() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4h24', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h24', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4h24_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4h24_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: PM Schedule Compliance % = (No. of PM completed / Total PM planned) * 100
        $completed = intval($this->input->post('pm_completed')) ?: 0;
        $planned = intval($this->input->post('pm_planned')) ?: 0;
        $dataset['pm_compliance_percentage'] = ($planned > 0) ? round(($completed / $planned) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI4h24($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4h24?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4h24_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h24', $data);
    }
}
// âœ… CQI4h25 - Compliance to safe storage of chemicals (Engineering & Maintenance)
public function edit_feedback_CQI4h25() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4h25', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h25', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4h25_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4h25_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: Safe Storage Compliance % = (No. of compliant storage areas / Total inspected) * 100
        $compliant = intval($this->input->post('compliant_areas')) ?: 0;
        $inspected = intval($this->input->post('areas_inspected')) ?: 0;
        $dataset['safe_storage_compliance_percentage'] = ($inspected > 0) ? round(($compliant / $inspected) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI4h25($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4h25?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4h25_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h25', $data);
    }
}
// âœ… CQI4h26 - Outsourced Security Service Staff Attendance (Safety & Security - Security)
public function edit_feedback_CQI4h26() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4h26', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h26', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4h26_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4h26_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: Staff Attendance % = (No. of staff present / Total scheduled) * 100
        $present = intval($this->input->post('staff_present')) ?: 0;
        $scheduled = intval($this->input->post('staff_scheduled')) ?: 0;
        $dataset['staff_attendance_percentage'] = ($scheduled > 0) ? round(($present / $scheduled) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI4h26($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4h26?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4h26_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h26', $data);
    }
}
// âœ… CQI4h27 - Compliance to reporting of critical values in Lab (within 30 min) (Lab Service)
public function edit_feedback_CQI4h27() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4h27', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h27', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4h27_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4h27_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: Compliance % = (No. of critical values reported within 30 min / Total critical values) * 100
        $within = intval($this->input->post('critical_within_30')) ?: 0;
        $total = intval($this->input->post('critical_total')) ?: 0;
        $dataset['critical_reporting_compliance'] = ($total > 0) ? round(($within / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI4h27($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4h27?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4h27_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h27', $data);
    }
}
// âœ… CQI4h28 - Compliance to reporting of critical values in POCT (Lab Service)
public function edit_feedback_CQI4h28() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4h28', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h28', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4h28_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4h28_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: POCT Critical Value Reporting % = (Reported within 30 min / Total critical POCT values) * 100
        $within = intval($this->input->post('poct_within_30')) ?: 0;
        $total = intval($this->input->post('poct_total')) ?: 0;
        $dataset['poct_reporting_compliance'] = ($total > 0) ? round(($within / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI4h28($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4h28?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4h28_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h28', $data);
    }
}
// âœ… CQI4h29 - TAT for Lab tests (Lab Service)
public function edit_feedback_CQI4h29() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4h29', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h29', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4h29_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4h29_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: Avg. TAT = (Total time for all tests completed / Number of tests)
        $total_time = floatval($this->input->post('total_time')) ?: 0;
        $tests_done = intval($this->input->post('tests_done')) ?: 0;
        $dataset['avg_tat'] = ($tests_done > 0) ? round($total_time / $tests_done, 2) : 0;

        $this->quality_model->update_feedback_CQI4h29($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4h29?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4h29_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h29', $data);
    }
}


// âœ… CQI4h30 - TAT for Lab STAT (Lab Service)
public function edit_feedback_CQI4h30() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4h30', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h30', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4h30_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4h30_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: Avg. STAT TAT = (Total STAT test time / No. of STAT tests)
        $total_time = floatval($this->input->post('total_time')) ?: 0;
        $stat_tests = intval($this->input->post('stat_tests')) ?: 0;
        $dataset['avg_stat_tat'] = ($stat_tests > 0) ? round($total_time / $stat_tests, 2) : 0;

        $this->quality_model->update_feedback_CQI4h30($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4h30?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4h30_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h30', $data);
    }
}


// âœ… CQI4h31 - Compliance to TAT for lab outsourced test (Lab Service)
public function edit_feedback_CQI4h31() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4h31', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h31', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4h31_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4h31_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        // ðŸ”¹ File management identical for all CQI functions
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: Outsourced TAT Compliance % = (No. within TAT / Total outsourced tests) * 100
        $within_tat = intval($this->input->post('within_tat')) ?: 0;
        $total_tests = intval($this->input->post('total_tests')) ?: 0;
        $dataset['tat_compliance_percentage'] = ($total_tests > 0) ? round(($within_tat / $total_tests) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI4h31($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4h31?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4h31_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h31', $data);
    }
}


// âœ… CQI4h32 - Lab Specimen Rejection Rate (Lab Service)
public function edit_feedback_CQI4h32() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4h32', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h32', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4h32_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4h32_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: Specimen Rejection Rate = (Rejected specimens / Total specimens) * 100
        $rejected = intval($this->input->post('rejected')) ?: 0;
        $total_specimens = intval($this->input->post('total_specimens')) ?: 0;
        $dataset['rejection_rate'] = ($total_specimens > 0) ? round(($rejected / $total_specimens) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI4h32($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4h32?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4h32_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h32', $data);
    }
}
// âœ… CQI4h33 - Insurance Claims Rejection Rate (Insurance)
public function edit_feedback_CQI4h33() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4h33', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h33', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4h33_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4h33_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        // Remove deleted files
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        // Upload new files
        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: Claims Rejection Rate = (Rejected claims / Total claims) * 100
        $rejected = intval($this->input->post('rejected')) ?: 0;
        $total_claims = intval($this->input->post('total_claims')) ?: 0;
        $dataset['claim_rejection_rate'] = ($total_claims > 0) ? round(($rejected / $total_claims) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI4h33($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4h33?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4h33_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h33', $data);
    }
}


// âœ… CQI4h34 - TPA TAT (Insurance) for the month
public function edit_feedback_CQI4h34() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4h34', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h34', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4h34_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4h34_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        // File removal and upload
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);
        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: Avg. TPA TAT = (Total processing time / No. of TPA cases)
        $total_time = floatval($this->input->post('total_time')) ?: 0;
        $tpa_cases = intval($this->input->post('tpa_cases')) ?: 0;
        $dataset['avg_tpa_tat'] = ($tpa_cases > 0) ? round($total_time / $tpa_cases, 2) : 0;

        $this->quality_model->update_feedback_CQI4h34($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4h34?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4h34_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h34', $data);
    }
}
// âœ… CQI4h35 - Medical Waste Collection Rate (House Keeping)
public function edit_feedback_CQI4h35() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4h35', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h35', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4h35_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4h35_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: Medical Waste Collection Rate = (No. of timely collections / Total scheduled collections) * 100
        $timely = intval($this->input->post('timely_collections')) ?: 0;
        $total = intval($this->input->post('total_collections')) ?: 0;
        $dataset['waste_collection_rate'] = ($total > 0) ? round(($timely / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI4h35($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4h35?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4h35_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h35', $data);
    }
}
// âœ… CQI4h36 - Compliance to MSDS in Facility (House Keeping)
public function edit_feedback_CQI4h36() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4h36', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h36', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4h36_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4h36_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: MSDS Compliance % = (Areas with MSDS available / Total areas inspected) * 100
        $available = intval($this->input->post('areas_with_msds')) ?: 0;
        $total = intval($this->input->post('areas_inspected')) ?: 0;
        $dataset['msds_compliance'] = ($total > 0) ? round(($available / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI4h36($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4h36?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4h36_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h36', $data);
    }
}
// âœ… CQI4h37 - Percentage of Pest Control Complaints Rate (House Keeping)
public function edit_feedback_CQI4h37() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4h37', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h37', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4h37_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4h37_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: % Pest Control Complaints = (No. of Complaints / Total Inspections) * 100
        $complaints = floatval($this->input->post('complaints')) ?: 0;
        $inspections = floatval($this->input->post('inspections')) ?: 0;
        $dataset['pest_complaint_rate'] = ($inspections > 0) ? round(($complaints / $inspections) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI4h37($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4h37?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4h37_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h37', $data);
    }
}
// âœ… CQI4h38 - Linen Quality - Compliance Rate (House Keeping)
public function edit_feedback_CQI4h38() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4h38', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h38', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4h38_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4h38_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: Linen Quality Compliance = (Accepted Linen / Total Linen Checked) * 100
        $accepted = floatval($this->input->post('accepted_linen')) ?: 0;
        $total = floatval($this->input->post('total_linen')) ?: 0;
        $dataset['linen_quality_compliance'] = ($total > 0) ? round(($accepted / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI4h38($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4h38?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4h38_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h38', $data);
    }
}
// âœ… CQI4h39 - Downtime of EMR (ITD)
public function edit_feedback_CQI4h39() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4h39', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h39', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4h39_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4h39_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: Downtime (%) = (Downtime Hours / Total Available Hours) * 100
        $downtime = floatval($this->input->post('downtime_hours')) ?: 0;
        $available = floatval($this->input->post('available_hours')) ?: 0;
        $dataset['downtime_percentage'] = ($available > 0) ? round(($downtime / $available) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI4h39($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4h39?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4h39_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h39', $data);
    }
}
// âœ… CQI4h40 - Outsourced Staff Manpower Compliance Rate (House Keeping)
public function edit_feedback_CQI4h40() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4h40', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h40', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4h40_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4h40_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: Manpower Compliance = (Actual Staff Present / Required Staff) * 100
        $present = floatval($this->input->post('present_staff')) ?: 0;
        $required = floatval($this->input->post('required_staff')) ?: 0;
        $dataset['manpower_compliance'] = ($required > 0) ? round(($present / $required) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI4h40($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4h40?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4h40_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h40', $data);
    }
}
// âœ… CQI4h41 - ITD Preventive Maintenance Compliance (ITD)
public function edit_feedback_CQI4h41() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4h41', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h41', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4h41_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4h41_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: Preventive Maintenance Compliance = (Completed PM / Planned PM) * 100
        $completed = floatval($this->input->post('completed_pm')) ?: 0;
        $planned = floatval($this->input->post('planned_pm')) ?: 0;
        $dataset['pm_compliance'] = ($planned > 0) ? round(($completed / $planned) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI4h41($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4h41?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4h41_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h41', $data);
    }
}
// âœ… CQI4h42 - Biomedical Preventive Maintenance Completion Rate (Biomedical Engineering)
public function edit_feedback_CQI4h42() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4h42', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h42', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4h42_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4h42_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: PM Completion Rate = (Completed PM / Scheduled PM) * 100
        $completed = floatval($this->input->post('completed_pm')) ?: 0;
        $scheduled = floatval($this->input->post('scheduled_pm')) ?: 0;
        $dataset['pm_completion_rate'] = ($scheduled > 0) ? round(($completed / $scheduled) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI4h42($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4h42?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4h42_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h42', $data);
    }
}
// âœ… CQI4h43 - Quality of Patient Transportation by Ambulance (Out-sourced) (Lab Service)
public function edit_feedback_CQI4h43() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4h43', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h43', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4h43_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4h43_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: Quality Score = (Total Satisfied Feedback / Total Feedback) * 100
        $satisfied = floatval($this->input->post('satisfied_feedback')) ?: 0;
        $total = floatval($this->input->post('total_feedback')) ?: 0;
        $dataset['ambulance_quality_score'] = ($total > 0) ? round(($satisfied / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI4h43($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4h43?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4h43_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h43', $data);
    }
}
// âœ… CQI4h44 - F&B Patient Complaints Rate (Food and Beverage Services)
public function edit_feedback_CQI4h44() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4h44', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h44', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4h44_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4h44_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: Complaint Rate = (Total Complaints / Total Meals Served) * 100
        $complaints = floatval($this->input->post('complaints')) ?: 0;
        $meals = floatval($this->input->post('meals_served')) ?: 0;
        $dataset['fb_complaint_rate'] = ($meals > 0) ? round(($complaints / $meals) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI4h44($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4h44?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4h44_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h44', $data);
    }
}
// âœ… CQI4h45 - Delay in Room Services (Food and Beverage Services)
public function edit_feedback_CQI4h45() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4h45', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h45', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4h45_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4h45_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: Delay Rate = (Delayed Orders / Total Orders) * 100
        $delayed = floatval($this->input->post('delayed_orders')) ?: 0;
        $total = floatval($this->input->post('total_orders')) ?: 0;
        $dataset['room_service_delay_rate'] = ($total > 0) ? round(($delayed / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI4h45($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4h45?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4h45_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h45', $data);
    }
}
// âœ… CQI4h46 - Compliance to PCRA (Engineering & Maintenance)
public function edit_feedback_CQI4h46() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4h46', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h46', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4h46_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4h46_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        // ðŸ—‚ File removal and uploads
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: PCRA Compliance = (Audits Complied / Total Audits) * 100
        $audits_complied = floatval($this->input->post('audits_complied')) ?: 0;
        $total_audits = floatval($this->input->post('total_audits')) ?: 0;
        $dataset['pcra_compliance_rate'] = ($total_audits > 0) ? round(($audits_complied / $total_audits) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI4h46($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4h46?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4h46_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h46', $data);
    }
}
// âœ… CQI4h47 - Compliances in patient room cleaning and hygiene practices (House Keeping)
public function edit_feedback_CQI4h47() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4h47', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h47', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4h47_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4h47_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        // File handling logic identical to above
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);
        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = ['upload_path' => './api/file_uploads/', 'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = ['url' => base_url('api/file_uploads/' . $up['file_name']), 'name' => $up['file_name']];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: Room Cleaning Compliance = (Rooms Cleaned / Rooms Audited) * 100
        $cleaned = floatval($this->input->post('rooms_cleaned')) ?: 0;
        $audited = floatval($this->input->post('rooms_audited')) ?: 0;
        $dataset['cleaning_compliance_rate'] = ($audited > 0) ? round(($cleaned / $audited) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI4h47($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4h47?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4h47_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h47', $data);
    }
}
// âœ… CQI4h48 - Patient's Complaints Rate (House Keeping)
public function edit_feedback_CQI4h48() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4h48', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h48', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4h48_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4h48_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);
        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = ['upload_path' => './api/file_uploads/', 'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = ['url' => base_url('api/file_uploads/' . $up['file_name']), 'name' => $up['file_name']];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: Complaint Rate = (Total Complaints / Total Patients) * 100
        $complaints = floatval($this->input->post('complaints')) ?: 0;
        $patients = floatval($this->input->post('patients')) ?: 0;
        $dataset['complaint_rate'] = ($patients > 0) ? round(($complaints / $patients) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI4h48($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4h48?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4h48_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h48', $data);
    }
}
// âœ… CQI4h49 - Percentage of renewable energy used against total energy used (Engineering & Maintenance)
public function edit_feedback_CQI4h49() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4h49', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h49', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4h49_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4h49_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        // File management
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        // Upload new files
        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = ['upload_path' => './api/file_uploads/', 'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = ['url' => base_url('api/file_uploads/' . $up['file_name']), 'name' => $up['file_name']];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: Renewable Energy % = (Renewable Energy Used / Total Energy Used) * 100
        $renewable = floatval($this->input->post('renewable_energy')) ?: 0;
        $total = floatval($this->input->post('total_energy')) ?: 0;
        $dataset['renewable_energy_percentage'] = ($total > 0) ? round(($renewable / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI4h49($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4h49?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4h49_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h49', $data);
    }
}



// âœ… CQI4h50 - To Monitor the Energy Consumption (Engineering & Maintenance)
public function edit_feedback_CQI4h50() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4h50', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h50', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4h50_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4h50_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = ['upload_path' => './api/file_uploads/', 'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = ['url' => base_url('api/file_uploads/' . $up['file_name']), 'name' => $up['file_name']];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: Energy Consumption per Bed = Total Energy Consumed / No. of Beds
        $energy = floatval($this->input->post('total_energy_consumed')) ?: 0;
        $beds = floatval($this->input->post('no_of_beds')) ?: 0;
        $dataset['energy_per_bed'] = ($beds > 0) ? round($energy / $beds, 2) : 0;

        $this->quality_model->update_feedback_CQI4h50($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4h50?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4h50_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h50', $data);
    }
}
// âœ… CQI4h51 - Percentage of Wrong Food Delivery for Patients & Bystanders (Food and Beverage Services)
public function edit_feedback_CQI4h51() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4h51', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h51', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4h51_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4h51_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        // File handling logic
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        // Upload new files
        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = ['upload_path' => './api/file_uploads/', 'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = ['url' => base_url('api/file_uploads/' . $up['file_name']), 'name' => $up['file_name']];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: Wrong Food Delivery % = (Wrong Deliveries / Total Deliveries) * 100
        $wrong = floatval($this->input->post('wrong_deliveries')) ?: 0;
        $total = floatval($this->input->post('total_deliveries')) ?: 0;
        $dataset['wrong_delivery_percentage'] = ($total > 0) ? round(($wrong / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI4h51($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4h51?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4h51_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h51', $data);
    }
}



// âœ… CQI4h52 - Percentage of Adherence to Facility Audit Observation Closure (Safety & Security)
public function edit_feedback_CQI4h52() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4h52', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h52', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4h52_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4h52_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = ['upload_path' => './api/file_uploads/', 'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = ['url' => base_url('api/file_uploads/' . $up['file_name']), 'name' => $up['file_name']];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: Adherence % = (Closed Observations / Total Observations) * 100
        $closed = floatval($this->input->post('closed_observations')) ?: 0;
        $total = floatval($this->input->post('total_observations')) ?: 0;
        $dataset['adherence_percentage'] = ($total > 0) ? round(($closed / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI4h52($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4h52?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4h52_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h52', $data);
    }
}



// âœ… CQI4h53 - Standardised Mortality Ratio for ICU-1 (Nursing - ICU 1)
public function edit_feedback_CQI4h53() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4h53', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h53', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4h53_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4h53_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = ['upload_path' => './api/file_uploads/', 'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = ['url' => base_url('api/file_uploads/' . $up['file_name']), 'name' => $up['file_name']];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // ðŸ”¹ KPI Formula: SMR = (Actual Deaths / Expected Deaths)
        $actual = floatval($this->input->post('actual_deaths')) ?: 0;
        $expected = floatval($this->input->post('expected_deaths')) ?: 0;
        $dataset['smr_ratio'] = ($expected > 0) ? round(($actual / $expected), 2) : 0;

        $this->quality_model->update_feedback_CQI4h53($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4h53?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4h53_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h53', $data);
    }
}



// âœ… CQI4h54 - Standardised Mortality Ratio for ICU-2 (Nursing - ICU 2)
public function edit_feedback_CQI4h54() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4h54', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h54', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4h54_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4h54_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        // Upload logic + formula same as above
        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = ['upload_path' => './api/file_uploads/', 'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = ['url' => base_url('api/file_uploads/' . $up['file_name']), 'name' => $up['file_name']];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // KPI Formula
        $actual = floatval($this->input->post('actual_deaths')) ?: 0;
        $expected = floatval($this->input->post('expected_deaths')) ?: 0;
        $dataset['smr_ratio'] = ($expected > 0) ? round(($actual / $expected), 2) : 0;

        $this->quality_model->update_feedback_CQI4h54($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4h54?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4h54_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h54', $data);
    }
}
// âœ… CQI4h55 - Standardised Mortality Ratio for PICU (Actual deaths in PICU)
public function edit_feedback_CQI4h55() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4h55', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h55', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4h55_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4h55_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        // ðŸ”¸ Handle removed files
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        // ðŸ”¹ Handle newly uploaded files
        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = ['upload_path' => './api/file_uploads/', 'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = ['url' => base_url('api/file_uploads/' . $up['file_name']), 'name' => $up['file_name']];
                }
            }
        }

        // ðŸ”¹ Update dataset
        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // âš™ï¸ KPI Formula: SMR = (Observed Deaths / Expected Deaths) * 100
        $observed = floatval($this->input->post('observed_deaths')) ?: 0;
        $expected = floatval($this->input->post('expected_deaths')) ?: 0;
        $dataset['smr_picu'] = ($expected > 0) ? round(($observed / $expected) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI4h55($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4h55?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4h55_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h55', $data);
    }
}
// âœ… CQI4h56 - Standardised Mortality Ratio for NICU (Actual deaths in NICU)
public function edit_feedback_CQI4h56() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CQI4h56', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h56', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4h56_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4h56_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        // ðŸ”¸ Handle removed files
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        // ðŸ”¹ Handle newly uploaded files
        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = ['upload_path' => './api/file_uploads/', 'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = ['url' => base_url('api/file_uploads/' . $up['file_name']), 'name' => $up['file_name']];
                }
            }
        }

        // ðŸ”¹ Update dataset
        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // âš™ï¸ KPI Formula: SMR = (Observed Deaths / Expected Deaths) * 100
        $observed = floatval($this->input->post('observed_deaths')) ?: 0;
        $expected = floatval($this->input->post('expected_deaths')) ?: 0;
        $dataset['smr_nicu'] = ($expected > 0) ? round(($observed / $expected) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI4h56($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4h56?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4h56_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4h56', $data);
    }
}
// âœ… CLOTCM1 - Average length of stay (MRD - Cardiology)
public function edit_feedback_CLOTCM1() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CLOTCM1', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CLOTCM1', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CLOTCM1_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CLOTCM1_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        // Remove old files if deleted
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        // Handle new uploads
        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = ['upload_path' => './api/file_uploads/', 'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = ['url' => base_url('api/file_uploads/' . $up['file_name']), 'name' => $up['file_name']];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;

        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // âš™ï¸ KPI Formula: Average Length of Stay = Total Patient Days / Total Discharges
        $days = floatval($this->input->post('total_patient_days')) ?: 0;
        $discharges = floatval($this->input->post('total_discharges')) ?: 0;
        $dataset['average_los'] = ($discharges > 0) ? round(($days / $discharges), 2) : 0;

        $this->quality_model->update_feedback_CLOTCM1($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CLOTCM1?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CLOTCM1_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CLOTCM1', $data);
    }
}
// âœ… CLOTCM2 - Average length of stay (MRD - CVTS)
public function edit_feedback_CLOTCM2() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CLOTCM2', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CLOTCM2', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CLOTCM2_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CLOTCM2_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = ['upload_path' => './api/file_uploads/', 'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = ['url' => base_url('api/file_uploads/' . $up['file_name']), 'name' => $up['file_name']];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // âš™ï¸ KPI Formula: Average Length of Stay = Total Patient Days / Total Discharges
        $days = floatval($this->input->post('total_patient_days')) ?: 0;
        $discharges = floatval($this->input->post('total_discharges')) ?: 0;
        $dataset['average_los'] = ($discharges > 0) ? round(($days / $discharges), 2) : 0;

        $this->quality_model->update_feedback_CLOTCM2($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CLOTCM2?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CLOTCM2_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CLOTCM2', $data);
    }
}
// âœ… CLOTCM3 - Average length of stay (MRD - Gastro Surgery)
public function edit_feedback_CLOTCM3() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CLOTCM3', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CLOTCM3', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CLOTCM3_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CLOTCM3_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = ['upload_path' => './api/file_uploads/', 'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = ['url' => base_url('api/file_uploads/' . $up['file_name']), 'name' => $up['file_name']];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // âš™ï¸ KPI Formula: Average Length of Stay = Total Patient Days / Total Discharges
        $days = floatval($this->input->post('total_patient_days')) ?: 0;
        $discharges = floatval($this->input->post('total_discharges')) ?: 0;
        $dataset['average_los'] = ($discharges > 0) ? round(($days / $discharges), 2) : 0;

        $this->quality_model->update_feedback_CLOTCM3($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CLOTCM3?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CLOTCM3_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CLOTCM3', $data);
    }
}
// âœ… CLOTCM4 - Average length of stay (MRD - Gastroenterology)
public function edit_feedback_CLOTCM4() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CLOTCM4', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CLOTCM4', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CLOTCM4_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CLOTCM4_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        // Remove + upload logic same as above
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = ['upload_path' => './api/file_uploads/', 'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = ['url' => base_url('api/file_uploads/' . $up['file_name']), 'name' => $up['file_name']];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // âš™ï¸ Formula
        $days = floatval($this->input->post('total_patient_days')) ?: 0;
        $discharges = floatval($this->input->post('total_discharges')) ?: 0;
        $dataset['average_los'] = ($discharges > 0) ? round(($days / $discharges), 2) : 0;

        $this->quality_model->update_feedback_CLOTCM4($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CLOTCM4?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CLOTCM4_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CLOTCM4', $data);
    }
}
// âœ… CLOTCM5 - Average length of stay (MRD - General Medicine)
public function edit_feedback_CLOTCM5() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CLOTCM5', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CLOTCM5', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CLOTCM5_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CLOTCM5_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = ['upload_path' => './api/file_uploads/', 'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = ['url' => base_url('api/file_uploads/' . $up['file_name']), 'name' => $up['file_name']];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // âš™ï¸ Formula
        $days = floatval($this->input->post('total_patient_days')) ?: 0;
        $discharges = floatval($this->input->post('total_discharges')) ?: 0;
        $dataset['average_los'] = ($discharges > 0) ? round(($days / $discharges), 2) : 0;

        $this->quality_model->update_feedback_CLOTCM5($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CLOTCM5?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CLOTCM5_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CLOTCM5', $data);
    }
}
// âœ… CLOTCM6 - Average length of stay (MRD - ICU)
public function edit_feedback_CLOTCM6() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CLOTCM6', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CLOTCM6', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CLOTCM6_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CLOTCM6_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        // File Handling
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = ['upload_path' => './api/file_uploads/', 'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = ['url' => base_url('api/file_uploads/' . $up['file_name']), 'name' => $up['file_name']];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // âš™ï¸ KPI Formula: Average Length of Stay = Total Patient Days / Total Discharges
        $days = floatval($this->input->post('total_patient_days')) ?: 0;
        $discharges = floatval($this->input->post('total_discharges')) ?: 0;
        $dataset['average_los'] = ($discharges > 0) ? round(($days / $discharges), 2) : 0;

        $this->quality_model->update_feedback_CLOTCM6($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CLOTCM6?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CLOTCM6_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CLOTCM6', $data);
    }
}
// âœ… CLOTCM7 - Readmission rate within 30 days (MRD - ICU)
public function edit_feedback_CLOTCM7() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CLOTCM7', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CLOTCM7', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CLOTCM7_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CLOTCM7_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        // ðŸ—‘ï¸ Remove selected files
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        // ðŸ“‚ Upload new files
        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;

        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // âš™ï¸ KPI Formula: Readmission Rate = (No. of Readmissions within 30 days / Total Discharges) Ã— 100
        $readmissions = floatval($this->input->post('readmissions_30_days')) ?: 0;
        $total_discharges = floatval($this->input->post('total_discharges')) ?: 0;
        $dataset['readmission_rate'] = ($total_discharges > 0) ? round(($readmissions / $total_discharges) * 100, 2) : 0;

        $this->quality_model->update_feedback_CLOTCM7($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CLOTCM7?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CLOTCM7_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CLOTCM7', $data);
    }
}
// âœ… CLOTCM8 - Mortality Rate (MRD - ICU)
public function edit_feedback_CLOTCM8() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CLOTCM8', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CLOTCM8', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CLOTCM8_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CLOTCM8_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        // ðŸ—‘ï¸ Remove selected files
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        // ðŸ“‚ Upload new files
        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;

        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // âš™ï¸ KPI Formula: Mortality Rate = (Total Deaths / Total Discharges) Ã— 100
        $deaths = floatval($this->input->post('total_deaths')) ?: 0;
        $discharges = floatval($this->input->post('total_discharges')) ?: 0;
        $dataset['mortality_rate'] = ($discharges > 0) ? round(($deaths / $discharges) * 100, 2) : 0;

        $this->quality_model->update_feedback_CLOTCM8($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CLOTCM8?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CLOTCM8_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CLOTCM8', $data);
    }
}
// âœ… CLOTCM9 - Bed Occupancy Rate (MRD - ICU)
public function edit_feedback_CLOTCM9() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD') ?
            $this->load->view('qualitymodules/edit_feedback_CLOTCM9', $data, true) :
            $this->load->view('qualitymodules/dephead/edit_feedback_CLOTCM9', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CLOTCM9_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CLOTCM9_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        // ðŸ—‘ï¸ Remove selected files
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        // ðŸ“‚ Upload new files
        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;

        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // âš™ï¸ KPI Formula: Bed Occupancy Rate = (Total Patient Days / (Available Beds Ã— Days in Period)) Ã— 100
        $patient_days = floatval($this->input->post('total_patient_days')) ?: 0;
        $available_beds = floatval($this->input->post('available_beds')) ?: 0;
        $days_in_period = floatval($this->input->post('days_in_period')) ?: 0;
        $denominator = $available_beds * $days_in_period;
        $dataset['bed_occupancy_rate'] = ($denominator > 0) ? round(($patient_days / $denominator) * 100, 2) : 0;

        $this->quality_model->update_feedback_CLOTCM9($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CLOTCM9?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CLOTCM9_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CLOTCM9', $data);
    }
}
// âœ… CLOTCM10 - Average Length of Stay (MRD - Neurosurgery)
public function edit_feedback_CLOTCM10() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD')
            ? $this->load->view('qualitymodules/edit_feedback_CLOTCM10', $data, true)
            : $this->load->view('qualitymodules/dephead/edit_feedback_CLOTCM10', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CLOTCM10_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CLOTCM10_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        // ðŸ—‘ï¸ Remove files
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        // ðŸ“‚ Upload new files
        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = ['upload_path' => './api/file_uploads/', 'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = ['url' => base_url('api/file_uploads/' . $up['file_name']), 'name' => $up['file_name']];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // âš™ï¸ Formula: Average LOS = Total Patient Days / Total Discharges
        $days = floatval($this->input->post('total_patient_days')) ?: 0;
        $discharges = floatval($this->input->post('total_discharges')) ?: 0;
        $dataset['average_los'] = ($discharges > 0) ? round(($days / $discharges), 2) : 0;

        $this->quality_model->update_feedback_CLOTCM10($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CLOTCM10?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CLOTCM10_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CLOTCM10', $data);
    }
}
// âœ… CLOTCM11 - Average Length of Stay (MRD - Ortho Neuro Integrated Spine)
public function edit_feedback_CLOTCM11() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD')
            ? $this->load->view('qualitymodules/edit_feedback_CLOTCM11', $data, true)
            : $this->load->view('qualitymodules/dephead/edit_feedback_CLOTCM11', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CLOTCM11_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CLOTCM11_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        // ðŸ—‘ï¸ Remove and upload files (same as before)
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);
        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = ['upload_path' => './api/file_uploads/', 'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = ['url' => base_url('api/file_uploads/' . $up['file_name']), 'name' => $up['file_name']];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // âš™ï¸ Formula: Average LOS = Total Patient Days / Total Discharges
        $days = floatval($this->input->post('total_patient_days')) ?: 0;
        $discharges = floatval($this->input->post('total_discharges')) ?: 0;
        $dataset['average_los'] = ($discharges > 0) ? round(($days / $discharges), 2) : 0;

        $this->quality_model->update_feedback_CLOTCM11($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CLOTCM11?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CLOTCM11_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CLOTCM11', $data);
    }
}
// âœ… CLOTCM12 - Average Length of Stay (MRD - Ortho THR)
public function edit_feedback_CLOTCM12() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD')
            ? $this->load->view('qualitymodules/edit_feedback_CLOTCM12', $data, true)
            : $this->load->view('qualitymodules/dephead/edit_feedback_CLOTCM12', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CLOTCM12_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CLOTCM12_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        // ðŸ—‘ï¸ Remove old files
        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        // ðŸ“‚ Upload new files
        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // âš™ï¸ KPI Formula: Average LOS = Total Patient Days / Total Discharges
        $days = floatval($this->input->post('total_patient_days')) ?: 0;
        $discharges = floatval($this->input->post('total_discharges')) ?: 0;
        $dataset['average_los'] = ($discharges > 0) ? round(($days / $discharges), 2) : 0;

        $this->quality_model->update_feedback_CLOTCM12($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CLOTCM12?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CLOTCM12_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CLOTCM12', $data);
    }
}
// âœ… CLOTCM13 - Average Length of Stay (MRD - Pulmonology)
public function edit_feedback_CLOTCM13() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD')
            ? $this->load->view('qualitymodules/edit_feedback_CLOTCM13', $data, true)
            : $this->load->view('qualitymodules/dephead/edit_feedback_CLOTCM13', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CLOTCM13_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CLOTCM13_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // âš™ï¸ KPI Formula: Average LOS = Total Patient Days / Total Discharges
        $days = floatval($this->input->post('total_patient_days')) ?: 0;
        $discharges = floatval($this->input->post('total_discharges')) ?: 0;
        $dataset['average_los'] = ($discharges > 0) ? round(($days / $discharges), 2) : 0;

        $this->quality_model->update_feedback_CLOTCM13($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CLOTCM13?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CLOTCM13_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CLOTCM13', $data);
    }
}
// âœ… CLOTCM14 - Average Length of Stay (MRD - Plastic Surgery)
public function edit_feedback_CLOTCM14() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD')
            ? $this->load->view('qualitymodules/edit_feedback_CLOTCM14', $data, true)
            : $this->load->view('qualitymodules/dephead/edit_feedback_CLOTCM14', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CLOTCM14_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CLOTCM14_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // âš™ï¸ KPI Formula: Average LOS = Total Patient Days / Total Discharges
        $days = floatval($this->input->post('total_patient_days')) ?: 0;
        $discharges = floatval($this->input->post('total_discharges')) ?: 0;
        $dataset['average_los'] = ($discharges > 0) ? round(($days / $discharges), 2) : 0;

        $this->quality_model->update_feedback_CLOTCM14($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CLOTCM14?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CLOTCM14_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CLOTCM14', $data);
    }
}
// âœ… CLOTCM15 - Average Length of Stay (MRD - Urology)
public function edit_feedback_CLOTCM15() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD')
            ? $this->load->view('qualitymodules/edit_feedback_CLOTCM15', $data, true)
            : $this->load->view('qualitymodules/dephead/edit_feedback_CLOTCM15', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CLOTCM15_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CLOTCM15_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // âš™ï¸ KPI Formula: Average LOS = Total Patient Days / Total Discharges
        $days = floatval($this->input->post('total_patient_days')) ?: 0;
        $discharges = floatval($this->input->post('total_discharges')) ?: 0;
        $dataset['average_los'] = ($discharges > 0) ? round(($days / $discharges), 2) : 0;

        $this->quality_model->update_feedback_CLOTCM15($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CLOTCM15?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CLOTCM15_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CLOTCM15', $data);
    }
}
// âœ… CLOTCM16 - Average length of stay (MRD - Urology)
public function edit_feedback_CLOTCM16() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD')
            ? $this->load->view('qualitymodules/edit_feedback_CLOTCM16', $data, true)
            : $this->load->view('qualitymodules/dephead/edit_feedback_CLOTCM16', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CLOTCM16_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CLOTCM16_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // âš™ï¸ KPI Formula: Average LOS = Total Patient Days / Total Discharges
        $days = floatval($this->input->post('total_patient_days')) ?: 0;
        $discharges = floatval($this->input->post('total_discharges')) ?: 0;
        $dataset['average_los'] = ($discharges > 0) ? round(($days / $discharges), 2) : 0;

        $this->quality_model->update_feedback_CLOTCM16($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CLOTCM16?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CLOTCM16_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CLOTCM16', $data);
    }
}
// âœ… CLOTCM17 - Catheter associated urinary tract infection rate (Infection Control - ICU1)
public function edit_feedback_CLOTCM17() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module); 
    if ($LOAD == 'inpatient_modules') {     
        $data['title'] = 'EDIT KPI FORM';     
        $data['content'] = isfeature_active('QUALITY-DASHBOARD')
            ? $this->load->view('qualitymodules/edit_feedback_CLOTCM17', $data, true)
            : $this->load->view('qualitymodules/dephead/edit_feedback_CLOTCM17', $data, true);     
        $this->load->view('layout/main_wrapper', $data); 
    } 
}

public function edit_feedback_CLOTCM17_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CLOTCM17_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);     
        foreach ($removeIndexes as $i) {         
            if (isset($existingFiles[$i])) {             
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);             
                if (file_exists($p)) @unlink($p);             
                unset($existingFiles[$i]);         
            }     
        }     
        $existingFiles = array_values($existingFiles);      

        if (!empty($_FILES['uploaded_files']['name'][0])) {         
            $this->load->library('upload');         
            $config = [             
                'upload_path' => './api/file_uploads/',             
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'         
            ];         
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {             
                $_FILES['file'] = [                 
                    'name' => $name,                 
                    'type' => $_FILES['uploaded_files']['type'][$i],                 
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],                 
                    'error' => $_FILES['uploaded_files']['error'][$i],                 
                    'size' => $_FILES['uploaded_files']['size'][$i]             
                ];             
                $this->upload->initialize($config);             
                if ($this->upload->do_upload('file')) {                 
                    $up = $this->upload->data();                 
                    $existingFiles[] = [                     
                        'url' => base_url('api/file_uploads/' . $up['file_name']),                     
                        'name' => $up['file_name']                 
                    ];             
                }         
            }     
        }      

        $dataset['files_name'] = $existingFiles;     
        foreach ($_POST as $k => $v)         
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))             
                $dataset[$k] = $v;      

        // âš™ï¸ KPI Formula: (CAUTI Cases / Catheter Days) Ã— 1000
        $cases = floatval($this->input->post('cauti_cases')) ?: 0;
        $days = floatval($this->input->post('catheter_days')) ?: 0;
        $dataset['cauti_rate'] = ($days > 0) ? round(($cases / $days) * 1000, 2) : 0;

        $this->quality_model->update_feedback_CLOTCM17($id, ['dataset' => json_encode($dataset)]);     
        redirect('quality/patient_feedback_CLOTCM17?id=' . $id); 
    } else {     
        $data['param'] = $this->quality_model->get_feedback_CLOTCM17_byid($id);     
        $this->load->view('qualitymodules/dephead/edit_feedback_CLOTCM17', $data); 
    } 
}
// âœ… CLOTCM18 - Catheter associated urinary tract infection rate (Infection Control - ICU2)
public function edit_feedback_CLOTCM18() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module); 
    if ($LOAD == 'inpatient_modules') {     
        $data['title'] = 'EDIT KPI FORM';     
        $data['content'] = isfeature_active('QUALITY-DASHBOARD')
            ? $this->load->view('qualitymodules/edit_feedback_CLOTCM18', $data, true)
            : $this->load->view('qualitymodules/dephead/edit_feedback_CLOTCM18', $data, true);     
        $this->load->view('layout/main_wrapper', $data); 
    } 
}

public function edit_feedback_CLOTCM18_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CLOTCM18_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // âš™ï¸ KPI Formula: (CAUTI Cases / Catheter Days) Ã— 1000
        $cases = floatval($this->input->post('cauti_cases')) ?: 0;
        $days = floatval($this->input->post('catheter_days')) ?: 0;
        $dataset['cauti_rate'] = ($days > 0) ? round(($cases / $days) * 1000, 2) : 0;

        $this->quality_model->update_feedback_CLOTCM18($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CLOTCM18?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CLOTCM18_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CLOTCM18', $data);
    }
}


// âœ… CLOTCM19 - Catheter associated urinary tract infection rate (Infection Control - ICU3)
public function edit_feedback_CLOTCM19() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module); 
    if ($LOAD == 'inpatient_modules') {     
        $data['title'] = 'EDIT KPI FORM';     
        $data['content'] = isfeature_active('QUALITY-DASHBOARD')
            ? $this->load->view('qualitymodules/edit_feedback_CLOTCM19', $data, true)
            : $this->load->view('qualitymodules/dephead/edit_feedback_CLOTCM19', $data, true);     
        $this->load->view('layout/main_wrapper', $data); 
    } 
}

public function edit_feedback_CLOTCM19_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CLOTCM19_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // âš™ï¸ KPI Formula: (CAUTI Cases / Catheter Days) Ã— 1000
        $cases = floatval($this->input->post('cauti_cases')) ?: 0;
        $days = floatval($this->input->post('catheter_days')) ?: 0;
        $dataset['cauti_rate'] = ($days > 0) ? round(($cases / $days) * 1000, 2) : 0;

        $this->quality_model->update_feedback_CLOTCM19($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CLOTCM19?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CLOTCM19_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CLOTCM19', $data);
    }
}


// âœ… CLOTCM20 - Central Line Associated Blood Stream Infection (CLABSI) (ICU1)
public function edit_feedback_CLOTCM20() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module); 
    if ($LOAD == 'inpatient_modules') {     
        $data['title'] = 'EDIT KPI FORM';     
        $data['content'] = isfeature_active('QUALITY-DASHBOARD')
            ? $this->load->view('qualitymodules/edit_feedback_CLOTCM20', $data, true)
            : $this->load->view('qualitymodules/dephead/edit_feedback_CLOTCM20', $data, true);     
        $this->load->view('layout/main_wrapper', $data); 
    } 
}

public function edit_feedback_CLOTCM20_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CLOTCM20_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // âš™ï¸ KPI Formula: (CLABSI Cases / Central Line Days) Ã— 1000
        $cases = floatval($this->input->post('clabsi_cases')) ?: 0;
        $days = floatval($this->input->post('central_line_days')) ?: 0;
        $dataset['clabsi_rate'] = ($days > 0) ? round(($cases / $days) * 1000, 2) : 0;

        $this->quality_model->update_feedback_CLOTCM20($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CLOTCM20?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CLOTCM20_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CLOTCM20', $data);
    }
}
// âœ… CLOTCM21 - Central Line Associated Blood Stream Infection (CLABSI) (Infection Control - ICU2)
public function edit_feedback_CLOTCM21() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD')
            ? $this->load->view('qualitymodules/edit_feedback_CLOTCM21', $data, true)
            : $this->load->view('qualitymodules/dephead/edit_feedback_CLOTCM21', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CLOTCM21_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CLOTCM21_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // âš™ï¸ KPI Formula: (CLABSI Cases / Central Line Days) Ã— 1000
        $cases = floatval($this->input->post('clabsi_cases')) ?: 0;
        $days = floatval($this->input->post('central_line_days')) ?: 0;
        $dataset['clabsi_rate'] = ($days > 0) ? round(($cases / $days) * 1000, 2) : 0;

        $this->quality_model->update_feedback_CLOTCM21($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CLOTCM21?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CLOTCM21_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CLOTCM21', $data);
    }
}


// âœ… CLOTCM22 - Central Line Associated Blood Stream Infection (CLABSI) (Infection Control - ICU3)
public function edit_feedback_CLOTCM22() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD')
            ? $this->load->view('qualitymodules/edit_feedback_CLOTCM22', $data, true)
            : $this->load->view('qualitymodules/dephead/edit_feedback_CLOTCM22', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CLOTCM22_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CLOTCM22_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // âš™ï¸ KPI Formula: (CLABSI Cases / Central Line Days) Ã— 1000
        $cases = floatval($this->input->post('clabsi_cases')) ?: 0;
        $days = floatval($this->input->post('central_line_days')) ?: 0;
        $dataset['clabsi_rate'] = ($days > 0) ? round(($cases / $days) * 1000, 2) : 0;

        $this->quality_model->update_feedback_CLOTCM22($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CLOTCM22?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CLOTCM22_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CLOTCM22', $data);
    }
}


// âœ… CLOTCM23 - Surgical Site Infection rate (Infection Control - Ortho THR)
public function edit_feedback_CLOTCM23() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD')
            ? $this->load->view('qualitymodules/edit_feedback_CLOTCM23', $data, true)
            : $this->load->view('qualitymodules/dephead/edit_feedback_CLOTCM23', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CLOTCM23_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CLOTCM23_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // âš™ï¸ KPI Formula: (SSI Cases / Total Procedures) Ã— 100  â€” percentage
        $cases = floatval($this->input->post('ssi_cases')) ?: 0;
        $procedures = floatval($this->input->post('total_procedures')) ?: 0;
        $dataset['ssi_rate_percent'] = ($procedures > 0) ? round(($cases / $procedures) * 100, 2) : 0;

        $this->quality_model->update_feedback_CLOTCM23($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CLOTCM23?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CLOTCM23_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CLOTCM23', $data);
    }
}


// âœ… CLOTCM24 - Surgical Site Infection rate (Infection Control - Ortho TKR)
public function edit_feedback_CLOTCM24() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD')
            ? $this->load->view('qualitymodules/edit_feedback_CLOTCM24', $data, true)
            : $this->load->view('qualitymodules/dephead/edit_feedback_CLOTCM24', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CLOTCM24_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CLOTCM24_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // âš™ï¸ KPI Formula: (SSI Cases / Total Procedures) Ã— 100  â€” percentage
        $cases = floatval($this->input->post('ssi_cases')) ?: 0;
        $procedures = floatval($this->input->post('total_procedures')) ?: 0;
        $dataset['ssi_rate_percent'] = ($procedures > 0) ? round(($cases / $procedures) * 100, 2) : 0;

        $this->quality_model->update_feedback_CLOTCM24($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CLOTCM24?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CLOTCM24_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CLOTCM24', $data);
    }
}


// âœ… CLOTCM25 - Ventilator associated pneumonias (VAP) in 1000 ventilator days (Infection Control - ICU1)
public function edit_feedback_CLOTCM25() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD')
            ? $this->load->view('qualitymodules/edit_feedback_CLOTCM25', $data, true)
            : $this->load->view('qualitymodules/dephead/edit_feedback_CLOTCM25', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CLOTCM25_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CLOTCM25_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // âš™ï¸ KPI Formula: (VAP Cases / Ventilator Days) Ã— 1000
        $cases = floatval($this->input->post('vap_cases')) ?: 0;
        $days = floatval($this->input->post('ventilator_days')) ?: 0;
        $dataset['vap_rate'] = ($days > 0) ? round(($cases / $days) * 1000, 2) : 0;

        $this->quality_model->update_feedback_CLOTCM25($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CLOTCM25?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CLOTCM25_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CLOTCM25', $data);
    }
}
// âœ… CLOTCM26 - Ventilator associated pneumonias (VAP) in 1000 ventilator days (Infection Control - ICU2)
public function edit_feedback_CLOTCM26() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);  
    if ($LOAD == 'inpatient_modules') {      
        $data['title'] = 'EDIT KPI FORM';      
        $data['content'] = isfeature_active('QUALITY-DASHBOARD')
            ? $this->load->view('qualitymodules/edit_feedback_CLOTCM26', $data, true)
            : $this->load->view('qualitymodules/dephead/edit_feedback_CLOTCM26', $data, true);      
        $this->load->view('layout/main_wrapper', $data);  
    } 
}

public function edit_feedback_CLOTCM26_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CLOTCM26_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);      
        foreach ($removeIndexes as $i) {          
            if (isset($existingFiles[$i])) {              
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);              
                if (file_exists($p)) @unlink($p);              
                unset($existingFiles[$i]);          
            }      
        }      
        $existingFiles = array_values($existingFiles);      

        if (!empty($_FILES['uploaded_files']['name'][0])) {          
            $this->load->library('upload');          
            $config = [              
                'upload_path' => './api/file_uploads/',              
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'          
            ];          
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {              
                $_FILES['file'] = [                  
                    'name' => $name,                  
                    'type' => $_FILES['uploaded_files']['type'][$i],                  
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],                  
                    'error' => $_FILES['uploaded_files']['error'][$i],                  
                    'size' => $_FILES['uploaded_files']['size'][$i]              
                ];              
                $this->upload->initialize($config);              
                if ($this->upload->do_upload('file')) {                  
                    $up = $this->upload->data();                  
                    $existingFiles[] = [                      
                        'url' => base_url('api/file_uploads/' . $up['file_name']),                      
                        'name' => $up['file_name']                  
                    ];              
                }          
            }      
        }      

        $dataset['files_name'] = $existingFiles;      
        foreach ($_POST as $k => $v)          
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))              
                $dataset[$k] = $v;      

        // âš™ï¸ KPI Formula: (VAP Cases / Ventilator Days) Ã— 1000
        $cases = floatval($this->input->post('vap_cases')) ?: 0;
        $days = floatval($this->input->post('ventilator_days')) ?: 0;
        $dataset['vap_rate'] = ($days > 0) ? round(($cases / $days) * 1000, 2) : 0;

        $this->quality_model->update_feedback_CLOTCM26($id, ['dataset' => json_encode($dataset)]);      
        redirect('quality/patient_feedback_CLOTCM26?id=' . $id);  
    } else {      
        $data['param'] = $this->quality_model->get_feedback_CLOTCM26_byid($id);      
        $this->load->view('qualitymodules/dephead/edit_feedback_CLOTCM26', $data);  
    }  
}
// âœ… CLOTCM27 - Ventilator associated pneumonias (VAP) in 1000 ventilator days (Infection Control - ICU3)
public function edit_feedback_CLOTCM27() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);  
    if ($LOAD == 'inpatient_modules') {      
        $data['title'] = 'EDIT KPI FORM';      
        $data['content'] = isfeature_active('QUALITY-DASHBOARD')
            ? $this->load->view('qualitymodules/edit_feedback_CLOTCM27', $data, true)
            : $this->load->view('qualitymodules/dephead/edit_feedback_CLOTCM27', $data, true);      
        $this->load->view('layout/main_wrapper', $data);  
    } 
}

public function edit_feedback_CLOTCM27_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CLOTCM27_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);      
        foreach ($removeIndexes as $i) {          
            if (isset($existingFiles[$i])) {              
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);              
                if (file_exists($p)) @unlink($p);              
                unset($existingFiles[$i]);          
            }      
        }      
        $existingFiles = array_values($existingFiles);      

        if (!empty($_FILES['uploaded_files']['name'][0])) {          
            $this->load->library('upload');          
            $config = [              
                'upload_path' => './api/file_uploads/',              
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'          
            ];          
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {              
                $_FILES['file'] = [                  
                    'name' => $name,                  
                    'type' => $_FILES['uploaded_files']['type'][$i],                  
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],                  
                    'error' => $_FILES['uploaded_files']['error'][$i],                  
                    'size' => $_FILES['uploaded_files']['size'][$i]              
                ];              
                $this->upload->initialize($config);              
                if ($this->upload->do_upload('file')) {                  
                    $up = $this->upload->data();                  
                    $existingFiles[] = [                      
                        'url' => base_url('api/file_uploads/' . $up['file_name']),                      
                        'name' => $up['file_name']                  
                    ];              
                }          
            }      
        }      

        $dataset['files_name'] = $existingFiles;      
        foreach ($_POST as $k => $v)          
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))              
                $dataset[$k] = $v;      

        // âš™ï¸ KPI Formula: (VAP Cases / Ventilator Days) Ã— 1000
        $cases = floatval($this->input->post('vap_cases')) ?: 0;
        $days = floatval($this->input->post('ventilator_days')) ?: 0;
        $dataset['vap_rate'] = ($days > 0) ? round(($cases / $days) * 1000, 2) : 0;

        $this->quality_model->update_feedback_CLOTCM27($id, ['dataset' => json_encode($dataset)]);      
        redirect('quality/patient_feedback_CLOTCM27?id=' . $id);  
    } else {      
        $data['param'] = $this->quality_model->get_feedback_CLOTCM27_byid($id);      
        $this->load->view('qualitymodules/dephead/edit_feedback_CLOTCM27', $data);  
    }  
}
// âœ… CLOTCM28 - Ventilator associated pneumonias (VAP) in 1000 ventilator days (Infection Control - Ortho THR)
public function edit_feedback_CLOTCM28() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {      
        $data['title'] = 'EDIT KPI FORM';      
        $data['content'] = isfeature_active('QUALITY-DASHBOARD')
            ? $this->load->view('qualitymodules/edit_feedback_CLOTCM28', $data, true)
            : $this->load->view('qualitymodules/dephead/edit_feedback_CLOTCM28', $data, true);      
        $this->load->view('layout/main_wrapper', $data);  
    } 
}

public function edit_feedback_CLOTCM28_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CLOTCM28_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // âš™ï¸ KPI Formula: (VAP Cases / Ventilator Days) Ã— 1000
        $cases = floatval($this->input->post('vap_cases')) ?: 0;
        $days = floatval($this->input->post('ventilator_days')) ?: 0;
        $dataset['vap_rate'] = ($days > 0) ? round(($cases / $days) * 1000, 2) : 0;

        $this->quality_model->update_feedback_CLOTCM28($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CLOTCM28?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CLOTCM28_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CLOTCM28', $data);
    }
}
// âœ… CLOTCM29 - Ventilator associated pneumonias (VAP) in 1000 ventilator days (Infection Control - Ortho TKR)
public function edit_feedback_CLOTCM29() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {      
        $data['title'] = 'EDIT KPI FORM';      
        $data['content'] = isfeature_active('QUALITY-DASHBOARD')
            ? $this->load->view('qualitymodules/edit_feedback_CLOTCM29', $data, true)
            : $this->load->view('qualitymodules/dephead/edit_feedback_CLOTCM29', $data, true);      
        $this->load->view('layout/main_wrapper', $data);  
    } 
}

public function edit_feedback_CLOTCM29_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CLOTCM29_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // âš™ï¸ KPI Formula: (VAP Cases / Ventilator Days) Ã— 1000
        $cases = floatval($this->input->post('vap_cases')) ?: 0;
        $days = floatval($this->input->post('ventilator_days')) ?: 0;
        $dataset['vap_rate'] = ($days > 0) ? round(($cases / $days) * 1000, 2) : 0;

        $this->quality_model->update_feedback_CLOTCM29($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CLOTCM29?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CLOTCM29_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CLOTCM29', $data);
    }
}
// âœ… CLOTCM30 - Prevalence of transfusion reactions in Leuco depleted PRBC transfusions (Blood Center)
public function edit_feedback_CLOTCM30() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {      
        $data['title'] = 'EDIT KPI FORM';      
        $data['content'] = isfeature_active('QUALITY-DASHBOARD')
            ? $this->load->view('qualitymodules/edit_feedback_CLOTCM30', $data, true)
            : $this->load->view('qualitymodules/dephead/edit_feedback_CLOTCM30', $data, true);      
        $this->load->view('layout/main_wrapper', $data);  
    } 
}

public function edit_feedback_CLOTCM30_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CLOTCM30_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // âš™ï¸ KPI Formula: (Transfusion Reactions / Leuco Depleted PRBC Transfusions) Ã— 100
        $reactions = floatval($this->input->post('transfusion_reactions')) ?: 0;
        $transfusions = floatval($this->input->post('leuco_depleted_transfusions')) ?: 0;
        $dataset['reaction_rate'] = ($transfusions > 0) ? round(($reactions / $transfusions) * 100, 2) : 0;

        $this->quality_model->update_feedback_CLOTCM30($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CLOTCM30?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CLOTCM30_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CLOTCM30', $data);
    }
}
// âœ… CQI4i1 - Compliance to medical service requests - Heart, Lung transplantation (Medical Administration)
public function edit_feedback_CQI4i1() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {      
        $data['title'] = 'EDIT KPI FORM';      
        $data['content'] = isfeature_active('QUALITY-DASHBOARD')
            ? $this->load->view('qualitymodules/edit_feedback_CQI4i1', $data, true)
            : $this->load->view('qualitymodules/dephead/edit_feedback_CQI4i1', $data, true);      
        $this->load->view('layout/main_wrapper', $data);  
    } 
}

public function edit_feedback_CQI4i1_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4i1_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // âš™ï¸ KPI Formula: Compliance % = (No. of Complied Requests / Total Requests) Ã— 100
        $complied = floatval($this->input->post('complied_requests')) ?: 0;
        $total = floatval($this->input->post('total_requests')) ?: 0;
        $dataset['compliance_rate'] = ($total > 0) ? round(($complied / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI4i1($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4i1?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4i1_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4i1', $data);
    }
}
// âœ… CQI4i2 - Compliance to medical service requests - Heart, Lung transplantation (Liver transplantation)
public function edit_feedback_CQI4i2() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {      
        $data['title'] = 'EDIT KPI FORM';      
        $data['content'] = isfeature_active('QUALITY-DASHBOARD')
            ? $this->load->view('qualitymodules/edit_feedback_CQI4i2', $data, true)
            : $this->load->view('qualitymodules/dephead/edit_feedback_CQI4i2', $data, true);      
        $this->load->view('layout/main_wrapper', $data);  
    } 
}

public function edit_feedback_CQI4i2_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4i2_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // âš™ï¸ KPI Formula: Compliance % = (No. of Complied Requests / Total Requests) Ã— 100
        $complied = floatval($this->input->post('complied_requests')) ?: 0;
        $total = floatval($this->input->post('total_requests')) ?: 0;
        $dataset['compliance_rate'] = ($total > 0) ? round(($complied / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI4i2($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4i2?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4i2_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4i2', $data);
    }
}

// âœ… CQI4i3 - TAT compliance for radiology outsourced test (Radiology)
public function edit_feedback_CQI4i3() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {      
        $data['title'] = 'EDIT KPI FORM';      
        $data['content'] = isfeature_active('QUALITY-DASHBOARD')
            ? $this->load->view('qualitymodules/edit_feedback_CQI4i3', $data, true)
            : $this->load->view('qualitymodules/dephead/edit_feedback_CQI4i3', $data, true);      
        $this->load->view('layout/main_wrapper', $data);  
    } 
}

public function edit_feedback_CQI4i3_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4i3_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // âš™ï¸ KPI Formula: TAT Compliance % = (Tests within TAT / Total Tests) Ã— 100
        $within_tat = floatval($this->input->post('within_tat')) ?: 0;
        $total_tests = floatval($this->input->post('total_tests')) ?: 0;
        $dataset['tat_compliance'] = ($total_tests > 0) ? round(($within_tat / $total_tests) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI4i3($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4i3?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4i3_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4i3', $data);
    }
}
// âœ… CQI4i4 - Food waste collection rate (House Keeping)
public function edit_feedback_CQI4i4() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD')
            ? $this->load->view('qualitymodules/edit_feedback_CQI4i4', $data, true)
            : $this->load->view('qualitymodules/dephead/edit_feedback_CQI4i4', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4i4_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4i4_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // âš™ï¸ KPI Formula: (Food Waste Collected / Total Food Produced) Ã— 100
        $waste = floatval($this->input->post('food_waste_collected')) ?: 0;
        $produced = floatval($this->input->post('total_food_produced')) ?: 0;
        $dataset['food_waste_rate'] = ($produced > 0) ? round(($waste / $produced) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI4i4($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4i4?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4i4_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4i4', $data);
    }
}

// âœ… CQI4i5 - Solid waste collection rate (House Keeping)
public function edit_feedback_CQI4i5() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD')
            ? $this->load->view('qualitymodules/edit_feedback_CQI4i5', $data, true)
            : $this->load->view('qualitymodules/dephead/edit_feedback_CQI4i5', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4i5_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4i5_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // âš™ï¸ KPI Formula: (Solid Waste Collected / Total Waste Generated) Ã— 100
        $collected = floatval($this->input->post('solid_waste_collected')) ?: 0;
        $generated = floatval($this->input->post('total_waste_generated')) ?: 0;
        $dataset['solid_waste_rate'] = ($generated > 0) ? round(($collected / $generated) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI4i5($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4i5?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4i5_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4i5', $data);
    }
}

// âœ… CQI4i6 - Outsourced GDA absenteeism rate (House Keeping)
public function edit_feedback_CQI4i6() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD')
            ? $this->load->view('qualitymodules/edit_feedback_CQI4i6', $data, true)
            : $this->load->view('qualitymodules/dephead/edit_feedback_CQI4i6', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4i6_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4i6_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // âš™ï¸ KPI Formula: Absenteeism Rate % = (Absent Days / Total Working Days) Ã— 100
        $absent = floatval($this->input->post('absent_days')) ?: 0;
        $working = floatval($this->input->post('total_working_days')) ?: 0;
        $dataset['absenteeism_rate'] = ($working > 0) ? round(($absent / $working) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI4i6($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4i6?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4i6_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4i6', $data);
    }
}
// âœ… CQI4i7 - Outsourced OPD Assistance attendance (Operation)
public function edit_feedback_CQI4i7() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD')
            ? $this->load->view('qualitymodules/edit_feedback_CQI4i7', $data, true)
            : $this->load->view('qualitymodules/dephead/edit_feedback_CQI4i7', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4i7_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4i7_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // âš™ï¸ KPI Formula: Attendance % = (Attended Days / Total Working Days) Ã— 100
        $attended = floatval($this->input->post('attended_days')) ?: 0;
        $working = floatval($this->input->post('total_working_days')) ?: 0;
        $dataset['attendance_rate'] = ($working > 0) ? round(($attended / $working) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI4i7($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4i7?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4i7_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4i7', $data);
    }
}


// âœ… CQI4i8 - Outsourced UTIZ staff attendance (House Keeping)
public function edit_feedback_CQI4i8() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD')
            ? $this->load->view('qualitymodules/edit_feedback_CQI4i8', $data, true)
            : $this->load->view('qualitymodules/dephead/edit_feedback_CQI4i8', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4i8_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4i8_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // âš™ï¸ KPI Formula: Attendance % = (Attended Days / Total Working Days) Ã— 100
        $attended = floatval($this->input->post('attended_days')) ?: 0;
        $working = floatval($this->input->post('total_working_days')) ?: 0;
        $dataset['attendance_rate'] = ($working > 0) ? round(($attended / $working) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI4i8($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4i8?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4i8_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4i8', $data);
    }
}


// âœ… CQI4i9 - Compliance to safe transportation of Oil waste (Engineering & Maintenance)
public function edit_feedback_CQI4i9() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD')
            ? $this->load->view('qualitymodules/edit_feedback_CQI4i9', $data, true)
            : $this->load->view('qualitymodules/dephead/edit_feedback_CQI4i9', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4i9_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4i9_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // âš™ï¸ KPI Formula: Compliance % = (Compliant Trips / Total Trips) Ã— 100
        $compliant = floatval($this->input->post('compliant_trips')) ?: 0;
        $total = floatval($this->input->post('total_trips')) ?: 0;
        $dataset['transport_compliance'] = ($total > 0) ? round(($compliant / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI4i9($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4i9?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4i9_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4i9', $data);
    }
}


// âœ… CQI4i10 - Number of laundry loads reduced by optimizing and sorting laundry (House Keeping)
public function edit_feedback_CQI4i10() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD')
            ? $this->load->view('qualitymodules/edit_feedback_CQI4i10', $data, true)
            : $this->load->view('qualitymodules/dephead/edit_feedback_CQI4i10', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4i10_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4i10_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // âš™ï¸ KPI Formula: Reduction % = (Loads Reduced / Previous Loads) Ã— 100
        $reduced = floatval($this->input->post('loads_reduced')) ?: 0;
        $previous = floatval($this->input->post('previous_loads')) ?: 0;
        $dataset['reduction_percent'] = ($previous > 0) ? round(($reduced / $previous) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI4i10($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4i10?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4i10_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4i10', $data);
    }
}
// âœ… CQI4i11 - Percentage of cleaning products used biodegradable (House Keeping)
public function edit_feedback_CQI4i11() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD')
            ? $this->load->view('qualitymodules/edit_feedback_CQI4i11', $data, true)
            : $this->load->view('qualitymodules/dephead/edit_feedback_CQI4i11', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4i11_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4i11_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // âš™ï¸ KPI Formula: Biodegradable % = (Biodegradable Products Used / Total Products Used) Ã— 100
        $bio = floatval($this->input->post('biodegradable_used')) ?: 0;
        $total = floatval($this->input->post('total_products_used')) ?: 0;
        $dataset['biodegradable_percent'] = ($total > 0) ? round(($bio / $total) * 100, 2) : 0;

        $this->quality_model->update_feedback_CQI4i11($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4i11?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4i11_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4i11', $data);
    }
}
// âœ… CQI4i12 - Average use of Ecofriendly catering supplies in a month (House Keeping)
public function edit_feedback_CQI4i12() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD')
            ? $this->load->view('qualitymodules/edit_feedback_CQI4i12', $data, true)
            : $this->load->view('qualitymodules/dephead/edit_feedback_CQI4i12', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4i12_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4i12_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // âš™ï¸ KPI Formula: Avg Ecofriendly Usage = (Total Ecofriendly Supplies Used / Total Months)
        $eco = floatval($this->input->post('ecofriendly_used')) ?: 0;
        $months = floatval($this->input->post('months_count')) ?: 1;
        $dataset['avg_ecofriendly_usage'] = round($eco / $months, 2);

        $this->quality_model->update_feedback_CQI4i12($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4i12?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4i12_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4i12', $data);
    }
}
// âœ… CQI4i13 - Average quantity of Medical waste disposed per month in Kgs (House Keeping)
public function edit_feedback_CQI4i13() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD')
            ? $this->load->view('qualitymodules/edit_feedback_CQI4i13', $data, true)
            : $this->load->view('qualitymodules/dephead/edit_feedback_CQI4i13', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4i13_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4i13_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // âš™ï¸ KPI Formula: Avg Medical Waste = (Total Medical Waste (Kg) / No. of Months)
        $totalWaste = floatval($this->input->post('total_waste_kg')) ?: 0;
        $months = floatval($this->input->post('months_count')) ?: 1;
        $dataset['avg_waste_per_month'] = round($totalWaste / $months, 2);

        $this->quality_model->update_feedback_CQI4i13($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4i13?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4i13_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4i13', $data);
    }
}
// âœ… CQI4i14 - Non-Recyclable Waste per Patient Day (Kg) (House Keeping)
public function edit_feedback_CQI4i14() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD')
            ? $this->load->view('qualitymodules/edit_feedback_CQI4i14', $data, true)
            : $this->load->view('qualitymodules/dephead/edit_feedback_CQI4i14', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4i14_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4i14_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // âš™ï¸ KPI Formula: Non-Recyclable Waste/Patient Day = (Total Non-Recyclable Waste / Total Patient Days)
        $waste = floatval($this->input->post('non_recyclable_waste_kg')) ?: 0;
        $patient_days = floatval($this->input->post('patient_days')) ?: 1;
        $dataset['waste_per_patient_day'] = round($waste / $patient_days, 2);

        $this->quality_model->update_feedback_CQI4i14($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4i14?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4i14_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4i14', $data);
    }
}
// âœ… CQI4j1 - Door to Physician â‰¤10 min (Stroke Unit)
public function edit_feedback_CQI4j1() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD')
            ? $this->load->view('qualitymodules/edit_feedback_CQI4j1', $data, true)
            : $this->load->view('qualitymodules/dephead/edit_feedback_CQI4j1', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4j1_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4j1_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // âš™ï¸ KPI Formula: (Patients seen by physician â‰¤10 min / Total stroke patients) Ã— 100
        $within10 = floatval($this->input->post('patients_within_10')) ?: 0;
        $total = floatval($this->input->post('total_stroke_patients')) ?: 1;
        $dataset['compliance_rate'] = round(($within10 / $total) * 100, 2);

        $this->quality_model->update_feedback_CQI4j1($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4j1?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4j1_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4j1', $data);
    }
}


// âœ… CQI4j2 - Door to stroke team â‰¤15 min (Stroke Unit)
public function edit_feedback_CQI4j2() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD')
            ? $this->load->view('qualitymodules/edit_feedback_CQI4j2', $data, true)
            : $this->load->view('qualitymodules/dephead/edit_feedback_CQI4j2', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4j2_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4j2_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // âš™ï¸ KPI Formula: (Patients attended by stroke team â‰¤15 min / Total stroke patients) Ã— 100
        $within15 = floatval($this->input->post('patients_within_15')) ?: 0;
        $total = floatval($this->input->post('total_stroke_patients')) ?: 1;
        $dataset['compliance_rate'] = round(($within15 / $total) * 100, 2);

        $this->quality_model->update_feedback_CQI4j2($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4j2?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4j2_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4j2', $data);
    }
}
// âœ… CQI4j3 - Door to CT/MRI initiation â‰¤20 min (Stroke Unit)
public function edit_feedback_CQI4j3() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD')
            ? $this->load->view('qualitymodules/edit_feedback_CQI4j3', $data, true)
            : $this->load->view('qualitymodules/dephead/edit_feedback_CQI4j3', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4j3_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4j3_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // âš™ï¸ KPI Formula: (CT/MRI initiated â‰¤20 min / Total stroke patients) Ã— 100
        $within20 = floatval($this->input->post('patients_ctmri_within_20')) ?: 0;
        $total = floatval($this->input->post('total_stroke_patients')) ?: 1;
        $dataset['compliance_rate'] = round(($within20 / $total) * 100, 2);

        $this->quality_model->update_feedback_CQI4j3($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4j3?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4j3_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4j3', $data);
    }
}


// âœ… CQI4j4 - Door to CT/MRI interpretation â‰¤30 min (Stroke Unit)
public function edit_feedback_CQI4j4() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD')
            ? $this->load->view('qualitymodules/edit_feedback_CQI4j4', $data, true)
            : $this->load->view('qualitymodules/dephead/edit_feedback_CQI4j4', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4j4_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4j4_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // âš™ï¸ KPI Formula: (CT/MRI interpreted â‰¤30 min / Total stroke patients) Ã— 100
        $within30 = floatval($this->input->post('patients_interpretation_within_30')) ?: 0;
        $total = floatval($this->input->post('total_stroke_patients')) ?: 1;
        $dataset['compliance_rate'] = round(($within30 / $total) * 100, 2);

        $this->quality_model->update_feedback_CQI4j4($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4j4?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4j4_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4j4', $data);
    }
}


// âœ… CQI4j5 - Order to lab results â‰¤30 min, if ordered (Stroke Unit)
public function edit_feedback_CQI4j5() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD')
            ? $this->load->view('qualitymodules/edit_feedback_CQI4j5', $data, true)
            : $this->load->view('qualitymodules/dephead/edit_feedback_CQI4j5', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4j5_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4j5_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // âš™ï¸ KPI Formula: (Lab results received â‰¤30 min / Total lab orders) Ã— 100
        $within30 = floatval($this->input->post('lab_results_within_30')) ?: 0;
        $totalOrders = floatval($this->input->post('total_lab_orders')) ?: 1;
        $dataset['compliance_rate'] = round(($within30 / $totalOrders) * 100, 2);

        $this->quality_model->update_feedback_CQI4j5($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4j5?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4j5_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4j5', $data);
    }
}


// âœ… CQI4j6 - Door to IV thrombolytic bolus â‰¤60 min (â‰¥75% compliance) (Stroke Unit)
public function edit_feedback_CQI4j6() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD')
            ? $this->load->view('qualitymodules/edit_feedback_CQI4j6', $data, true)
            : $this->load->view('qualitymodules/dephead/edit_feedback_CQI4j6', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4j6_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4j6_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // âš™ï¸ KPI Formula: (Patients receiving IV thrombolytic bolus â‰¤60 min / Total eligible stroke patients) Ã— 100
        $within60 = floatval($this->input->post('patients_within_60')) ?: 0;
        $eligible = floatval($this->input->post('total_eligible_patients')) ?: 1;
        $dataset['compliance_rate'] = round(($within60 / $eligible) * 100, 2);

        $this->quality_model->update_feedback_CQI4j6($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4j6?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4j6_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4j6', $data);
    }
}
// âœ… CQI4j7 - Door to IV thrombolytic bolus â‰¤45 min (â‰¥50% compliance) (Stroke Unit)
public function edit_feedback_CQI4j7() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD')
            ? $this->load->view('qualitymodules/edit_feedback_CQI4j7', $data, true)
            : $this->load->view('qualitymodules/dephead/edit_feedback_CQI4j7', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4j7_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4j7_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // âš™ï¸ KPI Formula: (Patients receiving IV bolus â‰¤45 min / Total eligible patients) Ã— 100
        $within45 = floatval($this->input->post('patients_within_45')) ?: 0;
        $eligible = floatval($this->input->post('total_eligible_patients')) ?: 1;
        $dataset['compliance_rate'] = round(($within45 / $eligible) * 100, 2);

        $this->quality_model->update_feedback_CQI4j7($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4j7?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4j7_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4j7', $data);
    }
}


// âœ… CQI4j8 - Door to puncture time â‰¤90 min (Stroke Unit)
public function edit_feedback_CQI4j8() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD')
            ? $this->load->view('qualitymodules/edit_feedback_CQI4j8', $data, true)
            : $this->load->view('qualitymodules/dephead/edit_feedback_CQI4j8', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4j8_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4j8_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // âš™ï¸ KPI Formula: (Patients puncture â‰¤90 min / Total stroke patients undergoing procedure) Ã— 100
        $within90 = floatval($this->input->post('patients_puncture_within_90')) ?: 0;
        $totalProc = floatval($this->input->post('total_procedures')) ?: 1;
        $dataset['compliance_rate'] = round(($within90 / $totalProc) * 100, 2);

        $this->quality_model->update_feedback_CQI4j8($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4j8?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4j8_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4j8', $data);
    }
}


// âœ… CQI4j9 - Periprocedural complication rate (Stroke Unit)
public function edit_feedback_CQI4j9() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD')
            ? $this->load->view('qualitymodules/edit_feedback_CQI4j9', $data, true)
            : $this->load->view('qualitymodules/dephead/edit_feedback_CQI4j9', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4j9_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4j9_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

       if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // âš™ï¸ KPI Formula: Complication Rate % = (Periprocedural Complications / Total Procedures) Ã— 100
        $complications = floatval($this->input->post('periprocedural_complications')) ?: 0;
        $procedures = floatval($this->input->post('total_procedures')) ?: 1;
        $dataset['complication_rate_percent'] = round(($complications / $procedures) * 100, 2);

        $this->quality_model->update_feedback_CQI4j9($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4j9?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4j9_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4j9', $data);
    }
}


// âœ… CQI4j10 - Periprocedural mortality rate (Stroke Unit)
public function edit_feedback_CQI4j10() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD')
            ? $this->load->view('qualitymodules/edit_feedback_CQI4j10', $data, true)
            : $this->load->view('qualitymodules/dephead/edit_feedback_CQI4j10', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4j10_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4j10_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

       if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // âš™ï¸ KPI Formula: Mortality Rate % = (Periprocedural Deaths / Total Procedures) Ã— 100
        $deaths = floatval($this->input->post('periprocedural_deaths')) ?: 0;
        $procedures = floatval($this->input->post('total_procedures')) ?: 1;
        $dataset['mortality_rate_percent'] = round(($deaths / $procedures) * 100, 2);

        $this->quality_model->update_feedback_CQI4j10($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4j10?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4j10_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4j10', $data);
    }
}


// âœ… CQI4j11 - % of stroke/TIA patients with NIHSS documented (Stroke Unit)
public function edit_feedback_CQI4j11() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD')
            ? $this->load->view('qualitymodules/edit_feedback_CQI4j11', $data, true)
            : $this->load->view('qualitymodules/dephead/edit_feedback_CQI4j11', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4j11_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4j11_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // âš™ï¸ KPI Formula: NIHSS Documentation % = (Patients with NIHSS documented / Total patients with deficit) Ã— 100
        $documented = floatval($this->input->post('nihss_documented')) ?: 0;
        $deficit = floatval($this->input->post('total_deficit_patients')) ?: 1;
        $dataset['nihss_documentation_percent'] = round(($documented / $deficit) * 100, 2);

        $this->quality_model->update_feedback_CQI4j11($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4j11?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4j11_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4j11', $data);
    }
}


// âœ… CQI4j12 - % of ischemic stroke patients eligible for IV thrombolysis who receive it within window (Stroke Unit)
public function edit_feedback_CQI4j12() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD')
            ? $this->load->view('qualitymodules/edit_feedback_CQI4j12', $data, true)
            : $this->load->view('qualitymodules/dephead/edit_feedback_CQI4j12', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4j12_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4j12_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // âš™ï¸ KPI Formula: (Ischemic patients thrombolysed within window / Eligible ischemic patients) Ã— 100
        $treated_in_window = floatval($this->input->post('treated_within_window')) ?: 0;
        $eligible = floatval($this->input->post('eligible_ischemic_patients')) ?: 1;
        $dataset['thrombolysis_within_window_percent'] = round(($treated_in_window / $eligible) * 100, 2);

        $this->quality_model->update_feedback_CQI4j12($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4j12?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4j12_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4j12', $data);
    }
}
// âœ… CQI4j13 - Percentage of patients treated for acute ischemic stroke with IV thrombolysis whose treatment is started within 60 minutes after arrival (Stroke Unit)
public function edit_feedback_CQI4j13() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD')
            ? $this->load->view('qualitymodules/edit_feedback_CQI4j13', $data, true)
            : $this->load->view('qualitymodules/dephead/edit_feedback_CQI4j13', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4j13_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4j13_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // âš™ï¸ KPI Formula: Compliance % = (No. of patients treated within 60 mins / Total eligible stroke patients) * 100
        $treated = floatval($this->input->post('treated_within_60')) ?: 0;
        $total = floatval($this->input->post('total_eligible')) ?: 1;
        $dataset['compliance_percentage'] = round(($treated / $total) * 100, 2);

        $this->quality_model->update_feedback_CQI4j13($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4j13?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4j13_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4j13', $data);
    }
}
// âœ… CQI4j14 - Time from arrival to the start of initial imaging workup for all patients who arrive within 24 hours of last known well (In Minutes) (Stroke Unit)
public function edit_feedback_CQI4j14() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD')
            ? $this->load->view('qualitymodules/edit_feedback_CQI4j14', $data, true)
            : $this->load->view('qualitymodules/dephead/edit_feedback_CQI4j14', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4j14_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4j14_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // âš™ï¸ KPI Formula: Average Time (Minutes) = (Î£ Imaging Time from Arrival) / Total Patients
        $total_time = floatval($this->input->post('total_imaging_time')) ?: 0;
        $patients = floatval($this->input->post('total_patients')) ?: 1;
        $dataset['avg_time_minutes'] = round($total_time / $patients, 2);

        $this->quality_model->update_feedback_CQI4j14($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4j14?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4j14_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4j14', $data);
    }
}
// âœ… CQI4j15 - Percentage of ischemic stroke patients who develop a symptomatic intracranial hemorrhage within 36 hours after treatment (Stroke Unit)
public function edit_feedback_CQI4j15() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD')
            ? $this->load->view('qualitymodules/edit_feedback_CQI4j15', $data, true)
            : $this->load->view('qualitymodules/dephead/edit_feedback_CQI4j15', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4j15_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4j15_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // âš™ï¸ KPI Formula: Percentage = (No. with hemorrhage / Total treated patients) * 100
        $hemorrhage = floatval($this->input->post('hemorrhage_cases')) ?: 0;
        $total_treated = floatval($this->input->post('total_treated')) ?: 1;
        $dataset['hemorrhage_rate'] = round(($hemorrhage / $total_treated) * 100, 2);

        $this->quality_model->update_feedback_CQI4j15($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4j15?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4j15_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4j15', $data);
    }
}
// âœ… CQI4j16 - Percentage of patients undergoing CEA, or carotid angioplasty or stenting, having stroke or death within 30 days of the procedure (Stroke Unit)
public function edit_feedback_CQI4j16() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD')
            ? $this->load->view('qualitymodules/edit_feedback_CQI4j16', $data, true)
            : $this->load->view('qualitymodules/dephead/edit_feedback_CQI4j16', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4j16_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4j16_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // âš™ï¸ KPI Formula: Percentage = (No. of strokes or deaths / Total CEA or stenting procedures) Ã— 100
        $adverse = floatval($this->input->post('stroke_or_death_cases')) ?: 0;
        $total = floatval($this->input->post('total_procedures')) ?: 1;
        $dataset['stroke_death_rate'] = round(($adverse / $total) * 100, 2);

        $this->quality_model->update_feedback_CQI4j16($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4j16?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4j16_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4j16', $data);
    }
}
// âœ… CQI4j17 - Percentage of patients undergoing intracranial angioplasty and/or stenting for atherosclerotic disease having stroke or death within 30 days of the procedure (Stroke Unit)
public function edit_feedback_CQI4j17() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD')
            ? $this->load->view('qualitymodules/edit_feedback_CQI4j17', $data, true)
            : $this->load->view('qualitymodules/dephead/edit_feedback_CQI4j17', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4j17_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4j17_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // âš™ï¸ KPI Formula: Percentage = (Stroke or death cases / Total intracranial angioplasty procedures) Ã— 100
        $adverse = floatval($this->input->post('stroke_or_death_cases')) ?: 0;
        $total = floatval($this->input->post('total_intracranial_procedures')) ?: 1;
        $dataset['stroke_death_rate_intracranial'] = round(($adverse / $total) * 100, 2);

        $this->quality_model->update_feedback_CQI4j17($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4j17?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4j17_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4j17', $data);
    }
}
// âœ… CQI4j18 - Percentage of patients with stroke or death within 24 hours of diagnostic cerebral-angiography (Stroke Unit)
public function edit_feedback_CQI4j18() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD')
            ? $this->load->view('qualitymodules/edit_feedback_CQI4j18', $data, true)
            : $this->load->view('qualitymodules/dephead/edit_feedback_CQI4j18', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4j18_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4j18_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // âš™ï¸ KPI Formula: Percentage = (Stroke or death cases within 24 hrs / Total diagnostic angiography cases) Ã— 100
        $adverse = floatval($this->input->post('stroke_or_death_24h')) ?: 0;
        $total = floatval($this->input->post('total_angiography_cases')) ?: 1;
        $dataset['stroke_death_24h_rate'] = round(($adverse / $total) * 100, 2);

        $this->quality_model->update_feedback_CQI4j18($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4j18?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4j18_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4j18', $data);
    }
}
// âœ… CQI4j19 - Percentage of ischemic stroke patients who undergo EVD and then develop ventriculitis (Stroke Unit)
public function edit_feedback_CQI4j19() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD')
            ? $this->load->view('qualitymodules/edit_feedback_CQI4j19', $data, true)
            : $this->load->view('qualitymodules/dephead/edit_feedback_CQI4j19', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4j19_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4j19_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // âš™ï¸ KPI Formula: Ventriculitis % = (Ventriculitis cases after EVD / Patients with EVD) Ã— 100
        $vent_cases = floatval($this->input->post('ventriculitis_cases')) ?: 0;
        $evd_patients = floatval($this->input->post('patients_with_evd')) ?: 1;
        $dataset['ventriculitis_percent'] = round(($vent_cases / $evd_patients) * 100, 2);

        $this->quality_model->update_feedback_CQI4j19($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4j19?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4j19_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4j19', $data);
    }
}


// âœ… CQI4j20 - % of ischemic stroke patients with post-treatment reperfusion grade TICI â‰¥2B (Stroke Unit)
public function edit_feedback_CQI4j20() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD')
            ? $this->load->view('qualitymodules/edit_feedback_CQI4j20', $data, true)
            : $this->load->view('qualitymodules/dephead/edit_feedback_CQI4j20', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4j20_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4j20_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // âš™ï¸ KPI Formula: TICI â‰¥2B % = (Patients achieving TICI â‰¥2B / Total treated patients) Ã— 100
        $tici_cases = floatval($this->input->post('tici_2b_or_higher_cases')) ?: 0;
        $total_treated = floatval($this->input->post('total_treated_patients')) ?: 1;
        $dataset['tici_2b_percent'] = round(($tici_cases / $total_treated) * 100, 2);

        $this->quality_model->update_feedback_CQI4j20($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4j20?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4j20_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4j20', $data);
    }
}


// âœ… CQI4j21 - % LVO patients receiving MER within 120 min and achieving TICI â‰¥2B (Stroke Unit)
public function edit_feedback_CQI4j21() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD')
            ? $this->load->view('qualitymodules/edit_feedback_CQI4j21', $data, true)
            : $this->load->view('qualitymodules/dephead/edit_feedback_CQI4j21', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4j21_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4j21_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

       if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // âš™ï¸ KPI Formula: % = (LVO patients receiving MER within 120 min AND achieving TICI â‰¥2B) / (Total LVO patients) Ã— 100
        $success_cases = floatval($this->input->post('lvo_mer_within_120_and_tici2b')) ?: 0;
        $total_lvo = floatval($this->input->post('total_lvo_patients')) ?: 1;
        $dataset['mer_120_tici2b_percent'] = round(($success_cases / $total_lvo) * 100, 2);

        $this->quality_model->update_feedback_CQI4j21($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4j21?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4j21_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4j21', $data);
    }
}


// âœ… CQI4j22 - % MER procedures achieving TICI â‰¥2B â‰¤60 min from skin puncture (Stroke Unit)
public function edit_feedback_CQI4j22() {
    if (!isset($this->session->userdata['isLogIn']) || !$this->session->userdata('isLogIn'))
        $this->session->set_userdata('referred_from', current_url());
    else
        $this->session->set_userdata('referred_from', NULL);

    $LOAD = pagetoload($this->module);
    if ($LOAD == 'inpatient_modules') {
        $data['title'] = 'EDIT KPI FORM';
        $data['content'] = isfeature_active('QUALITY-DASHBOARD')
            ? $this->load->view('qualitymodules/edit_feedback_CQI4j22', $data, true)
            : $this->load->view('qualitymodules/dephead/edit_feedback_CQI4j22', $data, true);
        $this->load->view('layout/main_wrapper', $data);
    }
}

public function edit_feedback_CQI4j22_byid($id) {
    if ($this->input->post()) {
        $existing = $this->quality_model->get_feedback_CQI4j22_byid($id);
        $dataset = json_decode($existing->dataset, true) ?: [];
        $existingFiles = $dataset['files_name'] ?? [];

        $removeIndexes = json_decode($this->input->post('remove_files_json') ?? '[]', true);
        foreach ($removeIndexes as $i) {
            if (isset($existingFiles[$i])) {
                $p = FCPATH . str_replace(base_url(), '', $existingFiles[$i]['url']);
                if (file_exists($p)) @unlink($p);
                unset($existingFiles[$i]);
            }
        }
        $existingFiles = array_values($existingFiles);

        if (!empty($_FILES['uploaded_files']['name'][0])) {
            $this->load->library('upload');
            $config = [
                'upload_path' => './api/file_uploads/',
                'allowed_types' => 'jpg|jpeg|png|pdf|csv|doc|docx|xls|xlsx'
            ];
            foreach ($_FILES['uploaded_files']['name'] as $i => $name) {
                $_FILES['file'] = [
                    'name' => $name,
                    'type' => $_FILES['uploaded_files']['type'][$i],
                    'tmp_name' => $_FILES['uploaded_files']['tmp_name'][$i],
                    'error' => $_FILES['uploaded_files']['error'][$i],
                    'size' => $_FILES['uploaded_files']['size'][$i]
                ];
                $this->upload->initialize($config);
                if ($this->upload->do_upload('file')) {
                    $up = $this->upload->data();
                    $existingFiles[] = [
                        'url' => base_url('api/file_uploads/' . $up['file_name']),
                        'name' => $up['file_name']
                    ];
                }
            }
        }

        $dataset['files_name'] = $existingFiles;
        foreach ($_POST as $k => $v)
            if (!in_array($k, ['uploaded_files', 'remove_files_json']))
                $dataset[$k] = $v;

        // âš™ï¸ KPI Formula: % = (MER procedures achieving TICI â‰¥2B within 60 min skin puncture / Total MER procedures) Ã— 100
        $success = floatval($this->input->post('mer_tici2b_within_60')) ?: 0;
        $total_mer = floatval($this->input->post('total_mer_procedures')) ?: 1;
        $dataset['mer_60_tici2b_percent'] = round(($success / $total_mer) * 100, 2);

        $this->quality_model->update_feedback_CQI4j22($id, ['dataset' => json_encode($dataset)]);
        redirect('quality/patient_feedback_CQI4j22?id=' . $id);
    } else {
        $data['param'] = $this->quality_model->get_feedback_CQI4j22_byid($id);
        $this->load->view('qualitymodules/dephead/edit_feedback_CQI4j22', $data);
    }
}

    //START REPORTS




    public function overall_CQI3a1_report()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {


            $table_feedback = 'bf_feedback_CQI3a1';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->quality_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'KPI Recorded by';
            $header[1] = 'KPI Recorded on';
            $header[2] = 'Sum of time taken for initial assessment of in-patients in MRD-ICU (in Hrs)';
            $header[3] = 'Total number of in-patients (in No.s)';
            $header[4] = 'Avg. time taken for initial assessment of in-patients in MRD-ICU (in Hrs)';

            $j = 5;

            $header[$j++] = 'Benchmark time';
            $header[$j++] = 'Data analysis (RCA, Reason for Variation etc.)';
            $header[$j++] = 'Corrective action';
            $header[$j++] = 'Preventive action';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                $dataexport[$i]['name'] = $data['name'];
                $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
                $dataexport[$i]['initial_assessment_total'] = $data['initial_assessment_total'];
                $dataexport[$i]['total_admission'] = $data['total_admission'];
                $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
                $dataexport[$i]['benchmark'] = $data['benchmark'];
                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
                $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
                $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];

                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- Average Time for initial assessment of in-patients (Doctors) in MRD(ICU) - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function overall_CQI3a2_report()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {


            $table_feedback = 'bf_feedback_CQI3a2';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->quality_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'KPI Recorded by';
            $header[1] = 'KPI Recorded on';
            $header[2] = 'Sum of time taken for initial assessment of in-patients in MRD-WARD (in Hrs)';
            $header[3] = 'Total number of in-patients (in No.s)';
            $header[4] = 'Avg. time taken for initial assessment of in-patients in MRD-WARD (in Hrs)';

            $j = 5;

            $header[$j++] = 'Benchmark time';
            $header[$j++] = 'Data analysis (RCA, Reason for Variation etc.)';
            $header[$j++] = 'Corrective action';
            $header[$j++] = 'Preventive action';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                $dataexport[$i]['name'] = $data['name'];
                $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
                $dataexport[$i]['initial_assessment_total'] = $data['initial_assessment_total'];
                $dataexport[$i]['total_admission'] = $data['total_admission'];
                $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
                $dataexport[$i]['benchmark'] = $data['benchmark'];
                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
                $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
                $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];

                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- Average Time for initial assessment of in-patients (Doctors)- (MRI WARD) - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function overall_CQI3a3_report()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {


            $table_feedback = 'bf_feedback_CQI3a3';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->quality_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'KPI Recorded by';
            $header[1] = 'KPI Recorded on';
            $header[2] = 'Sum of time taken for initial assessment emergency patients (in Hrs)';
            $header[3] = 'Total number of emergency patients (in No.s)';
            $header[4] = 'Avg.Time for initial assessment of in-patients (in Hrs)';

            $j = 5;

            $header[$j++] = 'Benchmark time';
            $header[$j++] = 'Data analysis (RCA, Reason for Variation etc.)';
            $header[$j++] = 'Corrective action';
            $header[$j++] = 'Preventive action';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                $dataexport[$i]['name'] = $data['name'];
                $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
                $dataexport[$i]['initial_assessment_total'] = $data['initial_assessment_total'];
                $dataexport[$i]['total_admission'] = $data['total_admission'];
                $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
                $dataexport[$i]['benchmark'] = $data['benchmark'];
                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
                $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
                $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];

                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- Average Time for initial assessment of in-patients (Doctors)-(Emergency Department) - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function overall_CQI3a4_report()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {


            $table_feedback = 'bf_feedback_CQI3a4';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->quality_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'KPI Recorded by';
            $header[1] = 'KPI Recorded on';
            $header[2] = 'Number of case sheets where care plan is documented (in No.s)';
            $header[3] = 'Total number of in-patients for the month (in No.s)';
            $header[4] = 'Percentage of Care-plan is documented for inpatients(MRD) (in %)';

            $j = 5;

            // $header[$j++] = 'Benchmark time';
            $header[$j++] = 'Data analysis (RCA, Reason for Variation etc.)';
            $header[$j++] = 'Corrective action';
            $header[$j++] = 'Preventive action';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                $dataexport[$i]['name'] = $data['name'];
                $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
                $dataexport[$i]['initial_assessment_total'] = $data['initial_assessment_total'];
                $dataexport[$i]['total_admission'] = $data['total_admission'];
                $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
                //$dataexport[$i]['benchmark'] = $data['benchmark'];
                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
                $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
                $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];

                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- Percentage of Care-plan is documented for inpatients (MRD) - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function overall_CQI3a5_report()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {


            $table_feedback = 'bf_feedback_CQI3a5';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->quality_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'KPI Recorded by';
            $header[1] = 'KPI Recorded on';
            $header[2] = 'Number of case sheets where care plan is documented (in No.s)';
            $header[3] = 'Total number of in-patients for the month (in No.s)';
            $header[4] = 'Percentage of Care-plan is documented for inpatients(MRD) (in %)';

            $j = 5;

            // $header[$j++] = 'Benchmark time';
            $header[$j++] = 'Data analysis (RCA, Reason for Variation etc.)';
            $header[$j++] = 'Corrective action';
            $header[$j++] = 'Preventive action';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                $dataexport[$i]['name'] = $data['name'];
                $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
                $dataexport[$i]['initial_assessment_total'] = $data['initial_assessment_total'];
                $dataexport[$i]['total_admission'] = $data['total_admission'];
                $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
                //$dataexport[$i]['benchmark'] = $data['benchmark'];
                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
                $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
                $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];

                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- Percentage of Nutritional assessment is documented for inpatients (Clinical Nutrition and Dietetics) - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function overall_CQI3a6_report()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {


            $table_feedback = 'bf_feedback_CQI3a6';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->quality_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'KPI Recorded by';
            $header[1] = 'KPI Recorded on';
            $header[2] = 'Number of case sheets where nursing plan is documented (in No.s)';
            $header[3] = 'Total number of in-patients for the month (in No.s)';
            $header[4] = 'Percentage of Nursing care is documented for inpatients(MRD - Nursing) (in %)';

            $j = 5;

            // $header[$j++] = 'Benchmark time';
            $header[$j++] = 'Data analysis (RCA, Reason for Variation etc.)';
            $header[$j++] = 'Corrective action';
            $header[$j++] = 'Preventive action';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                $dataexport[$i]['name'] = $data['name'];
                $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
                $dataexport[$i]['initial_assessment_total'] = $data['initial_assessment_total'];
                $dataexport[$i]['total_admission'] = $data['total_admission'];
                $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
                //$dataexport[$i]['benchmark'] = $data['benchmark'];
                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
                $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
                $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];

                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- Percentage of Nursing care is documented for inpatients (MRD - Nursing) - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function overall_CQI3a7_report()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {


            $table_feedback = 'bf_feedback_CQI3a7';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->quality_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'KPI Recorded by';
            $header[1] = 'KPI Recorded on';
            $header[2] = 'Sum of time taken for initial assessment Emergency patients';
            $header[3] = 'Total number of emergency patients (in No.s)';
            $header[4] = 'Avg.Time for initial assessment of Emergency patients(Nurses)-(Emergency Department)';

            $j = 5;

            $header[$j++] = 'Benchmark time';
            $header[$j++] = 'Data analysis (RCA, Reason for Variation etc.)';
            $header[$j++] = 'Corrective action';
            $header[$j++] = 'Preventive action';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                $dataexport[$i]['name'] = $data['name'];
                $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
                $dataexport[$i]['initial_assessment_total'] = $data['initial_assessment_total'];
                $dataexport[$i]['total_admission'] = $data['total_admission'];
                $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
                $dataexport[$i]['benchmark'] = $data['benchmark'];
                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
                $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
                $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];

                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- Average Time for initial assessment of Emergency patients(Nurses)-(Emergency Department) - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function overall_CQI3a8_report()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {


            $table_feedback = 'bf_feedback_CQI3a8';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->quality_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'KPI Recorded by';
            $header[1] = 'KPI Recorded on';
            $header[2] = 'Sum of time taken for assessment in patients';
            $header[3] = 'Total number of in-patients (in No.s)';
            $header[4] = 'Avg. Time for initial assessment of in-patients (Nurses)-(Nursing-ICU) (in Hrs)';

            $j = 5;

            $header[$j++] = 'Benchmark time';
            $header[$j++] = 'Data analysis (RCA, Reason for Variation etc.)';
            $header[$j++] = 'Corrective action';
            $header[$j++] = 'Preventive action';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                $dataexport[$i]['name'] = $data['name'];
                $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
                $dataexport[$i]['initial_assessment_total'] = $data['initial_assessment_total'];
                $dataexport[$i]['total_admission'] = $data['total_admission'];
                $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
                $dataexport[$i]['benchmark'] = $data['benchmark'];
                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
                $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
                $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];

                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- Average Time for initial assessment of in-patients (Nurses)-(Nursing-ICU) - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function overall_CQI3a9_report()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {


            $table_feedback = 'bf_feedback_CQI3a9';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->quality_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'KPI Recorded by';
            $header[1] = 'KPI Recorded on';
            $header[2] = 'Sum of time taken for assessment in patients (in Hrs)';
            $header[3] = 'Total number of in-patients  (in No.s)';
            $header[4] = 'Avg. Time for initial assessment of in-patients (Nurses)-(Nursing-Ward) (in Hrs)';

            $j = 5;

            $header[$j++] = 'Benchmark time';
            $header[$j++] = 'Data analysis (RCA, Reason for Variation etc.)';
            $header[$j++] = 'Corrective action';
            $header[$j++] = 'Preventive action';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                $dataexport[$i]['name'] = $data['name'];
                $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
                $dataexport[$i]['initial_assessment_total'] = $data['initial_assessment_total'];
                $dataexport[$i]['total_admission'] = $data['total_admission'];
                $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
                $dataexport[$i]['benchmark'] = $data['benchmark'];
                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
                $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
                $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];

                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- Average Time for initial assessment of in-patients (Nurses)-(Nursing-Ward) - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function overall_CQI3a10_report()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {

            $table_feedback = 'bf_feedback_CQI3a10';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->quality_model->setup_result($setup);

            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }

            $header[0] = 'KPI Recorded by';
            $header[1] = 'KPI Recorded on';
            $header[2] = 'Total number of Contaminated blood culture (in No.s)';
            $header[3] = 'Total number of blood culture test Performed (in No.s)';
            $header[4] = 'Percentage of Blood culture contamination rate(Lab Service) (in %)';
            $j = 5;

            // $header[$j++] = 'Benchmark time';
            $header[$j++] = 'Data analysis (RCA, Reason for Variation etc.)';
            $header[$j++] = 'Corrective action';
            $header[$j++] = 'Preventive action';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                $dataexport[$i]['name'] = $data['name'];
                $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
                $dataexport[$i]['initial_assessment_total'] = $data['initial_assessment_total'];
                $dataexport[$i]['total_admission'] = $data['total_admission'];
                $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
                // $dataexport[$i]['benchmark'] = $data['benchmark'];
                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
                $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
                $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];

                $i++;
            }

            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- Percentage of Blood culture contamination rate (Lab Service) - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function overall_CQI3a11_report()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {

            $table_feedback = 'bf_feedback_CQI3a11';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->quality_model->setup_result($setup);

            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }

            $header[0] = 'KPI Recorded by';
            $header[1] = 'KPI Recorded on';
            $header[2] = 'Number of patients discharged with a diagnosis of CHF with reduced EF and prescribed a beta blocker at discharge (in No.s)';
            $header[3] = 'Number of patients discharged with a diagnosis of CHF (in No.s)';
            $header[4] = 'Percentage of Beta-blocker prescriptions with a diagnosis of CHF with reduced EF (Cardiology - Emergency Department) (in %)';
            $j = 5;

            // $header[$j++] = 'Benchmark time';
            $header[$j++] = 'Data analysis (RCA, Reason for Variation etc.)';
            $header[$j++] = 'Corrective action';
            $header[$j++] = 'Preventive action';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                $dataexport[$i]['name'] = $data['name'];
                $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
                $dataexport[$i]['initial_assessment_total'] = $data['initial_assessment_total'];
                $dataexport[$i]['total_admission'] = $data['total_admission'];
                $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
                // $dataexport[$i]['benchmark'] = $data['benchmark'];
                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
                $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
                $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];

                $i++;
            }

            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- Percentage of Beta-blocker prescriptions with a diagnosis of CHF with reduced EF (Cardiology - Emergency Department) - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function overall_CQI3a12_report()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {

            $table_feedback = 'bf_feedback_CQI3a12';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->quality_model->setup_result($setup);

            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }

            $header[0] = 'KPI Recorded by';
            $header[1] = 'KPI Recorded on';
            $header[2] = 'Number of patients with hypoglycemic events where the target glucose level was achieved post-treatment (in No.s)';
            $header[3] = 'Number of patients with Hypoglycemic events (in No.s)';
            $header[4] = 'Percentage of Hospitalized patients with hypoglycemia who achieved targeted blood glucose level(Endocrinology and Diabetes - Emergency Department) (in %)';
            $j = 5;

            // $header[$j++] = 'Benchmark time';
            $header[$j++] = 'Data analysis (RCA, Reason for Variation etc.)';
            $header[$j++] = 'Corrective action';
            $header[$j++] = 'Preventive action';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                $dataexport[$i]['name'] = $data['name'];
                $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
                $dataexport[$i]['initial_assessment_total'] = $data['initial_assessment_total'];
                $dataexport[$i]['total_admission'] = $data['total_admission'];
                $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
                // $dataexport[$i]['benchmark'] = $data['benchmark'];
                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
                $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
                $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];

                $i++;
            }

            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- Percentage of Hospitalized patients with hypoglycemia who achieved targeted blood glucose level (Endocrinology and Diabetes - Emergency Department) - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function overall_CQI3a13_report()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {

            $table_feedback = 'bf_feedback_CQI3a13';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->quality_model->setup_result($setup);

            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }

            $header[0] = 'KPI Recorded by';
            $header[1] = 'KPI Recorded on';
            $header[2] = 'Number of cases where a spontaneous perineal tear occurs (in No.s)';
            $header[3] = 'Total number of Vaginal deliveries (in No.s)';
            $header[4] = 'Percentage of Spontaneous perineal Tear Rate (in %)';
            $j = 5;

            // $header[$j++] = 'Benchmark time';
            $header[$j++] = 'Data analysis (RCA, Reason for Variation etc.)';
            $header[$j++] = 'Corrective action';
            $header[$j++] = 'Preventive action';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                $dataexport[$i]['name'] = $data['name'];
                $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
                $dataexport[$i]['initial_assessment_total'] = $data['initial_assessment_total'];
                $dataexport[$i]['total_admission'] = $data['total_admission'];
                $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
                // $dataexport[$i]['benchmark'] = $data['benchmark'];
                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
                $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
                $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
                $i++;
            }

            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- Percentage of Spontaneous perineal Tear Rate - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function overall_CQI3a14_report()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {

            $table_feedback = 'bf_feedback_CQI3a14';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->quality_model->setup_result($setup);

            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }

            $header[0] = 'KPI Recorded by';
            $header[1] = 'KPI Recorded on';
            $header[2] = 'Number of sepsis patients who receive care as per the hour-1 sepsis bundle (in No.s)';
            $header[3] = 'Total number of sepsis cases (in No.s)';
            $header[4] = 'Percentage of sepsis patients who receive care as per the HOUR-1 sepsis bundle(Critical Care Medicine - Medical records) (in %)';
            $j = 5;

            // $header[$j++] = 'Benchmark time';
            $header[$j++] = 'Data analysis (RCA, Reason for Variation etc.)';
            $header[$j++] = 'Corrective action';
            $header[$j++] = 'Preventive action';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                $dataexport[$i]['name'] = $data['name'];
                $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
                $dataexport[$i]['initial_assessment_total'] = $data['initial_assessment_total'];
                $dataexport[$i]['total_admission'] = $data['total_admission'];
                $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
                // $dataexport[$i]['benchmark'] = $data['benchmark'];
                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
                $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
                $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
                $i++;
            }

            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- Percentage of sepsis patients who receive care as per the HOUR-1 sepsis bundle (Critical Care Medicine - Medical records) - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function overall_CQI3a15_report()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {

            $table_feedback = 'bf_feedback_CQI3a15';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->quality_model->setup_result($setup);

            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }

            $header[0] = 'KPI Recorded by';
            $header[1] = 'KPI Recorded on';
            $header[2] = 'Number of COPD patients provided with a COPD action plan at the time of discharge (in No.s)';
            $header[3] = 'Number of COPD patients discharged (in No.s)';
            $header[4] = 'Percentage of COPD patients receiving COPD Action plan at the time of discharge (Pulmonary Medicine) (in %)';
            $j = 5;

            // $header[$j++] = 'Benchmark time';
            $header[$j++] = 'Data analysis (RCA, Reason for Variation etc.)';
            $header[$j++] = 'Corrective action';
            $header[$j++] = 'Preventive action';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                $dataexport[$i]['name'] = $data['name'];
                $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
                $dataexport[$i]['initial_assessment_total'] = $data['initial_assessment_total'];
                $dataexport[$i]['total_admission'] = $data['total_admission'];
                $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
                // $dataexport[$i]['benchmark'] = $data['benchmark'];
                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
                $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
                $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
                $i++;
            }

            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- Percentage of COPD patients receiving COPD Action plan at the time of discharge (Pulmonary Medicine) - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }
    public function overall_CQI3a16_report()
{
    if ($this->session->userdata('isLogIn') == false)
        redirect('login');
    if (ismodule_active('QUALITY') === true) {

        $table_feedback = 'bf_feedback_CQI3a16';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $setup = 'setup';

        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $sresult = $this->quality_model->setup_result($setup);
        $setarray = array();
        $questioarray = array();
        foreach ($sresult as $r) {
            $setarray[$r->type] = $r->title;
        }
        foreach ($sresult as $r) {
            $questioarray[$r->type][$r->shortkey] = $r->shortname;
        }

        $arraydata = array();
        foreach ($questioarray as $setr) {
            foreach ($setr as $k => $v) {
                $arraydata[$k] = $v;
            }
        }

        $header[0] = 'KPI Recorded by';
        $header[1] = 'KPI Recorded on';
        $header[2] = 'Number of bronchiolitis patients treated inappropriately (in No.s)';
        $header[3] = 'Total bronchiolitis patients (in No.s)';
        $header[4] = 'Percentage of patients treated inappropriately (in %)';

        $j = 5;
        $header[$j++] = 'Data analysis (RCA, Reason for Variation etc.)';
        $header[$j++] = 'Corrective action';
        $header[$j++] = 'Preventive action';

        $dataexport = [];
        $i = 0;
        foreach ($feedbacktaken as $row) {
            $data = json_decode($row->dataset, true);

            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['initial_assessment_total'] = isset($data['initial_assessment_total']) ? $data['initial_assessment_total'] : '';
            $dataexport[$i]['total_admission'] = isset($data['total_admission']) ? $data['total_admission'] : '';
            $dataexport[$i]['calculatedResult'] = isset($data['calculatedResult']) ? $data['calculatedResult'] : '';
            $dataexport[$i]['dataAnalysis'] = isset($data['dataAnalysis']) ? $data['dataAnalysis'] : '';
            $dataexport[$i]['correctiveAction'] = isset($data['correctiveAction']) ? $data['correctiveAction'] : '';
            $dataexport[$i]['preventiveAction'] = isset($data['preventiveAction']) ? $data['preventiveAction'] : '';

            $i++;
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- Percentage of bronchiolitis patients treated inappropriately (Pediatrics) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (isset($dataexport[0])) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) {
                fputcsv($fp, $values, ',');
            }
            fclose($fp);
        }
        ob_flush();
        exit;
    } else {
        redirect('dashboard/noaccess');
    }
}

public function overall_CQI3a17_report()
{
    if ($this->session->userdata('isLogIn') == false)
        redirect('login');
    if (ismodule_active('QUALITY') === true) {

        $table_feedback = 'bf_feedback_CQI3a17';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $setup = 'setup';

        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $sresult = $this->quality_model->setup_result($setup);
        $setarray = array();
        $questioarray = array();
        foreach ($sresult as $r) {
            $setarray[$r->type] = $r->title;
        }
        foreach ($sresult as $r) {
            $questioarray[$r->type][$r->shortkey] = $r->shortname;
        }

        $arraydata = array();
        foreach ($questioarray as $setr) {
            foreach ($setr as $k => $v) {
                $arraydata[$k] = $v;
            }
        }

        $header[0] = 'KPI Recorded by';
        $header[1] = 'KPI Recorded on';
        $header[2] = 'Number of oncology patients who had treatment initiated after tumour board (in No.s)';
        $header[3] = 'Total oncology patients discussed (in No.s)';
        $header[4] = 'Percentage with treatment initiated after tumour board (in %)';

        $j = 5;
        $header[$j++] = 'Data analysis (RCA, Reason for Variation etc.)';
        $header[$j++] = 'Corrective action';
        $header[$j++] = 'Preventive action';

        $dataexport = [];
        $i = 0;
        foreach ($feedbacktaken as $row) {
            $data = json_decode($row->dataset, true);

            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['initial_assessment_total'] = isset($data['initial_assessment_total']) ? $data['initial_assessment_total'] : '';
            $dataexport[$i]['total_admission'] = isset($data['total_admission']) ? $data['total_admission'] : '';
            $dataexport[$i]['calculatedResult'] = isset($data['calculatedResult']) ? $data['calculatedResult'] : '';
            $dataexport[$i]['dataAnalysis'] = isset($data['dataAnalysis']) ? $data['dataAnalysis'] : '';
            $dataexport[$i]['correctiveAction'] = isset($data['correctiveAction']) ? $data['correctiveAction'] : '';
            $dataexport[$i]['preventiveAction'] = isset($data['preventiveAction']) ? $data['preventiveAction'] : '';

            $i++;
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- Percentage of oncology patients who had treatment initiated following multidisciplinary meeting (Oncology) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (isset($dataexport[0])) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) {
                fputcsv($fp, $values, ',');
            }
            fclose($fp);
        }
        ob_flush();
        exit;
    } else {
        redirect('dashboard/noaccess');
    }
}

public function overall_CQI3a18_report()
{
    if ($this->session->userdata('isLogIn') == false)
        redirect('login');
    if (ismodule_active('QUALITY') === true) {

        $table_feedback = 'bf_feedback_CQI3a18';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $setup = 'setup';

        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $sresult = $this->quality_model->setup_result($setup);
        $setarray = array();
        $questioarray = array();
        foreach ($sresult as $r) {
            $setarray[$r->type] = $r->title;
        }
        foreach ($sresult as $r) {
            $questioarray[$r->type][$r->shortkey] = $r->shortname;
        }

        $arraydata = array();
        foreach ($questioarray as $setr) {
            foreach ($setr as $k => $v) {
                $arraydata[$k] = $v;
            }
        }

        $header[0] = 'KPI Recorded by';
        $header[1] = 'KPI Recorded on';
        $header[2] = 'Number of Intravenous Contrast Media Extravasation events (in No.s)';
        $header[3] = 'Total contrast administrations (in No.s)';
        $header[4] = 'Percentage of extravasation events (in %)';

        $j = 5;
        $header[$j++] = 'Data analysis (RCA, Reason for Variation etc.)';
        $header[$j++] = 'Corrective action';
        $header[$j++] = 'Preventive action';

        $dataexport = [];
        $i = 0;
        foreach ($feedbacktaken as $row) {
            $data = json_decode($row->dataset, true);

            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['initial_assessment_total'] = isset($data['initial_assessment_total']) ? $data['initial_assessment_total'] : '';
            $dataexport[$i]['total_admission'] = isset($data['total_admission']) ? $data['total_admission'] : '';
            $dataexport[$i]['calculatedResult'] = isset($data['calculatedResult']) ? $data['calculatedResult'] : '';
            $dataexport[$i]['dataAnalysis'] = isset($data['dataAnalysis']) ? $data['dataAnalysis'] : '';
            $dataexport[$i]['correctiveAction'] = isset($data['correctiveAction']) ? $data['correctiveAction'] : '';
            $dataexport[$i]['preventiveAction'] = isset($data['preventiveAction']) ? $data['preventiveAction'] : '';

            $i++;
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- Percentage of Intravenous Contrast Media Extravasation (Radiology) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (isset($dataexport[0])) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) {
                fputcsv($fp, $values, ',');
            }
            fclose($fp);
        }
        ob_flush();
        exit;
    } else {
        redirect('dashboard/noaccess');
    }
}

public function overall_CQI3a19_report()
{
    if ($this->session->userdata('isLogIn') == false)
        redirect('login');
    if (ismodule_active('QUALITY') === true) {

        $table_feedback = 'bf_feedback_CQI3a19';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $setup = 'setup';

        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $sresult = $this->quality_model->setup_result($setup);
        $setarray = array();
        $questioarray = array();
        foreach ($sresult as $r) {
            $setarray[$r->type] = $r->title;
        }
        foreach ($sresult as $r) {
            $questioarray[$r->type][$r->shortkey] = $r->shortname;
        }

        $arraydata = array();
        foreach ($questioarray as $setr) {
            foreach ($setr as $k => $v) {
                $arraydata[$k] = $v;
            }
        }

        $header[0] = 'KPI Recorded by';
        $header[1] = 'KPI Recorded on';
        $header[2] = 'Sum of time taken for triage (in Mins)';
        $header[3] = 'Total number of triage cases (in No.s)';
        $header[4] = 'Average time taken for triage (in Mins)';

        $j = 5;
        $header[$j++] = 'Benchmark time';
        $header[$j++] = 'Data analysis (RCA, Reason for Variation etc.)';
        $header[$j++] = 'Corrective action';
        $header[$j++] = 'Preventive action';

        $dataexport = [];
        $i = 0;
        foreach ($feedbacktaken as $row) {
            $data = json_decode($row->dataset, true);

            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['initial_assessment_total'] = isset($data['initial_assessment_total']) ? $data['initial_assessment_total'] : '';
            $dataexport[$i]['total_admission'] = isset($data['total_admission']) ? $data['total_admission'] : '';
            $dataexport[$i]['calculatedResult'] = isset($data['calculatedResult']) ? $data['calculatedResult'] : '';
            $dataexport[$i]['benchmark'] = isset($data['benchmark']) ? $data['benchmark'] : '';
            $dataexport[$i]['dataAnalysis'] = isset($data['dataAnalysis']) ? $data['dataAnalysis'] : '';
            $dataexport[$i]['correctiveAction'] = isset($data['correctiveAction']) ? $data['correctiveAction'] : '';
            $dataexport[$i]['preventiveAction'] = isset($data['preventiveAction']) ? $data['preventiveAction'] : '';

            $i++;
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- Average Time taken for triage (Emergency Department) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (isset($dataexport[0])) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) {
                fputcsv($fp, $values, ',');
            }
            fclose($fp);
        }
        ob_flush();
        exit;
    } else {
        redirect('dashboard/noaccess');
    }
}
public function overall_CQI3a20_report()
{
    if ($this->session->userdata('isLogIn') == false)
        redirect('login');
    if (ismodule_active('QUALITY') === true) {

        $table_feedback = 'bf_feedback_CQI3a20';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $setup = 'setup';

        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $sresult = $this->quality_model->setup_result($setup);
        $setarray = array();
        $questioarray = array();
        foreach ($sresult as $r) {
            $setarray[$r->type] = $r->title;
        }
        foreach ($sresult as $r) {
            $questioarray[$r->type][$r->shortkey] = $r->shortname;
        }

        $arraydata = array();
        foreach ($questioarray as $setr) {
            foreach ($setr as $k => $v) {
                $arraydata[$k] = $v;
            }
        }

        $header[0] = 'KPI Recorded by';
        $header[1] = 'KPI Recorded on';
        $header[2] = 'Number of dialysis patients achieving target hemoglobin (in No.s)';
        $header[3] = 'Total dialysis patients (in No.s)';
        $header[4] = 'Percentage achieving target hemoglobin (in %)';

        $j = 5;
        $header[$j++] = 'Data analysis (RCA, Reason for Variation etc.)';
        $header[$j++] = 'Corrective action';
        $header[$j++] = 'Preventive action';

        $dataexport = [];
        $i = 0;
        foreach ($feedbacktaken as $row) {
            $data = json_decode($row->dataset, true);

            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['initial_assessment_total'] = isset($data['initial_assessment_total']) ? $data['initial_assessment_total'] : '';
            $dataexport[$i]['total_admission'] = isset($data['total_admission']) ? $data['total_admission'] : '';
            $dataexport[$i]['calculatedResult'] = isset($data['calculatedResult']) ? $data['calculatedResult'] : '';
            $dataexport[$i]['dataAnalysis'] = isset($data['dataAnalysis']) ? $data['dataAnalysis'] : '';
            $dataexport[$i]['correctiveAction'] = isset($data['correctiveAction']) ? $data['correctiveAction'] : '';
            $dataexport[$i]['preventiveAction'] = isset($data['preventiveAction']) ? $data['preventiveAction'] : '';

            $i++;
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- Percentage of patients undergoing dialysis achieving target hemoglobin levels (Nephrology) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (isset($dataexport[0])) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) {
                fputcsv($fp, $values, ',');
            }
            fclose($fp);
        }
        ob_flush();
        exit;
    } else {
        redirect('dashboard/noaccess');
    }
}

public function overall_CQI3a21_report()
{
    if ($this->session->userdata('isLogIn') == false)
        redirect('login');
    if (ismodule_active('QUALITY') === true) {

        $table_feedback = 'bf_feedback_CQI3a21';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $setup = 'setup';

        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $sresult = $this->quality_model->setup_result($setup);
        $setarray = array();
        $questioarray = array();
        foreach ($sresult as $r) {
            $setarray[$r->type] = $r->title;
        }
        foreach ($sresult as $r) {
            $questioarray[$r->type][$r->shortkey] = $r->shortname;
        }

        $arraydata = array();
        foreach ($questioarray as $setr) {
            foreach ($setr as $k => $v) {
                $arraydata[$k] = $v;
            }
        }

        $header[0] = 'KPI Recorded by';
        $header[1] = 'KPI Recorded on';
        $header[2] = 'Number of critical results responded by physician within time (in No.s)';
        $header[3] = 'Total critical results reported (in No.s)';
        $header[4] = 'Percentage compliance of timely physician response (in %)';

        $j = 5;
        $header[$j++] = 'Data analysis (RCA, Reason for Variation etc.)';
        $header[$j++] = 'Corrective action';
        $header[$j++] = 'Preventive action';

        $dataexport = [];
        $i = 0;
        foreach ($feedbacktaken as $row) {
            $data = json_decode($row->dataset, true);

            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['initial_assessment_total'] = isset($data['initial_assessment_total']) ? $data['initial_assessment_total'] : '';
            $dataexport[$i]['total_admission'] = isset($data['total_admission']) ? $data['total_admission'] : '';
            $dataexport[$i]['calculatedResult'] = isset($data['calculatedResult']) ? $data['calculatedResult'] : '';
            $dataexport[$i]['dataAnalysis'] = isset($data['dataAnalysis']) ? $data['dataAnalysis'] : '';
            $dataexport[$i]['correctiveAction'] = isset($data['correctiveAction']) ? $data['correctiveAction'] : '';
            $dataexport[$i]['preventiveAction'] = isset($data['preventiveAction']) ? $data['preventiveAction'] : '';

            $i++;
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- Percentage of Compliance rate of timeliness of physician responding to critical results (Medical Administration) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (isset($dataexport[0])) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) {
                fputcsv($fp, $values, ',');
            }
            fclose($fp);
        }
        ob_flush();
        exit;
    } else {
        redirect('dashboard/noaccess');
    }
}

public function overall_CQI3a22_report()
{
    if ($this->session->userdata('isLogIn') == false)
        redirect('login');
    if (ismodule_active('QUALITY') === true) {

        $table_feedback = 'bf_feedback_CQI3a22';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $setup = 'setup';

        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $sresult = $this->quality_model->setup_result($setup);
        $setarray = array();
        $questioarray = array();
        foreach ($sresult as $r) {
            $setarray[$r->type] = $r->title;
        }
        foreach ($sresult as $r) {
            $questioarray[$r->type][$r->shortkey] = $r->shortname;
        }

        $arraydata = array();
        foreach ($questioarray as $setr) {
            foreach ($setr as $k => $v) {
                $arraydata[$k] = $v;
            }
        }

        $header[0] = 'KPI Recorded by';
        $header[1] = 'KPI Recorded on';
        $header[2] = 'Number complying with Holding area care (in No.s)';
        $header[3] = 'Total patients requiring Holding area care (in No.s)';
        $header[4] = 'Percentage compliance to Holding area care (in %)';

        $j = 5;
        $header[$j++] = 'Data analysis (RCA, Reason for Variation etc.)';
        $header[$j++] = 'Corrective action';
        $header[$j++] = 'Preventive action';

        $dataexport = [];
        $i = 0;
        foreach ($feedbacktaken as $row) {
            $data = json_decode($row->dataset, true);

            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['initial_assessment_total'] = isset($data['initial_assessment_total']) ? $data['initial_assessment_total'] : '';
            $dataexport[$i]['total_admission'] = isset($data['total_admission']) ? $data['total_admission'] : '';
            $dataexport[$i]['calculatedResult'] = isset($data['calculatedResult']) ? $data['calculatedResult'] : '';
            $dataexport[$i]['dataAnalysis'] = isset($data['dataAnalysis']) ? $data['dataAnalysis'] : '';
            $dataexport[$i]['correctiveAction'] = isset($data['correctiveAction']) ? $data['correctiveAction'] : '';
            $dataexport[$i]['preventiveAction'] = isset($data['preventiveAction']) ? $data['preventiveAction'] : '';

            $i++;
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- Percentage of compliance to Holding area care (Nursing) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (isset($dataexport[0])) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) {
                fputcsv($fp, $values, ',');
            }
            fclose($fp);
        }
        ob_flush();
        exit;
    } else {
        redirect('dashboard/noaccess');
    }
}
public function overall_CQI3b1_report()
{
    if ($this->session->userdata('isLogIn') == false)
        redirect('login');
    if (ismodule_active('QUALITY') === true) {

        $table_feedback = 'bf_feedback_CQI3b1';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $setup = 'setup';

        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $sresult = $this->quality_model->setup_result($setup);
        $setarray = array();
        $questioarray = array();
        foreach ($sresult as $r) {
            $setarray[$r->type] = $r->title;
        }
        foreach ($sresult as $r) {
            $questioarray[$r->type][$r->shortkey] = $r->shortname;
        }

        $arraydata = array();
        foreach ($questioarray as $setr) {
            foreach ($setr as $k => $v) {
                $arraydata[$k] = $v;
            }
        }

        $header[0] = 'KPI Recorded by';
        $header[1] = 'KPI Recorded on';
        $header[2] = 'Number of reporting errors (in No.s)';
        $header[3] = 'Number of investigations (in No.s)';
        $header[4] = 'Reporting errors per 1000 investigations';

        $j = 5;
        $header[$j++] = 'Data analysis (RCA, Reason for Variation etc.)';
        $header[$j++] = 'Corrective action';
        $header[$j++] = 'Preventive action';

        $dataexport = [];
        $i = 0;
        foreach ($feedbacktaken as $row) {
            $data = json_decode($row->dataset, true);

            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['initial_assessment_total'] = isset($data['initial_assessment_total']) ? $data['initial_assessment_total'] : '';
            $dataexport[$i]['total_admission'] = isset($data['total_admission']) ? $data['total_admission'] : '';
            $dataexport[$i]['calculatedResult'] = isset($data['calculatedResult']) ? $data['calculatedResult'] : '';
            $dataexport[$i]['dataAnalysis'] = isset($data['dataAnalysis']) ? $data['dataAnalysis'] : '';
            $dataexport[$i]['correctiveAction'] = isset($data['correctiveAction']) ? $data['correctiveAction'] : '';
            $dataexport[$i]['preventiveAction'] = isset($data['preventiveAction']) ? $data['preventiveAction'] : '';

            $i++;
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- Number of reporting errors per 1000 investigations (Lab) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (isset($dataexport[0])) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) {
                fputcsv($fp, $values, ',');
            }
            fclose($fp);
        }
        ob_flush();
        exit;
    } else {
        redirect('dashboard/noaccess');
    }
}

public function overall_CQI3b2_report()
{
    if ($this->session->userdata('isLogIn') == false)
        redirect('login');
    if (ismodule_active('QUALITY') === true) {

        $table_feedback = 'bf_feedback_CQI3b2';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $setup = 'setup';

        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $sresult = $this->quality_model->setup_result($setup);
        $setarray = array();
        $questioarray = array();
        foreach ($sresult as $r) {
            $setarray[$r->type] = $r->title;
        }
        foreach ($sresult as $r) {
            $questioarray[$r->type][$r->shortkey] = $r->shortname;
        }

        $arraydata = array();
        foreach ($questioarray as $setr) {
            foreach ($setr as $k => $v) {
                $arraydata[$k] = $v;
            }
        }

        $header[0] = 'KPI Recorded by';
        $header[1] = 'KPI Recorded on';
        $header[2] = 'Number of redo tests (in No.s)';
        $header[3] = 'Total tests performed (in No.s)';
        $header[4] = 'Rate of redo per 1000 tests';

        $j = 5;
        $header[$j++] = 'Data analysis (RCA, Reason for Variation etc.)';
        $header[$j++] = 'Corrective action';
        $header[$j++] = 'Preventive action';

        $dataexport = [];
        $i = 0;
        foreach ($feedbacktaken as $row) {
            $data = json_decode($row->dataset, true);

            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['initial_assessment_total'] = isset($data['initial_assessment_total']) ? $data['initial_assessment_total'] : '';
            $dataexport[$i]['total_admission'] = isset($data['total_admission']) ? $data['total_admission'] : '';
            $dataexport[$i]['calculatedResult'] = isset($data['calculatedResult']) ? $data['calculatedResult'] : '';
            $dataexport[$i]['dataAnalysis'] = isset($data['dataAnalysis']) ? $data['dataAnalysis'] : '';
            $dataexport[$i]['correctiveAction'] = isset($data['correctiveAction']) ? $data['correctiveAction'] : '';
            $dataexport[$i]['preventiveAction'] = isset($data['preventiveAction']) ? $data['preventiveAction'] : '';

            $i++;
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- Rate of redo in 1000 tests (Lab) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (isset($dataexport[0])) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) {
                fputcsv($fp, $values, ',');
            }
            fclose($fp);
        }
        ob_flush();
        exit;
    } else {
        redirect('dashboard/noaccess');
    }
}

public function overall_CQI3b3_report()
{
    if ($this->session->userdata('isLogIn') == false)
        redirect('login');
    if (ismodule_active('QUALITY') === true) {

        $table_feedback = 'bf_feedback_CQI3b3';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $setup = 'setup';

        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $sresult = $this->quality_model->setup_result($setup);
        $setarray = array();
        $questioarray = array();
        foreach ($sresult as $r) {
            $setarray[$r->type] = $r->title;
        }
        foreach ($sresult as $r) {
            $questioarray[$r->type][$r->shortkey] = $r->shortname;
        }

        $arraydata = array();
        foreach ($questioarray as $setr) {
            foreach ($setr as $k => $v) {
                $arraydata[$k] = $v;
            }
        }

        $header[0] = 'KPI Recorded by';
        $header[1] = 'KPI Recorded on';
        $header[2] = 'Number of reports correlating to clinical diagnosis (in No.s)';
        $header[3] = 'Total reports (in No.s)';
        $header[4] = 'Percentage reports correlating to clinical diagnosis (in %)';

        $j = 5;
        $header[$j++] = 'Data analysis (RCA, Reason for Variation etc.)';
        $header[$j++] = 'Corrective action';
        $header[$j++] = 'Preventive action';

        $dataexport = [];
        $i = 0;
        foreach ($feedbacktaken as $row) {
            $data = json_decode($row->dataset, true);

            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['initial_assessment_total'] = isset($data['initial_assessment_total']) ? $data['initial_assessment_total'] : '';
            $dataexport[$i]['total_admission'] = isset($data['total_admission']) ? $data['total_admission'] : '';
            $dataexport[$i]['calculatedResult'] = isset($data['calculatedResult']) ? $data['calculatedResult'] : '';
            $dataexport[$i]['dataAnalysis'] = isset($data['dataAnalysis']) ? $data['dataAnalysis'] : '';
            $dataexport[$i]['correctiveAction'] = isset($data['correctiveAction']) ? $data['correctiveAction'] : '';
            $dataexport[$i]['preventiveAction'] = isset($data['preventiveAction']) ? $data['preventiveAction'] : '';

            $i++;
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- Percentage of reports correlating to clinical diagnosis (Lab) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (isset($dataexport[0])) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) {
                fputcsv($fp, $values, ',');
            }
            fclose($fp);
        }
        ob_flush();
        exit;
    } else {
        redirect('dashboard/noaccess');
    }
}

public function overall_CQI3b4_report()
{
    if ($this->session->userdata('isLogIn') == false)
        redirect('login');
    if (ismodule_active('QUALITY') === true) {

        $table_feedback = 'bf_feedback_CQI3b4';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $setup = 'setup';

        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $sresult = $this->quality_model->setup_result($setup);
        $setarray = array();
        $questioarray = array();
        foreach ($sresult as $r) {
            $setarray[$r->type] = $r->title;
        }
        foreach ($sresult as $r) {
            $questioarray[$r->type][$r->shortkey] = $r->shortname;
        }

        $arraydata = array();
        foreach ($questioarray as $setr) {
            foreach ($setr as $k => $v) {
                $arraydata[$k] = $v;
            }
        }

        $header[0] = 'KPI Recorded by';
        $header[1] = 'KPI Recorded on';
        $header[2] = 'Number of employees adhering to safety precautions (in No.s)';
        $header[3] = 'Total employees observed (in No.s)';
        $header[4] = 'Percentage adherence to safety precautions (in %)';

        $j = 5;
        $header[$j++] = 'Data analysis (RCA, Reason for Variation etc.)';
        $header[$j++] = 'Corrective action';
        $header[$j++] = 'Preventive action';

        $dataexport = [];
        $i = 0;
        foreach ($feedbacktaken as $row) {
            $data = json_decode($row->dataset, true);

            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['initial_assessment_total'] = isset($data['initial_assessment_total']) ? $data['initial_assessment_total'] : '';
            $dataexport[$i]['total_admission'] = isset($data['total_admission']) ? $data['total_admission'] : '';
            $dataexport[$i]['calculatedResult'] = isset($data['calculatedResult']) ? $data['calculatedResult'] : '';
            $dataexport[$i]['dataAnalysis'] = isset($data['dataAnalysis']) ? $data['dataAnalysis'] : '';
            $dataexport[$i]['correctiveAction'] = isset($data['correctiveAction']) ? $data['correctiveAction'] : '';
            $dataexport[$i]['preventiveAction'] = isset($data['preventiveAction']) ? $data['preventiveAction'] : '';

            $i++;
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- Percentage of employees in diagnostics adhering to safety precautions (Lab) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (isset($dataexport[0])) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) {
                fputcsv($fp, $values, ',');
            }
            fclose($fp);
        }
        ob_flush();
        exit;
    } else {
        redirect('dashboard/noaccess');
    }
}

public function overall_CQI3b5_report()
{
    if ($this->session->userdata('isLogIn') == false)
        redirect('login');
    if (ismodule_active('QUALITY') === true) {

        $table_feedback = 'bf_feedback_CQI3b5';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $setup = 'setup';

        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $sresult = $this->quality_model->setup_result($setup);
        $setarray = array();
        $questioarray = array();
        foreach ($sresult as $r) {
            $setarray[$r->type] = $r->title;
        }
        foreach ($sresult as $r) {
            $questioarray[$r->type][$r->shortkey] = $r->shortname;
        }

        $arraydata = array();
        foreach ($questioarray as $setr) {
            foreach ($setr as $k => $v) {
                $arraydata[$k] = $v;
            }
        }

        $header[0] = 'KPI Recorded by';
        $header[1] = 'KPI Recorded on';
        $header[2] = 'Number of redo tests (in No.s)';
        $header[3] = 'Total radiology tests (in No.s)';
        $header[4] = 'Rate of redo per 1000 tests (Radiology)';

        $j = 5;
        $header[$j++] = 'Data analysis (RCA, Reason for Variation etc.)';
        $header[$j++] = 'Corrective action';
        $header[$j++] = 'Preventive action';

        $dataexport = [];
        $i = 0;
        foreach ($feedbacktaken as $row) {
            $data = json_decode($row->dataset, true);

            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['initial_assessment_total'] = isset($data['initial_assessment_total']) ? $data['initial_assessment_total'] : '';
            $dataexport[$i]['total_admission'] = isset($data['total_admission']) ? $data['total_admission'] : '';
            $dataexport[$i]['calculatedResult'] = isset($data['calculatedResult']) ? $data['calculatedResult'] : '';
            $dataexport[$i]['dataAnalysis'] = isset($data['dataAnalysis']) ? $data['dataAnalysis'] : '';
            $dataexport[$i]['correctiveAction'] = isset($data['correctiveAction']) ? $data['correctiveAction'] : '';
            $dataexport[$i]['preventiveAction'] = isset($data['preventiveAction']) ? $data['preventiveAction'] : '';

            $i++;
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- Rate of redo in 1000 tests (Radiology) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (isset($dataexport[0])) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) {
                fputcsv($fp, $values, ',');
            }
            fclose($fp);
        }
        ob_flush();
        exit;
    } else {
        redirect('dashboard/noaccess');
    }
}

public function overall_CQI3b6_report()
{
    if ($this->session->userdata('isLogIn') == false)
        redirect('login');
    if (ismodule_active('QUALITY') === true) {

        $table_feedback = 'bf_feedback_CQI3b6';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $setup = 'setup';

        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $sresult = $this->quality_model->setup_result($setup);
        $setarray = array();
        $questioarray = array();
        foreach ($sresult as $r) {
            $setarray[$r->type] = $r->title;
        }
        foreach ($sresult as $r) {
            $questioarray[$r->type][$r->shortkey] = $r->shortname;
        }

        $arraydata = array();
        foreach ($questioarray as $setr) {
            foreach ($setr as $k => $v) {
                $arraydata[$k] = $v;
            }
        }

        $header[0] = 'KPI Recorded by';
        $header[1] = 'KPI Recorded on';
        $header[2] = 'Number of reporting errors (in No.s)';
        $header[3] = 'Number of radiology investigations (in No.s)';
        $header[4] = 'Reporting errors per 1000 investigations (Radiology)';

        $j = 5;
        $header[$j++] = 'Data analysis (RCA, Reason for Variation etc.)';
        $header[$j++] = 'Corrective action';
        $header[$j++] = 'Preventive action';

        $dataexport = [];
        $i = 0;
        foreach ($feedbacktaken as $row) {
            $data = json_decode($row->dataset, true);

            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['initial_assessment_total'] = isset($data['initial_assessment_total']) ? $data['initial_assessment_total'] : '';
            $dataexport[$i]['total_admission'] = isset($data['total_admission']) ? $data['total_admission'] : '';
            $dataexport[$i]['calculatedResult'] = isset($data['calculatedResult']) ? $data['calculatedResult'] : '';
            $dataexport[$i]['dataAnalysis'] = isset($data['dataAnalysis']) ? $data['dataAnalysis'] : '';
            $dataexport[$i]['correctiveAction'] = isset($data['correctiveAction']) ? $data['correctiveAction'] : '';
            $dataexport[$i]['preventiveAction'] = isset($data['preventiveAction']) ? $data['preventiveAction'] : '';

            $i++;
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- Number of reporting errors per 1000 investigations (Radiology) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (isset($dataexport[0])) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) {
                fputcsv($fp, $values, ',');
            }
            fclose($fp);
        }
        ob_flush();
        exit;
    } else {
        redirect('dashboard/noaccess');
    }
}

public function overall_CQI3b7_report()
{
    if ($this->session->userdata('isLogIn') == false)
        redirect('login');
    if (ismodule_active('QUALITY') === true) {

        $table_feedback = 'bf_feedback_CQI3b7';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $setup = 'setup';

        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $sresult = $this->quality_model->setup_result($setup);
        $setarray = array();
        $questioarray = array();
        foreach ($sresult as $r) {
            $setarray[$r->type] = $r->title;
        }
        foreach ($sresult as $r) {
            $questioarray[$r->type][$r->shortkey] = $r->shortname;
        }

        $arraydata = array();
        foreach ($questioarray as $setr) {
            foreach ($setr as $k => $v) {
                $arraydata[$k] = $v;
            }
        }

        $header[0] = 'KPI Recorded by';
        $header[1] = 'KPI Recorded on';
        $header[2] = 'Number of reports correlating to clinical diagnosis (in No.s)';
        $header[3] = 'Total radiology reports (in No.s)';
        $header[4] = 'Percentage reports correlating to clinical diagnosis (Radiology)';

        $j = 5;
        $header[$j++] = 'Data analysis (RCA, Reason for Variation etc.)';
        $header[$j++] = 'Corrective action';
        $header[$j++] = 'Preventive action';

        $dataexport = [];
        $i = 0;
        foreach ($feedbacktaken as $row) {
            $data = json_decode($row->dataset, true);

            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['initial_assessment_total'] = isset($data['initial_assessment_total']) ? $data['initial_assessment_total'] : '';
            $dataexport[$i]['total_admission'] = isset($data['total_admission']) ? $data['total_admission'] : '';
            $dataexport[$i]['calculatedResult'] = isset($data['calculatedResult']) ? $data['calculatedResult'] : '';
            $dataexport[$i]['dataAnalysis'] = isset($data['dataAnalysis']) ? $data['dataAnalysis'] : '';
            $dataexport[$i]['correctiveAction'] = isset($data['correctiveAction']) ? $data['correctiveAction'] : '';
            $dataexport[$i]['preventiveAction'] = isset($data['preventiveAction']) ? $data['preventiveAction'] : '';

            $i++;
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- Percentage of reports correlating to clinical diagnosis (Radiology) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (isset($dataexport[0])) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) {
                fputcsv($fp, $values, ',');
            }
            fclose($fp);
        }
        ob_flush();
        exit;
    } else {
        redirect('dashboard/noaccess');
    }
}
public function overall_CQI3b8_report()
{
    if ($this->session->userdata('isLogIn') == false)
        redirect('login');
    if (ismodule_active('QUALITY') === true) {

        $table_feedback = 'bf_feedback_CQI3b8';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $setup = 'setup';

        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $sresult = $this->quality_model->setup_result($setup);
        $setarray = array();
        $questioarray = array();
        foreach ($sresult as $r) {
            $setarray[$r->type] = $r->title;
        }
        foreach ($sresult as $r) {
            $questioarray[$r->type][$r->shortkey] = $r->shortname;
        }

        $arraydata = array();
        foreach ($questioarray as $setr) {
            foreach ($setr as $k => $v) {
                $arraydata[$k] = $v;
            }
        }

        $header[0] = 'KPI Recorded by';
        $header[1] = 'KPI Recorded on';
        $header[2] = 'Number of employees adhering to safety precautions (in No.s)';
        $header[3] = 'Total employees observed (in No.s)';
        $header[4] = 'Percentage adherence to safety precautions (in %)';

        $j = 5;
        $header[$j++] = 'Data analysis (RCA, Reason for Variation etc.)';
        $header[$j++] = 'Corrective action';
        $header[$j++] = 'Preventive action';

        $dataexport = [];
        $i = 0;
        foreach ($feedbacktaken as $row) {
            $data = json_decode($row->dataset, true);

            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['initial_assessment_total'] = isset($data['initial_assessment_total']) ? $data['initial_assessment_total'] : '';
            $dataexport[$i]['total_admission'] = isset($data['total_admission']) ? $data['total_admission'] : '';
            $dataexport[$i]['calculatedResult'] = isset($data['calculatedResult']) ? $data['calculatedResult'] : '';
            $dataexport[$i]['dataAnalysis'] = isset($data['dataAnalysis']) ? $data['dataAnalysis'] : '';
            $dataexport[$i]['correctiveAction'] = isset($data['correctiveAction']) ? $data['correctiveAction'] : '';
            $dataexport[$i]['preventiveAction'] = isset($data['preventiveAction']) ? $data['preventiveAction'] : '';

            $i++;
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- Percentage of employees in diagnostics adhering to safety precautions (Radiology) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (isset($dataexport[0])) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) {
                fputcsv($fp, $values, ',');
            }
            fclose($fp);
        }
        ob_flush();
        exit;
    } else {
        redirect('dashboard/noaccess');
    }
}

public function overall_CQI3b9_report()
{
    if ($this->session->userdata('isLogIn') == false)
        redirect('login');
    if (ismodule_active('QUALITY') === true) {

        $table_feedback = 'bf_feedback_CQI3b9';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $setup = 'setup';

        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $sresult = $this->quality_model->setup_result($setup);
        $setarray = array();
        $questioarray = array();
        foreach ($sresult as $r) {
            $setarray[$r->type] = $r->title;
        }
        foreach ($sresult as $r) {
            $questioarray[$r->type][$r->shortkey] = $r->shortname;
        }

        $arraydata = array();
        foreach ($questioarray as $setr) {
            foreach ($setr as $k => $v) {
                $arraydata[$k] = $v;
            }
        }

        $header[0] = 'KPI Recorded by';
        $header[1] = 'KPI Recorded on';
        $header[2] = 'Number of employees adhering to safety precautions (OT) (in No.s)';
        $header[3] = 'Total employees observed (OT) (in No.s)';
        $header[4] = 'Percentage adherence to safety precautions (OT) (in %)';

        $j = 5;
        $header[$j++] = 'Data analysis (RCA, Reason for Variation etc.)';
        $header[$j++] = 'Corrective action';
        $header[$j++] = 'Preventive action';

        $dataexport = [];
        $i = 0;
        foreach ($feedbacktaken as $row) {
            $data = json_decode($row->dataset, true);

            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['initial_assessment_total'] = isset($data['initial_assessment_total']) ? $data['initial_assessment_total'] : '';
            $dataexport[$i]['total_admission'] = isset($data['total_admission']) ? $data['total_admission'] : '';
            $dataexport[$i]['calculatedResult'] = isset($data['calculatedResult']) ? $data['calculatedResult'] : '';
            $dataexport[$i]['dataAnalysis'] = isset($data['dataAnalysis']) ? $data['dataAnalysis'] : '';
            $dataexport[$i]['correctiveAction'] = isset($data['correctiveAction']) ? $data['correctiveAction'] : '';
            $dataexport[$i]['preventiveAction'] = isset($data['preventiveAction']) ? $data['preventiveAction'] : '';

            $i++;
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- Percentage of employees in diagnostics adhering to safety precautions (Radiology-OT) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (isset($dataexport[0])) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) {
                fputcsv($fp, $values, ',');
            }
            fclose($fp);
        }
        ob_flush();
        exit;
    } else {
        redirect('dashboard/noaccess');
    }
}

public function overall_CQI3b10_report()
{
    if ($this->session->userdata('isLogIn') == false)
        redirect('login');
    if (ismodule_active('QUALITY') === true) {

        $table_feedback = 'bf_feedback_CQI3b10';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $setup = 'setup';

        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $sresult = $this->quality_model->setup_result($setup);
        $setarray = array();
        $questioarray = array();
        foreach ($sresult as $r) {
            $setarray[$r->type] = $r->title;
        }
        foreach ($sresult as $r) {
            $questioarray[$r->type][$r->shortkey] = $r->shortname;
        }

        $arraydata = array();
        foreach ($questioarray as $setr) {
            foreach ($setr as $k => $v) {
                $arraydata[$k] = $v;
            }
        }

        $header[0] = 'KPI Recorded by';
        $header[1] = 'KPI Recorded on';
        $header[2] = 'Number of employees adhering to safety precautions (Nursing) (in No.s)';
        $header[3] = 'Total employees observed (Nursing) (in No.s)';
        $header[4] = 'Percentage adherence to safety precautions (Nursing) (in %)';

        $j = 5;
        $header[$j++] = 'Data analysis (RCA, Reason for Variation etc.)';
        $header[$j++] = 'Corrective action';
        $header[$j++] = 'Preventive action';

        $dataexport = [];
        $i = 0;
        foreach ($feedbacktaken as $row) {
            $data = json_decode($row->dataset, true);

            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['initial_assessment_total'] = isset($data['initial_assessment_total']) ? $data['initial_assessment_total'] : '';
            $dataexport[$i]['total_admission'] = isset($data['total_admission']) ? $data['total_admission'] : '';
            $dataexport[$i]['calculatedResult'] = isset($data['calculatedResult']) ? $data['calculatedResult'] : '';
            $dataexport[$i]['dataAnalysis'] = isset($data['dataAnalysis']) ? $data['dataAnalysis'] : '';
            $dataexport[$i]['correctiveAction'] = isset($data['correctiveAction']) ? $data['correctiveAction'] : '';
            $dataexport[$i]['preventiveAction'] = isset($data['preventiveAction']) ? $data['preventiveAction'] : '';

            $i++;
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- Percentage of employees in diagnostics adhering to safety precautions (Radiology-Nursing) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (isset($dataexport[0])) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) {
                fputcsv($fp, $values, ',');
            }
            fclose($fp);
        }
        ob_flush();
        exit;
    } else {
        redirect('dashboard/noaccess');
    }
}

public function overall_CQI3b11_report()
{
    if ($this->session->userdata('isLogIn') == false)
        redirect('login');
    if (ismodule_active('QUALITY') === true) {

        $table_feedback = 'bf_feedback_CQI3b11';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $setup = 'setup';

        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $sresult = $this->quality_model->setup_result($setup);
        $setarray = array();
        $questioarray = array();
        foreach ($sresult as $r) {
            $setarray[$r->type] = $r->title;
        }
        foreach ($sresult as $r) {
            $questioarray[$r->type][$r->shortkey] = $r->shortname;
        }

        $arraydata = array();
        foreach ($questioarray as $setr) {
            foreach ($setr as $k => $v) {
                $arraydata[$k] = $v;
            }
        }

        $header[0] = 'KPI Recorded by';
        $header[1] = 'KPI Recorded on';
        $header[2] = 'Number of reporting errors before dispatch (in No.s)';
        $header[3] = 'Total reports dispatched (in No.s)';
        $header[4] = 'Reporting errors before dispatch (in No.s)';

        $j = 5;
        $header[$j++] = 'Data analysis (RCA, Reason for Variation etc.)';
        $header[$j++] = 'Corrective action';
        $header[$j++] = 'Preventive action';

        $dataexport = [];
        $i = 0;
        foreach ($feedbacktaken as $row) {
            $data = json_decode($row->dataset, true);

            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['initial_assessment_total'] = isset($data['initial_assessment_total']) ? $data['initial_assessment_total'] : '';
            $dataexport[$i]['total_admission'] = isset($data['total_admission']) ? $data['total_admission'] : '';
            $dataexport[$i]['calculatedResult'] = isset($data['calculatedResult']) ? $data['calculatedResult'] : '';
            $dataexport[$i]['dataAnalysis'] = isset($data['dataAnalysis']) ? $data['dataAnalysis'] : '';
            $dataexport[$i]['correctiveAction'] = isset($data['correctiveAction']) ? $data['correctiveAction'] : '';
            $dataexport[$i]['preventiveAction'] = isset($data['preventiveAction']) ? $data['preventiveAction'] : '';

            $i++;
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- Number of reporting errors before dispatch (Lab) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (isset($dataexport[0])) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) {
                fputcsv($fp, $values, ',');
            }
            fclose($fp);
        }
        ob_flush();
        exit;
    } else {
        redirect('dashboard/noaccess');
    }
}

public function overall_CQI3b12_report()
{
    if ($this->session->userdata('isLogIn') == false)
        redirect('login');
    if (ismodule_active('QUALITY') === true) {

        $table_feedback = 'bf_feedback_CQI3b12';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $setup = 'setup';

        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $sresult = $this->quality_model->setup_result($setup);
        $setarray = array();
        $questioarray = array();
        foreach ($sresult as $r) {
            $setarray[$r->type] = $r->title;
        }
        foreach ($sresult as $r) {
            $questioarray[$r->type][$r->shortkey] = $r->shortname;
        }

        $arraydata = array();
        foreach ($questioarray as $setr) {
            foreach ($setr as $k => $v) {
                $arraydata[$k] = $v;
            }
        }

        $header[0] = 'KPI Recorded by';
        $header[1] = 'KPI Recorded on';
        $header[2] = 'Total waiting time for laboratory services (in Mins)';
        $header[3] = 'Number of patients served (in No.s)';
        $header[4] = 'Average waiting time (in Mins)';

        $j = 5;
        $header[$j++] = 'Benchmark time';
        $header[$j++] = 'Data analysis (RCA, Reason for Variation etc.)';
        $header[$j++] = 'Corrective action';
        $header[$j++] = 'Preventive action';

        $dataexport = [];
        $i = 0;
        foreach ($feedbacktaken as $row) {
            $data = json_decode($row->dataset, true);

            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['initial_assessment_total'] = isset($data['initial_assessment_total']) ? $data['initial_assessment_total'] : '';
            $dataexport[$i]['total_admission'] = isset($data['total_admission']) ? $data['total_admission'] : '';
            $dataexport[$i]['calculatedResult'] = isset($data['calculatedResult']) ? $data['calculatedResult'] : '';
            $dataexport[$i]['benchmark'] = isset($data['benchmark']) ? $data['benchmark'] : '';
            $dataexport[$i]['dataAnalysis'] = isset($data['dataAnalysis']) ? $data['dataAnalysis'] : '';
            $dataexport[$i]['correctiveAction'] = isset($data['correctiveAction']) ? $data['correctiveAction'] : '';
            $dataexport[$i]['preventiveAction'] = isset($data['preventiveAction']) ? $data['preventiveAction'] : '';

            $i++;
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- Waiting time for Laboratory services - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (isset($dataexport[0])) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) {
                fputcsv($fp, $values, ',');
            }
            fclose($fp);
        }
        ob_flush();
        exit;
    } else {
        redirect('dashboard/noaccess');
    }
}

public function overall_CQI3b13_report()
{
    if ($this->session->userdata('isLogIn') == false)
        redirect('login');
    if (ismodule_active('QUALITY') === true) {

        $table_feedback = 'bf_feedback_CQI3b13';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $setup = 'setup';

        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $sresult = $this->quality_model->setup_result($setup);
        $setarray = array();
        $questioarray = array();
        foreach ($sresult as $r) {
            $setarray[$r->type] = $r->title;
        }
        foreach ($sresult as $r) {
            $questioarray[$r->type][$r->shortkey] = $r->shortname;
        }

        $arraydata = array();
        foreach ($questioarray as $setr) {
            foreach ($setr as $k => $v) {
                $arraydata[$k] = $v;
            }
        }

        $header[0] = 'KPI Recorded by';
        $header[1] = 'KPI Recorded on';
        $header[2] = 'Number of patient safety events related to pathology samples (in No.s)';
        $header[3] = 'Total relevant specimens handled (in No.s)';
        $header[4] = 'Number/Percentage of patient safety events';

        $j = 5;
        $header[$j++] = 'Data analysis (RCA, Reason for Variation etc.)';
        $header[$j++] = 'Corrective action';
        $header[$j++] = 'Preventive action';

        $dataexport = [];
        $i = 0;
        foreach ($feedbacktaken as $row) {
            $data = json_decode($row->dataset, true);

            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['initial_assessment_total'] = isset($data['initial_assessment_total']) ? $data['initial_assessment_total'] : '';
            $dataexport[$i]['total_admission'] = isset($data['total_admission']) ? $data['total_admission'] : '';
            $dataexport[$i]['calculatedResult'] = isset($data['calculatedResult']) ? $data['calculatedResult'] : '';
            $dataexport[$i]['dataAnalysis'] = isset($data['dataAnalysis']) ? $data['dataAnalysis'] : '';
            $dataexport[$i]['correctiveAction'] = isset($data['correctiveAction']) ? $data['correctiveAction'] : '';
            $dataexport[$i]['preventiveAction'] = isset($data['preventiveAction']) ? $data['preventiveAction'] : '';

            $i++;
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- Patient safety events related to pathology samples (Lab Services) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (isset($dataexport[0])) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) {
                fputcsv($fp, $values, ',');
            }
            fclose($fp);
        }
        ob_flush();
        exit;
    } else {
        redirect('dashboard/noaccess');
    }
}
public function overall_CQI3c1_report()
{
    if ($this->session->userdata('isLogIn') == false)
        redirect('login');
    if (ismodule_active('QUALITY') === true) {

        $table_feedback = 'bf_feedback_CQI3c1';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $setup = 'setup';

        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $sresult = $this->quality_model->setup_result($setup);
        $setarray = array();
        $questioarray = array();
        foreach ($sresult as $r) {
            $setarray[$r->type] = $r->title;
        }
        foreach ($sresult as $r) {
            $questioarray[$r->type][$r->shortkey] = $r->shortname;
        }

        $arraydata = array();
        foreach ($questioarray as $setr) {
            foreach ($setr as $k => $v) {
                $arraydata[$k] = $v;
            }
        }

        $header[0] = 'KPI Recorded by';
        $header[1] = 'KPI Recorded on';
        $header[2] = 'Number of Medication Errors (in No.s)';
        $header[3] = 'Total number of Prescriptions/Dispensations (in No.s)';
        $header[4] = 'Medication Errors Rate (in %)';

        $j = 5;

        $header[$j++] = 'Data analysis (RCA, Reason for Variation etc.)';
        $header[$j++] = 'Corrective action';
        $header[$j++] = 'Preventive action';

        $dataexport = [];
        $i = 0;
        foreach ($feedbacktaken as $row) {
            $data = json_decode($row->dataset, true);

            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['initial_assessment_total'] = $data['initial_assessment_total'];
            $dataexport[$i]['total_admission'] = $data['total_admission'];
            $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];

            $i++;
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- Medication errors Rate (Clinical Pharmacy) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (isset($dataexport[0])) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) {
                fputcsv($fp, $values, ',');
            }
            fclose($fp);
        }
        ob_flush();
        exit;
    } else {
        redirect('dashboard/noaccess');
    }
}
public function overall_CQI3c2_report()
{
    if ($this->session->userdata('isLogIn') == false)
        redirect('login');
    if (ismodule_active('QUALITY') === true) {

        $table_feedback = 'bf_feedback_CQI3c2';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $setup = 'setup';

        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $sresult = $this->quality_model->setup_result($setup);
        $setarray = array();
        $questioarray = array();
        foreach ($sresult as $r) {
            $setarray[$r->type] = $r->title;
        }
        foreach ($sresult as $r) {
            $questioarray[$r->type][$r->shortkey] = $r->shortname;
        }

        $arraydata = array();
        foreach ($questioarray as $setr) {
            foreach ($setr as $k => $v) {
                $arraydata[$k] = $v;
            }
        }

        $header[0] = 'KPI Recorded by';
        $header[1] = 'KPI Recorded on';
        $header[2] = 'Number of cases';
        $header[3] = 'Total prescriptions';
        $header[4] = 'Percentage / Rate';

        $j = 5;
        $header[$j++] = 'Data analysis (RCA, Reason for Variation etc.)';
        $header[$j++] = 'Corrective action';
        $header[$j++] = 'Preventive action';

        $dataexport = [];
        $i = 0;
        foreach ($feedbacktaken as $row) {
            $data = json_decode($row->dataset, true);

            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['initial_assessment_total'] = $data['initial_assessment_total'];
            $dataexport[$i]['total_admission'] = $data['total_admission'];
            $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];

            $i++;
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3c2 - Incidence of medication errors -Prescription errors(IP) (Clinical Pharmacy) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (isset($dataexport[0])) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) {
                fputcsv($fp, $values, ',');
            }
            fclose($fp);
        }
        ob_flush();
        exit;
    } else {
        redirect('dashboard/noaccess');
    }
}

public function overall_CQI3c3_report()
{
    if ($this->session->userdata('isLogIn') == false)
        redirect('login');
    if (ismodule_active('QUALITY') === true) {

        $table_feedback = 'bf_feedback_CQI3c3';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $setup = 'setup';

        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $sresult = $this->quality_model->setup_result($setup);
        $setarray = array();
        $questioarray = array();
        foreach ($sresult as $r) {
            $setarray[$r->type] = $r->title;
        }
        foreach ($sresult as $r) {
            $questioarray[$r->type][$r->shortkey] = $r->shortname;
        }

        $arraydata = array();
        foreach ($questioarray as $setr) {
            foreach ($setr as $k => $v) {
                $arraydata[$k] = $v;
            }
        }

        $header[0] = 'KPI Recorded by';
        $header[1] = 'KPI Recorded on';
        $header[2] = 'Number of cases';
        $header[3] = 'Total dispensing';
        $header[4] = 'Percentage / Rate';

        $j = 5;
        $header[$j++] = 'Data analysis (RCA, Reason for Variation etc.)';
        $header[$j++] = 'Corrective action';
        $header[$j++] = 'Preventive action';

        $dataexport = [];
        $i = 0;
        foreach ($feedbacktaken as $row) {
            $data = json_decode($row->dataset, true);

            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['initial_assessment_total'] = $data['initial_assessment_total'];
            $dataexport[$i]['total_admission'] = $data['total_admission'];
            $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];

            $i++;
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3c3 - Incidence of medication errors -Dispensing errors(IP) (Clinical Pharmacy) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (isset($dataexport[0])) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) {
                fputcsv($fp, $values, ',');
            }
            fclose($fp);
        }
        ob_flush();
        exit;
    } else {
        redirect('dashboard/noaccess');
    }
}
public function overall_CQI3c4_report()
{
    if ($this->session->userdata('isLogIn') == false)
        redirect('login');
    if (ismodule_active('QUALITY') === true) {

        $table_feedback = 'bf_feedback_CQI3c4';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $setup = 'setup';

        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $sresult = $this->quality_model->setup_result($setup);
        $setarray = array();
        $questioarray = array();
        foreach ($sresult as $r) {
            $setarray[$r->type] = $r->title;
        }
        foreach ($sresult as $r) {
            $questioarray[$r->type][$r->shortkey] = $r->shortname;
        }

        $arraydata = array();
        foreach ($questioarray as $setr) {
            foreach ($setr as $k => $v) {
                $arraydata[$k] = $v;
            }
        }

        $header[0] = 'KPI Recorded by';
        $header[1] = 'KPI Recorded on';
        $header[2] = 'Total admissions';
        $header[3] = 'Number of ADR cases';
        $header[4] = 'Percentage of admissions with ADR (in %)';

        $j = 5;
        $header[$j++] = 'Data analysis (RCA, Reason for Variation etc.)';
        $header[$j++] = 'Corrective action';
        $header[$j++] = 'Preventive action';

        $dataexport = [];
        $i = 0;
        foreach ($feedbacktaken as $row) {
            $data = json_decode($row->dataset, true);

            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['total_admission'] = $data['total_admission'];
            $dataexport[$i]['adr_cases'] = $data['adr_cases'];
            $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];

            $i++;
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3c4 - Percentage of admissions with ADR (Clinical Pharmacy) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (isset($dataexport[0])) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) {
                fputcsv($fp, $values, ',');
            }
            fclose($fp);
        }
        ob_flush();
        exit;
    } else {
        redirect('dashboard/noaccess');
    }
}

public function overall_CQI3c5_report()
{
    if ($this->session->userdata('isLogIn') == false)
        redirect('login');
    if (ismodule_active('QUALITY') === true) {

        $table_feedback = 'bf_feedback_CQI3c5';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $setup = 'setup';

        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $sresult = $this->quality_model->setup_result($setup);
        $setarray = array();
        $questioarray = array();
        foreach ($sresult as $r) {
            $setarray[$r->type] = $r->title;
        }
        foreach ($sresult as $r) {
            $questioarray[$r->type][$r->shortkey] = $r->shortname;
        }

        $arraydata = array();
        foreach ($questioarray as $setr) {
            foreach ($setr as $k => $v) {
                $arraydata[$k] = $v;
            }
        }

        $header[0] = 'KPI Recorded by';
        $header[1] = 'KPI Recorded on';
        $header[2] = 'Total medication charts';
        $header[3] = 'Number of charts with error-prone abbreviations';
        $header[4] = 'Percentage of medication charts with error-prone abbreviations (in %)';

        $j = 5;
        $header[$j++] = 'Data analysis (RCA, Reason for Variation etc.)';
        $header[$j++] = 'Corrective action';
        $header[$j++] = 'Preventive action';

        $dataexport = [];
        $i = 0;
        foreach ($feedbacktaken as $row) {
            $data = json_decode($row->dataset, true);

            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['total_charts'] = $data['total_charts'];
            $dataexport[$i]['error_charts'] = $data['error_charts'];
            $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];

            $i++;
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3c5 - Percentage of medication charts with error-prone abbreviations (Clinical Pharmacy) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (isset($dataexport[0])) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) {
                fputcsv($fp, $values, ',');
            }
            fclose($fp);
        }
        ob_flush();
        exit;
    } else {
        redirect('dashboard/noaccess');
    }
}

public function overall_CQI3c6_report()
{
    if ($this->session->userdata('isLogIn') == false)
        redirect('login');
    if (ismodule_active('QUALITY') === true) {

        $table_feedback = 'bf_feedback_CQI3c6';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $setup = 'setup';

        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $sresult = $this->quality_model->setup_result($setup);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Total patients receiving high-risk medications',
            'Number developing adverse drug events',
            'Percentage developing adverse drug events (in %)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);

            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['total_patients'] = $data['total_patients'];
            $dataexport[$i]['adverse_events'] = $data['adverse_events'];
            $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3c6 - Percentage of patients receiving high-risk medication developing adverse drug events - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) {
                fputcsv($fp, $values, ',');
            }
            fclose($fp);
        }
        ob_flush();
        exit;
    } else {
        redirect('dashboard/noaccess');
    }
}

public function overall_CQI3c7_report()
{
    if ($this->session->userdata('isLogIn') == false)
        redirect('login');
    if (ismodule_active('QUALITY') === true) {

        $table_feedback = 'bf_feedback_CQI3c7';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $setup = 'setup';

        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Total medication administrations',
            'Number of administering errors',
            'Percentage of administering errors (in %)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['total_administration'] = $data['total_administration'];
            $dataexport[$i]['errors'] = $data['errors'];
            $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3c7 - Incidence of Medication Administering errors - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) {
                fputcsv($fp, $values, ',');
            }
            fclose($fp);
        }
        ob_flush();
        exit;
    } else {
        redirect('dashboard/noaccess');
    }
}

public function overall_CQI3c8_report()
{
    if ($this->session->userdata('isLogIn') == false)
        redirect('login');
    if (ismodule_active('QUALITY') === true) {

        $table_feedback = 'bf_feedback_CQI3c8';
        $table_patients = 'bf_patients';
        $desc = 'desc';

        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Total in-patients',
            'Number developing adverse drug reactions',
            'Percentage of patients developing ADR (in %)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['total_inpatients'] = $data['total_inpatients'];
            $dataexport[$i]['adr_cases'] = $data['adr_cases'];
            $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3c8 - Percentage of in-patients developing adverse drug reaction - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) {
                fputcsv($fp, $values, ',');
            }
            fclose($fp);
        }
        ob_flush();
        exit;
    } else {
        redirect('dashboard/noaccess');
    }
}

public function overall_CQI3c9_report()
{
    if ($this->session->userdata('isLogIn') == false)
        redirect('login');
    if (ismodule_active('QUALITY') === true) {

        $table_feedback = 'bf_feedback_CQI3c9';
        $table_patients = 'bf_patients';
        $desc = 'desc';

        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Total medication administrations',
            'Number of administering errors',
            'Percentage of administering errors (in %)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['total_administration'] = $data['total_administration'];
            $dataexport[$i]['errors'] = $data['errors'];
            $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3c9 - Incidence of Medication Administering errors - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) {
                fputcsv($fp, $values, ',');
            }
            fclose($fp);
        }
        ob_flush();
        exit;
    } else {
        redirect('dashboard/noaccess');
    }
}

public function overall_CQI3c10_report()
{
    if ($this->session->userdata('isLogIn') == false)
        redirect('login');
    if (ismodule_active('QUALITY') === true) {

        $table_feedback = 'bf_feedback_CQI3c10';
        $table_patients = 'bf_patients';
        $desc = 'desc';

        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Total medication dispensed',
            'Number of dispensing errors',
            'Percentage of dispensing errors (in %)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['total_dispensed'] = $data['total_dispensed'];
            $dataexport[$i]['errors'] = $data['errors'];
            $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3c10 - Incidence of medication errors - Dispensing errors(IP) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) {
                fputcsv($fp, $values, ',');
            }
            fclose($fp);
        }
        ob_flush();
        exit;
    } else {
        redirect('dashboard/noaccess');
    }
}

public function overall_CQI3c11_report()
{
    if ($this->session->userdata('isLogIn') == false)
        redirect('login');
    if (ismodule_active('QUALITY') === true) {

        $table_feedback = 'bf_feedback_CQI3c11';
        $table_patients = 'bf_patients';
        $desc = 'desc';

        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Total prescriptions',
            'Number of prescription errors',
            'Percentage of prescription errors (in %)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['total_prescriptions'] = $data['total_prescriptions'];
            $dataexport[$i]['errors'] = $data['errors'];
            $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3c11 - Incidence of medication errors - Prescription errors(IP) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) {
                fputcsv($fp, $values, ',');
            }
            fclose($fp);
        }
        ob_flush();
        exit;
    } else {
        redirect('dashboard/noaccess');
    }
}

public function overall_CQI3c12_report()
{
    if ($this->session->userdata('isLogIn') == false)
        redirect('login');
    if (ismodule_active('QUALITY') === true) {

        $table_feedback = 'bf_feedback_CQI3c12';
        $table_patients = 'bf_patients';
        $desc = 'desc';

        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Total high-risk infections',
            'Number of cases compliant with empirical antibiotics therapy',
            'Compliance rate (in %)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['total_cases'] = $data['total_cases'];
            $dataexport[$i]['compliant_cases'] = $data['compliant_cases'];
            $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3c12 - Empirical Antibiotics therapy compliance rate - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) {
                fputcsv($fp, $values, ',');
            }
            fclose($fp);
        }
        ob_flush();
        exit;
    } else {
        redirect('dashboard/noaccess');
    }
}

public function overall_CQI3c13_report()
{
    if ($this->session->userdata('isLogIn') == false)
        redirect('login');
    if (ismodule_active('QUALITY') === true) {

        $table_feedback = 'bf_feedback_CQI3c13';
        $table_patients = 'bf_patients';
        $desc = 'desc';

        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Total restricted antibiotics prescribed',
            'Number of compliant cases',
            'Compliance rate (in %)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['total_cases'] = $data['total_cases'];
            $dataexport[$i]['compliant_cases'] = $data['compliant_cases'];
            $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3c13 - Restricted antibiotics usage compliance rate - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) {
                fputcsv($fp, $values, ',');
            }
            fclose($fp);
        }
        ob_flush();
        exit;
    } else {
        redirect('dashboard/noaccess');
    }
}

public function overall_CQI3c14_report()
{
    if ($this->session->userdata('isLogIn') == false)
        redirect('login');
    if (ismodule_active('QUALITY') === true) {

        $table_feedback = 'bf_feedback_CQI3c14';
        $table_patients = 'bf_patients';
        $desc = 'desc';

        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Total new drug prescriptions',
            'Number with appropriate indication',
            'Appropriateness rate (in %)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['initial_assessment_total'] = $data['initial_assessment_total'];
            $dataexport[$i]['total_admission'] = $data['total_admission'];
            $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3c14 - Monitor appropriateness of indication for new drugs - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) {
                fputcsv($fp, $values, ',');
            }
            fclose($fp);
        }
        ob_flush();
        exit;
    } else {
        redirect('dashboard/noaccess');
    }
}
public function overall_CQI3d1_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3d1';
        $table_patients = 'bf_patients';
        $desc = 'desc';

        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Total anaesthesia cases',
            'Number of modifications of anaesthesia plan',
            'Percentage of modifications (in %)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['total_cases'] = $data['total_cases'];
            $dataexport[$i]['modified_cases'] = $data['modified_cases'];
            $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3d1 - Percentage of modification of anaesthesia plan - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

public function overall_CQI3d2_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3d2';
        $table_patients = 'bf_patients';
        $desc = 'desc';

        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Total anaesthesia cases',
            'Number of unplanned ventilations',
            'Percentage of unplanned ventilations (in %)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['total_cases'] = $data['total_cases'];
            $dataexport[$i]['unplanned_ventilation'] = $data['unplanned_ventilation'];
            $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3d2 - Percentage of unplanned ventilation following anaesthesia - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

public function overall_CQI3d3_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3d3';
        $table_patients = 'bf_patients';
        $desc = 'desc';

        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Total anaesthesia cases',
            'Number of adverse anaesthesia events',
            'Percentage of adverse events (in %)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['total_cases'] = $data['total_cases'];
            $dataexport[$i]['adverse_events'] = $data['adverse_events'];
            $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3d3 - Percentage of adverse anaesthesia events - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

public function overall_CQI3d4_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3d4';
        $table_patients = 'bf_patients';
        $desc = 'desc';

        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Total anaesthesia cases',
            'Number of anaesthesia-related deaths',
            'Anaesthesia mortality rate (in %)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['total_cases'] = $data['total_cases'];
            $dataexport[$i]['deaths'] = $data['deaths'];
            $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3d4 - Anaesthesia related mortality rate - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

public function overall_CQI3d5_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3d5';
        $table_patients = 'bf_patients';
        $desc = 'desc';

        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Total prescriptions',
            'Number of safe and rational prescriptions',
            'Percentage of safe prescriptions (in %)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['total_prescriptions'] = $data['total_prescriptions'];
            $dataexport[$i]['safe_prescriptions'] = $data['safe_prescriptions'];
            $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3d5 - Percentage of safe and rational prescriptions - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}
public function overall_CQI3e1_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3e1';
        $table_patients = 'bf_patients';
        $desc = 'desc';

        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Total OT cases',
            'Number of unplanned returns to OT',
            'Percentage of unplanned returns (in %)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['total_cases'] = $data['total_cases'];
            $dataexport[$i]['unplanned_return'] = $data['unplanned_return'];
            $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3e1 - Percentage of unplanned return to OT - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

public function overall_CQI3e2_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3e2';
        $table_patients = 'bf_patients';
        $desc = 'desc';

        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Total OT cases',
            'Number of rescheduled surgeries',
            'Percentage of rescheduled surgeries (in %)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['total_cases'] = $data['total_cases'];
            $dataexport[$i]['rescheduled_cases'] = $data['rescheduled_cases'];
            $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3e2 - Percentage of rescheduling of surgeries - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}
public function overall_CQI3e3_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3e3';
        $table_patients = 'bf_patients';
        $desc = 'desc';

        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Total OT cases',
            'Number of cases with adherence to surgery error prevention procedure',
            'Percentage adherence (in %)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['total_cases'] = $data['total_cases'];
            $dataexport[$i]['adherence_cases'] = $data['adherence_cases'];
            $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3e3 - Adherence to surgery error prevention procedure - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

public function overall_CQI3e4_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3e4';
        $table_patients = 'bf_patients';
        $desc = 'desc';

        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Total cases receiving surgery',
            'Number of cases receiving prophylactic antibiotics on time',
            'Percentage compliance (in %)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['total_cases'] = $data['total_cases'];
            $dataexport[$i]['on_time_antibiotics'] = $data['on_time_antibiotics'];
            $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3e4 - Prophylactic antibiotics compliance - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

public function overall_CQI3e5_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3e5';
        $table_patients = 'bf_patients';
        $desc = 'desc';

        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Total planned surgeries',
            'Number of surgeries changed intraoperatively',
            'Percentage changed (in %)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['total_surgeries'] = $data['total_surgeries'];
            $dataexport[$i]['changed_surgeries'] = $data['changed_surgeries'];
            $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3e5 - Surgeries changed intraoperatively - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

public function overall_CQI3e6_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3e6';
        $table_patients = 'bf_patients';
        $desc = 'desc';

        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Total OT cases',
            'Number of re-explorations',
            'Re-exploration rate (in %)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['total_cases'] = $data['total_cases'];
            $dataexport[$i]['reexplorations'] = $data['reexplorations'];
            $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3e6 - Re-exploration rate - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

public function overall_CQI3e7_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3e7';
        $table_patients = 'bf_patients';
        $desc = 'desc';

        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Total deliveries',
            'Number of primary cesareans',
            'Primary Cesarean Rate (in %)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['total_deliveries'] = $data['total_deliveries'];
            $dataexport[$i]['primary_cesareans'] = $data['primary_cesareans'];
            $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3e7 - Primary Cesarean Rate - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

public function overall_CQI3e8_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3e8';
        $table_patients = 'bf_patients';
        $desc = 'desc';

        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Total implant cases',
            'Number of adverse events related to implant devices',
            'Adverse event rate (in %)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['total_cases'] = $data['total_cases'];
            $dataexport[$i]['adverse_events'] = $data['adverse_events'];
            $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3e8 - Adverse events related to implant devices - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

public function overall_CQI3e9_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3e9';
        $table_patients = 'bf_patients';
        $desc = 'desc';

        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Total surgical cases',
            'Number of major patient safety events',
            'Event rate (in %)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['total_cases'] = $data['total_cases'];
            $dataexport[$i]['major_events'] = $data['major_events'];
            $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3e9 - Major patient safety events in surgical procedures - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}
public function overall_CQI3f1_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3f1';
        $table_patients = 'bf_patients';
        $desc = 'desc';

        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Total transfusions',
            'Number of transfusion reactions',
            'Percentage of transfusion reactions (in %)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['total_transfusions'] = $data['total_transfusions'];
            $dataexport[$i]['reactions'] = $data['reactions'];
            $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3f1 - Percentage of transfusion reactions - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

public function overall_CQI3f2_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3f2';
        $table_patients = 'bf_patients';
        $desc = 'desc';

        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Total blood units issued',
            'Number of wasted units among issued',
            'Percentage waste among issued (in %)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['total_units_issued'] = $data['total_units_issued'];
            $dataexport[$i]['wasted_units'] = $data['wasted_units'];
            $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3f2 - Percentage of waste among issued blood units - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}
public function overall_CQI3f3_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3f3';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Total blood units stored',
            'Number of wasted units among stored',
            'Percentage waste among stored (in %)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['total_units_stored'] = $data['total_units_stored'];
            $dataexport[$i]['wasted_units_stored'] = $data['wasted_units_stored'];
            $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3f3 - Percentage of waste among stored blood units - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

public function overall_CQI3f4_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3f4';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Total blood component units used',
            'Total patients receiving transfusions',
            'Percentage of blood component units used (in %)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['total_units_used'] = $data['total_units_used'];
            $dataexport[$i]['total_patients'] = $data['total_patients'];
            $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3f4 - Percentage of blood component units used - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

public function overall_CQI3f5_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3f5';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Sum of turnaround time for cross matched/reserved blood (in Hrs)',
            'Total number of requests',
            'Average turnaround time (in Hrs)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['turnaround_total'] = $data['turnaround_total'];
            $dataexport[$i]['total_requests'] = $data['total_requests'];
            $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3f5 - Turnaround time for cross matched/reserved blood - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}
public function overall_CQI3f6_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3f6';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Number of adverse/near miss events in blood/transfusion services',
            'Total transfusions/units',
            'Percentage of adverse/near miss events (in %)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['adverse_events'] = $data['adverse_events'];
            $dataexport[$i]['total_units'] = $data['total_units'];
            $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3f6 - Adverse/Near miss events in blood/transfusion - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

public function overall_CQI3f7_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3f7';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Total blood units required',
            'Total units available',
            'Blood availability rate (in %)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['units_required'] = $data['units_required'];
            $dataexport[$i]['units_available'] = $data['units_available'];
            $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3f7 - Blood availability rate - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

public function overall_CQI3f8_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3f8';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Total units cross matched',
            'Total units transfused',
            'CT Ratio (cross match to transfusion)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['units_cross_matched'] = $data['units_cross_matched'];
            $dataexport[$i]['units_transfused'] = $data['units_transfused'];
            $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3f8 - CT Ratio (Cross match to transfusion) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

public function overall_CQI3f9_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3f9';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Sum of turnaround time for Platelet Apheresis (in Hrs)',
            'Total number of procedures',
            'Average turnaround time (in Hrs)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['turnaround_total'] = $data['turnaround_total'];
            $dataexport[$i]['total_procedures'] = $data['total_procedures'];
            $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3f9 - Turnaround time for Platelet Apheresis - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

public function overall_CQI3f10_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3f10';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Sum of turnaround time for blood donation (in Hrs)',
            'Total donors',
            'Average turnaround time (in Hrs)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['turnaround_total'] = $data['turnaround_total'];
            $dataexport[$i]['total_donors'] = $data['total_donors'];
            $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3f10 - Turnaround time for blood donation - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}
public function overall_CQI3g1_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3g1';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Number of catheter-associated UTIs',
            'Total catheter-days',
            'CAUTI Rate (per 1000 catheter days)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['num_infections'] = $data['num_infections'];
            $dataexport[$i]['total_catheter_days'] = $data['total_catheter_days'];
            $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3g1 - Catheter associated UTI rate - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

public function overall_CQI3g2_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3g2';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Number of ventilator-associated pneumonias',
            'Total ventilator days',
            'VAP Rate (per 1000 ventilator days)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['num_vap'] = $data['num_vap'];
            $dataexport[$i]['total_vent_days'] = $data['total_vent_days'];
            $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3g2 - VAP rate - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

public function overall_CQI3g3_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3g3';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Number of CLABSI events',
            'Total central line days',
            'CLABSI Rate (per 1000 central line days)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['num_clabsi'] = $data['num_clabsi'];
            $dataexport[$i]['total_central_line_days'] = $data['total_central_line_days'];
            $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3g3 - CLABSI rate - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

public function overall_CQI3g4_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3g4';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Number of surgical site infections',
            'Total number of surgeries',
            'SSI Rate (in %)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['num_ssi'] = $data['num_ssi'];
            $dataexport[$i]['total_surgeries'] = $data['total_surgeries'];
            $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3g4 - Surgical Site Infection rate - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

public function overall_CQI3g5_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3g5';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Number of late onset sepsis cases (>72 hrs)',
            'Total NICU admissions',
            'Late Onset Sepsis Rate (in %)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['num_late_sepsis'] = $data['num_late_sepsis'];
            $dataexport[$i]['total_nicu'] = $data['total_nicu'];
            $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3g5 - Late Onset Sepsis Rate - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

public function overall_CQI3g6_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3g6';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Number of environmental cleaning audits conducted',
            'Total cleaning audits planned',
            'Compliance rate (%)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['num_audits'] = $data['num_audits'];
            $dataexport[$i]['total_audits'] = $data['total_audits'];
            $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3g6 - Environmental cleaning & disinfection compliance - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}
public function overall_CQI3h1_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3h1';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Number of deaths',
            'Total in-patients (MRD)',
            'Mortality rate (%)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['num_deaths'] = $data['num_deaths'];
            $dataexport[$i]['total_inpatients'] = $data['total_inpatients'];
            $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3h1 - Mortality rate (MRD) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

public function overall_CQI3h2_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3h2';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Number of ICU1 readmissions within 48 hours',
            'Total ICU1 discharges',
            'Return to ICU within 48 hours (%)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['num_readmissions'] = $data['num_readmissions'];
            $dataexport[$i]['total_discharges'] = $data['total_discharges'];
            $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3h2 - Return to ICU within 48 hours (ICU1) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

public function overall_CQI3h3_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3h3';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Number of ICU2 readmissions within 48 hours',
            'Total ICU2 discharges',
            'Return to ICU 2 within 48 hours (%)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['num_readmissions'] = $data['num_readmissions'];
            $dataexport[$i]['total_discharges'] = $data['total_discharges'];
            $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3h3 - Return to ICU 2 within 48 hours (ICU2) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

public function overall_CQI3h4_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3h4';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Number of CICU readmissions within 48 hours',
            'Total CICU discharges',
            'Return to ICU 3 within 48 hours (%)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['num_readmissions'] = $data['num_readmissions'];
            $dataexport[$i]['total_discharges'] = $data['total_discharges'];
            $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3h4 - Return to ICU 3 within 48 hours (CICU) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

public function overall_CQI3h5_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3h5';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Number of ED returns after 72 hours',
            'Total ED discharges',
            'Return to emergency dept. after 72 hours (%)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['num_returns'] = $data['num_returns'];
            $dataexport[$i]['total_discharges'] = $data['total_discharges'];
            $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3h5 - Return to emergency department after 72 hours - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

public function overall_CQI3h6_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3h6';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Number of reintubations ICU1',
            'Total extubations ICU1',
            'Reintubation rate (%)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['num_reintubations'] = $data['num_reintubations'];
            $dataexport[$i]['total_extubations'] = $data['total_extubations'];
            $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3h6 - Reintubation rate ICU1 - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

public function overall_CQI3h7_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3h7';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Number of reintubations ICU2',
            'Total extubations ICU2',
            'Reintubation rate (%)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['num_reintubations'] = $data['num_reintubations'];
            $dataexport[$i]['total_extubations'] = $data['total_extubations'];
            $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3h7 - Reintubation rate ICU2 - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

public function overall_CQI3h8_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3h8';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Number of reintubations CICU',
            'Total extubations CICU',
            'Reintubation rate (%)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['num_reintubations'] = $data['num_reintubations'];
            $dataexport[$i]['total_extubations'] = $data['total_extubations'];
            $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3h8 - Reintubation rate CICU - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

public function overall_CQI3h9_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3h9';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Number of NICU readmissions',
            'Total NICU discharges',
            'Re Admission Rate (%)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['num_readmissions'] = $data['num_readmissions'];
            $dataexport[$i]['total_discharges'] = $data['total_discharges'];
            $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3h9 - Re Admission Rate NICU - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}
public function overall_CQI3j1_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3j1';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Shift change handover communication (Nurses) ED/ICU/Ward',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['handover'] = $data['handover'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3j1 - Shift change handover communication (Nurses ED/ICU/Ward) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

public function overall_CQI3j2_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3j2';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Shift change handover communication (Nurses) ED/ICU/Ward - ICU',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['handover'] = $data['handover'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3j2 - Shift change handover communication (Nurses ICU) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

public function overall_CQI3j3_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3j3';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Shift change handover communication (Nurses) ED/ICU/Ward - Ward',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['handover'] = $data['handover'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3j3 - Shift change handover communication (Nurses Ward) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

public function overall_CQI3j4_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3j4';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Incidence of patient identification error (Quality Office)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['error_incidence'] = $data['error_incidence'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3j4 - Incidence of patient identification error - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

public function overall_CQI3j5_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3j5';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Number of missed hand hygiene opportunities (Infection Control - Nursing)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['missed_hygiene'] = $data['missed_hygiene'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3j5 - Missed hand hygiene opportunities - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

public function overall_CQI3j6_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3j6';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Compliance rate to medication prescription in capitals (Clinical Pharmacy)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['compliance'] = $data['compliance'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3j6 - Compliance to medication prescription - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

public function overall_CQI3j7_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3j7';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Shift change handover communication (Doctors) (MRD - Emergency Department)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['handover'] = $data['handover'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3j7 - Shift change handover (Doctors ED) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

public function overall_CQI3j8_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3j8';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Shift change handover communication (Doctors) - MRD ICU',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['handover'] = $data['handover'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3j8 - Shift change handover (Doctors ICU) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

public function overall_CQI3j9_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3j9';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Compliance to patient identification - IPD (Nursing)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['compliance'] = $data['compliance'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3j9 - Compliance to patient identification - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

public function overall_CQI3j10_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3j10';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Compliance rate of timeliness of reporting Critical results in Radiology (within 30 min)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['timeliness'] = $data['timeliness'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3j10 - Timeliness of reporting Critical results in Radiology - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}
public function overall_CQI3j11_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3j11';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'IPSG 2.2 - Hand off communication interdepartmental shift (MRD - Emergency Department)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['handoff'] = $data['handoff'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3j11 - IPSG 2.2 Hand off MRD-ED - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

public function overall_CQI3j12_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3j12';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'IPSG 2.2 - Hand off communication interdepartmental shift (MRD - ICU)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['handoff'] = $data['handoff'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3j12 - IPSG 2.2 Hand off MRD-ICU - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

public function overall_CQI3j13_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3j13';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'IPSG 2.2 - Hand off communication interdepartmental Shift(Nurses) - Nursing - Emergency Department',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['handoff'] = $data['handoff'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3j13 - IPSG 2.2 Hand off ED Nurses - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

public function overall_CQI3j14_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3j14';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'IPSG 2.2 - Hand off communication interdepartmental Shift(Nurses) - Nursing - ICU',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['handoff'] = $data['handoff'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3j14 - IPSG 2.2 Hand off ICU Nurses - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

public function overall_CQI3j15_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3j15';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'IPSG 2.2 - Hand off communication interdepartmental Shift(Nurses) - Nursing - Ward',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['handoff'] = $data['handoff'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3j15 - IPSG 2.2 Hand off Ward Nurses - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

public function overall_CQI3j16_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3j16';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'IPSG 2.2 - Hand off communication among doctors (During shift change) - MRD - Emergency Department',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['handoff'] = $data['handoff'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3j16 - Hand off Doctors ED - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

public function overall_CQI3j17_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3j17';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'IPSG 2.2 - Hand off communication among doctors (During shift change) - MRD - ICU',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['handoff'] = $data['handoff'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3j17 - Hand off Doctors ICU - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

public function overall_CQI3j18_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3j18';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'IPSG 2.2 - Hand off communication among nurses (During shift change) - Nursing - Emergency Department',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['handoff'] = $data['handoff'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3j18 - Hand off Nurses ED - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

public function overall_CQI3j19_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3j19';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'IPSG 2.2 - Hand off communication among nurses (During shift change) - Nursing - ICU',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['handoff'] = $data['handoff'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3j19 - Hand off Nurses ICU - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

public function overall_CQI3j20_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3j20';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'IPSG 2.2 - Hand off communication among nurses (During shift change) - Nursing - Ward',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['handoff'] = $data['handoff'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3j20 - Hand off Nurses Ward - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}
public function overall_CQI3j21_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3j21';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'IPSG 4 - Ensure correct site, correct procedure, correct patient surgery - Quality Office - Endoscopy',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3j21 - Correct site surgery Endoscopy - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

public function overall_CQI3j22_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3j22';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'IPSG 4 - Ensure correct site, correct procedure, correct patient surgery - Quality Office - ICU',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3j22 - Correct site surgery ICU - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

public function overall_CQI3j23_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3j23';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'IPSG 4 - Ensure correct site, correct procedure, correct patient surgery - Quality Office - OT',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3j23 - Correct site surgery OT - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

public function overall_CQI3j24_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3j24';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'PSG 6 - Compliance to Fall prevention measures in IPD - Nursing - IPD',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3j24 - Fall prevention IPD - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

public function overall_CQI3j25_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3j25';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'PSG 6 - Compliance to Fall prevention measures in OPD - Nursing - OPD',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3j25 - Fall prevention OPD - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}
public function overall_CQI3j26_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3j26';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'IPSG 6 - Compliance to Fall prevention measures in Physiotherapy OP patients - Physical therapy and Rehabilitation Department - Physiotherapy',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3j26 - Fall prevention Physiotherapy OP - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

public function overall_CQI3j27_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3j27';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Compliance to hand hygiene practice (New) - Infection Control - Nursing',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3j27 - Hand hygiene compliance - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

public function overall_CQI3j28_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3j28';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Compliance to patient identification OPD - Nursing - OPD',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3j28 - Patient ID compliance OPD - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

public function overall_CQI3j29_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3j29';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Shift change handover communication (Doctors - ward) - Medical Administration',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3j29 - Handover Doctors Ward - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

public function overall_CQI3j30_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3j30';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Incidence of Adverse events in Physiotherapy (IPD) - Physical therapy and Rehabilitation Department - Physiotherapy',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3j30 - Adverse events Physiotherapy IPD - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}
public function overall_CQI3j31_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3j31';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Incidence of Adverse events in Physiotherapy (OPD) - Physical therapy and Rehabilitation Department - Physiotherapy',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3j31 - Adverse events Physiotherapy OPD - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

public function overall_CQI3j32_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3j32';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'IPSG 4 - Ensure correct site, correct procedure, correct patient surgery - Quality Office - OT',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3j32 - Correct site procedure OT - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

public function overall_CQI3j33_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3j33';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Security incidents rate (JCI8-FMS 4.0) - Safety & Security',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3j33 - Security incidents rate - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

public function overall_CQI3j34_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3j34';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Safety incidents rate (JCI8-FMS 3.0)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3j34 - Safety incidents rate - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}
// CQI4a1 - Percentage of drugs and consumables procured by local purchases within the formulary (Pharmacy)
public function overall_CQI4a1_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4a1';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Percentage of drugs and consumables procured by local purchases within the formulary (Pharmacy)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4a1 - Local purchases within formulary - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// CQI4a2 - Percentage of drugs and consumables procured by local purchase outside the formulary (Pharmacy)
public function overall_CQI4a2_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4a2';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Percentage of drugs and consumables procured by local purchase outside the formulary (Pharmacy)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4a2 - Local purchases outside formulary - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}
// CQI4a3 - Stock out rate of emergency medications (Pharmacy)
public function overall_CQI4a3_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4a3';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Stock out rate of emergency medications (Pharmacy)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4a3 - Stock out rate of emergency medications - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// CQI4a4 - Percentage of drugs and consumables rejected before preparation of Goods Receipt Note (SCM-Store)
public function overall_CQI4a4_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4a4';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Percentage of drugs and consumables rejected before preparation of Goods Receipt Note (SCM-Store)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4a4 - Rejected drugs/consumables before GRN - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// CQI4a5 - Percentage of variations from procurement process (SCM-Purchase)
public function overall_CQI4a5_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4a5';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Percentage of variations from procurement process (SCM-Purchase)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4a5 - Variations from procurement process - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}
// CQI4b1 - Incidence of bed sores (hospital associated pressure ulcers) after admission (in 1000 patient days) - Nursing
public function overall_CQI4b1_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4b1';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Incidence of bed sores (hospital associated pressure ulcers) after admission (in 1000 patient days) - Nursing',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4b1 - Incidence of bed sores - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// CQI4b2 - Incidence of falls (in 1000 IPD days) - Office-Quality
public function overall_CQI4b2_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4b2';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Incidence of falls (in 1000 IPD days) - Office-Quality',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4b2 - Incidence of falls - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// CQI4b3 - Number of variations observed in mock drill (Safety & Security)
public function overall_CQI4b3_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4b3';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Number of variations observed in mock drill (Safety & Security)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4b3 - Mock drill variations - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// CQI4b4 - Percentage of staff provided with pre-exposure prophylaxis (Infection Control)
public function overall_CQI4b4_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4b4';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Percentage of staff provided with pre-exposure prophylaxis (Infection Control)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4b4 - Pre-exposure prophylaxis - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// CQI4b5 - Number of Fire Incidents (Safety & Security)
public function overall_CQI4b5_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4b5';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Number of Fire Incidents (Safety & Security)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4b5 - Fire Incidents - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// CQI4b6 - Incidence of device associated pressure ulcer after admission (Nursing)
public function overall_CQI4b6_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4b6';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Incidence of device associated pressure ulcer after admission (Nursing)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4b6 - Device associated pressure ulcer - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// CQI4b7 - Number of Extravasation (Nursing)
public function overall_CQI4b7_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4b7';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Number of Extravasation (Nursing)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4b7 - Extravasation - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// CQI4b8 - Monitoring of Clinical Errors (JCI8-PCC 2.3) - Quality Office
public function overall_CQI4b8_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4b8';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Monitoring of Clinical Errors (JCI8-PCC 2.3) - Quality Office',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4b8 - Clinical Errors Monitoring - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}
// CQI4c1 - Bed occupancy rate (MRD)
public function overall_CQI4c1_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4c1';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Bed occupancy rate (MRD)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4c1 - Bed occupancy rate - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// CQI4c2 - Average length of stay (MRD)
public function overall_CQI4c2_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4c2';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Average length of stay (MRD)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4c2 - Average length of stay - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// CQI4c3 - OT Utilisation Rate (OT)
public function overall_CQI4c3_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4c3';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'OT Utilisation Rate (OT)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4c3 - OT Utilisation Rate - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}
// CQI4c4 - ICU equipment utilisation rate (Nursing - ICU1)
public function overall_CQI4c4_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4c4';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'ICU equipment utilisation rate (Nursing - ICU1)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4c4 - ICU equipment utilisation rate (ICU1) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// CQI4c5 - ICU equipment utilisation rate (Nursing - ICU2)
public function overall_CQI4c5_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4c5';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'ICU equipment utilisation rate (Nursing - ICU2)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4c5 - ICU equipment utilisation rate (ICU2) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// CQI4c6 - ICU equipment utilisation rate (Nursing - ICU3)
public function overall_CQI4c6_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4c6';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'ICU equipment utilisation rate (Nursing - ICU3)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4c6 - ICU equipment utilisation rate (ICU3) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// CQI4c7 - ICU Bed utilisation rate (Nursing - ICU)
public function overall_CQI4c7_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4c7';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'ICU Bed utilisation rate (Nursing - ICU)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4c7 - ICU Bed utilisation rate - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}
// CQI4c8 - Critical equipment downtime (Biomedical Engineering)
public function overall_CQI4c8_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4c8';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Critical equipment downtime (Biomedical Engineering)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4c8 - Critical equipment downtime - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// CQI4c9 - Cath lab utilization rate (Cath Lab - Nursing)
public function overall_CQI4c9_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4c9';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Cath lab utilization rate (Cath Lab - Nursing)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4c9 - Cath lab utilization rate - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// CQI4c10 - Nurse patient ratio for ICU Ventilated (Nursing-ICU)
public function overall_CQI4c10_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4c10';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Nurse patient ratio for ICU Ventilated (Nursing-ICU)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4c10 - Nurse patient ratio for ICU Ventilated - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// CQI4c11 - Nurse patient ratio for ICU Non Ventilated (Nursing-ICU)
public function overall_CQI4c11_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4c11';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Nurse patient ratio for ICU Non Ventilated (Nursing-ICU)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4c11 - Nurse patient ratio for ICU Non Ventilated - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// CQI4c12 - Nurse patient ratio for HDU (Nursing-HDU)
public function overall_CQI4c12_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4c12';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Nurse patient ratio for HDU (Nursing-HDU)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4c12 - Nurse patient ratio for HDU - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// CQI4c13 - Nurse patient ratio for Ward (Nursing-Ward)
public function overall_CQI4c13_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4c13';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Nurse patient ratio for Ward (Nursing-Ward)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4c13 - Nurse patient ratio for Ward - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// CQI4c14 - Engineering Critical equipment downtime (Engineering & Maintenance)
public function overall_CQI4c14_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4c14';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Engineering Critical equipment downtime',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4c14 - Engineering Critical equipment downtime - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}
// CQI4d1 - Out patient satisfaction index (Patient Care Services - OPD)
public function overall_CQI4d1_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4d1';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Out patient satisfaction index (Patient Care Services - OPD)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4d1 - Out patient satisfaction index - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// CQI4d2 - Inpatient satisfaction index (Patient Care Services - IPD)
public function overall_CQI4d2_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4d2';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Inpatient satisfaction index (Patient Care Services - IPD)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4d2 - Inpatient satisfaction index - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// CQI4d3 - Time taken for discharge - Cash Patients (Patient Care Services - Cash)
public function overall_CQI4d3_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4d3';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Time taken for discharge - Cash Patients (Patient Care Services - Cash)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4d3 - Time taken for discharge - Cash Patients - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// CQI4d4 - Time taken for discharge Cashless Patients (Patient Care Services - Cashless)
public function overall_CQI4d4_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4d4';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Time taken for discharge Cashless Patients (Patient Care Services - Cashless)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4d4 - Time taken for discharge Cashless Patients - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}
// CQI4d5 - Waiting time for diagnostic services (Radiology - CT)
public function overall_CQI4d5_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4d5';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Waiting time for diagnostic services (Radiology - CT)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4d5 - Waiting time for diagnostic services (CT) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// CQI4d6 - Waiting time for diagnostic services (Radiology - MRI)
public function overall_CQI4d6_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4d6';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Waiting time for diagnostic services (Radiology - MRI)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4d6 - Waiting time for diagnostic services (MRI) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// CQI4d7 - Waiting time for diagnostic services (Radiology - USG)
public function overall_CQI4d7_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4d7';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Waiting time for diagnostic services (Radiology - USG)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4d7 - Waiting time for diagnostic services (USG) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// CQI4d8 - Waiting Time for OPD appointments (Patient Care Services - OPD)
public function overall_CQI4d8_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4d8';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Waiting Time for OPD appointments (Patient Care Services - OPD)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4d8 - Waiting Time for OPD appointments - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// CQI4d9 - Waiting Time for OPD Walkin (Patient Care Services - OPD)
public function overall_CQI4d9_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4d9';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Waiting Time for OPD Walkin (Patient Care Services - OPD)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4d9 - Waiting Time for OPD Walkin - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// CQI4d10 - Patient Satisfaction Rate (Nursing - OBG)
public function overall_CQI4d10_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4d10';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Patient Satisfaction Rate (Nursing - OBG)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4d10 - Patient Satisfaction Rate - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// CQI4d11 - Turn-around Time for Nursing call bell responds (Nursing)
public function overall_CQI4d11_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4d11';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Turn-around Time for Nursing call bell responds (Nursing)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4d11 - Turn-around Time for Nursing call bell responds - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}
// CQI4e1 - Employee satisfaction index (HR)
public function overall_CQI4e1_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4e1';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Employee satisfaction index (HR)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4e1 - Employee satisfaction index - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// CQI4e2 - Employee attrition rate (HR)
public function overall_CQI4e2_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4e2';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Employee attrition rate (HR)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4e2 - Employee attrition rate - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// CQI4e3 - Employee absenteeism rate (HR)
public function overall_CQI4e3_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4e3';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Employee absenteeism rate (HR)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4e3 - Employee absenteeism rate - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// CQI4e4 - Percentage of employees aware of rights, responsibility and welfare schemes (HR)
public function overall_CQI4e4_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4e4';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Percentage of employees aware of rights, responsibility and welfare schemes (HR)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4e4 - Employees aware of rights & welfare - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// CQI4e5 - Average number of training hours (HR)
public function overall_CQI4e5_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4e5';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Average number of training hours (HR)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4e5 - Average training hours - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// CQI4e6 - Nurses Attrition Rate (Nursing)
public function overall_CQI4e6_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4e6';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Nurses Attrition Rate (Nursing)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4e6 - Nurses Attrition Rate - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// CQI4e7 - Outsourced employee absenteeism rate (Nursing Assistants) (Patient Care Services - OPD)
public function overall_CQI4e7_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4e7';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Outsourced employee absenteeism rate (Nursing Assistants) - OPD',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4e7 - Outsourced absenteeism rate - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// CQI4e8 - Average number of unpaid leave per month (HR)
public function overall_CQI4e8_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4e8';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Average number of unpaid leave per month (HR)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4e8 - Average unpaid leave - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}
// CQI4f1 - Incidence of needle stick injuries IPD area (in 1000 IPD days) (Infection Control - IPD)
public function overall_CQI4f1_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4f1';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Incidence of needle stick injuries IPD area (in 1000 IPD days)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4f1 - Needle Stick Injuries IPD - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// CQI4f2 - Incidence of needle stick injuries OPD area (in 1000 OPD days) (Infection Control - OPD)
public function overall_CQI4f2_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4f2';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Incidence of needle stick injuries OPD area (in 1000 OPD days)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4f2 - Needle Stick Injuries OPD - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// CQI4f3 - Percentage of sentinel events, reported, collected and analysed within defined time frame (Quality Office)
public function overall_CQI4f3_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4f3';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Percentage of sentinel events reported, collected & analysed',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4f3 - Sentinel Events - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// CQI4f4 - Percentage of near misses (Quality Office)
public function overall_CQI4f4_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4f4';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Percentage of near misses',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4f4 - Near Misses - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// CQI4f5 - Incidence of blood body fluid exposure IPD (Infection Control - IPD)
public function overall_CQI4f5_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4f5';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Incidence of blood body fluid exposure IPD',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4f5 - Blood Body Fluid Exposure IPD - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// CQI4f6 - Incidence of blood body fluid exposure OPD (Infection Control - OPD)
public function overall_CQI4f6_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4f6';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Incidence of blood body fluid exposure OPD',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4f6 - Blood Body Fluid Exposure OPD - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// CQI4f7 - Adverse events related to SUDs (JCI8-PCI 3.1) (CSSD)
public function overall_CQI4f7_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4f7';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Adverse events related to SUDs (JCI8-PCI 3.1)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4f7 - Adverse Events SUDs - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}
// CQI4g1 - Percentage of Medical records not having discharge summary (MRD)
public function overall_CQI4g1_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4g1';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Percentage of Medical records not having discharge summary',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4g1 - Discharge Summary Missing - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// CQI4g2 - Percentage of Medical records not having codification as per ICD (MRD)
public function overall_CQI4g2_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4g2';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Percentage of Medical records not having codification as per ICD',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4g2 - ICD Codification Missing - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// CQI4g3 - Percentage of Medical records having improper or incomplete consent (MRD)
public function overall_CQI4g3_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4g3';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Percentage of Medical records having improper or incomplete consent',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4g3 - Incomplete Consent - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// CQI4g4 - Percentage of missing medical records (MRD)
public function overall_CQI4g4_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4g4';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Percentage of missing medical records',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4g4 - Missing Medical Records - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}
// CQI4g5 - Compliance rate of adhering with policies and procedures for care of patients at risk for suicide and self-harm (JCI8-COP 5) (MRD)
public function overall_CQI4g5_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4g5';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Compliance rate of adhering with policies and procedures for care of patients at risk for suicide and self-harm',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4g5 - Suicide/Self-Harm Policy Compliance - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}
// CQI4g6 - Monthly Abbreviation Compliance(MRD)
public function overall_CQI4g6_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4g6';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Monthly Abbreviation Compliance',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4g6 - Monthly Abbreviation Compliance - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// CQI3k1 - Total number of LAMA cases with Reasons (MRD)
public function overall_CQI3k1_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3k1';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Total number of LAMA cases with Reasons',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3k1 - Total LAMA Cases with Reasons - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// CQI3k2 - Adverse events due to handover(Quality Office)
public function overall_CQI3k2_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3k2';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Adverse events due to handover',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3k2 - Adverse Events due to Handover - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}
// CQI3k3 - Inguinal herniorrhaphy with mesh (Infection Control)
public function overall_CQI3k3_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3k3';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Inguinal herniorrhaphy with mesh',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3k3 - Inguinal Herniorrhaphy with Mesh - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// CQI3k4 - Coronary artery bypass grafting (CABG) (Infection Control)
public function overall_CQI3k4_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3k4';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Coronary artery bypass grafting (CABG)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3k4 - CABG - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// CQI3k5 - Laparoscopic cholecystectomy (Infection Control)
public function overall_CQI3k5_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3k5';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Laparoscopic cholecystectomy',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3k5 - Laparoscopic Cholecystectomy - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// CQI3k6 - Monitoring the duration of antibiotic usage in surgical prophylaxis (After 48 hours) (Clinical Pharmacy)
public function overall_CQI3k6_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3k6';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Monitoring the duration of antibiotic usage in surgical prophylaxis (After 48 hours)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3k6 - Antibiotic Usage Monitoring - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// CQI3k7 - De-escalation of antibiotics (Clinical Pharmacy)
public function overall_CQI3k7_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3k7';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'De-escalation of antibiotics',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3k7 - De-escalation of Antibiotics - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// CQI3k8 - High Alert Medication Segregation, storage & labelling Compliance rate (Pharmacy - Store)
public function overall_CQI3k8_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3k8';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'High Alert Medication Segregation, Storage & Labelling Compliance rate',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3k8 - High Alert Medication Compliance - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}
// CQI3k9 - Average recovery time (OT - Post OP)
public function overall_CQI3k9_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3k9';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Average recovery time (OT - Post OP)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3k9 - Average Recovery Time (OT - Post OP) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}


// CQI3k10 - Door to thrombolysis time in ischemic stroke in ER (Emergency Department)
public function overall_CQI3k10_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3k10';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Door to thrombolysis time in ischemic stroke in ER (Emergency Department)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3k10 - Door to Thrombolysis Time (ER) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}


// CQI3k11 - Door to image time in Stroke patients (Emergency Department)
public function overall_CQI3k11_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3k11';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Door to image time in Stroke patients (Emergency Department)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3k11 - Door to Image Time (Stroke Patients) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}


// CQI3k12 - Average number of patients visiting Emergency per day (Emergency Department)
public function overall_CQI3k12_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3k12';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Average number of patients visiting Emergency per day (Emergency Department)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3k12 - Avg Emergency Patients per Day - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}


// CQI3k13 - Efficiency of code blue team (Emergency Department)
public function overall_CQI3k13_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3k13';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Efficiency of code blue team (Emergency Department)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3k13 - Efficiency of Code Blue Team - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}


// CQI3k14 - Time for first defibrillation (Emergency Department)
public function overall_CQI3k14_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3k14';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Time for first defibrillation (Emergency Department)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3k14 - Time for First Defibrillation - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}


// CQI3k15 - Door to Balloon time in PTCA (Cath Lab)
public function overall_CQI3k15_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3k15';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Door to Balloon time in PTCA (Cath Lab)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3k15 - Door to Balloon Time (PTCA) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}
// CQI3k16 - Compliance to diet order (Clinical Nutrition and Dietetics)
public function overall_CQI3k16_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3k16';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Compliance to diet order (Clinical Nutrition and Dietetics)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3k16 - Compliance to Diet Order (Clinical Nutrition and Dietetics) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}


// CQI3k17 - Case Fatality 1 - CAD (MRD)
public function overall_CQI3k17_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3k17';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Case Fatality 1 - CAD (MRD)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3k17 - Case Fatality 1 CAD (MRD) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}


// CQI3k18 - Case Fatality 2 - Acute coronary syndrome (MRD)
public function overall_CQI3k18_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3k18';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Case Fatality 2 - Acute coronary syndrome (MRD)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3k18 - Case Fatality 2 Acute Coronary Syndrome (MRD) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}


// CQI3k19 - Case Fatality 3 - Cerebral infarction (MRD)
public function overall_CQI3k19_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3k19';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Case Fatality 3 - Cerebral infarction (MRD)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3k19 - Case Fatality 3 Cerebral Infarction (MRD) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}


// CQI3k20 - Case Fatality 4 - MI (MRD)
public function overall_CQI3k20_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3k20';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Case Fatality 4 - MI (MRD)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3k20 - Case Fatality 4 MI (MRD) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}


// CQI3k21 - Case Fatality 5 - Heart failure (MRD)
public function overall_CQI3k21_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3k21';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Case Fatality 5 - Heart failure (MRD)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3k21 - Case Fatality 5 Heart Failure (MRD) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}


// CQI3k22 - Compliances in patient transfer and transportation process (External transfer) - (Emergency Department)
public function overall_CQI3k22_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3k22';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Compliances in patient transfer and transportation process (External transfer) - (Emergency Department)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3k22 - Compliance in Patient Transfer (External - Emergency) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}
// CQI3k23 - Number of Adverse Events During Patient Transfers (Out Side) (Emergency Department)
public function overall_CQI3k23_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3k23';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Number of Adverse Events During Patient Transfers (Out Side)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3k23 - Adverse Events During Patient Transfers - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// CQI3k24 - ILC/EQAS compliance rate (Lab Services)
public function overall_CQI3k24_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3k24';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'ILC/EQAS compliance rate',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3k24 - ILC EQAS Compliance Rate - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// CQI3k25 - Compliance with Biological Indicator (CSSD)
public function overall_CQI3k25_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3k25';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Compliance with Biological Indicator',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3k25 - Compliance with Biological Indicator - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// CQI3k26 - Compliance to risk assessment in reprocessing of SUMD (CSSD)
public function overall_CQI3k26_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3k26';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Compliance to risk assessment in reprocessing of SUMD',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3k26 - Compliance to SUMD Risk Assessment - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// CQI3k27 - Non-compliance to Copy and Paste Policy (MRD)
public function overall_CQI3k27_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3k27';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Non-compliance to Copy and Paste Policy',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3k27 - Non-Compliance Copy Paste Policy - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// CQI3k28 - Compliance to POCT IQC Checking (Lab Services)
public function overall_CQI3k28_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3k28';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Compliance to POCT IQC Checking',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3k28 - Compliance to POCT IQC Checking - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// CQI3k29 - Case Fatality - COVID 19 (MRD)
public function overall_CQI3k29_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3k29';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Case Fatality - COVID 19',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3k29 - Case Fatality COVID 19 - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}
// âœ… CQI3k30 - Case Fatality - Stroke (MRD)
public function overall_CQI3k30_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3k30';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Case Fatality - Stroke',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3k30 - Case Fatality Stroke - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CQI3k31 - Post procedure complication rate - Colonoscopy (Endoscopy)
public function overall_CQI3k31_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3k31';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Post procedure complication rate - Colonoscopy',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3k31 - Post procedure complication rate Colonoscopy - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CQI3k32 - Polyp retrieval rate after colonoscopic polypectomy (Endoscopy)
public function overall_CQI3k32_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3k32';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Polyp retrieval rate after colonoscopic polypectomy',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3k32 - Polyp retrieval rate - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CQI3k33 - Survival rate for living donor kidney transplants (Nephrology)
public function overall_CQI3k33_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3k33';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Survival rate for living donor kidney transplants',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3k33 - Survival rate for living donor kidney transplants - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CQI3k34 - CAUTI Prevention Bundle compliance Rate (Infection Control)
public function overall_CQI3k34_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3k34';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'CAUTI Prevention Bundle compliance Rate',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3k34 - CAUTI Prevention Bundle compliance Rate - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CQI3k35 - Major Discrepancies between Preoperative and Postoperative Diagnosis (OT)
public function overall_CQI3k35_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3k35';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Major Discrepancies between Preoperative and Postoperative Diagnosis',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3k35 - Major Discrepancies Pre & Postoperative Diagnosis - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}
// âœ… CQI3k36 - Adverse Events Related to patient Identification (Quality Office)
public function overall_CQI3k36_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3k36';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Adverse Events Related to patient Identification',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3k36 - Adverse Events Related to patient Identification - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CQI3k37 - CLABSI Prevention Bundle compliance Rate (Infection Control)
public function overall_CQI3k37_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3k37';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'CLABSI Prevention Bundle compliance Rate',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3k37 - CLABSI Prevention Bundle compliance Rate - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CQI3k38 - SSI Prevention Bundle compliance Rate (Infection Control)
public function overall_CQI3k38_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3k38';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'SSI Prevention Bundle compliance Rate',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3k38 - SSI Prevention Bundle compliance Rate - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CQI3k39 - VAP Prevention Bundle compliance Rate (Infection Control)
public function overall_CQI3k39_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3k39';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'VAP Prevention Bundle compliance Rate',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3k39 - VAP Prevention Bundle compliance Rate - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CQI3k40 - Restraint related injuries among admitted patients (Nursing)
public function overall_CQI3k40_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3k40';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Restraint related injuries among admitted patients',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3k40 - Restraint related injuries - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}
// âœ… CQI3k41 - Rate of compliance for restraint consent policy (Nursing)
public function overall_CQI3k41_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3k41';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Rate of compliance for restraint consent policy (Nursing)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3k41 - Restraint Consent Policy Compliance - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}


// âœ… CQI3k42 - Percentage of Accidental removal of line (Nursing)
public function overall_CQI3k42_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3k42';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Percentage of Accidental removal of line (Nursing)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3k42 - Accidental Line Removal Rate - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}


// âœ… CQI3k43 - Significant hypotension necessitating termination of dialysis (Nursing)
public function overall_CQI3k43_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3k43';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Significant hypotension necessitating termination of dialysis (Nursing)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3k43 - Dialysis Hypotension Termination Cases - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}


// âœ… CQI3k44 - IPSG4 - Time out compliance in outside OT (Nursing)
public function overall_CQI3k44_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3k44';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'IPSG4 - Time out compliance in outside OT (Nursing)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3k44 - IPSG4 Time Out Compliance Outside OT - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}


// âœ… CQI3k45 - Percentage of cases where Initial assessment done in physiotherapy within 24 hours (IPD)
public function overall_CQI3k45_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3k45';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Initial assessment in physiotherapy within 24 hours (IPD)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3k45 - Physiotherapy Initial Assessment 24hr - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}


// âœ… CQI3k46 - Radiology TAT orders for CT (Radiology)
public function overall_CQI3k46_report()
{
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3k46';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Radiology TAT orders for CT (Radiology)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3k46 - Radiology TAT CT Orders - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}
// âœ… CQI3k47 - Radiology TAT orders for MRI (Radiology)
public function overall_CQI3k47_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3k47';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Radiology TAT orders for MRI (Radiology)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3k47 - Radiology TAT MRI Orders - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CQI3k48 - Radiology TAT orders for USG (Radiology)
public function overall_CQI3k48_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3k48';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Radiology TAT orders for USG (Radiology)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3k48 - Radiology TAT USG Orders - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CQI3k49 - Radiology TAT orders for X-ray (Radiology)
public function overall_CQI3k49_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3k49';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Radiology TAT orders for X-ray (Radiology)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3k49 - Radiology TAT X-ray Orders - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CQI3k50 - Site Marking Compliance Rate (OT)
public function overall_CQI3k50_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3k50';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Site Marking Compliance Rate (OT)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3k50 - Site Marking Compliance Rate (OT) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CQI3k51 - Time Out Compliance Rate (OT)
public function overall_CQI3k51_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3k51';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Time Out Compliance Rate (OT)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3k51 - Time Out Compliance Rate (OT) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CQI3k52 - Sign Out Compliance Rate (OT)
public function overall_CQI3k52_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3k52';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Sign Out Compliance Rate (OT)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3k52 - Sign Out Compliance Rate (OT) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CQI3k53 - Post transplant complication rate for Donor (Liver)-(Transplant Unit)
public function overall_CQI3k53_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3k53';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Post transplant complication rate for Donor (Liver)-(Transplant Unit)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3k53 - Post transplant complication rate (Donor-Liver) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CQI3k54 - Post transplant complication rate (Heart)-(Transplant Unit)
public function overall_CQI3k54_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3k54';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Post transplant complication rate (Heart)-(Transplant Unit)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3k54 - Post transplant complication rate (Heart) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CQI3k55 - Percentage of research activities approved by ethics committee (Research)
public function overall_CQI3k55_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3k55';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Percentage of research activities approved by ethics committee (Research)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3k55 - Percentage of Research Activities Approved by Ethics Committee - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}
// âœ… CQI3k56 - Percentage of patients withdrawing from the study (Research)
public function overall_CQI3k56_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3k56';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Percentage of patients withdrawing from the study (Research)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3k56 - Percentage of patients withdrawing from the study - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}


// âœ… CQI3k57 - Percentage of protocol violations/deviations reported (Research)
public function overall_CQI3k57_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3k57';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Percentage of protocol violations/deviations reported (Research)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3k57 - Protocol Violations Reported - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}


// âœ… CQI3k58 - Percentage of serious adverse events reported to ethics committee (Research)
public function overall_CQI3k58_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3k58';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Serious Adverse Events Reported to Ethics Committee (Research)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3k58 - Serious Adverse Events Reported - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}


// âœ… CQI3k59 - Percentage of cases where Initial assessment done in physiotherapy within 24 hours OPD
public function overall_CQI3k59_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3k59';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Initial assessment done in physiotherapy within 24 hours (Physical therapy and Rehabilitation Department - Medical records)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3k59 - Physiotherapy Assessment within 24hrs - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}


// âœ… CQI3k60 - Survival rate for living donor Liver transplants (Gastrointestinal Surgery)
public function overall_CQI3k60_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3k60';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Survival rate for living donor Liver transplants (Gastrointestinal Surgery)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3k60 - Survival rate for living donor Liver transplants - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}
// âœ… CQI3k61 - Return of spontaneous circulation (ROSC) achieving rate (JCI8-COP 4) - (Emergency Department)
public function overall_CQI3k61_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3k61';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Return of spontaneous circulation (ROSC) achieving rate (Emergency Department)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3k61 - ROSC Achieving Rate (Emergency Dept) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}


// âœ… CQI3k62 - Timeliness of initiation of advanced cardiovascular life support (ACLS) within 5 Min (JCI8-COP 4) - (Nursing)
public function overall_CQI3k62_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3k62';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Timeliness of initiation of ACLS within 5 Min (Nursing)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3k62 - Timeliness of ACLS within 5 Min (Nursing) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}


// âœ… CQI3k63 - Timeliness of staff response to cardiac arrest (JCI8-COP 4) - (Emergency Department)
public function overall_CQI3k63_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3k63';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Timeliness of staff response to cardiac arrest (Emergency Department)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3k63 - Timeliness of Staff Response to Cardiac Arrest - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}


// âœ… CQI3k64 - Rate to RRT response turn to Code blue (JCI8-COP 4) - (Nursing)
public function overall_CQI3k64_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI3k64';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Rate to RRT response turn to Code blue (Nursing)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI3k64 - RRT Response Turn to Code Blue (Nursing) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}
// âœ… CQI4h1 - Patient satisfaction index - Physiotherapy (Physical therapy and Rehabilitation Department)
public function overall_CQI4h1_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4h1';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Patient satisfaction index - Physiotherapy (Physical therapy and Rehabilitation Department)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4h1 - Patient Satisfaction Index Physiotherapy - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}


// âœ… CQI4h2 - TAT for radiology STAT orders (Radiology - CT)
public function overall_CQI4h2_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4h2';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'TAT for radiology STAT orders (Radiology - CT)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4h2 - Radiology STAT Orders CT - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}


// âœ… CQI4h3 - TAT for radiology STAT orders (Radiology - MRI)
public function overall_CQI4h3_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4h3';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'TAT for radiology STAT orders (Radiology - MRI)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4h3 - Radiology STAT Orders MRI - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}


// âœ… CQI4h4 - TAT for radiology STAT orders (Radiology - USG)
public function overall_CQI4h4_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4h4';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'TAT for radiology STAT orders (Radiology - USG)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4h4 - Radiology STAT Orders USG - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}


// âœ… CQI4h5 - HAZMAT compliance in radiology
public function overall_CQI4h5_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4h5';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'HAZMAT compliance in radiology',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4h5 - HAZMAT Compliance Radiology - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}
// âœ… CQI4h6 - TLD Reading Compliance (Radiology)
public function overall_CQI4h6_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4h6';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'TLD Reading Compliance (Radiology)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4h6 - TLD Reading Compliance (Radiology) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}
// âœ… CQI4h7 - Variance in Financial counselling (Patient Care Services - IPD)
public function overall_CQI4h7_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4h7';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Variance in Financial counselling (Patient Care Services - IPD)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4h7 - Variance in Financial counselling (IPD) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}
// âœ… CQI4h8 - Planned Discharge rate (Patient Care Services - IPD)
public function overall_CQI4h8_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4h8';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Planned Discharge rate (Patient Care Services - IPD)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4h8 - Planned Discharge rate (IPD) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}
// âœ… CQI4h9 - Incident report rate (Quality Office)
public function overall_CQI4h9_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4h9';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Incident report rate (Quality Office)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4h9 - Incident report rate (Quality Office) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}
// âœ… CQI4h10 - TAT for dispensing medicine - IP (Pharmacy)
public function overall_CQI4h10_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4h10';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'TAT for dispensing medicine - IP (Pharmacy)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4h10 - TAT for dispensing medicine - IP (Pharmacy) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}
// âœ… CQI4h11 - TAT for STAT medicine (Pharmacy)
public function overall_CQI4h11_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4h11';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'TAT for STAT medicine (Pharmacy)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4h11 - TAT for STAT medicine (Pharmacy) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CQI4h12 - Average number of Doctors on hospital rolls at any point of time (HR)
public function overall_CQI4h12_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4h12';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Average number of Doctors on hospital rolls at any point of time (HR)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4h12 - Average number of Doctors on hospital rolls (HR) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CQI4h13 - Average number of Nurses on hospital rolls at any point of time (HR)
public function overall_CQI4h13_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4h13';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Average number of Nurses on hospital rolls at any point of time (HR)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4h13 - Average number of Nurses on hospital rolls (HR) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CQI4h14 - Reason for staff exit (HR)
public function overall_CQI4h14_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4h14';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Reason for staff exit (HR)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4h14 - Reason for staff exit (HR) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CQI4h15 - Compliance to Internal complaints committee requirements (HR)
public function overall_CQI4h15_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4h15';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Compliance to Internal complaints committee requirements (HR)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4h15 - Compliance to Internal complaints committee (HR) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}
// âœ… CQI4h16 - Effectiveness in recruitment (MRF submission days - Staff onboarded time) (HR)
public function overall_CQI4h16_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4h16';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Effectiveness in recruitment (MRF submission days - Staff onboarded time) (HR)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4h16 - Effectiveness in recruitment (HR) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CQI4h17 - Compliance to Employee Engagement activities (HR)
public function overall_CQI4h17_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4h17';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Compliance to Employee Engagement activities (HR)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4h17 - Compliance to Employee Engagement activities (HR) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CQI4h18 - Number of Mandatory training hours coverage / staff (HR)
public function overall_CQI4h18_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4h18';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Number of Mandatory training hours coverage / staff (HR)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4h18 - Number of Mandatory training hours coverage per staff (HR) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CQI4h19 - Compliance to ACLS training (HR)
public function overall_CQI4h19_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4h19';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Compliance to ACLS training (HR)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4h19 - Compliance to ACLS training (HR) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CQI4h20 - Average units of electricity consumed per day (Units) (Engineering & Maintenance)
public function overall_CQI4h20_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4h20';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);

        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Average units of electricity consumed per day (Units) (Engineering & Maintenance)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];

        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4h20 - Average units of electricity consumed per day (Engineering & Maintenance) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}
// âœ… CQI4h21 - TAT for complaints on equipment/Utility/Facility (Engineering & Maintenance)
public function overall_CQI4h21_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4h21';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = ['KPI Recorded by', 'KPI Recorded on', 'TAT for complaints on equipment/Utility/Facility (Engineering & Maintenance)', 'Data analysis (RCA, Reason for Variation etc.)', 'Corrective action', 'Preventive action'];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }
        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4h21 - TAT for complaints on equipment/Utility/Facility (Engineering & Maintenance) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CQI4h22 - Average units of water consumed/Day (L) (Engineering & Maintenance)
public function overall_CQI4h22_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4h22';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = ['KPI Recorded by', 'KPI Recorded on', 'Average units of water consumed/Day (L) (Engineering & Maintenance)', 'Data analysis (RCA, Reason for Variation etc.)', 'Corrective action', 'Preventive action'];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }
        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4h22 - Average units of water consumed per day (Engineering & Maintenance) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CQI4h23 - Adherence to PPE usage in Engineering and Maintenance department (Engineering & Maintenance)
public function overall_CQI4h23_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4h23';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = ['KPI Recorded by', 'KPI Recorded on', 'Adherence to PPE usage in Engineering and Maintenance department (Engineering & Maintenance)', 'Data analysis (RCA, Reason for Variation etc.)', 'Corrective action', 'Preventive action'];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }
        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4h23 - Adherence to PPE usage in Engineering and Maintenance (Engineering & Maintenance) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}
// âœ… CQI4h24 - Compliance to PM schedule (Engineering & Maintenance)
public function overall_CQI4h24_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4h24';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = ['KPI Recorded by', 'KPI Recorded on', 'Compliance to PM schedule (Engineering & Maintenance)', 'Data analysis (RCA, Reason for Variation etc.)', 'Corrective action', 'Preventive action'];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }
        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4h24 - Compliance to PM schedule (Engineering & Maintenance) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CQI4h25 - Compliance to safe storage of chemicals (Engineering & Maintenance)
public function overall_CQI4h25_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4h25';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = ['KPI Recorded by', 'KPI Recorded on', 'Compliance to safe storage of chemicals (Engineering & Maintenance)', 'Data analysis (RCA, Reason for Variation etc.)', 'Corrective action', 'Preventive action'];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }
        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4h25 - Compliance to safe storage of chemicals (Engineering & Maintenance) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CQI4h26 - Outsourced Security service Staff Attendance (Safety & Security - Security)
public function overall_CQI4h26_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4h26';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = ['KPI Recorded by', 'KPI Recorded on', 'Outsourced Security service Staff Attendance (Safety & Security - Security)', 'Data analysis (RCA, Reason for Variation etc.)', 'Corrective action', 'Preventive action'];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }
        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4h26 - Outsourced Security service Staff Attendance (Safety & Security - Security) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CQI4h27 - Compliance to reporting of critical values in Lab (within 30 min) (Lab Service)
public function overall_CQI4h27_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4h27';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = ['KPI Recorded by', 'KPI Recorded on', 'Compliance to reporting of critical values in Lab (within 30 min) (Lab Service)', 'Data analysis (RCA, Reason for Variation etc.)', 'Corrective action', 'Preventive action'];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }
        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4h27 - Compliance to reporting of critical values in Lab (within 30 min) (Lab Service) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CQI4h28 - Compliance to reporting of critical values in POCT (Lab Service)
public function overall_CQI4h28_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4h28';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = ['KPI Recorded by', 'KPI Recorded on', 'Compliance to reporting of critical values in POCT (Lab Service)', 'Data analysis (RCA, Reason for Variation etc.)', 'Corrective action', 'Preventive action'];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }
        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4h28 - Compliance to reporting of critical values in POCT (Lab Service) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CQI4h29 - TAT for Lab tests (Lab Service)
public function overall_CQI4h29_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4h29';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = ['KPI Recorded by', 'KPI Recorded on', 'TAT for Lab tests (Lab Service)', 'Data analysis (RCA, Reason for Variation etc.)', 'Corrective action', 'Preventive action'];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }
        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4h29 - TAT for Lab tests (Lab Service) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CQI4h30 - TAT for Lab STAT (Lab Service)
public function overall_CQI4h30_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4h30';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = ['KPI Recorded by', 'KPI Recorded on', 'TAT for Lab STAT (Lab Service)', 'Data analysis (RCA, Reason for Variation etc.)', 'Corrective action', 'Preventive action'];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }
        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4h30 - TAT for Lab STAT (Lab Service) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}
// âœ… CQI4h31 - Compliance to TAT for lab outsourced test (Lab Service)
public function overall_CQI4h31_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4h31';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = ['KPI Recorded by', 'KPI Recorded on', 'Compliance to TAT for lab outsourced test (Lab Service)', 'Data analysis (RCA, Reason for Variation etc.)', 'Corrective action', 'Preventive action'];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }
        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4h31 - Compliance to TAT for lab outsourced test (Lab Service) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CQI4h32 - Lab Specimen Rejection Rate (Lab Service)
public function overall_CQI4h32_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4h32';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = ['KPI Recorded by', 'KPI Recorded on', 'Lab Specimen Rejection Rate (Lab Service)', 'Data analysis (RCA, Reason for Variation etc.)', 'Corrective action', 'Preventive action'];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }
        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4h32 - Lab Specimen Rejection Rate (Lab Service) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CQI4h33 - Insurance Claims Rejection Rate (Insurance)
public function overall_CQI4h33_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4h33';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = ['KPI Recorded by', 'KPI Recorded on', 'Insurance Claims Rejection Rate (Insurance)', 'Data analysis (RCA, Reason for Variation etc.)', 'Corrective action', 'Preventive action'];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }
        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4h33 - Insurance Claims Rejection Rate (Insurance) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CQI4h34 - TPA TAT (Insurance) for the month
public function overall_CQI4h34_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4h34';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = ['KPI Recorded by', 'KPI Recorded on', 'TPA TAT (Insurance) for the month', 'Data analysis (RCA, Reason for Variation etc.)', 'Corrective action', 'Preventive action'];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }
        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4h34 - TPA TAT (Insurance) for the month - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}
// âœ… CQI4h35 - Medical Waste Collection Rate (House Keeping)
public function overall_CQI4h35_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4h35';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = ['KPI Recorded by', 'KPI Recorded on', 'Medical Waste Collection Rate (House Keeping)', 'Data analysis (RCA, Reason for Variation etc.)', 'Corrective action', 'Preventive action'];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }
        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4h35 - Medical Waste Collection Rate (House Keeping) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CQI4h36 - Compliance to MSDS in Facility (House Keeping)
public function overall_CQI4h36_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4h36';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = ['KPI Recorded by', 'KPI Recorded on', 'Compliance to MSDS in Facility (House Keeping)', 'Data analysis (RCA, Reason for Variation etc.)', 'Corrective action', 'Preventive action'];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }
        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4h36 - Compliance to MSDS in Facility (House Keeping) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CQI4h37 - Percentage of Pest Control Complaints Rate (House Keeping)
public function overall_CQI4h37_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4h37';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = ['KPI Recorded by', 'KPI Recorded on', 'Percentage of Pest Control Complaints Rate (House Keeping)', 'Data analysis (RCA, Reason for Variation etc.)', 'Corrective action', 'Preventive action'];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }
        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4h37 - Percentage of Pest Control Complaints Rate (House Keeping) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CQI4h38 - Linen Quality - Compliance Rate (House Keeping)
public function overall_CQI4h38_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4h38';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = ['KPI Recorded by', 'KPI Recorded on', 'Linen Quality - Compliance Rate (House Keeping)', 'Data analysis (RCA, Reason for Variation etc.)', 'Corrective action', 'Preventive action'];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }
        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4h38 - Linen Quality - Compliance Rate (House Keeping) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CQI4h39 - Downtime of EMR (ITD)
public function overall_CQI4h39_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4h39';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = ['KPI Recorded by', 'KPI Recorded on', 'Downtime of EMR (ITD)', 'Data analysis (RCA, Reason for Variation etc.)', 'Corrective action', 'Preventive action'];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }
        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4h39 - Downtime of EMR (ITD) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CQI4h40 - Outsourced Staff Manpower Compliance Rate (House Keeping)
public function overall_CQI4h40_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4h40';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = ['KPI Recorded by', 'KPI Recorded on', 'Outsourced Staff Manpower Compliance Rate (House Keeping)', 'Data analysis (RCA, Reason for Variation etc.)', 'Corrective action', 'Preventive action'];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }
        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4h40 - Outsourced Staff Manpower Compliance Rate (House Keeping) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}
// âœ… CQI4h41 - ITD Preventive Maintenance Compliance (ITD)
public function overall_CQI4h41_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4h41';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = ['KPI Recorded by', 'KPI Recorded on', 'ITD Preventive Maintenance Compliance (ITD)', 'Data analysis (RCA, Reason for Variation etc.)', 'Corrective action', 'Preventive action'];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }
        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4h41 - ITD Preventive Maintenance Compliance (ITD) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CQI4h42 - Biomedical Preventive Maintenance Completion Rate (Biomedical Engineering)
public function overall_CQI4h42_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4h42';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = ['KPI Recorded by', 'KPI Recorded on', 'Biomedical Preventive Maintenance Completion Rate (Biomedical Engineering)', 'Data analysis (RCA, Reason for Variation etc.)', 'Corrective action', 'Preventive action'];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }
        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4h42 - Biomedical Preventive Maintenance Completion Rate (Biomedical Engineering) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CQI4h43 - Quality of Patient Transportation by Ambulance (Out-sourced) (Lab Service)
public function overall_CQI4h43_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4h43';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = ['KPI Recorded by', 'KPI Recorded on', 'Quality of Patient Transportation by Ambulance (Out-sourced) (Lab Service)', 'Data analysis (RCA, Reason for Variation etc.)', 'Corrective action', 'Preventive action'];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }
        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4h43 - Quality of Patient Transportation by Ambulance (Out-sourced) (Lab Service) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CQI4h44 - F&B Patient Complaints Rate (Food and Beverage Services)
public function overall_CQI4h44_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4h44';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = ['KPI Recorded by', 'KPI Recorded on', 'F&B Patient Complaints Rate (Food and Beverage Services)', 'Data analysis (RCA, Reason for Variation etc.)', 'Corrective action', 'Preventive action'];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }
        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4h44 - F&B Patient Complaints Rate (Food and Beverage Services) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CQI4h45 - Delay in Room Services (Food and Beverage Services)
public function overall_CQI4h45_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4h45';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = ['KPI Recorded by', 'KPI Recorded on', 'Delay in Room Services (Food and Beverage Services)', 'Data analysis (RCA, Reason for Variation etc.)', 'Corrective action', 'Preventive action'];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }
        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4h45 - Delay in Room Services (Food and Beverage Services) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CQI4h46 - Compliance to PCRA (Engineering & Maintenance)
public function overall_CQI4h46_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4h46';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = ['KPI Recorded by', 'KPI Recorded on', 'Compliance to PCRA (Engineering & Maintenance)', 'Data analysis (RCA, Reason for Variation etc.)', 'Corrective action', 'Preventive action'];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }
        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4h46 - Compliance to PCRA (Engineering & Maintenance) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CQI4h47 - Compliances in Patient Room Cleaning and Hygiene Practices (House Keeping)
public function overall_CQI4h47_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4h47';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = ['KPI Recorded by', 'KPI Recorded on', 'Compliances in Patient Room Cleaning and Hygiene Practices (House Keeping)', 'Data analysis (RCA, Reason for Variation etc.)', 'Corrective action', 'Preventive action'];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }
        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4h47 - Compliances in Patient Room Cleaning and Hygiene Practices (House Keeping) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CQI4h48 - Patient's Complaints Rate (House Keeping)
public function overall_CQI4h48_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4h48';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = ['KPI Recorded by', 'KPI Recorded on', 'Patient\'s Complaints Rate (House Keeping)', 'Data analysis (RCA, Reason for Variation etc.)', 'Corrective action', 'Preventive action'];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }
        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4h48 - Patient\'s Complaints Rate (House Keeping) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CQI4h49 - Percentage of Renewable Energy Used Against Total Energy Used (Engineering & Maintenance)
public function overall_CQI4h49_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4h49';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = ['KPI Recorded by', 'KPI Recorded on', 'Percentage of Renewable Energy Used Against Total Energy Used (Engineering & Maintenance)', 'Data analysis (RCA, Reason for Variation etc.)', 'Corrective action', 'Preventive action'];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }
        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4h49 - Percentage of Renewable Energy Used Against Total Energy Used (Engineering & Maintenance) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CQI4h50 - To Monitor the Energy Consumption (Engineering & Maintenance)
public function overall_CQI4h50_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4h50';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = ['KPI Recorded by', 'KPI Recorded on', 'To Monitor the Energy Consumption (Engineering & Maintenance)', 'Data analysis (RCA, Reason for Variation etc.)', 'Corrective action', 'Preventive action'];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }
        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4h50 - To Monitor the Energy Consumption (Engineering & Maintenance) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}
// âœ… CQI4h51 - Percentage of Wrong Food Delivery for Patients & Bystanders (Food and Beverage Services)
public function overall_CQI4h51_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4h51';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = ['KPI Recorded by', 'KPI Recorded on', 'Percentage of Wrong Food Delivery for Patients & Bystanders (Food and Beverage Services)', 'Data analysis (RCA, Reason for Variation etc.)', 'Corrective action', 'Preventive action'];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }
        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4h51 - Percentage of Wrong Food Delivery for Patients & Bystanders (Food and Beverage Services) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CQI4h52 - Percentage of Adherence to Facility Audit Observation Closure (Safety & Security)
public function overall_CQI4h52_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4h52';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = ['KPI Recorded by', 'KPI Recorded on', 'Percentage of Adherence to Facility Audit Observation Closure (Safety & Security)', 'Data analysis (RCA, Reason for Variation etc.)', 'Corrective action', 'Preventive action'];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }
        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4h52 - Percentage of Adherence to Facility Audit Observation Closure (Safety & Security) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CQI4h53 - Standardised Mortality Ratio for ICU - 1 (Nursing - ICU 1)
public function overall_CQI4h53_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4h53';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = ['KPI Recorded by', 'KPI Recorded on', 'Standardised Mortality Ratio for ICU - 1 (Nursing - ICU 1)', 'Data analysis (RCA, Reason for Variation etc.)', 'Corrective action', 'Preventive action'];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }
        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4h53 - Standardised Mortality Ratio for ICU - 1 (Nursing - ICU 1) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CQI4h54 - Standardised Mortality Ratio for ICU - 2 (Actual Deaths in ICU-2)
public function overall_CQI4h54_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4h54';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = ['KPI Recorded by', 'KPI Recorded on', 'Standardised Mortality Ratio for ICU - 2 (Actual Deaths in ICU-2)', 'Data analysis (RCA, Reason for Variation etc.)', 'Corrective action', 'Preventive action'];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }
        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4h54 - Standardised Mortality Ratio for ICU - 2 (Actual Deaths in ICU-2) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CQI4h55 - Standardised Mortality Ratio for PICU (Actual Deaths in PICU)
public function overall_CQI4h55_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4h55';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = ['KPI Recorded by', 'KPI Recorded on', 'Standardised Mortality Ratio for PICU (Actual Deaths in PICU)', 'Data analysis (RCA, Reason for Variation etc.)', 'Corrective action', 'Preventive action'];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }
        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4h55 - Standardised Mortality Ratio for PICU (Actual Deaths in PICU) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CQI4h56 - Standardised Mortality Ratio for NICU (Actual Deaths in NICU)
public function overall_CQI4h56_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4h56';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = ['KPI Recorded by', 'KPI Recorded on', 'Standardised Mortality Ratio for NICU (Actual Deaths in NICU)', 'Data analysis (RCA, Reason for Variation etc.)', 'Corrective action', 'Preventive action'];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }
        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4h56 - Standardised Mortality Ratio for NICU (Actual Deaths in NICU) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}
// âœ… CLOTCM1 - Average length of stay(MRD - Cardiology)
public function overall_CLOTCM1_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CLOTCM1';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = ['KPI Recorded by', 'KPI Recorded on', 'Average length of stay(MRD - Cardiology)', 'Data analysis (RCA, Reason for Variation etc.)', 'Corrective action', 'Preventive action'];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }
        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CLOTCM1 - Average length of stay(MRD - Cardiology) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CLOTCM2 - Average length of stay(MRD - CVTS)
public function overall_CLOTCM2_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CLOTCM2';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = ['KPI Recorded by', 'KPI Recorded on', 'Average length of stay(MRD - CVTS)', 'Data analysis (RCA, Reason for Variation etc.)', 'Corrective action', 'Preventive action'];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }
        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CLOTCM2 - Average length of stay(MRD - CVTS) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CLOTCM3 - Average length of stay(MRD - Gastro surgery)
public function overall_CLOTCM3_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CLOTCM3';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = ['KPI Recorded by', 'KPI Recorded on', 'Average length of stay(MRD - Gastro surgery)', 'Data analysis (RCA, Reason for Variation etc.)', 'Corrective action', 'Preventive action'];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }
        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CLOTCM3 - Average length of stay(MRD - Gastro surgery) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CLOTCM4 - Average length of stay(MRD - Gastroenterology)
public function overall_CLOTCM4_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CLOTCM4';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = ['KPI Recorded by', 'KPI Recorded on', 'Average length of stay(MRD - Gastroenterology)', 'Data analysis (RCA, Reason for Variation etc.)', 'Corrective action', 'Preventive action'];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }
        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CLOTCM4 - Average length of stay(MRD - Gastroenterology) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CLOTCM5 - Average length of stay(MRD - General Medicine)
public function overall_CLOTCM5_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CLOTCM5';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = ['KPI Recorded by', 'KPI Recorded on', 'Average length of stay(MRD - General Medicine)', 'Data analysis (RCA, Reason for Variation etc.)', 'Corrective action', 'Preventive action'];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }
        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CLOTCM5 - Average length of stay(MRD - General Medicine) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}
// âœ… CLOTCM6 - Average length of stay(MRD - ICU)
public function overall_CLOTCM6_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CLOTCM6';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = ['KPI Recorded by', 'KPI Recorded on', 'Average length of stay(MRD - ICU)', 'Data analysis (RCA, Reason for Variation etc.)', 'Corrective action', 'Preventive action'];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }
        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CLOTCM6 - Average length of stay(MRD - ICU) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CLOTCM7 - Average length of stay(MRD - Nephrology)
public function overall_CLOTCM7_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CLOTCM7';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = ['KPI Recorded by', 'KPI Recorded on', 'Average length of stay(MRD - Nephrology)', 'Data analysis (RCA, Reason for Variation etc.)', 'Corrective action', 'Preventive action'];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }
        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CLOTCM7 - Average length of stay(MRD - Nephrology) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CLOTCM8 - Average length of stay(MRD - Neuro Intervention)
public function overall_CLOTCM8_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CLOTCM8';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = ['KPI Recorded by', 'KPI Recorded on', 'Average length of stay(MRD - Neuro Intervention)', 'Data analysis (RCA, Reason for Variation etc.)', 'Corrective action', 'Preventive action'];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }
        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CLOTCM8 - Average length of stay(MRD - Neuro Intervention) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CLOTCM9 - Average length of stay(MRD - Neurology)
public function overall_CLOTCM9_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CLOTCM9';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = ['KPI Recorded by', 'KPI Recorded on', 'Average length of stay(MRD - Neurology)', 'Data analysis (RCA, Reason for Variation etc.)', 'Corrective action', 'Preventive action'];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }
        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CLOTCM9 - Average length of stay(MRD - Neurology) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CLOTCM10 - Average length of stay(MRD - Neurosurgery)
public function overall_CLOTCM10_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CLOTCM10';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = ['KPI Recorded by', 'KPI Recorded on', 'Average length of stay(MRD - Neurosurgery)', 'Data analysis (RCA, Reason for Variation etc.)', 'Corrective action', 'Preventive action'];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }
        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CLOTCM10 - Average length of stay(MRD - Neurosurgery) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}
// âœ… CLOTCM11 - Average length of stay(MRD - Ortho neuro integrated spine)
public function overall_CLOTCM11_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CLOTCM11';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = ['KPI Recorded by', 'KPI Recorded on', 'Average length of stay(MRD - Ortho neuro integrated spine)', 'Data analysis (RCA, Reason for Variation etc.)', 'Corrective action', 'Preventive action'];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }
        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CLOTCM11 - Average length of stay(MRD - Ortho neuro integrated spine) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CLOTCM12 - Average length of stay(MRD - Ortho THR)
public function overall_CLOTCM12_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CLOTCM12';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = ['KPI Recorded by', 'KPI Recorded on', 'Average length of stay(MRD - Ortho THR)', 'Data analysis (RCA, Reason for Variation etc.)', 'Corrective action', 'Preventive action'];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }
        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CLOTCM12 - Average length of stay(MRD - Ortho THR) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CLOTCM13 - Average length of stay(MRD - Ortho TKR)
public function overall_CLOTCM13_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CLOTCM13';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = ['KPI Recorded by', 'KPI Recorded on', 'Average length of stay(MRD - Ortho TKR)', 'Data analysis (RCA, Reason for Variation etc.)', 'Corrective action', 'Preventive action'];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }
        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CLOTCM13 - Average length of stay(MRD - Ortho TKR) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}
// âœ… CLOTCM14 - Average length of stay(MRD - Orthopaedics)
public function overall_CLOTCM14_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CLOTCM14';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = ['KPI Recorded by', 'KPI Recorded on', 'Average length of stay(MRD - Orthopaedics)', 'Data analysis (RCA, Reason for Variation etc.)', 'Corrective action', 'Preventive action'];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }
        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CLOTCM14 - Average length of stay(MRD - Orthopaedics) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CLOTCM15 - Average length of stay(MRD - Pulmonology)
public function overall_CLOTCM15_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CLOTCM15';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = ['KPI Recorded by', 'KPI Recorded on', 'Average length of stay(MRD - Pulmonology)', 'Data analysis (RCA, Reason for Variation etc.)', 'Corrective action', 'Preventive action'];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }
        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CLOTCM15 - Average length of stay(MRD - Pulmonology) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CLOTCM16 - Average length of stay(MRD - Urology)
public function overall_CLOTCM16_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CLOTCM16';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = ['KPI Recorded by', 'KPI Recorded on', 'Average length of stay(MRD - Urology)', 'Data analysis (RCA, Reason for Variation etc.)', 'Corrective action', 'Preventive action'];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }
        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CLOTCM16 - Average length of stay(MRD - Urology) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CLOTCM17 - Catheter associated urinary tract infection rate(Infection Control - ICU1)
public function overall_CLOTCM17_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CLOTCM17';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = ['KPI Recorded by', 'KPI Recorded on', 'Catheter associated urinary tract infection rate(Infection Control - ICU1)', 'Data analysis (RCA, Reason for Variation etc.)', 'Corrective action', 'Preventive action'];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }
        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CLOTCM17 - Catheter associated urinary tract infection rate(Infection Control - ICU1) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}
// âœ… CLOTCM18 - Catheter associated urinary tract infection rate(Infection Control - ICU2)
public function overall_CLOTCM18_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CLOTCM18';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = ['KPI Recorded by', 'KPI Recorded on', 'Catheter associated urinary tract infection rate(Infection Control - ICU2)', 'Data analysis (RCA, Reason for Variation etc.)', 'Corrective action', 'Preventive action'];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }
        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CLOTCM18 - Catheter associated urinary tract infection rate(Infection Control - ICU2) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CLOTCM19 - Catheter associated urinary tract infection rate(Infection Control - ICU3)
public function overall_CLOTCM19_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CLOTCM19';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = ['KPI Recorded by', 'KPI Recorded on', 'Catheter associated urinary tract infection rate(Infection Control - ICU3)', 'Data analysis (RCA, Reason for Variation etc.)', 'Corrective action', 'Preventive action'];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }
        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CLOTCM19 - Catheter associated urinary tract infection rate(Infection Control - ICU3) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CLOTCM20 - Central Line Associated Blood Stream Infection (CLABSI)-(Infection Control - ICU1)
public function overall_CLOTCM20_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CLOTCM20';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = ['KPI Recorded by', 'KPI Recorded on', 'Central Line Associated Blood Stream Infection (CLABSI)-(Infection Control - ICU1)', 'Data analysis (RCA, Reason for Variation etc.)', 'Corrective action', 'Preventive action'];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }
        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CLOTCM20 - Central Line Associated Blood Stream Infection (CLABSI)-(Infection Control - ICU1) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}
// âœ… CLOTCM21 - Central Line Associated Blood Stream Infection (CLABSI)-(Infection Control - ICU2)
public function overall_CLOTCM21_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CLOTCM21';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = ['KPI Recorded by', 'KPI Recorded on', 'Central Line Associated Blood Stream Infection (CLABSI)-(Infection Control - ICU2)', 'Data analysis (RCA, Reason for Variation etc.)', 'Corrective action', 'Preventive action'];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }
        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CLOTCM21 - Central Line Associated Blood Stream Infection (CLABSI)-(Infection Control - ICU2) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CLOTCM22 - Central Line Associated Blood Stream Infection (CLABSI)-(Infection Control - ICU3)
public function overall_CLOTCM22_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CLOTCM22';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = ['KPI Recorded by', 'KPI Recorded on', 'Central Line Associated Blood Stream Infection (CLABSI)-(Infection Control - ICU3)', 'Data analysis (RCA, Reason for Variation etc.)', 'Corrective action', 'Preventive action'];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }
        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CLOTCM22 - Central Line Associated Blood Stream Infection (CLABSI)-(Infection Control - ICU3) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CLOTCM23 - Surgical Site Infection rate(Infection Control - Ortho THR)
public function overall_CLOTCM23_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CLOTCM23';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = ['KPI Recorded by', 'KPI Recorded on', 'Surgical Site Infection rate(Infection Control - Ortho THR)', 'Data analysis (RCA, Reason for Variation etc.)', 'Corrective action', 'Preventive action'];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }
        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CLOTCM23 - Surgical Site Infection rate(Infection Control - Ortho THR) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}
// âœ… CLOTCM24 - Surgical Site Infection rate(Infection Control - Ortho TKR)
public function overall_CLOTCM24_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CLOTCM24';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = ['KPI Recorded by', 'KPI Recorded on', 'Surgical Site Infection rate(Infection Control - Ortho TKR)', 'Data analysis (RCA, Reason for Variation etc.)', 'Corrective action', 'Preventive action'];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }
        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CLOTCM24 - Surgical Site Infection rate(Infection Control - Ortho TKR) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CLOTCM25 - Ventilator associated pneumonias (VAP) in 1000 ventilator days(Infection Control - ICU1)
public function overall_CLOTCM25_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CLOTCM25';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = ['KPI Recorded by', 'KPI Recorded on', 'Ventilator associated pneumonias (VAP) in 1000 ventilator days(Infection Control - ICU1)', 'Data analysis (RCA, Reason for Variation etc.)', 'Corrective action', 'Preventive action'];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }
        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CLOTCM25 - Ventilator associated pneumonias (VAP) in 1000 ventilator days(Infection Control - ICU1) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CLOTCM26 - Ventilator associated pneumonias (VAP) in 1000 ventilator days(Infection Control - ICU2)
public function overall_CLOTCM26_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CLOTCM26';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = ['KPI Recorded by', 'KPI Recorded on', 'Ventilator associated pneumonias (VAP) in 1000 ventilator days(Infection Control - ICU2)', 'Data analysis (RCA, Reason for Variation etc.)', 'Corrective action', 'Preventive action'];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }
        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CLOTCM26 - Ventilator associated pneumonias (VAP) in 1000 ventilator days(Infection Control - ICU2) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CLOTCM27 - Ventilator associated pneumonias (VAP) in 1000 ventilator days(Infection Control - ICU3)
public function overall_CLOTCM27_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CLOTCM27';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = ['KPI Recorded by', 'KPI Recorded on', 'Ventilator associated pneumonias (VAP) in 1000 ventilator days(Infection Control - ICU3)', 'Data analysis (RCA, Reason for Variation etc.)', 'Corrective action', 'Preventive action'];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }
        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CLOTCM27 - Ventilator associated pneumonias (VAP) in 1000 ventilator days(Infection Control - ICU3) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CLOTCM28 - Ventilator associated pneumonias (VAP) in 1000 ventilator days(Infection Control - Ortho THR)
public function overall_CLOTCM28_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CLOTCM28';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = ['KPI Recorded by', 'KPI Recorded on', 'Ventilator associated pneumonias (VAP) in 1000 ventilator days(Infection Control - Ortho THR)', 'Data analysis (RCA, Reason for Variation etc.)', 'Corrective action', 'Preventive action'];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }
        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CLOTCM28 - Ventilator associated pneumonias (VAP) in 1000 ventilator days(Infection Control - Ortho THR) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CLOTCM29 - Ventilator associated pneumonias (VAP) in 1000 ventilator days(Infection Control - Ortho TKR)
public function overall_CLOTCM29_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CLOTCM29';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = ['KPI Recorded by', 'KPI Recorded on', 'Ventilator associated pneumonias (VAP) in 1000 ventilator days(Infection Control - Ortho TKR)', 'Data analysis (RCA, Reason for Variation etc.)', 'Corrective action', 'Preventive action'];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }
        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CLOTCM29 - Ventilator associated pneumonias (VAP) in 1000 ventilator days(Infection Control - Ortho TKR) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CLOTCM30 - Prevalence of transfusion reactions in Leuco depleted PRBC transfusions(Blood Center)
public function overall_CLOTCM30_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CLOTCM30';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = ['KPI Recorded by', 'KPI Recorded on', 'Prevalence of transfusion reactions in Leuco depleted PRBC transfusions(Blood Center)', 'Data analysis (RCA, Reason for Variation etc.)', 'Corrective action', 'Preventive action'];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }
        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CLOTCM30 - Prevalence of transfusion reactions in Leuco depleted PRBC transfusions(Blood Center) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}// âœ… CQI4i1 - Compliance to medical service requests - Heart, Lung transplantation(Medical Administration)
public function overall_CQI4i1_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4i1';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = ['KPI Recorded by', 'KPI Recorded on', 'Compliance to medical service requests - Heart, Lung transplantation(Medical Administration)', 'Data analysis (RCA, Reason for Variation etc.)', 'Corrective action', 'Preventive action'];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }
        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4i1 - Compliance to medical service requests - Heart, Lung transplantation(Medical Administration) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CQI4i2 - Compliance to medical service requests - Heart, Lung transplantation(Liver transplantation)
public function overall_CQI4i2_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4i2';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = ['KPI Recorded by', 'KPI Recorded on', 'Compliance to medical service requests - Heart, Lung transplantation(Liver transplantation)', 'Data analysis (RCA, Reason for Variation etc.)', 'Corrective action', 'Preventive action'];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }
        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4i2 - Compliance to medical service requests - Heart, Lung transplantation(Liver transplantation) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CQI4i3 - TAT compliance for radiology outsourced test(Radiology)
public function overall_CQI4i3_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4i3';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = ['KPI Recorded by', 'KPI Recorded on', 'TAT compliance for radiology outsourced test(Radiology)', 'Data analysis (RCA, Reason for Variation etc.)', 'Corrective action', 'Preventive action'];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }
        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4i3 - TAT compliance for radiology outsourced test(Radiology) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}
// âœ… CQI4i4 - Food waste collection rate (House Keeping)
public function overall_CQI4i4_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4i4';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = ['KPI Recorded by', 'KPI Recorded on', 'Food waste collection rate (House Keeping)', 'Data analysis (RCA, Reason for Variation etc.)', 'Corrective action', 'Preventive action'];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }
        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4i4 - Food waste collection rate (House Keeping) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CQI4i5 - Solid waste collection rate (House Keeping)
public function overall_CQI4i5_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4i5';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = ['KPI Recorded by', 'KPI Recorded on', 'Solid waste collection rate (House Keeping)', 'Data analysis (RCA, Reason for Variation etc.)', 'Corrective action', 'Preventive action'];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }
        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4i5 - Solid waste collection rate (House Keeping) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CQI4i6 - Outsourced GDA (General Duty Assistance) absenteeism rate (House Keeping)
public function overall_CQI4i6_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4i6';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = ['KPI Recorded by', 'KPI Recorded on', 'Outsourced GDA (General Duty Assistance) absenteeism rate (House Keeping)', 'Data analysis (RCA, Reason for Variation etc.)', 'Corrective action', 'Preventive action'];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }
        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4i6 - Outsourced GDA (General Duty Assistance) absenteeism rate (House Keeping) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CQI4i7 - Outsourced OPD Assistance attendance (Operation)
public function overall_CQI4i7_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4i7';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = ['KPI Recorded by', 'KPI Recorded on', 'Outsourced OPD Assistance attendance (Operation)', 'Data analysis (RCA, Reason for Variation etc.)', 'Corrective action', 'Preventive action'];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }
        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4i7 - Outsourced OPD Assistance attendance (Operation) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CQI4i8 - Outsourced UTIZ staff attendance (House Keeping)
public function overall_CQI4i8_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4i8';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = ['KPI Recorded by', 'KPI Recorded on', 'Outsourced UTIZ staff attendance (House Keeping)', 'Data analysis (RCA, Reason for Variation etc.)', 'Corrective action', 'Preventive action'];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }
        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4i8 - Outsourced UTIZ staff attendance (House Keeping) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CQI4i9 - Compliance to safe transportation of Oil waste (Engineering & Maintenance)
public function overall_CQI4i9_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4i9';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = ['KPI Recorded by', 'KPI Recorded on', 'Compliance to safe transportation of Oil waste (Engineering & Maintenance)', 'Data analysis (RCA, Reason for Variation etc.)', 'Corrective action', 'Preventive action'];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }
        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4i9 - Compliance to safe transportation of Oil waste (Engineering & Maintenance) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CQI4i10 - Number of laundry loads reduced by optimizing and sorting laundry (GHI 3ME4) (JCI8-GHI 3)-(House Keeping)
public function overall_CQI4i10_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4i10';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = ['KPI Recorded by', 'KPI Recorded on', 'Number of laundry loads reduced by optimizing and sorting laundry (GHI 3ME4) (JCI8-GHI 3)-(House Keeping)', 'Data analysis (RCA, Reason for Variation etc.)', 'Corrective action', 'Preventive action'];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }
        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4i10 - Number of laundry loads reduced by optimizing and sorting laundry (GHI 3ME4) (JCI8-GHI 3)-(House Keeping) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}
// âœ… CQI4i11 - Percentage of cleaning products used biodegradable (GHI 3ME4) (JCI8-GHI 3)-(House Keeping)
public function overall_CQI4i11_report() {
    if ($this->session->userdata('isLogIn') == false)
        redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4i11';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = ['KPI Recorded by', 'KPI Recorded on', 'Percentage of cleaning products used biodegradable (GHI 3ME4) (JCI8-GHI 3)-(House Keeping)', 'Data analysis (RCA, Reason for Variation etc.)', 'Corrective action', 'Preventive action'];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }
        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4i11 - Percentage of cleaning products used biodegradable (GHI 3ME4) (JCI8-GHI 3)-(House Keeping) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values)
                fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CQI4i12 - Average use of Ecofriendly catering supplies in a month (carbon intensity reduction -JCI8-GHI 3)-(House Keeping)
public function overall_CQI4i12_report() {
    if ($this->session->userdata('isLogIn') == false)
        redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4i12';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = ['KPI Recorded by', 'KPI Recorded on', 'Average use of Ecofriendly catering supplies in a month (carbon intensity reduction -JCI8-GHI 3)-(House Keeping)', 'Data analysis (RCA, Reason for Variation etc.)', 'Corrective action', 'Preventive action'];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }
        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4i12 - Average use of Ecofriendly catering supplies in a month (carbon intensity reduction -JCI8-GHI 3)-(House Keeping) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values)
                fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CQI4i13 - Average quantity of Medical waste disposed per month in Kgs (Clinical practices to reduce the environmental impact -JCI8-GHI 3)-(House Keeping)
public function overall_CQI4i13_report() {
    if ($this->session->userdata('isLogIn') == false)
        redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4i13';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = ['KPI Recorded by', 'KPI Recorded on', 'Average quantity of Medical waste disposed per month in Kgs (Clinical practices to reduce the environmental impact -JCI8-GHI 3)-(House Keeping)', 'Data analysis (RCA, Reason for Variation etc.)', 'Corrective action', 'Preventive action'];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }
        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4i13 - Average quantity of Medical waste disposed per month in Kgs (Clinical practices to reduce the environmental impact -JCI8-GHI 3)-(House Keeping) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values)
                fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CQI4i14 - Non-Recyclable Waste per Patient Day(Kg)-(JCI8-GHI 3)-(House Keeping)
public function overall_CQI4i14_report() {
    if ($this->session->userdata('isLogIn') == false)
        redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4i14';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = ['KPI Recorded by', 'KPI Recorded on', 'Non-Recyclable Waste per Patient Day(Kg)-(JCI8-GHI 3)-(House Keeping)', 'Data analysis (RCA, Reason for Variation etc.)', 'Corrective action', 'Preventive action'];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }
        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4i14 - Non-Recyclable Waste per Patient Day(Kg)-(JCI8-GHI 3)-(House Keeping) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values)
                fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}
// âœ… CQI4j1 - Door to Physician â‰¤10 min(Stroke Unit)
public function overall_CQI4j1_report() {
    if ($this->session->userdata('isLogIn') == false)
        redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4j1';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = ['KPI Recorded by', 'KPI Recorded on', 'Door to Physician â‰¤10 min(Stroke Unit)', 'Data analysis (RCA, Reason for Variation etc.)', 'Corrective action', 'Preventive action'];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }
        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4j1 - Door to Physician â‰¤10 min(Stroke Unit) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values)
                fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CQI4j2 - Door to stroke team â‰¤15 min(Stroke Unit)
public function overall_CQI4j2_report() {
    if ($this->session->userdata('isLogIn') == false)
        redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4j2';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = ['KPI Recorded by', 'KPI Recorded on', 'Door to stroke team â‰¤15 min(Stroke Unit)', 'Data analysis (RCA, Reason for Variation etc.)', 'Corrective action', 'Preventive action'];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }
        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4j2 - Door to stroke team â‰¤15 min(Stroke Unit) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values)
                fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CQI4j3 - Door to CT/MRI initiation â‰¤20 min(Stroke Unit)
public function overall_CQI4j3_report() {
    if ($this->session->userdata('isLogIn') == false)
        redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4j3';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = ['KPI Recorded by', 'KPI Recorded on', 'Door to CT/MRI initiation â‰¤20 min(Stroke Unit)', 'Data analysis (RCA, Reason for Variation etc.)', 'Corrective action', 'Preventive action'];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }
        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4j3 - Door to CT/MRI initiation â‰¤20 min(Stroke Unit) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values)
                fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CQI4j4 - Door to CT/MRI interpretation â‰¤30 min(Stroke Unit)
public function overall_CQI4j4_report() {
    if ($this->session->userdata('isLogIn') == false)
        redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4j4';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = ['KPI Recorded by', 'KPI Recorded on', 'Door to CT/MRI interpretation â‰¤30 min(Stroke Unit)', 'Data analysis (RCA, Reason for Variation etc.)', 'Corrective action', 'Preventive action'];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }
        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4j4 - Door to CT/MRI interpretation â‰¤30 min(Stroke Unit) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values)
                fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CQI4j5 - Order to lab results â‰¤30 min, if ordered(Stroke Unit)
public function overall_CQI4j5_report() {
    if ($this->session->userdata('isLogIn') == false)
        redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4j5';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = ['KPI Recorded by', 'KPI Recorded on', 'Order to lab results â‰¤30 min, if ordered(Stroke Unit)', 'Data analysis (RCA, Reason for Variation etc.)', 'Corrective action', 'Preventive action'];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }
        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4j5 - Order to lab results â‰¤30 min, if ordered(Stroke Unit) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values)
                fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}
// âœ… CQI4j6 - Door to IV thrombolytic bolus (â‰¥75% compliance) â‰¤60 min [Achieving Door to needle times (time of bolus administration) within 60 minutes in 75% or more of acute ischemic stroke(Stroke Unit)
public function overall_CQI4j6_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4j6';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = ['KPI Recorded by', 'KPI Recorded on', 'Door to IV thrombolytic bolus (â‰¥75% compliance) â‰¤60 min [Achieving Door to needle times (time of bolus administration) within 60 minutes in 75% or more of acute ischemic stroke(Stroke Unit)', 'Data analysis (RCA, Reason for Variation etc.)', 'Corrective action', 'Preventive action'];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }
        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4j6 - Door to IV thrombolytic bolus (â‰¥75% compliance) â‰¤60 min [Achieving Door to needle times (time of bolus administration) within 60 minutes in 75% or more of acute ischemic stroke(Stroke Unit) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CQI4j7 - Door to IV thrombolytic bolus (â‰¥50% compliance) â‰¤45 min [Achieving Door to needle times (time of bolus administration) within 45 minutes in 50% or more of acute ischemic stroke patients treated with IV thrombolytic(Stroke Unit)
public function overall_CQI4j7_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4j7';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = ['KPI Recorded by', 'KPI Recorded on', 'Door to IV thrombolytic bolus (â‰¥50% compliance) â‰¤45 min [Achieving Door to needle times (time of bolus administration) within 45 minutes in 50% or more of acute ischemic stroke patients treated with IV thrombolytic(Stroke Unit)', 'Data analysis (RCA, Reason for Variation etc.)', 'Corrective action', 'Preventive action'];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }
        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4j7 - Door to IV thrombolytic bolus (â‰¥50% compliance) â‰¤45 min [Achieving Door to needle times (time of bolus administration) within 45 minutes in 50% or more of acute ischemic stroke patients treated with IV thrombolytic(Stroke Unit) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CQI4j8 - Door to puncture time â‰¤90 min(Stroke Unit)
public function overall_CQI4j8_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4j8';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = ['KPI Recorded by', 'KPI Recorded on', 'Door to puncture time â‰¤90 min(Stroke Unit)', 'Data analysis (RCA, Reason for Variation etc.)', 'Corrective action', 'Preventive action'];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }
        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4j8 - Door to puncture time â‰¤90 min(Stroke Unit) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CQI4j9 - The periprocedural complication rates after correcting for various comorbidities (Stroke Unit)
public function overall_CQI4j9_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4j9';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = ['KPI Recorded by', 'KPI Recorded on', 'The periprocedural complication rates after correcting for various comorbidities (Stroke Unit)', 'Data analysis (RCA, Reason for Variation etc.)', 'Corrective action', 'Preventive action'];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }
        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4j9 - The periprocedural complication rates after correcting for various comorbidities (Stroke Unit) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CQI4j10 - The periprocedural mortality rate for surgical or interventional procedures(Stroke Unit)
public function overall_CQI4j10_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4j10';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = ['KPI Recorded by', 'KPI Recorded on', 'The periprocedural mortality rate for surgical or interventional procedures(Stroke Unit)', 'Data analysis (RCA, Reason for Variation etc.)', 'Corrective action', 'Preventive action'];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }
        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4j10 - The periprocedural mortality rate for surgical or interventional procedures(Stroke Unit) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}
// âœ… CQI4j11 - Percentage of all stroke/TIA patients who have a deficit at the time of the initial note, ED Physician or Neurology consultation note for whom an NIHSS score is documented(Stroke Unit)
public function overall_CQI4j11_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4j11';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = ['KPI Recorded by', 'KPI Recorded on', 'Percentage of all stroke/TIA patients who have a deficit at the time of the initial note, ED Physician or Neurology consultation note for whom an NIHSS score is documented(Stroke Unit)', 'Data analysis (RCA, Reason for Variation etc.)', 'Corrective action', 'Preventive action'];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }
        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4j11 - Percentage of all stroke/TIA patients who have a deficit at the time of the initial note, ED Physician or Neurology consultation note for whom an NIHSS score is documented(Stroke Unit) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CQI4j12 - Percentage of ischemic stroke patients eligible for intravenous thrombolysis who receive it within the appropriate time window(Stroke Unit)
public function overall_CQI4j12_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4j12';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = ['KPI Recorded by', 'KPI Recorded on', 'Percentage of ischemic stroke patients eligible for intravenous thrombolysis who receive it within the appropriate time window(Stroke Unit)', 'Data analysis (RCA, Reason for Variation etc.)', 'Corrective action', 'Preventive action'];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }
        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4j12 - Percentage of ischemic stroke patients eligible for intravenous thrombolysis who receive it within the appropriate time window(Stroke Unit) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CQI4j13 - Percentage of patients who are treated for acute ischemic stroke with intravenous thrombolysis whose treatment is started within 60 minutes after arrival(Stroke Unit)
public function overall_CQI4j13_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4j13';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = ['KPI Recorded by', 'KPI Recorded on', 'Percentage of patients who are treated for acute ischemic stroke with intravenous thrombolysis whose treatment is started within 60 minutes after arrival(Stroke Unit)', 'Data analysis (RCA, Reason for Variation etc.)', 'Corrective action', 'Preventive action'];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }
        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4j13 - Percentage of patients who are treated for acute ischemic stroke with intravenous thrombolysis whose treatment is started within 60 minutes after arrival(Stroke Unit) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CQI4j14 - Time from arrival to the start of initial imaging workup for all patients who arrive within 24 hours of last known well (In Minutes)-(Stroke Unit)
public function overall_CQI4j14_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4j14';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = ['KPI Recorded by', 'KPI Recorded on', 'Time from arrival to the start of initial imaging workup for all patients who arrive within 24 hours of last known well (In Minutes)-(Stroke Unit)', 'Data analysis (RCA, Reason for Variation etc.)', 'Corrective action', 'Preventive action'];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }
        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4j14 - Time from arrival to the start of initial imaging workup for all patients who arrive within 24 hours of last known well (In Minutes)-(Stroke Unit) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}
// âœ… CQI4j15 - Percentage of ischemic stroke patients who develop a symptomatic intracranial hemorrhage (i.e., clinical deterioration â‰¥ 4-point increase on NIHSS and brain image finding of parenchymal hematoma, or subarachnoid hemorrhage, or intraventricular hemorrhage) within (â‰¤) 36 hours after the onset of treatment with intra-venous (IV) or intra-arterial (IA) thrombolytic (t-PA) therapy, or mechanical endovascular reperfusion procedure (i.e., mechanical endovascular thrombectomy with a clot retrieval device)-(Stroke Unit)
public function overall_CQI4j15_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4j15';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = ['KPI Recorded by', 'KPI Recorded on', 'Percentage of ischemic stroke patients who develop a symptomatic intracranial hemorrhage within (â‰¤) 36 hours after treatment-(Stroke Unit)', 'Data analysis (RCA, Reason for Variation etc.)', 'Corrective action', 'Preventive action'];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }
        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4j15 - Percentage of ischemic stroke patients who develop symptomatic intracranial hemorrhage within 36 hours-(Stroke Unit) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CQI4j16 - Percentage of patients undergoing CEA, or carotid angioplasty or stenting, having stroke or death within 30 days of the procedure (Stroke Unit)
public function overall_CQI4j16_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4j16';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = ['KPI Recorded by', 'KPI Recorded on', 'Percentage of patients undergoing CEA, or carotid angioplasty or stenting, having stroke or death within 30 days-(Stroke Unit)', 'Data analysis (RCA, Reason for Variation etc.)', 'Corrective action', 'Preventive action'];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }
        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4j16 - Percentage of patients undergoing CEA, carotid angioplasty/stenting having stroke or death within 30 days-(Stroke Unit) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CQI4j17 - Percentage of patients undergoing intracranial angioplasty and/or stenting for atherosclerotic disease having stroke or death within 30 days of the procedure(Stroke Unit)
public function overall_CQI4j17_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4j17';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = ['KPI Recorded by', 'KPI Recorded on', 'Percentage of patients undergoing intracranial angioplasty/stenting for atherosclerotic disease having stroke or death within 30 days-(Stroke Unit)', 'Data analysis (RCA, Reason for Variation etc.)', 'Corrective action', 'Preventive action'];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }
        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4j17 - Percentage of patients undergoing intracranial angioplasty/stenting having stroke or death within 30 days-(Stroke Unit) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CQI4j18 - Percentage of patients with stroke or death within 24 hours of diagnostic cerebral-angiography(Stroke Unit)
public function overall_CQI4j18_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4j18';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = ['KPI Recorded by', 'KPI Recorded on', 'Percentage of patients with stroke or death within 24 hours of diagnostic cerebral-angiography-(Stroke Unit)', 'Data analysis (RCA, Reason for Variation etc.)', 'Corrective action', 'Preventive action'];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }
        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4j18 - Percentage of patients with stroke or death within 24 hours of cerebral-angiography-(Stroke Unit) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CQI4j19 - Percentage of patients who have a diagnosis of ischemic stroke who undergo EVD and then develop ventriculitis(Stroke Unit)
public function overall_CQI4j19_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4j19';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = ['KPI Recorded by', 'KPI Recorded on', 'Percentage of ischemic stroke patients who undergo EVD and then develop ventriculitis-(Stroke Unit)', 'Data analysis (RCA, Reason for Variation etc.)', 'Corrective action', 'Preventive action'];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }
        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4j19 - Percentage of ischemic stroke patients who undergo EVD and develop ventriculitis-(Stroke Unit) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}

// âœ… CQI4j20 - Percentage Ischemic stroke patients with a post-treatment reperfusion grade of TICI 2B or higher in the vascular territory beyond the target arterial occlusion at the end of treatment with intra-arterial (IA) thrombolytic (t-PA) therapy and/or mechanical endovascular reperfusion therapy-(Stroke Unit)
public function overall_CQI4j20_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4j20';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = ['KPI Recorded by', 'KPI Recorded on', 'Percentage Ischemic stroke patients with a post-treatment reperfusion grade of TICI 2B or higher-(Stroke Unit)', 'Data analysis (RCA, Reason for Variation etc.)', 'Corrective action', 'Preventive action'];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }
        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];
        ob_end_clean();
        $fileName = 'EF- CQI4j20 - Percentage ischemic stroke patients with post-treatment reperfusion grade TICI 2B or higher-(Stroke Unit) - ' . $tdate . ' to ' . $fdate . '.csv';
        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);
        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }
        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}
// âœ… CQI4j21 - Percentage Ischemic stroke patients with a large vessel cerebral occlusion (i.e., internal carotid artery (ICA) or ICA terminus (T lesion; T-occlusion), middle cerebral artery (MCA) M1 or M2, basilar artery) who receive mechanical endovascular reperfusion (MER) therapy (time of first pass or deployment of device) within 120 minutes (â‰¥ 0 min. and â‰¤150 min.) of hospital arrival and achieve TICI 2B or higher at the end of the treatment (Stroke Unit)
public function overall_CQI4j21_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4j21';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Percentage Ischemic stroke patients with large vessel occlusion who receive MER therapy within 120 minutes and achieve TICI 2B or higher-(Stroke Unit)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];

        ob_end_clean();
        $fileName = 'EF- CQI4j21 - Percentage Ischemic stroke patients with large vessel occlusion who receive MER therapy within 120 minutes and achieve TICI 2B or higher-(Stroke Unit) - ' . $tdate . ' to ' . $fdate . '.csv';

        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }

        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}


// âœ… CQI4j22 - Percentage Ischemic stroke patients with a large vessel cerebral occlusion (i.e., internal carotid artery (ICA) or ICA terminus (T lesion; T-occlusion), middle cerebral artery (MCA) M1 or M2, basilar artery) who receive mechanical endovascular reperfusion (MER) therapy (time of first pass or deployment of device) and achieve TICI 2B or higher â‰¤60 minutes from the time of skin puncture (Stroke Unit)
public function overall_CQI4j22_report() {
    if ($this->session->userdata('isLogIn') == false) redirect('login');
    if (ismodule_active('QUALITY') === true) {
        $table_feedback = 'bf_feedback_CQI4j22';
        $table_patients = 'bf_patients';
        $desc = 'desc';
        $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
        $header = [
            'KPI Recorded by',
            'KPI Recorded on',
            'Percentage Ischemic stroke patients with large vessel occlusion who receive MER therapy and achieve TICI 2B or higher â‰¤60 minutes from skin puncture-(Stroke Unit)',
            'Data analysis (RCA, Reason for Variation etc.)',
            'Corrective action',
            'Preventive action'
        ];
        $dataexport = [];
        foreach ($feedbacktaken as $i => $row) {
            $data = json_decode($row->dataset, true);
            $dataexport[$i]['name'] = $data['name'];
            $dataexport[$i]['date'] = date('d-M-Y', strtotime($row->datetime)) . "\n" . date('h:i A', strtotime($row->datetime));
            $dataexport[$i]['value'] = $data['value'];
            $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
            $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
            $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];
        }

        $fdate = $_SESSION['from_date'];
        $tdate = $_SESSION['to_date'];

        ob_end_clean();
        $fileName = 'EF- CQI4j22 - Percentage Ischemic stroke patients with large vessel occlusion who receive MER therapy and achieve TICI 2B or higher â‰¤60 minutes from skin puncture-(Stroke Unit) - ' . $tdate . ' to ' . $fdate . '.csv';

        header('Pragma: public');
        header('Expires: 0');
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
        header('Cache-Control: private', false);
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment;filename=' . $fileName);

        if (!empty($dataexport)) {
            $fp = fopen('php://output', 'w');
            fputcsv($fp, $header, ',');
            foreach ($dataexport as $values) fputcsv($fp, $values, ',');
            fclose($fp);
        }

        ob_flush();
        exit;
    } else redirect('dashboard/noaccess');
}









       






















    




    



    

    











    public function overall_6psq3a_report()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {


            $table_feedback = 'bf_feedback_6PSQ3a';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->quality_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Recorded by';
            $header[1] = 'Month - Year';
            $header[2] = 'Employee details';
            $header[3] = 'Number of patients developing adverse drug reactions';
            $header[4] = 'Number of in-patients';
            $header[5] = 'Percentage of in-patients developing adverse drug reaction';

            $j = 6;


            $header[$j++] = 'Data analysis';
            $header[$j++] = 'Corrective action';
            $header[$j++] = 'Preventive action';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['name'] = $data['name'];
                $dataexport[$i]['date'] = date('M-Y', strtotime($row->datetime));
                $dataexport[$i]['patient_id'] = $data['name'] . "<" . $data['patientid'] . ">\n" .
                    $data['contactnumber'] . "\n" .
                    $data['email'];

                $dataexport[$i]['initial_assessment_hr'] = $data['initial_assessment_hr'];
                $dataexport[$i]['total_admission'] = $data['total_admission'];
                $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
                $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
                $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];

                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- 6.PSQ3a- Percentage of in-patients developing adverse drug reaction(s) - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function overall_7psq3a_report()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {


            $table_feedback = 'bf_feedback_7PSQ3a';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->quality_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Recorded by';
            $header[1] = 'Month - Year';
            $header[2] = 'Employee details';
            $header[3] = 'Number of unplanned return to OT';
            $header[4] = 'Number of patients who underwent surgeries in the OT';
            $header[5] = 'Percentage of unplanned return to OT';

            $j = 6;


            $header[$j++] = 'Data analysis';
            $header[$j++] = 'Corrective action';
            $header[$j++] = 'Preventive action';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['name'] = $data['name'];
                $dataexport[$i]['date'] = date('M-Y', strtotime($row->datetime));
                $dataexport[$i]['patient_id'] = $data['name'] . "<" . $data['patientid'] . ">\n" .
                    $data['contactnumber'] . "\n" .
                    $data['email'];

                $dataexport[$i]['initial_assessment_hr'] = $data['initial_assessment_hr'];
                $dataexport[$i]['total_admission'] = $data['total_admission'];
                $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
                $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
                $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];

                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- 7.PSQ3a- Percentage of unplanned return to OT - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function overall_8psq3a_report()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {


            $table_feedback = 'bf_feedback_8PSQ3a';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->quality_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Recorded by';
            $header[1] = 'Month - Year';
            $header[2] = 'Employee details';
            $header[3] = 'Number of surgeries where the procedure was followed';
            $header[4] = 'Number of surgeries performed';
            $header[5] = 'Percentage of Surgeries following adverse event prevention procedures';

            $j = 6;


            $header[$j++] = 'Data analysis';
            $header[$j++] = 'Corrective action';
            $header[$j++] = 'Preventive action';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['name'] = $data['name'];
                $dataexport[$i]['date'] = date('M-Y', strtotime($row->datetime));
                $dataexport[$i]['patient_id'] = $data['name'] . "<" . $data['patientid'] . ">\n" .
                    $data['contactnumber'] . "\n" .
                    $data['email'];

                $dataexport[$i]['initial_assessment_hr'] = $data['initial_assessment_hr'];
                $dataexport[$i]['total_admission'] = $data['total_admission'];
                $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
                $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
                $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];

                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- 8.PSQ3a- Percentage of surgeries where the organisations procedure to prevent adverse events - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function overall_9psq3a_report()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {


            $table_feedback = 'bf_feedback_9PSQ3a';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->quality_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Recorded by';
            $header[1] = 'Month - Year';
            $header[2] = 'Employee details';
            $header[3] = 'Number of transfusion reactions';
            $header[4] = 'Number of units transfused (in Units)';
            $header[5] = 'Percentage of transfusion reactions';

            $j = 6;


            $header[$j++] = 'Data analysis';
            $header[$j++] = 'Corrective action';
            $header[$j++] = 'Preventive action';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['name'] = $data['name'];
                $dataexport[$i]['date'] = date('M-Y', strtotime($row->datetime));
                $dataexport[$i]['patient_id'] = $data['name'] . "<" . $data['patientid'] . ">\n" .
                    $data['contactnumber'] . "\n" .
                    $data['email'];

                $dataexport[$i]['initial_assessment_hr'] = $data['initial_assessment_hr'];
                $dataexport[$i]['total_admission'] = $data['total_admission'];
                $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
                $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
                $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];

                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- 9.PSQ3a- Percentage of transfusion reactions - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function overall_10psq3a_report()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {


            $table_feedback = 'bf_feedback_10PSQ3a';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->quality_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Recorded by';
            $header[1] = 'Month - Year';
            $header[2] = 'Employee details';
            $header[3] = 'Actual deaths in ICU';
            $header[4] = 'Predicted deaths in ICU';
            $header[5] = 'Percentage of standardised mortality ratio for ICU';

            $j = 6;


            $header[$j++] = 'Data analysis';
            $header[$j++] = 'Corrective action';
            $header[$j++] = 'Preventive action';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['name'] = $data['name'];
                $dataexport[$i]['date'] = date('M-Y', strtotime($row->datetime));
                $dataexport[$i]['patient_id'] = $data['name'] . "<" . $data['patientid'] . ">\n" .
                    $data['contactnumber'] . "\n" .
                    $data['email'];

                $dataexport[$i]['initial_assessment_hr'] = $data['initial_assessment_hr'];
                $dataexport[$i]['total_admission'] = $data['total_admission'];
                $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
                $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
                $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];

                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- 10.PSQ3a- Standardised mortality ratio for ICU - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function overall_11psq3a_report()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {


            $table_feedback = 'bf_feedback_11PSQ3a';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->quality_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Recorded by';
            $header[1] = 'Month - Year';
            $header[2] = 'Employee details';
            $header[3] = 'Number of returns to emergency within 72 hrs with similar complaints';
            $header[4] = 'Number of patients who have come to the emergency';
            $header[5] = 'Percentage of returns to emergency within 72 hrs with similar complaints';

            $j = 6;


            $header[$j++] = 'Data analysis';
            $header[$j++] = 'Corrective action';
            $header[$j++] = 'Preventive action';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['name'] = $data['name'];
                $dataexport[$i]['date'] = date('M-Y', strtotime($row->datetime));
                $dataexport[$i]['patient_id'] = $data['name'] . "<" . $data['patientid'] . ">\n" .
                    $data['contactnumber'] . "\n" .
                    $data['email'];

                $dataexport[$i]['initial_assessment_hr'] = $data['initial_assessment_hr'];
                $dataexport[$i]['total_admission'] = $data['total_admission'];
                $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
                $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
                $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];

                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- 11.PSQ3a- Return to the emergency within 72 hours with similar complaints - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function overall_12psq3a_report()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {


            $table_feedback = 'bf_feedback_12PSQ3a';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->quality_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Recorded by';
            $header[1] = 'Month - Year';
            $header[2] = 'Employee details';
            $header[3] = 'Number of patients who develop new / worsening of pressure ulcer';
            $header[4] = 'Total no. of patient days';
            $header[5] = 'Incidence of hospital associated pressure ulcers after admission';

            $j = 6;


            $header[$j++] = 'Data analysis';
            $header[$j++] = 'Corrective action';
            $header[$j++] = 'Preventive action';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['name'] = $data['name'];
                $dataexport[$i]['date'] = date('M-Y', strtotime($row->datetime));
                $dataexport[$i]['patient_id'] = $data['name'] . "<" . $data['patientid'] . ">\n" .
                    $data['contactnumber'] . "\n" .
                    $data['email'];

                $dataexport[$i]['initial_assessment_hr'] = $data['initial_assessment_hr'];
                $dataexport[$i]['total_admission'] = $data['total_admission'];
                $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
                $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
                $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];

                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- 12.PSQ3a- Incidence of hospital associated pressure ulcers after admission - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function overall_13psq3a_report()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {


            $table_feedback = 'bf_feedback_13PSQ3b';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->quality_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Recorded by';
            $header[1] = 'Month - Year';
            $header[2] = 'Employee details';
            $header[3] = 'Number of urinary catheter associated UTIs';
            $header[4] = 'Number of urinary catheter days';
            $header[5] = 'Catheter associated Urinary tract infection rate';

            $j = 6;


            $header[$j++] = 'Data analysis';
            $header[$j++] = 'Corrective action';
            $header[$j++] = 'Preventive action';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['name'] = $data['name'];
                $dataexport[$i]['date'] = date('M-Y', strtotime($row->datetime));
                $dataexport[$i]['patient_id'] = $data['name'] . "<" . $data['patientid'] . ">\n" .
                    $data['contactnumber'] . "\n" .
                    $data['email'];

                $dataexport[$i]['initial_assessment_hr'] = $data['initial_assessment_hr'];
                $dataexport[$i]['total_admission'] = $data['total_admission'];
                $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
                $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
                $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];

                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- 13.PSQ3b- Catheter associated urinary tract infection rate - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function overall_14psq3a_report()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {


            $table_feedback = 'bf_feedback_14PSQ3b';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->quality_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Recorded by';
            $header[1] = 'Month - Year';
            $header[2] = 'Employee details';
            $header[3] = 'Number of ventilator associated pneumonia';
            $header[4] = 'Number of ventilator days';
            $header[5] = 'Ventilator associated pneumonia rate';

            $j = 6;


            $header[$j++] = 'Data analysis';
            $header[$j++] = 'Corrective action';
            $header[$j++] = 'Preventive action';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['name'] = $data['name'];
                $dataexport[$i]['date'] = date('M-Y', strtotime($row->datetime));
                $dataexport[$i]['patient_id'] = $data['name'] . "<" . $data['patientid'] . ">\n" .
                    $data['contactnumber'] . "\n" .
                    $data['email'];

                $dataexport[$i]['initial_assessment_hr'] = $data['initial_assessment_hr'];
                $dataexport[$i]['total_admission'] = $data['total_admission'];
                $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
                $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
                $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];

                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- 14.PSQ3b- Ventilator associated pneumonia rate - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function overall_15psq3a_report()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {


            $table_feedback = 'bf_feedback_15PSQ3b';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->quality_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Recorded by';
            $header[1] = 'Month - Year';
            $header[2] = 'Employee details';
            $header[3] = 'Number of central line - associated blood stream infections';
            $header[4] = 'No. of central line days';
            $header[5] = 'Central line - associated blood stream infection rate';

            $j = 6;


            $header[$j++] = 'Data analysis';
            $header[$j++] = 'Corrective action';
            $header[$j++] = 'Preventive action';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['name'] = $data['name'];
                $dataexport[$i]['date'] = date('M-Y', strtotime($row->datetime));
                $dataexport[$i]['patient_id'] = $data['name'] . "<" . $data['patientid'] . ">\n" .
                    $data['contactnumber'] . "\n" .
                    $data['email'];

                $dataexport[$i]['initial_assessment_hr'] = $data['initial_assessment_hr'];
                $dataexport[$i]['total_admission'] = $data['total_admission'];
                $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
                $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
                $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];

                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- 15.PSQ3b- Central line - associated blood stream infection rate - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function overall_16psq3a_report()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {


            $table_feedback = 'bf_feedback_16PSQ3b';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->quality_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Recorded by';
            $header[1] = 'Month - Year';
            $header[2] = 'Employee details';
            $header[3] = 'Number of surgical site infections';
            $header[4] = 'Number of surgeries performed';
            $header[5] = 'Surgical site infection rate';

            $j = 6;


            $header[$j++] = 'Data analysis';
            $header[$j++] = 'Corrective action';
            $header[$j++] = 'Preventive action';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['name'] = $data['name'];
                $dataexport[$i]['date'] = date('M-Y', strtotime($row->datetime));
                $dataexport[$i]['patient_id'] = $data['name'] . "<" . $data['patientid'] . ">\n" .
                    $data['contactnumber'] . "\n" .
                    $data['email'];

                $dataexport[$i]['initial_assessment_hr'] = $data['initial_assessment_hr'];
                $dataexport[$i]['total_admission'] = $data['total_admission'];
                $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
                $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
                $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];

                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- 16.PSQ3b- Surgical site infection rate - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function overall_17psq3a_report()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {


            $table_feedback = 'bf_feedback_17PSQ3b';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->quality_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Recorded by';
            $header[1] = 'Month - Year';
            $header[2] = 'Employee details';
            $header[3] = 'Number of hand hygiene actions performed';
            $header[4] = 'Number of hand hygiene opportunities';
            $header[5] = 'Hand hygiene compliance rate';

            $j = 6;


            $header[$j++] = 'Data analysis';
            $header[$j++] = 'Corrective action';
            $header[$j++] = 'Preventive action';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['name'] = $data['name'];
                $dataexport[$i]['date'] = date('M-Y', strtotime($row->datetime));
                $dataexport[$i]['patient_id'] = $data['name'] . "<" . $data['patientid'] . ">\n" .
                    $data['contactnumber'] . "\n" .
                    $data['email'];

                $dataexport[$i]['initial_assessment_hr'] = $data['initial_assessment_hr'];
                $dataexport[$i]['total_admission'] = $data['total_admission'];
                $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
                $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
                $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];

                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- 17.PSQ3b- Hand hygiene compliance rate - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function overall_18psq3a_report()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {


            $table_feedback = 'bf_feedback_18PSQ3b';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->quality_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Recorded by';
            $header[1] = 'Month - Year';
            $header[2] = 'Employee details';
            $header[3] = 'Number of patients who receive appropriate prophylactic antibiotic';
            $header[4] = 'Number of patients who underwent surgeries in the OT';
            $header[5] = 'Percentage of cases who received appropriate prophylactic antibiotics';

            $j = 6;


            $header[$j++] = 'Data analysis';
            $header[$j++] = 'Corrective action';
            $header[$j++] = 'Preventive action';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['name'] = $data['name'];
                $dataexport[$i]['date'] = date('M-Y', strtotime($row->datetime));
                $dataexport[$i]['patient_id'] = $data['name'] . "<" . $data['patientid'] . ">\n" .
                    $data['contactnumber'] . "\n" .
                    $data['email'];

                $dataexport[$i]['initial_assessment_hr'] = $data['initial_assessment_hr'];
                $dataexport[$i]['total_admission'] = $data['total_admission'];
                $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
                $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
                $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];

                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- 18.PSQ3b- Percentage of cases who received appropriate prophylactic antibiotics - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function overall_19psq3a_report()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {


            $table_feedback = 'bf_feedback_19PSQ3c';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->quality_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Recorded by';
            $header[1] = 'Month - Year';
            $header[2] = 'Employee details';
            $header[3] = 'Number of cases rescheduled';
            $header[4] = 'Number of surgeries planned';
            $header[5] = 'Percentage of re-scheduling of surgeries';

            $j = 6;


            $header[$j++] = 'Data analysis';
            $header[$j++] = 'Corrective action';
            $header[$j++] = 'Preventive action';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                echo '<pre>';
                print_r($data);
                echo '</pre>';
                exit;

                $dataexport[$i]['name'] = $data['name'];
                $dataexport[$i]['date'] = date('M-Y', strtotime($row->datetime));
                $dataexport[$i]['patient_id'] = $data['name'] . "<" . $data['patientid'] . ">\n" .
                    $data['contactnumber'] . "\n" .
                    $data['email'];

                $dataexport[$i]['initial_assessment_hr'] = $data['initial_assessment_hr'];
                $dataexport[$i]['total_admission'] = $data['total_admission'];
                $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
                $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
                $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];

                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- 19.PSQ3c- Percentage of re- scheduling of surgeries - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function overall_20psq3a_report()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {


            $table_feedback = 'bf_feedback_20PSQ3c';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->quality_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Recorded by';
            $header[1] = 'Month - Year';
            $header[2] = 'Employee details';
            $header[3] = 'Number of cases rescheduled';
            $header[4] = 'Number of surgeries planned';
            $header[5] = 'Percentage of re-scheduling of surgeries';

            $j = 6;

            $header[$j++] = 'Benchmark time';
            $header[$j++] = 'Data analysis';
            $header[$j++] = 'Corrective action';
            $header[$j++] = 'Preventive action';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['name'] = $data['name'];
                $dataexport[$i]['date'] = date('M-Y', strtotime($row->datetime));
                $dataexport[$i]['patient_id'] = $data['name'] . "<" . $data['patientid'] . ">\n" .
                    $data['contactnumber'] . "\n" .
                    $data['email'];

                $dataexport[$i]['initial_assessment_hr'] = $data['initial_assessment_hr'];
                $dataexport[$i]['total_admission'] = $data['total_admission'];
                $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
                $dataexport[$i]['benchmark'] = $data['benchmark'];
                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
                $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
                $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];

                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- 20.PSQ3c- Turn around time for issue of blood and blood components - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function overall_21psq3a_report()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {


            $table_feedback = 'bf_feedback_21PSQ3c';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->quality_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Recorded by';
            $header[1] = 'Month - Year';
            $header[2] = 'Employee details';
            $header[3] = 'Number of nursing staff';
            $header[4] = 'Number of occupied beds';
            $header[5] = 'Nurse-patient ratio for ICU';

            $j = 6;

            //$header[$j++] = 'Benchmark time';
            $header[$j++] = 'Data analysis';
            $header[$j++] = 'Corrective action';
            $header[$j++] = 'Preventive action';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['name'] = $data['name'];
                $dataexport[$i]['date'] = date('M-Y', strtotime($row->datetime));
                $dataexport[$i]['patient_id'] = $data['name'] . "<" . $data['patientid'] . ">\n" .
                    $data['contactnumber'] . "\n" .
                    $data['email'];

                $dataexport[$i]['initial_assessment_hr'] = $data['initial_assessment_hr'];
                $dataexport[$i]['total_admission'] = $data['total_admission'];
                $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
                //$dataexport[$i]['benchmark'] = $data['benchmark'];
                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
                $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
                $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];

                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- 21.PSQ3c- Nurse-patient ratio for ICUs - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function overall_21apsq3a_report()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {


            $table_feedback = 'bf_feedback_21aPSQ3c';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->quality_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Recorded by';
            $header[1] = 'Month - Year';
            $header[2] = 'Employee details';
            $header[3] = 'Number of nursing staff';
            $header[4] = 'Number of occupied beds';
            $header[5] = 'Nurse-patient ratio for Ward';

            $j = 6;

            //$header[$j++] = 'Benchmark time';
            $header[$j++] = 'Data analysis';
            $header[$j++] = 'Corrective action';
            $header[$j++] = 'Preventive action';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['name'] = $data['name'];
                $dataexport[$i]['date'] = date('M-Y', strtotime($row->datetime));
                $dataexport[$i]['patient_id'] = $data['name'] . "<" . $data['patientid'] . ">\n" .
                    $data['contactnumber'] . "\n" .
                    $data['email'];

                $dataexport[$i]['initial_assessment_hr'] = $data['initial_assessment_hr'];
                $dataexport[$i]['total_admission'] = $data['total_admission'];
                $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
                //$dataexport[$i]['benchmark'] = $data['benchmark'];
                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
                $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
                $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];

                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- 21a.PSQ3c- Nurse-patient ratio for Wards - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function overall_22psq3a_report()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {


            $table_feedback = 'bf_feedback_22PSQ3c';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->quality_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Recorded by';
            $header[1] = 'Month - Year';
            $header[2] = 'Employee details';
            $header[3] = 'Sum of total time for consultation';
            $header[4] = 'Total number of out-patients';
            $header[5] = 'Avg. waiting time for out-patient consultation';

            $j = 6;

            $header[$j++] = 'Benchmark time';
            $header[$j++] = 'Data analysis';
            $header[$j++] = 'Corrective action';
            $header[$j++] = 'Preventive action';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['name'] = $data['name'];
                $dataexport[$i]['date'] = date('M-Y', strtotime($row->datetime));
                $dataexport[$i]['patient_id'] = $data['name'] . "<" . $data['patientid'] . ">\n" .
                    $data['contactnumber'] . "\n" .
                    $data['email'];

                $dataexport[$i]['initial_assessment_hr'] = $data['initial_assessment_hr'];
                $dataexport[$i]['total_admission'] = $data['total_admission'];
                $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
                $dataexport[$i]['benchmark'] = $data['benchmark'];
                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
                $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
                $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];

                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- 22.PSQ3c - Waiting time for out- patient consultation - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function overall_23apsq3a_report()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {


            $table_feedback = 'bf_feedback_23aPSQ4c';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->quality_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Recorded by';
            $header[1] = 'Month - Year';
            $header[2] = 'Employee details';
            $header[3] = 'Sum of total patient reporting time';
            $header[4] = 'Number of patients reported in laboratory';
            $header[5] = 'Avg. waiting time for laboratory';

            $j = 6;

            $header[$j++] = 'Benchmark time';
            $header[$j++] = 'Data analysis';
            $header[$j++] = 'Corrective action';
            $header[$j++] = 'Preventive action';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['name'] = $data['name'];
                $dataexport[$i]['date'] = date('M-Y', strtotime($row->datetime));
                $dataexport[$i]['patient_id'] = $data['name'] . "<" . $data['patientid'] . ">\n" .
                    $data['contactnumber'] . "\n" .
                    $data['email'];

                $dataexport[$i]['initial_assessment_hr'] = $data['initial_assessment_hr'];
                $dataexport[$i]['total_admission'] = $data['total_admission'];
                $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
                $dataexport[$i]['benchmark'] = $data['benchmark'];
                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
                $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
                $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];

                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- 23a.PSQ4c- Waiting time for laboratory diagnostics - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function overall_23bpsq3a_report()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {


            $table_feedback = 'bf_feedback_23bPSQ4c';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->quality_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Recorded by';
            $header[1] = 'Month - Year';
            $header[2] = 'Employee details';
            $header[3] = 'Sum of total patient reporting time';
            $header[4] = 'Number of patients reported in X-Ray';
            $header[5] = 'Avg. waiting time for X-Ray';

            $j = 6;

            $header[$j++] = 'Benchmark time';
            $header[$j++] = 'Data analysis';
            $header[$j++] = 'Corrective action';
            $header[$j++] = 'Preventive action';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['name'] = $data['name'];
                $dataexport[$i]['date'] = date('M-Y', strtotime($row->datetime));
                $dataexport[$i]['patient_id'] = $data['name'] . "<" . $data['patientid'] . ">\n" .
                    $data['contactnumber'] . "\n" .
                    $data['email'];

                $dataexport[$i]['initial_assessment_hr'] = $data['initial_assessment_hr'];
                $dataexport[$i]['total_admission'] = $data['total_admission'];
                $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
                $dataexport[$i]['benchmark'] = $data['benchmark'];
                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
                $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
                $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];

                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- 23b.PSQ4c- Waiting time for X-ray diagnostics - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function overall_23cpsq3a_report()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {


            $table_feedback = 'bf_feedback_23cPSQ4c';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->quality_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Recorded by';
            $header[1] = 'Month - Year';
            $header[2] = 'Employee details';
            $header[3] = 'Sum of total patient reporting time';
            $header[4] = 'Number of patients reported in USG';
            $header[5] = 'Avg. waiting time for USG';

            $j = 6;

            $header[$j++] = 'Benchmark time';
            $header[$j++] = 'Data analysis';
            $header[$j++] = 'Corrective action';
            $header[$j++] = 'Preventive action';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['name'] = $data['name'];
                $dataexport[$i]['date'] = date('M-Y', strtotime($row->datetime));
                $dataexport[$i]['patient_id'] = $data['name'] . "<" . $data['patientid'] . ">\n" .
                    $data['contactnumber'] . "\n" .
                    $data['email'];

                $dataexport[$i]['initial_assessment_hr'] = $data['initial_assessment_hr'];
                $dataexport[$i]['total_admission'] = $data['total_admission'];
                $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
                $dataexport[$i]['benchmark'] = $data['benchmark'];
                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
                $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
                $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];

                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- 23c.PSQ4c- Waiting time for USG diagnostics - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function overall_23dpsq3a_report()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {


            $table_feedback = 'bf_feedback_23dPSQ4c';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->quality_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Recorded by';
            $header[1] = 'Month - Year';
            $header[2] = 'Employee details';
            $header[3] = 'Sum of total patient reporting time';
            $header[4] = 'Number of patients reported in CT scan';
            $header[5] = 'Avg. waiting time for CT scan';

            $j = 6;

            $header[$j++] = 'Benchmark time';
            $header[$j++] = 'Data analysis';
            $header[$j++] = 'Corrective action';
            $header[$j++] = 'Preventive action';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['name'] = $data['name'];
                $dataexport[$i]['date'] = date('M-Y', strtotime($row->datetime));
                $dataexport[$i]['patient_id'] = $data['name'] . "<" . $data['patientid'] . ">\n" .
                    $data['contactnumber'] . "\n" .
                    $data['email'];

                $dataexport[$i]['initial_assessment_hr'] = $data['initial_assessment_hr'];
                $dataexport[$i]['total_admission'] = $data['total_admission'];
                $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
                $dataexport[$i]['benchmark'] = $data['benchmark'];
                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
                $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
                $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];

                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- 23d.PSQ4c- Waiting time for CT scan diagnostics - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }



    public function overall_24gpsq3a_report()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {


            $table_feedback = 'bf_feedback_24PSQ4c';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->quality_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Recorded by';
            $header[1] = 'Month - Year';
            $header[2] = 'Employee details';
            $header[3] = 'Sum of time taken for discharge';
            $header[4] = 'Number of patients discharged';
            $header[5] = 'Avg. time taken for discharge';

            $j = 6;

            $header[$j++] = 'Benchmark time';
            $header[$j++] = 'Data analysis';
            $header[$j++] = 'Corrective action';
            $header[$j++] = 'Preventive action';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['name'] = $data['name'];
                $dataexport[$i]['date'] = date('M-Y', strtotime($row->datetime));
                $dataexport[$i]['patient_id'] = $data['name'] . "<" . $data['patientid'] . ">\n" .
                    $data['contactnumber'] . "\n" .
                    $data['email'];

                $dataexport[$i]['initial_assessment_hr'] = $data['initial_assessment_hr'];
                $dataexport[$i]['total_admission'] = $data['total_admission'];
                $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
                $dataexport[$i]['benchmark'] = $data['benchmark'];
                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
                $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
                $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];

                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- 24.PSQ4c- Time taken for discharge(General Patients) - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function overall_24ipsq3a_report()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {


            $table_feedback = 'bf_feedback_24PSQ4c';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->quality_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Recorded by';
            $header[1] = 'Month - Year';
            $header[2] = 'Employee details';
            $header[3] = 'Sum of time taken for discharge';
            $header[4] = 'Number of patients discharged';
            $header[5] = 'Avg. time taken for discharge';

            $j = 6;

            $header[$j++] = 'Benchmark time';
            $header[$j++] = 'Data analysis';
            $header[$j++] = 'Corrective action';
            $header[$j++] = 'Preventive action';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['name'] = $data['name'];
                $dataexport[$i]['date'] = date('M-Y', strtotime($row->datetime));
                $dataexport[$i]['patient_id'] = $data['name'] . "<" . $data['patientid'] . ">\n" .
                    $data['contactnumber'] . "\n" .
                    $data['email'];

                $dataexport[$i]['initial_assessment_hr'] = $data['initial_assessment_hr'];
                $dataexport[$i]['total_admission'] = $data['total_admission'];
                $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
                $dataexport[$i]['benchmark'] = $data['benchmark'];
                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
                $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
                $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];

                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- 24.PSQ4c- Time taken for discharge(Insurance Patients) - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function overall_24cpsq3a_report()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {


            $table_feedback = 'bf_feedback_24PSQ4c';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->quality_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Recorded by';
            $header[1] = 'Month - Year';
            $header[2] = 'Employee details';
            $header[3] = 'Sum of time taken for discharge';
            $header[4] = 'Number of patients discharged';
            $header[5] = 'Avg. time taken for discharge';

            $j = 6;

            $header[$j++] = 'Benchmark time';
            $header[$j++] = 'Data analysis';
            $header[$j++] = 'Corrective action';
            $header[$j++] = 'Preventive action';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['name'] = $data['name'];
                $dataexport[$i]['date'] = date('M-Y', strtotime($row->datetime));
                $dataexport[$i]['patient_id'] = $data['name'] . "<" . $data['patientid'] . ">\n" .
                    $data['contactnumber'] . "\n" .
                    $data['email'];

                $dataexport[$i]['initial_assessment_hr'] = $data['initial_assessment_hr'];
                $dataexport[$i]['total_admission'] = $data['total_admission'];
                $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
                $dataexport[$i]['benchmark'] = $data['benchmark'];
                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
                $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
                $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];

                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- 24.PSQ4c- Time taken for discharge(Corporate Patients) - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function overall_25psq3a_report()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {


            $table_feedback = 'bf_feedback_25PSQ4c';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->quality_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Recorded by';
            $header[1] = 'Month - Year';
            $header[2] = 'Employee details';
            $header[3] = 'Number of medical records having incomplete/ improper consent';
            $header[4] = 'Number of discharges and deaths';
            $header[5] = 'Percentage of medical records having incomplete/ improper consent';

            $j = 6;

            //$header[$j++] = 'Benchmark time';
            $header[$j++] = 'Data analysis';
            $header[$j++] = 'Corrective action';
            $header[$j++] = 'Preventive action';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['name'] = $data['name'];
                $dataexport[$i]['date'] = date('M-Y', strtotime($row->datetime));
                $dataexport[$i]['patient_id'] = $data['name'] . "<" . $data['patientid'] . ">\n" .
                    $data['contactnumber'] . "\n" .
                    $data['email'];

                $dataexport[$i]['initial_assessment_hr'] = $data['initial_assessment_hr'];
                $dataexport[$i]['total_admission'] = $data['total_admission'];
                $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
                //$dataexport[$i]['benchmark'] = $data['benchmark'];
                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
                $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
                $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];

                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- 25.PSQ4c- Percentage of medical records having incomplete/ improper consent - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function overall_26psq3a_report()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {


            $table_feedback = 'bf_feedback_26PSQ4c';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->quality_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Recorded by';
            $header[1] = 'Month - Year';
            $header[2] = 'Employee details';
            $header[3] = 'Number of stock outs of emergency drugs';
            $header[4] = 'Number of drugs listed as emergency drugs';
            $header[5] = 'Percentage of stock out rate for emergency medications';

            $j = 6;

            //$header[$j++] = 'Benchmark time';
            $header[$j++] = 'Data analysis';
            $header[$j++] = 'Corrective action';
            $header[$j++] = 'Preventive action';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['name'] = $data['name'];
                $dataexport[$i]['date'] = date('M-Y', strtotime($row->datetime));
                $dataexport[$i]['patient_id'] = $data['name'] . "<" . $data['patientid'] . ">\n" .
                    $data['contactnumber'] . "\n" .
                    $data['email'];

                $dataexport[$i]['initial_assessment_hr'] = $data['initial_assessment_hr'];
                $dataexport[$i]['total_admission'] = $data['total_admission'];
                $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
                //$dataexport[$i]['benchmark'] = $data['benchmark'];
                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
                $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
                $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];

                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- 26.PSQ4c- Stock out rate of emergency medications - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function overall_27psq3a_report()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {


            $table_feedback = 'bf_feedback_27PSQ4d';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->quality_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Recorded by';
            $header[1] = 'Month - Year';
            $header[2] = 'Employee details';
            $header[3] = 'Number of variations observed in a mock drill';
            $header[4] = 'Number of opportunities of variations';
            $header[5] = 'Percentage of number of variations observed in mock';

            $j = 6;

            //$header[$j++] = 'Benchmark time';
            $header[$j++] = 'Data analysis';
            $header[$j++] = 'Corrective action';
            $header[$j++] = 'Preventive action';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['name'] = $data['name'];
                $dataexport[$i]['date'] = date('M-Y', strtotime($row->datetime));
                $dataexport[$i]['patient_id'] = $data['name'] . "<" . $data['patientid'] . ">\n" .
                    $data['contactnumber'] . "\n" .
                    $data['email'];

                $dataexport[$i]['initial_assessment_hr'] = $data['initial_assessment_hr'];
                $dataexport[$i]['total_admission'] = $data['total_admission'];
                $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
                //$dataexport[$i]['benchmark'] = $data['benchmark'];
                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
                $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
                $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];

                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- 27.PSQ4d- Number of variations observed in mock drills - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function overall_28psq3a_report()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {


            $table_feedback = 'bf_feedback_28PSQ4d';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->quality_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Recorded by';
            $header[1] = 'Month - Year';
            $header[2] = 'Employee details';
            $header[3] = 'Number of patient falls';
            $header[4] = 'Total number of patient days';
            $header[5] = 'Patient fall rate';

            $j = 6;

            //$header[$j++] = 'Benchmark time';
            $header[$j++] = 'Data analysis';
            $header[$j++] = 'Corrective action';
            $header[$j++] = 'Preventive action';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['name'] = $data['name'];
                $dataexport[$i]['date'] = date('M-Y', strtotime($row->datetime));
                $dataexport[$i]['patient_id'] = $data['name'] . "<" . $data['patientid'] . ">\n" .
                    $data['contactnumber'] . "\n" .
                    $data['email'];

                $dataexport[$i]['initial_assessment_hr'] = $data['initial_assessment_hr'];
                $dataexport[$i]['total_admission'] = $data['total_admission'];
                $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
                //$dataexport[$i]['benchmark'] = $data['benchmark'];
                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
                $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
                $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];

                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- 28.PSQ4d- Patient fall rate - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function overall_29psq3a_report()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {


            $table_feedback = 'bf_feedback_29PSQ4d';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->quality_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Recorded by';
            $header[1] = 'Month - Year';
            $header[2] = 'Employee details';
            $header[3] = 'Number of near misses reported';
            $header[4] = 'Number of incidents reported';
            $header[5] = 'Percentage of near misses';

            $j = 6;

            //$header[$j++] = 'Benchmark time';
            $header[$j++] = 'Data analysis';
            $header[$j++] = 'Corrective action';
            $header[$j++] = 'Preventive action';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['name'] = $data['name'];
                $dataexport[$i]['date'] = date('M-Y', strtotime($row->datetime));
                $dataexport[$i]['patient_id'] = $data['name'] . "<" . $data['patientid'] . ">\n" .
                    $data['contactnumber'] . "\n" .
                    $data['email'];

                $dataexport[$i]['initial_assessment_hr'] = $data['initial_assessment_hr'];
                $dataexport[$i]['total_admission'] = $data['total_admission'];
                $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
                //$dataexport[$i]['benchmark'] = $data['benchmark'];
                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
                $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
                $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];

                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- 29.PSQ4d- Percentage of near misses - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function overall_30psq3a_report()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {


            $table_feedback = 'bf_feedback_30PSQ3d';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->quality_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Recorded by';
            $header[1] = 'Month - Year';
            $header[2] = 'Employee details';
            $header[3] = 'Number of parenteral exposures';
            $header[4] = 'Number of in-patient days';
            $header[5] = 'Incidence of needle stick injuries';

            $j = 6;

            //$header[$j++] = 'Benchmark time';
            $header[$j++] = 'Data analysis';
            $header[$j++] = 'Corrective action';
            $header[$j++] = 'Preventive action';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['name'] = $data['name'];
                $dataexport[$i]['date'] = date('M-Y', strtotime($row->datetime));
                $dataexport[$i]['patient_id'] = $data['name'] . "<" . $data['patientid'] . ">\n" .
                    $data['contactnumber'] . "\n" .
                    $data['email'];

                $dataexport[$i]['initial_assessment_hr'] = $data['initial_assessment_hr'];
                $dataexport[$i]['total_admission'] = $data['total_admission'];
                $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
                //$dataexport[$i]['benchmark'] = $data['benchmark'];
                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
                $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
                $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];

                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- 30.PSQ3d- Incidence of needle stick injuries - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function overall_31psq3a_report()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {


            $table_feedback = 'bf_feedback_31PSQ3d';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->quality_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Recorded by';
            $header[1] = 'Month - Year';
            $header[2] = 'Employee details';
            $header[3] = 'Number of handovers done appropriately';
            $header[4] = 'Number of handover opportunities';
            $header[5] = 'Percentage of appropriate handovers during shift change';

            $j = 6;

            //$header[$j++] = 'Benchmark time';
            $header[$j++] = 'Data analysis';
            $header[$j++] = 'Corrective action';
            $header[$j++] = 'Preventive action';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['name'] = $data['name'];
                $dataexport[$i]['date'] = date('M-Y', strtotime($row->datetime));
                $dataexport[$i]['patient_id'] = $data['name'] . "<" . $data['patientid'] . ">\n" .
                    $data['contactnumber'] . "\n" .
                    $data['email'];

                $dataexport[$i]['initial_assessment_hr'] = $data['initial_assessment_hr'];
                $dataexport[$i]['total_admission'] = $data['total_admission'];
                $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
                //$dataexport[$i]['benchmark'] = $data['benchmark'];
                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
                $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
                $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];

                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- 31.PSQ3d- Appropriate handovers during shift change - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function overall_32psq3a_report()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {


            $table_feedback = 'bf_feedback_32PSQ3d';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->quality_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Recorded by';
            $header[1] = 'Month - Year';
            $header[2] = 'Employee details';
            $header[3] = 'Number of prescriptions in capital letters';
            $header[4] = 'Number of prescriptions';
            $header[5] = 'Percentage of compliance rate to prescription in capitals';

            $j = 6;

            //$header[$j++] = 'Benchmark time';
            $header[$j++] = 'Data analysis';
            $header[$j++] = 'Corrective action';
            $header[$j++] = 'Preventive action';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['name'] = $data['name'];
                $dataexport[$i]['date'] = date('M-Y', strtotime($row->datetime));
                $dataexport[$i]['patient_id'] = $data['name'] . "<" . $data['patientid'] . ">\n" .
                    $data['contactnumber'] . "\n" .
                    $data['email'];

                $dataexport[$i]['initial_assessment_hr'] = $data['initial_assessment_hr'];
                $dataexport[$i]['total_admission'] = $data['total_admission'];
                $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
                //$dataexport[$i]['benchmark'] = $data['benchmark'];
                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
                $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
                $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];

                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- 32.PSQ3d- Compliance rate to medication prescription in capitals - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function overall_psq3a_report()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {


            $table_feedback = 'bf_feedback_PSQ3a';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->quality_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Recorded by';
            $header[1] = 'Month - Year';
            $header[2] = 'Employee details';
            $header[3] = 'Number of readmission to ICU within 48 hours';
            $header[4] = 'Number of admissions';
            $header[5] = 'Percentage of readmission rate';

            $j = 6;

            //$header[$j++] = 'Benchmark time';
            $header[$j++] = 'Data analysis';
            $header[$j++] = 'Corrective action';
            $header[$j++] = 'Preventive action';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['name'] = $data['name'];
                $dataexport[$i]['date'] = date('M-Y', strtotime($row->datetime));
                $dataexport[$i]['patient_id'] = $data['name'] . "<" . $data['patientid'] . ">\n" .
                    $data['contactnumber'] . "\n" .
                    $data['email'];

                $dataexport[$i]['initial_assessment_hr'] = $data['initial_assessment_hr'];
                $dataexport[$i]['total_admission'] = $data['total_admission'];
                $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
                //$dataexport[$i]['benchmark'] = $data['benchmark'];
                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
                $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
                $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];

                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- PSQ3a - Readmission to ICU within 48 hours after being discharged - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function overall_33psq3a_report()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {


            $table_feedback = 'bf_feedback_33PSQ3a';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->quality_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Recorded by';
            $header[1] = 'Month - Year';
            $header[2] = 'Employee details';
            $header[3] = 'Number of patients discharged with diagnosis of CHF with reduced EF';
            $header[4] = 'Number of patients discharged with diagnosis of CHF';
            $header[5] = 'Percentage of Beta-blocker prescription with diagnosis of CHF with reduced EF';

            $j = 6;

            //$header[$j++] = 'Benchmark time';
            $header[$j++] = 'Data analysis';
            $header[$j++] = 'Corrective action';
            $header[$j++] = 'Preventive action';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['name'] = $data['name'];
                $dataexport[$i]['date'] = date('M-Y', strtotime($row->datetime));
                $dataexport[$i]['patient_id'] = $data['name'] . "<" . $data['patientid'] . ">\n" .
                    $data['contactnumber'] . "\n" .
                    $data['email'];

                $dataexport[$i]['initial_assessment_hr'] = $data['initial_assessment_hr'];
                $dataexport[$i]['total_admission'] = $data['total_admission'];
                $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
                //$dataexport[$i]['benchmark'] = $data['benchmark'];
                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
                $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
                $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];

                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- PSQ3a - Percentage of Beta-blocker prescription with a diagnosis of CHF with reduced EF - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function overall_34psq3a_report()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {


            $table_feedback = 'bf_feedback_34PSQ3a';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->quality_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Recorded by';
            $header[1] = 'Month - Year';
            $header[2] = 'Employee details';
            $header[3] = 'Number of AMI patients during primary angioplasty for whom door to balloon time of 90 minutes is achieved';
            $header[4] = 'Number of AMI patients undergoing primary angioplasty';
            $header[5] = 'Percentage of patients with myocardial infarction for whom door to balloon time of 90 minutes';

            $j = 6;

            //$header[$j++] = 'Benchmark time';
            $header[$j++] = 'Data analysis';
            $header[$j++] = 'Corrective action';
            $header[$j++] = 'Preventive action';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['name'] = $data['name'];
                $dataexport[$i]['date'] = date('M-Y', strtotime($row->datetime));
                $dataexport[$i]['patient_id'] = $data['name'] . "<" . $data['patientid'] . ">\n" .
                    $data['contactnumber'] . "\n" .
                    $data['email'];

                $dataexport[$i]['initial_assessment_hr'] = $data['initial_assessment_hr'];
                $dataexport[$i]['total_admission'] = $data['total_admission'];
                $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
                //$dataexport[$i]['benchmark'] = $data['benchmark'];
                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
                $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
                $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];

                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- PSQ3a- Percentage of patients with myocardial infarction for whom door to balloon time of 90 minutes is achieved - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function overall_35psq3a_report()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {


            $table_feedback = 'bf_feedback_35PSQ3a';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->quality_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Recorded by';
            $header[1] = 'Month - Year';
            $header[2] = 'Employee details';
            $header[3] = 'Number of patients with hypoglycemic events where the target glucose level was achieved';
            $header[4] = 'Number of patients with hypoglycemic events';
            $header[5] = 'Percentage of hospitalized patients with hypoglycemia who achieved blood glucose level';

            $j = 6;

            //$header[$j++] = 'Benchmark time';
            $header[$j++] = 'Data analysis';
            $header[$j++] = 'Corrective action';
            $header[$j++] = 'Preventive action';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['name'] = $data['name'];
                $dataexport[$i]['date'] = date('M-Y', strtotime($row->datetime));
                $dataexport[$i]['patient_id'] = $data['name'] . "<" . $data['patientid'] . ">\n" .
                    $data['contactnumber'] . "\n" .
                    $data['email'];

                $dataexport[$i]['initial_assessment_hr'] = $data['initial_assessment_hr'];
                $dataexport[$i]['total_admission'] = $data['total_admission'];
                $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
                //$dataexport[$i]['benchmark'] = $data['benchmark'];
                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
                $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
                $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];

                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- PSQ3a- Percentage of Hospitalized patients with hypoglycemia who achieved targeted blood glucose level - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function overall_36psq3a_report()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {


            $table_feedback = 'bf_feedback_36PSQ3a';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->quality_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Recorded by';
            $header[1] = 'Month - Year';
            $header[2] = 'Employee details';
            $header[3] = 'Number of cases where a spontaneous perineal tear occurs';
            $header[4] = 'Number of vaginal deliveries';
            $header[5] = 'Percentage of cases where a spontaneous perineal tear occurs';

            $j = 6;

            //$header[$j++] = 'Benchmark time';
            $header[$j++] = 'Data analysis';
            $header[$j++] = 'Corrective action';
            $header[$j++] = 'Preventive action';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['name'] = $data['name'];
                $dataexport[$i]['date'] = date('M-Y', strtotime($row->datetime));
                $dataexport[$i]['patient_id'] = $data['name'] . "<" . $data['patientid'] . ">\n" .
                    $data['contactnumber'] . "\n" .
                    $data['email'];

                $dataexport[$i]['initial_assessment_hr'] = $data['initial_assessment_hr'];
                $dataexport[$i]['total_admission'] = $data['total_admission'];
                $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
                //$dataexport[$i]['benchmark'] = $data['benchmark'];
                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
                $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
                $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];

                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- PSQ3a- Spontaneous Perineal Tear Rate - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function overall_37psq3a_report()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {


            $table_feedback = 'bf_feedback_37PSQ3a';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->quality_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Recorded by';
            $header[1] = 'Month - Year';
            $header[2] = 'Employee details';
            $header[3] = 'Number of cases of postoperative endophthalmitis';
            $header[4] = 'Number of ophthalmic surgeries';
            $header[5] = 'Percentage of cases where postoperative endophthalmitis occurs';

            $j = 6;

            //$header[$j++] = 'Benchmark time';
            $header[$j++] = 'Data analysis';
            $header[$j++] = 'Corrective action';
            $header[$j++] = 'Preventive action';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['name'] = $data['name'];
                $dataexport[$i]['date'] = date('M-Y', strtotime($row->datetime));
                $dataexport[$i]['patient_id'] = $data['name'] . "<" . $data['patientid'] . ">\n" .
                    $data['contactnumber'] . "\n" .
                    $data['email'];

                $dataexport[$i]['initial_assessment_hr'] = $data['initial_assessment_hr'];
                $dataexport[$i]['total_admission'] = $data['total_admission'];
                $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
                //$dataexport[$i]['benchmark'] = $data['benchmark'];
                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
                $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
                $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];

                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- PSQ3a- Postoperative Endophthalmitis Rate - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function overall_38psq3a_report()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {


            $table_feedback = 'bf_feedback_38PSQ3a';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->quality_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Recorded by';
            $header[1] = 'Month - Year';
            $header[2] = 'Employee details';
            $header[3] = 'Number of patients sedated for the colonoscopy procedure';
            $header[4] = 'Number of patients undergoing colonoscopy';
            $header[5] = 'Percentage of patients undergoing colonoscopy who are sedated';

            $j = 6;

            //$header[$j++] = 'Benchmark time';
            $header[$j++] = 'Data analysis';
            $header[$j++] = 'Corrective action';
            $header[$j++] = 'Preventive action';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['name'] = $data['name'];
                $dataexport[$i]['date'] = date('M-Y', strtotime($row->datetime));
                $dataexport[$i]['patient_id'] = $data['name'] . "<" . $data['patientid'] . ">\n" .
                    $data['contactnumber'] . "\n" .
                    $data['email'];

                $dataexport[$i]['initial_assessment_hr'] = $data['initial_assessment_hr'];
                $dataexport[$i]['total_admission'] = $data['total_admission'];
                $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
                //$dataexport[$i]['benchmark'] = $data['benchmark'];
                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
                $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
                $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];

                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- PSQ3a- Percentage of patients undergoing colonoscopy who are sedated - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function overall_39psq3a_report()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {


            $table_feedback = 'bf_feedback_39PSQ3a';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->quality_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Recorded by';
            $header[1] = 'Month - Year';
            $header[2] = 'Employee details';
            $header[3] = 'Number of cases where bile duct injuries occurred';
            $header[4] = 'Laparoscopic cholecystectomies performed';
            $header[5] = 'Bile Duct Injury Rate';

            $j = 6;

            //$header[$j++] = 'Benchmark time';
            $header[$j++] = 'Data analysis';
            $header[$j++] = 'Corrective action';
            $header[$j++] = 'Preventive action';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['name'] = $data['name'];
                $dataexport[$i]['date'] = date('M-Y', strtotime($row->datetime));
                $dataexport[$i]['patient_id'] = $data['name'] . "<" . $data['patientid'] . ">\n" .
                    $data['contactnumber'] . "\n" .
                    $data['email'];

                $dataexport[$i]['initial_assessment_hr'] = $data['initial_assessment_hr'];
                $dataexport[$i]['total_admission'] = $data['total_admission'];
                $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
                //$dataexport[$i]['benchmark'] = $data['benchmark'];
                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
                $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
                $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];

                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- PSQ3a - Bile Duct injury rate requiring operative intervention during Laparoscopic cholecystectomy - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function overall_40psq3a_report()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {


            $table_feedback = 'bf_feedback_40PSQ3a';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->quality_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Recorded by';
            $header[1] = 'Month - Year';
            $header[2] = 'Employee details';
            $header[3] = 'Number of POCT tests which resulted in clinical intervention';
            $header[4] = 'Number of POCT tests where clinical intervention was necessary';
            $header[5] = 'Percentage of POCT results that led to clinical intervention';

            $j = 6;

            //$header[$j++] = 'Benchmark time';
            $header[$j++] = 'Data analysis';
            $header[$j++] = 'Corrective action';
            $header[$j++] = 'Preventive action';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['name'] = $data['name'];
                $dataexport[$i]['date'] = date('M-Y', strtotime($row->datetime));
                $dataexport[$i]['patient_id'] = $data['name'] . "<" . $data['patientid'] . ">\n" .
                    $data['contactnumber'] . "\n" .
                    $data['email'];

                $dataexport[$i]['initial_assessment_hr'] = $data['initial_assessment_hr'];
                $dataexport[$i]['total_admission'] = $data['total_admission'];
                $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
                //$dataexport[$i]['benchmark'] = $data['benchmark'];
                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
                $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
                $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];

                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- PSQ3a- Percentage of POCT results which led to a clinical intervention - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function overall_41psq3a_report()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {


            $table_feedback = 'bf_feedback_41PSQ3a';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->quality_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Recorded by';
            $header[1] = 'Month - Year';
            $header[2] = 'Employee details';
            $header[3] = 'Sum of functional gain patients in neurorehabilitation';
            $header[4] = 'Number of patients undergoing neurorehabilitation';
            $header[5] = 'Percentage of neurorehabilitation patient with functional gain';

            $j = 6;

            //$header[$j++] = 'Benchmark time';
            $header[$j++] = 'Data analysis';
            $header[$j++] = 'Corrective action';
            $header[$j++] = 'Preventive action';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['name'] = $data['name'];
                $dataexport[$i]['date'] = date('M-Y', strtotime($row->datetime));
                $dataexport[$i]['patient_id'] = $data['name'] . "<" . $data['patientid'] . ">\n" .
                    $data['contactnumber'] . "\n" .
                    $data['email'];

                $dataexport[$i]['initial_assessment_hr'] = $data['initial_assessment_hr'];
                $dataexport[$i]['total_admission'] = $data['total_admission'];
                $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
                //$dataexport[$i]['benchmark'] = $data['benchmark'];
                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
                $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
                $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];

                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- PSQ3a- Functional gain following rehabilitation - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function overall_42psq3a_report()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {


            $table_feedback = 'bf_feedback_42PSQ3a';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->quality_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Recorded by';
            $header[1] = 'Month - Year';
            $header[2] = 'Employee details';
            $header[3] = 'No.of sepsis patients receiving Hour-1 bundle care';
            $header[4] = 'Total number of sepsis cases';
            $header[5] = 'Percentage of sepsis patients receiving Hour-1 bundle care';

            $j = 6;

            //$header[$j++] = 'Benchmark time';
            $header[$j++] = 'Data analysis';
            $header[$j++] = 'Corrective action';
            $header[$j++] = 'Preventive action';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['name'] = $data['name'];
                $dataexport[$i]['date'] = date('M-Y', strtotime($row->datetime));
                $dataexport[$i]['patient_id'] = $data['name'] . "<" . $data['patientid'] . ">\n" .
                    $data['contactnumber'] . "\n" .
                    $data['email'];

                $dataexport[$i]['initial_assessment_hr'] = $data['initial_assessment_hr'];
                $dataexport[$i]['total_admission'] = $data['total_admission'];
                $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
                //$dataexport[$i]['benchmark'] = $data['benchmark'];
                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
                $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
                $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];

                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- PSQ3a- Percentage of sepsis patients who receive care as per the Hour-1 sepsis bundle - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function overall_43psq3a_report()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {


            $table_feedback = 'bf_feedback_43PSQ3a';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->quality_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Recorded by';
            $header[1] = 'Month - Year';
            $header[2] = 'Employee details';
            $header[3] = 'No. of COPD patients provided with COPD action plan';
            $header[4] = 'No. of COPD patients discharged';
            $header[5] = 'Percentage of COPD patients receiving COPD action plan at the time of discharge';

            $j = 6;

            //$header[$j++] = 'Benchmark time';
            $header[$j++] = 'Data analysis';
            $header[$j++] = 'Corrective action';
            $header[$j++] = 'Preventive action';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['name'] = $data['name'];
                $dataexport[$i]['date'] = date('M-Y', strtotime($row->datetime));
                $dataexport[$i]['patient_id'] = $data['name'] . "<" . $data['patientid'] . ">\n" .
                    $data['contactnumber'] . "\n" .
                    $data['email'];

                $dataexport[$i]['initial_assessment_hr'] = $data['initial_assessment_hr'];
                $dataexport[$i]['total_admission'] = $data['total_admission'];
                $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
                //$dataexport[$i]['benchmark'] = $data['benchmark'];
                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
                $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
                $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];

                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- PSQ3a- Percentage of COPD patients receiving COPD Action plan at the time of discharge - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function overall_44psq3a_report()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {


            $table_feedback = 'bf_feedback_44PSQ3a';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->quality_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Recorded by';
            $header[1] = 'Month - Year';
            $header[2] = 'Employee details';
            $header[3] = 'No. of stroke patients with DTN time within 60 minutes';
            $header[4] = 'No. of stroke patients receiving thrombolytic therapy';
            $header[5] = 'Percentage of stroke patients with DTN time within 60 minutes';

            $j = 6;

            //$header[$j++] = 'Benchmark time';
            $header[$j++] = 'Data analysis';
            $header[$j++] = 'Corrective action';
            $header[$j++] = 'Preventive action';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['name'] = $data['name'];
                $dataexport[$i]['date'] = date('M-Y', strtotime($row->datetime));
                $dataexport[$i]['patient_id'] = $data['name'] . "<" . $data['patientid'] . ">\n" .
                    $data['contactnumber'] . "\n" .
                    $data['email'];

                $dataexport[$i]['initial_assessment_hr'] = $data['initial_assessment_hr'];
                $dataexport[$i]['total_admission'] = $data['total_admission'];
                $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
                //$dataexport[$i]['benchmark'] = $data['benchmark'];
                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
                $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
                $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];

                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- PSQ3a- Percentage of stroke patients in whom the Door-to-Needle Time (DTN) of 60 minutes is achieved  - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function overall_45psq3a_report()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {


            $table_feedback = 'bf_feedback_45PSQ3a';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->quality_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Recorded by';
            $header[1] = 'Month - Year';
            $header[2] = 'Employee details';
            $header[3] = 'No. of patients treated inappropriately';
            $header[4] = 'Total no. of patients with bronchiolitis';
            $header[5] = 'Percentage of bronchiolitis patients treated inappropriately';

            $j = 6;

            //$header[$j++] = 'Benchmark time';
            $header[$j++] = 'Data analysis';
            $header[$j++] = 'Corrective action';
            $header[$j++] = 'Preventive action';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['name'] = $data['name'];
                $dataexport[$i]['date'] = date('M-Y', strtotime($row->datetime));
                $dataexport[$i]['patient_id'] = $data['name'] . "<" . $data['patientid'] . ">\n" .
                    $data['contactnumber'] . "\n" .
                    $data['email'];

                $dataexport[$i]['initial_assessment_hr'] = $data['initial_assessment_hr'];
                $dataexport[$i]['total_admission'] = $data['total_admission'];
                $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
                //$dataexport[$i]['benchmark'] = $data['benchmark'];
                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
                $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
                $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];

                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- PSQ3a- Percentage of bronchiolitis patients treated inappropriately  - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function overall_46psq3a_report()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {


            $table_feedback = 'bf_feedback_46PSQ3a';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->quality_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Recorded by';
            $header[1] = 'Month - Year';
            $header[2] = 'Employee details';
            $header[3] = 'No. of oncology patients treated post tumour board';
            $header[4] = 'No. of oncology cases treated';
            $header[5] = 'Percentage of oncology patients treated post tumour board';

            $j = 6;

            //$header[$j++] = 'Benchmark time';
            $header[$j++] = 'Data analysis';
            $header[$j++] = 'Corrective action';
            $header[$j++] = 'Preventive action';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['name'] = $data['name'];
                $dataexport[$i]['date'] = date('M-Y', strtotime($row->datetime));
                $dataexport[$i]['patient_id'] = $data['name'] . "<" . $data['patientid'] . ">\n" .
                    $data['contactnumber'] . "\n" .
                    $data['email'];

                $dataexport[$i]['initial_assessment_hr'] = $data['initial_assessment_hr'];
                $dataexport[$i]['total_admission'] = $data['total_admission'];
                $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
                //$dataexport[$i]['benchmark'] = $data['benchmark'];
                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
                $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
                $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];

                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- PSQ3a- Percentage of oncology patients who had treatment initiated following Multidisciplinary meeting  - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function overall_47psq3a_report()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {


            $table_feedback = 'bf_feedback_47PSQ3a';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->quality_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Recorded by';
            $header[1] = 'Month - Year';
            $header[2] = 'Employee details';
            $header[3] = 'No. of patients who developed adverse reaction';
            $header[4] = 'No. of patients receiving the radiopharmaceutical';
            $header[5] = 'Percentage of adverse reaction to radiopharmaceutical';

            $j = 6;

            //$header[$j++] = 'Benchmark time';
            $header[$j++] = 'Data analysis';
            $header[$j++] = 'Corrective action';
            $header[$j++] = 'Preventive action';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['name'] = $data['name'];
                $dataexport[$i]['date'] = date('M-Y', strtotime($row->datetime));
                $dataexport[$i]['patient_id'] = $data['name'] . "<" . $data['patientid'] . ">\n" .
                    $data['contactnumber'] . "\n" .
                    $data['email'];

                $dataexport[$i]['initial_assessment_hr'] = $data['initial_assessment_hr'];
                $dataexport[$i]['total_admission'] = $data['total_admission'];
                $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
                //$dataexport[$i]['benchmark'] = $data['benchmark'];
                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
                $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
                $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];

                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- PSQ3a- Percentage of adverse reaction to radiopharmaceutical  - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function overall_48psq3a_report()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {


            $table_feedback = 'bf_feedback_48PSQ3a';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->quality_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Recorded by';
            $header[1] = 'Month - Year';
            $header[2] = 'Employee details';
            $header[3] = 'No. of contrast extravasation';
            $header[4] = 'No. of patients receiving contrast';
            $header[5] = 'Percentage of Intravenous contrast media extravasation';

            $j = 6;

            //$header[$j++] = 'Benchmark time';
            $header[$j++] = 'Data analysis';
            $header[$j++] = 'Corrective action';
            $header[$j++] = 'Preventive action';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['name'] = $data['name'];
                $dataexport[$i]['date'] = date('M-Y', strtotime($row->datetime));
                $dataexport[$i]['patient_id'] = $data['name'] . "<" . $data['patientid'] . ">\n" .
                    $data['contactnumber'] . "\n" .
                    $data['email'];

                $dataexport[$i]['initial_assessment_hr'] = $data['initial_assessment_hr'];
                $dataexport[$i]['total_admission'] = $data['total_admission'];
                $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
                //$dataexport[$i]['benchmark'] = $data['benchmark'];
                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
                $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
                $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];

                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- PSQ3a- Percentage of Intravenous Contrast Media Extravasation  - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function overall_49psq3a_report()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {


            $table_feedback = 'bf_feedback_49PSQ3a';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->quality_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Recorded by';
            $header[1] = 'Month - Year';
            $header[2] = 'Employee details';
            $header[3] = 'Sum of time taken for triage';
            $header[4] = 'Total no. of patients coming to the emergency';
            $header[5] = 'Avg. waiting time for triage';

            $j = 6;

            $header[$j++] = 'Benchmark time';
            $header[$j++] = 'Data analysis';
            $header[$j++] = 'Corrective action';
            $header[$j++] = 'Preventive action';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['name'] = $data['name'];
                $dataexport[$i]['date'] = date('M-Y', strtotime($row->datetime));
                $dataexport[$i]['patient_id'] = $data['name'] . "<" . $data['patientid'] . ">\n" .
                    $data['contactnumber'] . "\n" .
                    $data['email'];

                $dataexport[$i]['initial_assessment_hr'] = $data['initial_assessment_hr'];
                $dataexport[$i]['total_admission'] = $data['total_admission'];
                $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
                $dataexport[$i]['benchmark'] = $data['benchmark'];
                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
                $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
                $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];

                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- PSQ3a- Time taken for triage  - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function overall_50psq3a_report()
    {

        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {


            $table_feedback = 'bf_feedback_50PSQ3a';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->quality_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $header[0] = 'Recorded by';
            $header[1] = 'Month - Year';
            $header[2] = 'Employee details';
            $header[3] = 'No. of dialysis patients with target hemoglobin';
            $header[4] = 'Total no. of patients undergoing dialysis';
            $header[5] = 'Percentage of dialysis patients with target hemoglobin levels';

            $j = 6;

            //$header[$j++] = 'Benchmark time';
            $header[$j++] = 'Data analysis';
            $header[$j++] = 'Corrective action';
            $header[$j++] = 'Preventive action';

            $dataexport = [];
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);

                // echo '<pre>';
                // print_r($data);
                // echo '</pre>';
                // exit;

                $dataexport[$i]['name'] = $data['name'];
                $dataexport[$i]['date'] = date('M-Y', strtotime($row->datetime));
                $dataexport[$i]['patient_id'] = $data['name'] . "<" . $data['patientid'] . ">\n" .
                    $data['contactnumber'] . "\n" .
                    $data['email'];

                $dataexport[$i]['initial_assessment_hr'] = $data['initial_assessment_hr'];
                $dataexport[$i]['total_admission'] = $data['total_admission'];
                $dataexport[$i]['calculatedResult'] = $data['calculatedResult'];
                //$dataexport[$i]['benchmark'] = $data['benchmark'];
                $dataexport[$i]['dataAnalysis'] = $data['dataAnalysis'];
                $dataexport[$i]['correctiveAction'] = $data['correctiveAction'];
                $dataexport[$i]['preventiveAction'] = $data['preventiveAction'];

                $i++;
            }


            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF- PSQ3a-  Percentage of patients undergoing dialysis who are able to achieve target hemoglobin levels  - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }

    //consoldited report 
    public function export_all_kpi()
    {
        $this->load->library('spreadsheet');

        // Define KPI tables and headers
        $kpiList = [
            [
                'table' => 'bf_feedback_1PSQ3a',
                'sheet' => '1.PSQ3a- Initial Assessment',
                'header' => [
                    'Recorded by',
                    'Month - Year',
                    'Employee details',
                    'Sum of time taken for initial assessment',
                    'Total number of admissions',
                    'Avg. time taken for initial assessment',
                    'Benchmark time',
                    'Data analysis',
                    'Corrective action',
                    'Preventive action'
                ]
            ],
            [
                'table' => 'bf_feedback_2PSQ3a',
                'sheet' => '2.PSQ3a- Number of reporting errors',
                'header' => [
                    'Recorded by',
                    'Month - Year',
                    'Employee details',
                    'No. of reporting errors',
                    'No. of tests performed',
                    'No. of reporting errors per 1000 investigations',
                    'Data analysis',
                    'Corrective action',
                    'Preventive action'
                ]
            ],
        ];

        $firstSheet = true;
        foreach ($kpiList as $kpi) {
            $feedbackData = $this->quality_model->patient_and_feedback('bf_patients', $kpi['table'], 'desc');

            // Create valid sheet name (max 31 chars)
            $sheetName = substr($kpi['sheet'], 0, 31);

            if ($firstSheet) {
                $sheet = $this->spreadsheet->getActiveSheet();
                $sheet->setTitle($sheetName);
                $firstSheet = false;
            } else {
                $sheet = $this->spreadsheet->addSheetWithTitle($sheetName);
            }

            $sheet->fromArray([$kpi['header']], null, 'A1');

            $rowIndex = 2;
            foreach ($feedbackData as $row) {
                $data = json_decode($row->dataset, true);

                if ($kpi['table'] === 'bf_feedback_1PSQ3a') {
                    $rowValues = [
                        $data['name'],
                        date('M-Y', strtotime($row->datetime)),
                        $data['name'] . "<" . $data['patientid'] . ">\n" . $data['contactnumber'] . "\n" . $data['email'],
                        $data['initial_assessment_total'],
                        $data['total_admission'],
                        $data['calculatedResult'],
                        $data['benchmark'],
                        $data['dataAnalysis'],
                        $data['correctiveAction'],
                        $data['preventiveAction']
                    ];
                } elseif ($kpi['table'] === 'bf_feedback_2PSQ3a') {
                    $rowValues = [
                        $data['name'],
                        date('M-Y', strtotime($row->datetime)),
                        $data['name'] . "<" . $data['patientid'] . ">\n" . $data['contactnumber'] . "\n" . $data['email'],
                        $data['initial_assessment_hr'],
                        $data['total_admission'],
                        $data['calculatedResult'],
                        $data['dataAnalysis'],
                        $data['correctiveAction'],
                        $data['preventiveAction']
                    ];
                }

                $sheet->fromArray([$rowValues], null, 'A' . $rowIndex);
                $sheet->getStyle('C' . $rowIndex)->getAlignment()->setWrapText(true);
                $rowIndex++;
            }
        }

        $this->spreadsheet->download('NABH_KPI_Report.xlsx');
    }



    //END OF QUAILTY KPI




    // IP DASHBOARD DOWNLOADS

    public function downloadcomments()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {


            $table_feedback = 'bf_feedback';
            $table_patients = 'bf_patients';
            $desc = 'desc';
            $setup = 'setup';

            $feedbacktaken = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $desc);
            $sresult = $this->quality_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();
            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }
            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();
            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }

            $header[0] = 'Date';
            $header[1] = 'Patient Name';
            $header[2] = 'Patient ID';
            $header[3] = 'Floor/Ward';
            $header[4] = 'Room/Bed';
            $header[5] = 'Mobile Number';
            $j = 6;
            $header[$j++] = 'Average Rating';
            $header[$j++] = 'NPS Score';
            $header[$j++] = 'Comments';
            foreach ($setarray as $r) {
                $header[$j] = $r;
                $j++;
            }
            $dataexport = array();
            $i = 0;
            foreach ($feedbacktaken as $row) {
                $data = json_decode($row->dataset, true);
                $dataexport[$i]['date'] = date('d-m-Y', strtotime($row->datetime));
                $dataexport[$i]['name'] = $data['name'];
                $dataexport[$i]['patient_id'] = $data['patientid'];
                $dataexport[$i]['ward'] = $data['ward'];
                $dataexport[$i]['bedno'] = $data['bedno'];
                $dataexport[$i]['mobile'] = $data['contactnumber'];
                $dataexport[$i]['overallScore'] = $data['overallScore'];
                $dataexport[$i]['recommend1Score'] = ($data['recommend1Score']) * 2;

                $dataexport[$i]['suggestionText'] = $data['suggestionText'];
                foreach ($setarray as $key => $t) {
                    if ($data['comment'][$key] != '') {
                        $dataexport[$i][$key] = $data['comment'][$key];
                    } else {
                        $dataexport[$i][$key] = '';
                    }
                }
                $i++;
            }
            $newdataset = $dataexport;
            $d = array();
            $p = array();
            $n = array();
            $para = array();
            $for5 = array();
            $for4 = array();
            $for3 = array();
            $for2 = array();
            $for1 = array();
            foreach ($dataexport as $row) {
                foreach ($row as $k => $r) {
                    if ($r * 1 > 0) {
                        $d[$k] = $d[$k] + 1;
                        if ($r > 2) {
                            $p[$k] = $p[$k] + 1;
                        } else {
                            $n[$k] = $n[$k] + 1;
                        }
                        $para[$k] = $para[$k] + $r;
                        if ($k == 'overallScore') {
                            if ($r == 5) {
                                $for5[$k] = $for5[$k] + 1;
                            }
                            if ($r == 4) {
                                $for4[$k] = $for4[$k] + 1;
                            }
                            if ($r == 3) {
                                $for3[$k] = $for3[$k] + 1;
                            }
                            if ($r == 2) {
                                $for2[$k] = $for2[$k] + 1;
                            }
                            if ($r == 1) {
                                $for1[$k] = $for1[$k] + 1;
                            }
                        }
                    }
                }
            }

            ob_end_clean();
            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];

            $fileName = 'EF- IPD PATIENT COMMENTS - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }



    public function overall_excel_report()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {

            $table_feedback = 'bf_feedback';
            $table_patients = 'bf_patients';
            $sorttime = 'asc';
            $setup = 'setup';
            $asc = 'asc';
            $desc = 'desc';
            $table_tickets = 'tickets';
            $open = 'Open';
            $closed = 'Closed';
            $addressed = 'Addressed';
            $type = 'inpatient';

            $ip_feedbacks_count = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $sorttime, $setup);
            $ticket_resolution_rate = $this->quality_model->ticket_resolution_rate($table_tickets, $closed, $table_feedback);
            $ip_tickets_count = $this->tickets_model->alltickets();
            $ip_open_tickets = $this->tickets_model->read();
            $ip_closed_tickets = $this->tickets_model->read_close();
            $ip_addressed_tickets = $this->tickets_model->addressedtickets();

            $ip_nps = $this->quality_model->nps_analytics($table_feedback, $asc, $setup);
            $ip_psat = $this->quality_model->psat_analytics($table_patients, $table_feedback, $table_tickets, $sorttime);

            $dataexport = array();
            $i = 0;

            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];

            $dataexport[$i]['row1'] = 'IPD FEEDBACK OVERALL REPORT';
            $dataexport[$i]['row2'] = '';
            $dataexport[$i]['row3'] = '';
            $dataexport[$i]['row4'] = '';
            $i++;

            $dataexport[$i]['row1'] = 'FROM DATE';
            $dataexport[$i]['row2'] = $tdate;
            $dataexport[$i]['row3'] = '';
            $dataexport[$i]['row4'] = '';
            $i++;

            $dataexport[$i]['row1'] = 'TO DATE';
            $dataexport[$i]['row2'] = $fdate;
            $dataexport[$i]['row3'] = '';
            $dataexport[$i]['row4'] = '';
            $i++;

            $dataexport[$i]['row1'] = 'TOTAL FEEDBACKS SUBMITTED';
            $dataexport[$i]['row2'] = count($ip_feedbacks_count);
            $dataexport[$i]['row3'] = '';
            $dataexport[$i]['row4'] = '';
            $i++;

            $dataexport[$i]['row1'] = '';
            $dataexport[$i]['row2'] = '';
            $dataexport[$i]['row3'] = '';
            $dataexport[$i]['row4'] = '';
            $i++;


            $dataexport[$i]['row1'] = 'SATISFACTION INDEX';
            $dataexport[$i]['row2'] = $ip_psat['psat_score'] . '%';
            $dataexport[$i]['row3'] = '';
            $dataexport[$i]['row4'] = '';
            $i++;

            $dataexport[$i]['row1'] = 'SATISFIED PATIENTS';
            $dataexport[$i]['row2'] =  $ip_psat['satisfied_count'];
            $dataexport[$i]['row3'] = '';
            $dataexport[$i]['row4'] = '';
            $i++;

            $dataexport[$i]['row1'] = 'UNSATISFIED PATIENTS';
            $dataexport[$i]['row2'] = $ip_psat['unsatisfied_count'];
            $dataexport[$i]['row3'] = '';
            $dataexport[$i]['row4'] = '';
            $i++;

            $dataexport[$i]['row1'] = '';
            $dataexport[$i]['row2'] = '';
            $dataexport[$i]['row3'] = '';
            $dataexport[$i]['row4'] = '';
            $i++;

            //add here
            $dataexport[$i]['row1'] = 'NET PROMOTER SCORE';
            $dataexport[$i]['row2'] =  $ip_nps['nps_score'] . '%';
            $dataexport[$i]['row3'] = '';
            $dataexport[$i]['row4'] = '';
            $i++;

            $dataexport[$i]['row1'] = 'NO. OF PROMOTERS';
            $dataexport[$i]['row2'] = $ip_nps['promoters_count'];
            $dataexport[$i]['row3'] = '';
            $dataexport[$i]['row4'] = '';
            $i++;

            $dataexport[$i]['row1'] = 'NO. OF PASSIVES';
            $dataexport[$i]['row2'] = $ip_nps['passives_count'];
            $dataexport[$i]['row3'] = '';
            $dataexport[$i]['row4'] = '';
            $i++;

            $dataexport[$i]['row1'] = 'NO. OF DETRACTORS';
            $dataexport[$i]['row2'] = $ip_nps['detractors_count'];
            $dataexport[$i]['row3'] = '';
            $dataexport[$i]['row4'] = '';
            $i++;


            $dataexport[$i]['row1'] = '';
            $dataexport[$i]['row2'] = '';
            $dataexport[$i]['row3'] = '';
            $dataexport[$i]['row4'] = '';
            $i++;


            $dataexport[$i]['row1'] = 'TICKETS REPORT';
            $dataexport[$i]['row2'] = '';
            $dataexport[$i]['row3'] = '';
            $dataexport[$i]['row4'] = '';
            $i++;

            $dataexport[$i]['row1'] = 'TOTAL TICKETS';
            $dataexport[$i]['row2'] = count($ip_tickets_count);
            $dataexport[$i]['row3'] = '';
            $dataexport[$i]['row4'] = '';
            $i++;

            $dataexport[$i]['row1'] = 'TICKET RESOLUTION RATE';
            $dataexport[$i]['row2'] = $ticket_resolution_rate . '%';
            $dataexport[$i]['row3'] = '';
            $dataexport[$i]['row4'] = '';
            $i++;
            $dataexport[$i]['row1'] = 'OPEN TICKETS';
            $dataexport[$i]['row2'] = count($ip_open_tickets);
            $dataexport[$i]['row3'] = '';
            $dataexport[$i]['row4'] = '';
            $i++;
            if (ticket_addressal('ip_addressal') === true) {
                $dataexport[$i]['row1'] = 'ADDRESSED TICKETS';
                $dataexport[$i]['row2'] = count($ip_addressed_tickets);
                $dataexport[$i]['row3'] = '';
                $dataexport[$i]['row4'] = '';
                $i++;
            }
            $dataexport[$i]['row1'] = 'CLOSED TICKETS';
            $dataexport[$i]['row2'] = count($ip_closed_tickets);
            $dataexport[$i]['row3'] = '';
            $dataexport[$i]['row4'] = '';
            $i++;

            $dataexport[$i]['row1'] = '';
            $dataexport[$i]['row2'] = '';
            $dataexport[$i]['row3'] = '';
            $dataexport[$i]['row4'] = '';
            $i++;



            $dataexport[$i]['row1'] = 'TICKETS RECEIVED BY DEPARTMENT';
            $dataexport[$i]['row2'] = 'PERCENTAGE';
            $dataexport[$i]['row3'] = 'COUNT';
            $dataexport[$i]['row4'] = 'OPEN';
            if (ticket_addressal('ip_addressal') === true) {

                $dataexport[$i]['row5'] = 'ADDRESSED';
            }
            $dataexport[$i]['row6'] = 'CLOSED';
            $dataexport[$i]['row7'] = 'RESOLUTION RATE';
            $dataexport[$i]['row8'] = 'RESOLUTION TIME';
            $dataexport[$i]['row9'] = '';
            $i++;

            $ticket = $this->quality_model->tickets_recived_by_department($type, $table_feedback, $table_tickets);
            foreach ($ticket as $ps) {
                $time = secondsToTimeforreport($ps['res_time']);
                $dataexport[$i]['row1'] = $ps['department'];
                $dataexport[$i]['row2'] = $ps['percentage'] . '%';
                $dataexport[$i]['row3'] = $ps['count'];
                $dataexport[$i]['row4'] = $ps['open_tickets'];
                if (ticket_addressal('ip_addressal') === true) {

                    $dataexport[$i]['row5'] = $ps['addressed_tickets'];
                }
                $dataexport[$i]['row6'] = $ps['closed_tickets'];
                $dataexport[$i]['row6'] = $ps['closed_tickets'];
                $dataexport[$i]['row7'] = $ps['tr_rate'] . '%';
                $dataexport[$i]['row8'] = $time;
                $dataexport[$i]['row9'] = '';
                $i++;
            }

            $dataexport[$i]['row1'] = '';
            $dataexport[$i]['row2'] = '';
            $dataexport[$i]['row3'] = '';
            $dataexport[$i]['row4'] = '';
            $i++;


            $dataexport[$i]['row1'] = 'WHY PATIENTS CHOSE YOUR HOSPITAL';
            $dataexport[$i]['row2'] = '';
            $dataexport[$i]['row3'] = '';
            $dataexport[$i]['row4'] = '';
            $i++;

            $dataexport[$i]['row1'] = 'REASON';
            $dataexport[$i]['row2'] = 'PERCENTAGE';
            $dataexport[$i]['row3'] = 'COUNT';
            $dataexport[$i]['row4'] = '';
            $i++;


            $choice_of_hospitals = $this->quality_model->reason_to_choose_hospital($table_feedback, $sorttime);

            foreach ($choice_of_hospitals as $key => $object) {

                $dataexport[$i]['row1'] = $object->title;
                $dataexport[$i]['row2'] =  $object->percentage . '%';
                $dataexport[$i]['row3'] = $object->count;
                $dataexport[$i]['row4'] = '';
                $i++;
            }


            $dataexport[$i]['row1'] = '';
            $dataexport[$i]['row2'] = '';
            $dataexport[$i]['row3'] = '';
            $dataexport[$i]['row4'] = '';
            $i++;

            $dataexport[$i]['row1'] = '';
            $dataexport[$i]['row2'] = '';
            $dataexport[$i]['row3'] = '';
            $dataexport[$i]['row4'] = '';
            $i++;
            //echo '<pre>';
            //print_r($dataexport); exit; 
            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            ob_end_clean();
            $fileName = 'EF - OVERALL IPD FEEDBACKS REPORT  - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                //fputcsv($fp, $header,',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }


    public function overall_department_excel()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {


            $dataexport = array();
            $i = 0;
            $table_feedback = 'bf_feedback';
            $table_patients = 'bf_patients';
            $sorttime = 'asc';
            $setup = 'setup';
            $asc = 'asc';
            $desc = 'desc';
            $table_tickets = 'tickets';
            $open = 'Open';
            $closed = 'Closed';
            $addressed = 'Addressed';
            $type = 'inpatient';

            $ip_tickets_count = $this->tickets_model->alltickets();
            $ip_open_tickets = $this->tickets_model->read();
            $ip_closed_tickets = $this->tickets_model->read_close();
            $ip_addressed_tickets = $this->tickets_model->addressedtickets();
            $ip_feedbacks_count = $this->quality_model->patient_and_feedback($table_patients, $table_feedback, $sorttime, $setup);

            $ticket_resolution_rate = $this->quality_model->ticket_resolution_rate($table_tickets, $closed, $table_feedback);

            $sresult = $this->quality_model->setup_result($setup);
            $setarray = array();
            $questioarray = array();

            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];

            $dataexport[$i]['row1'] = 'TICKETS REPORT';
            $dataexport[$i]['row2'] = '';
            $dataexport[$i]['row3'] = '';
            $dataexport[$i]['row4'] = '';
            $i++;


            $dataexport[$i]['row1'] = 'FROM DATE';
            $dataexport[$i]['row2'] = $tdate;
            $dataexport[$i]['row3'] = '';
            $dataexport[$i]['row4'] = '';
            $i++;

            $dataexport[$i]['row1'] = 'TO DATE';
            $dataexport[$i]['row2'] = $fdate;
            $dataexport[$i]['row3'] = '';
            $dataexport[$i]['row4'] = '';
            $i++;

            $dataexport[$i]['row1'] = 'TOTAL FEEDBACKS SUBMITTED';
            $dataexport[$i]['row2'] = count($ip_feedbacks_count);
            $dataexport[$i]['row3'] = '';
            $dataexport[$i]['row4'] = '';
            $i++;

            $dataexport[$i]['row1'] = '';
            $dataexport[$i]['row2'] = '';
            $dataexport[$i]['row3'] = '';
            $dataexport[$i]['row4'] = '';
            $i++;


            $dataexport[$i]['row1'] = 'TOTAL TICKETS';
            $dataexport[$i]['row2'] = count($ip_tickets_count);
            $dataexport[$i]['row3'] = '';
            $dataexport[$i]['row4'] = '';
            $i++;

            $dataexport[$i]['row1'] = 'TICKET RESOLUTION RATE';
            $dataexport[$i]['row2'] = $ticket_resolution_rate . '%';
            $dataexport[$i]['row3'] = '';
            $dataexport[$i]['row4'] = '';
            $i++;

            $dataexport[$i]['row1'] = 'OPEN TICKETS';
            $dataexport[$i]['row2'] = count($ip_open_tickets);
            $dataexport[$i]['row3'] = '';
            $dataexport[$i]['row4'] = '';
            $i++;


            if (ticket_addressal('ip_addressal') === true) {
                $dataexport[$i]['row1'] = 'ADDRESSED TICKETS';
                $dataexport[$i]['row2'] = count($ip_addressed_tickets);
                $dataexport[$i]['row3'] = '';
                $dataexport[$i]['row4'] = '';
                $i++;
            }

            $dataexport[$i]['row1'] = 'CLOSED TICKETS';
            $dataexport[$i]['row2'] = count($ip_closed_tickets);
            $dataexport[$i]['row3'] = '';
            $dataexport[$i]['row4'] = '';
            $i++;

            $dataexport[$i]['row1'] = '';
            $dataexport[$i]['row2'] = '';
            $dataexport[$i]['row3'] = '';
            $dataexport[$i]['row4'] = '';
            $i++;


            $dataexport[$i]['row1'] = 'TICKETS RECEIVED BY DEPARTMENT';
            $dataexport[$i]['row2'] = 'PERCENTAGE';
            $dataexport[$i]['row3'] = 'COUNT';
            $dataexport[$i]['row4'] = 'OPEN';
            if (ticket_addressal('ip_addressal') === true) {
                $dataexport[$i]['row5'] = 'ADDRESSED';
            }
            $dataexport[$i]['row6'] = 'CLOSED';
            $dataexport[$i]['row7'] = 'RESOLUTION RATE';
            $dataexport[$i]['row8'] = 'RESOLUTION TIME';
            $dataexport[$i]['row9'] = '';
            $i++;

            $ticket = $this->quality_model->tickets_recived_by_department($type, $table_feedback, $table_tickets);
            foreach ($ticket as $ps) {
                $time = secondsToTimeforreport($ps['res_time']);
                $dataexport[$i]['row1'] = $ps['department'];
                $dataexport[$i]['row2'] = $ps['percentage'] . '%';
                $dataexport[$i]['row3'] = $ps['count'];
                $dataexport[$i]['row4'] = $ps['open_tickets'];
                if (ticket_addressal('ip_addressal') === true) {
                    $dataexport[$i]['row5'] = $ps['addressed_tickets'];
                }
                $dataexport[$i]['row6'] = $ps['closed_tickets'];
                $dataexport[$i]['row7'] = $ps['tr_rate'] . '%';
                $dataexport[$i]['row8'] = $time;
                $dataexport[$i]['row9'] = '';
                $i++;
            }


            $dataexport[$i]['row1'] = '';
            $dataexport[$i]['row2'] = '';
            $dataexport[$i]['row3'] = '';
            $dataexport[$i]['row4'] = '';
            $i++;


            foreach ($sresult as $r) {
                $setarray[$r->type] = $r->title;
            }

            foreach ($sresult as $r) {
                $questioarray[$r->type][$r->shortkey] = $r->shortname;
            }

            $arraydata = array();

            foreach ($questioarray as $setr) {
                foreach ($setr as $k => $v) {
                    $arraydata[$k] = $v;
                }
            }


            $dataexport[$i]['row1'] = 'DEPARTMENT WISE FEEDBACK REPORT';
            $dataexport[$i]['row2'] = '';
            $dataexport[$i]['row3'] = '';
            $dataexport[$i]['row4'] = '';
            $i++;

            $k = 2;
            $dataexport[$i]['name'] = 'TITLE';
            foreach ($arraydata as $k => $r) {
                $dataexport[$i][$k] = $r;
                $k++;
            }
            $i++;



            $d = array();
            $p = array();
            $n = array();
            $para = array();
            $for5 = array();
            $for4 = array();
            $for3 = array();
            $for2 = array();
            $for1 = array();

            foreach ($ip_feedbacks_count as $row) {
                $data = json_decode($row->dataset, true);
                $dataexportt[$i]['name'] = $data['name'];
                $dataexportt[$i]['patient_id'] = $data['patientid'];
                $dataexportt[$i]['mobile'] = $data['mobile'];
                $dataexportt[$i]['email'] = $data['email'];
                foreach ($arraydata as $k => $r) {
                    $dataexportt[$i][$k] = $data[$k];
                }
                $dataexportt[$i]['overallScore'] = $data['overallScore'];
                $i++;
            }
            $i++;

            foreach ($dataexportt as $row) {
                foreach ($row as $k => $r) {
                    if ($r * 1 > 0) {
                        $d[$k] = $d[$k] + 1;
                        if ($r > 2) {
                            $p[$k] = $p[$k] + 1;
                        } else {
                            $n[$k] = $n[$k] + 1;
                        }
                        $para[$k] = $para[$k] + $r;
                        if ($k == 'overallScore') {
                            if ($r == 5) {
                                $for5[$k] = $for5[$k] + 1;
                            }
                            if ($r == 4) {
                                $for4[$k] = $for4[$k] + 1;
                            }
                            if ($r == 3) {
                                $for3[$k] = $for3[$k] + 1;
                            }
                            if ($r == 2) {
                                $for2[$k] = $for2[$k] + 1;
                            }
                            if ($r == 1) {
                                $for1[$k] = $for1[$k] + 1;
                            }
                        }
                    }
                }
            }

            $dataexport[$i]['name'] = 'RELATIVE PERFORMANCE';
            foreach ($arraydata as $k => $r) {
                if ($d[$k] * 5 != 0) {
                    $dataexport[$i][$k] = round(($para[$k] / ($d[$k] * 5)) * 100) . '%';
                } else {
                    $dataexport[$i][$k] = '-';  // or some other value that indicates undefined or not applicable
                }
            }
            $i++;

            $dataexport[$i]['name'] = 'MAXIMUM SCORE';
            foreach ($arraydata as $k => $r) {
                $dataexport[$i][$k] = $d[$k] * 5;
            }
            $i++;

            $dataexport[$i]['name'] = 'PARAMETER SCORE';
            foreach ($arraydata as $k => $r) {
                $dataexport[$i][$k] = $para[$k];
            }
            $i++;

            $dataexport[$i]['name'] = 'POSITIVE RATINGS RECIEVED';
            foreach ($arraydata as $k => $r) {
                $dataexport[$i][$k] = $p[$k];
            }
            $i++;

            $dataexport[$i]['name'] =  'NEGATIVE RATINGS RECIEVED';
            foreach ($arraydata as $k => $r) {
                $dataexport[$i][$k] = $n[$k];
            }
            $i++;


            $dataexport[$i]['name'] = 'TOTAL RESPONSES';
            foreach ($arraydata as $k => $r) {
                $dataexport[$i][$k] = $d[$k];
            }
            $i++;


            $dataexport[$i]['row1'] = '';
            $dataexport[$i]['row2'] = '';
            $dataexport[$i]['row3'] = '';
            $dataexport[$i]['row4'] = '';
            $i++;

            // $header1='sdgf';
            ob_end_clean();
            $fileName = 'EF- IPD DEPARTMENT WISE TICKET REPORT - ' . $tdate . ' to ' . $fdate . '.csv';
            header('Pragma: public');
            header('Expires: 0');
            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
            header('Cache-Control: private', false);
            header('Content-Type: text/csv');
            header('Content-Disposition: attachment;filename=' . $fileName);
            if (isset($dataexport[0])) {
                $fp = fopen('php://output', 'w');
                //print_r($header);
                fputcsv($fp, $header, ',');
                foreach ($dataexport as $values) {
                    //print_r($values); exit;
                    fputcsv($fp, $values, ',');
                }
                fclose($fp);
            }
            ob_flush();
            exit;
        } else {
            redirect('dashboard/noaccess');
        }
    }

    public function overall_pdf_report()
    {
        if ($this->session->userdata('isLogIn') == false)
            redirect('login');
        if (ismodule_active('QUALITY') === true) {

            $fdate = $_SESSION['from_date'];
            $tdate = $_SESSION['to_date'];
            redirect('pdfreport/ip_pdf_report?fdate=' . $tdate . '&tdate=' . $fdate);
            // redirect('report/ip_capa_report');

        } else {
            redirect('dashboard/noaccess');
        }
    }
}
